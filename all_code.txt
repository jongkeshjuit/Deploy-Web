===== FILE: ./backend/clear-products.js =====
const mongoose = require("mongoose");
const dotenv = require("dotenv");
const Product = require("./models/Product");

// Load env vars
dotenv.config();

// Connect to MongoDB
mongoose
  .connect(process.env.MONGO_URI, {
    useNewUrlParser: true,
    useUnifiedTopology: true,
  })
  .then(() => console.log("MongoDB connected"))
  .catch((err) => console.error("MongoDB connection error:", err));

// Clear all products
const clearAllProducts = async () => {
  try {
    console.log("ƒêang x√≥a t·∫•t c·∫£ s·∫£n ph·∫©m...");

    const result = await Product.deleteMany({});

    console.log(`‚úÖ ƒê√£ x√≥a th√†nh c√¥ng ${result.deletedCount} s·∫£n ph·∫©m`);
    console.log("Database ƒë√£ ƒë∆∞·ª£c l√†m s·∫°ch!");

    process.exit(0);
  } catch (error) {
    console.error(`‚ùå L·ªói khi x√≥a s·∫£n ph·∫©m: ${error.message}`);
    process.exit(1);
  }
};

// Run the clear function
clearAllProducts();


===== FILE: ./backend/config/db.js =====
const mongoose = require('mongoose');
// const connectDB = async () => {
//     try{
//         await mongoose.connect(process.env.MONGO_URI, {
//             useNewUrlParser: true,
//             useUnifiedTopology: true,
//         });
//         console.log('MongoDB connected successfully');
//     }
//     catch (error) {
//         console.error('MongoDB connection failed:', error.message);
//         process.exit(1); // Exit process with failure
//     }
// }
const connectDB = async () => {
    try {
        await mongoose.connect(process.env.MONGO_URI);
        console.log('MongoDB connected successfully');
    } catch (error) {
        console.error('MongoDB connection failed:', error.message);
        process.exit(1);
    }
}

module.exports = connectDB;
// Usage in server.js

===== FILE: ./backend/config/passport.js =====
const passport = require('passport');
const GoogleStrategy = require('passport-google-oauth20').Strategy;
const FacebookStrategy = require('passport-facebook').Strategy;
const User = require('../models/User');
const dotenv = require('dotenv');
dotenv.config();
// Google OAuth 2.0 Strategy
passport.use(new GoogleStrategy({
  clientID: process.env.GOOGLE_CLIENT_ID,
  clientSecret: process.env.GOOGLE_CLIENT_SECRET,
  callbackURL: process.env.GOOGLE_CALLBACK_URL
}, async (accessToken, refreshToken, profile, done) => {
  try {
    // Ki·ªÉm tra xem user ƒë√£ t·ªìn t·∫°i ch∆∞a
    let existingUser = await User.findOne({ googleId: profile.id });

    if (existingUser) {
      return done(null, existingUser);
    }

    // Ki·ªÉm tra email ƒë√£ ƒë∆∞·ª£c s·ª≠ d·ª•ng ch∆∞a
    let emailUser = await User.findOne({ email: profile.emails[0].value });

    if (emailUser) {
      // N·∫øu email ƒë√£ t·ªìn t·∫°i, li√™n k·∫øt v·ªõi Google account
      emailUser.googleId = profile.id;
      await emailUser.save();
      return done(null, emailUser);
    }

    // T·∫°o user m·ªõi
    const newUser = new User({
      googleId: profile.id,
      name: profile.displayName,
      email: profile.emails[0].value,
      // Kh√¥ng c·∫ßn password cho Google OAuth
      //password: 'google_oauth_user', // Placeholder password
      // T·∫°o random password an to√†n h∆°n
      password: `google_oauth_${Date.now()}_${Math.random().toString(36)}`,
      gender: 'other', // Default value
      profileImage: profile.photos[0]?.value
    });

    await newUser.save();
    done(null, newUser);

  } catch (error) {
    console.error('Google OAuth error:', error);
    done(error, null);
  }
}));

passport.serializeUser((user, done) => {
  done(null, user.id);
});

passport.deserializeUser(async (id, done) => {
  try {
    const user = await User.findById(id);
    done(null, user);
  } catch (error) {
    done(error, null);
  }
});
// Facebook 
passport.use(new FacebookStrategy({
  clientID: process.env.FACEBOOK_APP_ID,
  clientSecret: process.env.FACEBOOK_APP_SECRET,
  callbackURL: process.env.FACEBOOK_CALLBACK_URL,
  profileFields: ['id', 'displayName', 'email', 'photos']
}, async (accessToken, refreshToken, profile, done) => {
  try {
    let existingUser = await User.findOne({ facebookId: profile.id });

    if (existingUser) {
      return done(null, existingUser);
    }

    let emailUser = await User.findOne({ email: profile.emails?.[0]?.value });

    if (emailUser) {
      emailUser.facebookId = profile.id;
      await emailUser.save();
      return done(null, emailUser);
    }

    const newUser = new User({
      facebookId: profile.id,
      name: profile.displayName,
      email: profile.emails?.[0]?.value || `${profile.id}@facebook.com`,
      password: `facebook_oauth_${Date.now()}_${Math.random().toString(36)}`,
      gender: 'other',
      profileImage: profile.photos?.[0]?.value
    });

    await newUser.save();
    done(null, newUser);

  } catch (error) {
    console.error('Facebook OAuth error:', error);
    done(error, null);
  }
}));

passport.serializeUser((user, done) => {
  done(null, user.id);
});

passport.deserializeUser(async (id, done) => {
  try {
    const user = await User.findById(id);
    done(null, user);
  } catch (error) {
    done(error, null);
  }
});

module.exports = passport;

===== FILE: ./backend/data/collections.js =====
// backend/data/collections.js
const collections = [
  {
    id: "summer",
    name: "Summer Collection",
    bannerUrl:
      "https://images.unsplash.com/photo-1560472354-b33ff0c44a43?w=800&h=600&fit=crop",
    description:
      "B·ªô s∆∞u t·∫≠p m√πa h√® 2025 mang ƒë·∫øn l√†n gi√≥ m·ªõi v·ªõi nh·ªØng thi·∫øt k·∫ø tr·∫ª trung, nƒÉng ƒë·ªông v√† ƒë·∫ßy m√†u s·∫Øc, s·ª≠ d·ª•ng ch·∫•t li·ªáu nh·∫π m√°t, tho√°ng kh√≠, ph√π h·ª£p cho m·ªçi ho·∫°t ƒë·ªông ng√†y h√® ‚Äì t·ª´ d·∫°o ph·ªë, ƒëi bi·ªÉn ƒë·∫øn nh·ªØng bu·ªïi h·∫πn h√≤ ƒë·∫ßy c·∫£m h·ª©ng.",
    categories: ["√Åo ph√¥ng", "Qu·∫ßn short", "V√°y", "√Åo kho√°c nh·∫π"],
    products: [],
  },
  {
    id: "winter",
    name: "Winter Collection",
    bannerUrl:
      "https://images.unsplash.com/photo-1544966503-7cc4ac7b6201?w=800&h=600&fit=crop",
    description:
      "B·ªô s∆∞u t·∫≠p m√πa ƒë√¥ng 2025 l√† s·ª± k·∫øt h·ª£p gi·ªØa v·∫ª ƒë·∫πp hi·ªán ƒë·∫°i v√† c·∫£m gi√°c ·∫•m √°p, v·ªõi nh·ªØng thi·∫øt k·∫ø d√†y d·∫∑n, phom d√°ng √¥m v·ª´a v·∫∑n, gam m√†u trung t√≠nh sang tr·ªçng c√πng c√°c ch·∫•t li·ªáu nh∆∞ len, d·∫°, l√¥ng v√† n·ªâ cao c·∫•p ‚Äì mang ƒë·∫øn cho b·∫°n phong c√°ch tinh t·∫ø v√† t·ª± tin trong nh·ªØng ng√†y ƒë√¥ng l·∫°nh gi√°.",
    categories: ["√Åo len", "√Åo kho√°c", "Qu·∫ßn jean", "√Åo sweater"],
    products: [],
  },
  {
    id: "autumn",
    name: "Autumn Collection",
    bannerUrl:
      "https://images.unsplash.com/photo-1515372039744-b8f02a3ae446?w=800&h=600&fit=crop",
    description:
      "B·ªô s∆∞u t·∫≠p m√πa thu 2025 mang ƒë·∫øn h∆°i th·ªü d·ªãu d√†ng v√† s√¢u l·∫Øng c·ªßa th·ªùi kh·∫Øc chuy·ªÉn m√πa, v·ªõi nh·ªØng thi·∫øt k·∫ø tinh t·∫ø, gam m√†u ·∫•m √°p nh∆∞ n√¢u ƒë·∫•t, cam ch√°y, be nh·∫°t c√πng ch·∫•t li·ªáu m·ªÅm m·∫°i, gi·ªØ ·∫•m nh·∫π nh√†ng ‚Äì l√Ω t∆∞·ªüng cho nh·ªØng bu·ªïi chi·ªÅu se l·∫°nh ƒë·∫ßy c·∫£m x√∫c v√† phong c√°ch.",
    categories: ["√Åo s∆° mi", "Qu·∫ßn t√¢y", "√Åo blazer", "Ch√¢n v√°y"],
    products: [],
  },
  {
    id: "spring",
    name: "Spring Collection",
    bannerUrl:
      "https://images.unsplash.com/photo-1469334031218-e382a71b716b?w=800&h=600&fit=crop",
    description:
      "B·ªô s∆∞u t·∫≠p m√πa xu√¢n 2025 t∆∞∆°i m·ªõi nh∆∞ nh·ªØng c√°nh hoa ƒë·∫ßu m√πa, v·ªõi s·∫Øc m√†u r·ª±c r·ª°, thi·∫øt k·∫ø nh·∫π nh√†ng v√† tho·∫£i m√°i, mang ƒë·∫øn c·∫£m gi√°c t∆∞∆°i tr·∫ª v√† ƒë·∫ßy nƒÉng l∆∞·ª£ng cho nh·ªØng ng√†y xu√¢n ·∫•m √°p.",
    categories: ["√Åo ph√¥ng", "Qu·∫ßn jean", "V√°y", "√Åo kho√°c nh·∫π"],
    products: [],
  },
  {
    id: "man",
    name: "ƒê·ªì Nam",
    bannerUrl:
      "https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=800&h=600&fit=crop",
    description:
      "B·ªô s∆∞u t·∫≠p th·ªùi trang nam hi·ªán ƒë·∫°i, thanh l·ªãch v√† m·∫°nh m·∫Ω. T·ª´ √°o s∆° mi c√¥ng s·ªü ƒë·∫øn trang ph·ª•c casual cu·ªëi tu·∫ßn, t·∫•t c·∫£ ƒë·ªÅu ƒë∆∞·ª£c thi·∫øt k·∫ø ƒë·ªÉ t√¥n l√™n v·∫ª ƒë·∫πp v√† phong c√°ch ri√™ng c·ªßa ph√°i m·∫°nh.",
    categories: ["√Åo s∆° mi", "Qu·∫ßn t√¢y", "√Åo polo", "√Åo kho√°c"],
    products: [],
  },
  {
    id: "women",
    name: "ƒê·ªì N·ªØ",
    bannerUrl:
      "https://images.unsplash.com/photo-1566479179817-7c3c8c86e2e1?w=800&h=600&fit=crop",
    description:
      "B·ªô s∆∞u t·∫≠p th·ªùi trang n·ªØ ƒëa d·∫°ng v√† quy·∫øn r≈©. T·ª´ nh·ªØng thi·∫øt k·∫ø n·ªØ t√≠nh, thanh l·ªãch ƒë·∫øn phong c√°ch hi·ªán ƒë·∫°i, c√° t√≠nh, m·ªói m√≥n ƒë·ªì ƒë·ªÅu ƒë∆∞·ª£c chƒÉm ch√∫t ƒë·ªÉ t√¥n vinh v·∫ª ƒë·∫πp c·ªßa ng∆∞·ªùi ph·ª• n·ªØ Vi·ªát.",
    categories: ["V√°y", "√Åo s∆° mi", "Qu·∫ßn jean", "√Åo blazer"],
    products: [],
  },
];

module.exports = collections;


===== FILE: ./backend/data/dataManager.js =====
// backend/data/dataManager.js
const users = require('./users');
const products = require('./products');
const collections = require('./collections');
const cloudinary = require('cloudinary').v2;
const fs = require('fs');
const path = require('path');

// C·∫•u h√¨nh Cloudinary (n·∫øu s·ª≠ d·ª•ng)
if (process.env.CLOUDINARY_CLOUD_NAME) {
  cloudinary.config({
    cloud_name: process.env.CLOUDINARY_CLOUD_NAME,
    api_key: process.env.CLOUDINARY_API_KEY,
    api_secret: process.env.CLOUDINARY_API_SECRET,
  });
}

class DataManager {
  constructor() {
    this.users = users;
    this.products = products;
    this.collections = collections;
  }

  // ================== USER MANAGEMENT ==================
  getUsers() {
    return this.users;
  }

  createSampleUsers() {
    // L√†m s·∫°ch d·ªØ li·ªáu users hi·ªán c√≥ (x√≥a _id, id kh√¥ng h·ª£p l·ªá)
    const cleanedUsers = this.users.map(user => {
      const { _id, id, ...cleanUser } = user; // X√≥a _id v√† id
      return {
        ...cleanUser,
        // ƒê·∫£m b·∫£o c√≥ ƒë·∫ßy ƒë·ªß c√°c tr∆∞·ªùng b·∫Øt bu·ªôc
        name: cleanUser.name || 'Unknown User',
        email: cleanUser.email || `user${Date.now()}@example.com`,
        password: cleanUser.password || '123456',
        role: cleanUser.role || 'customer'
      };
    });

    // T·∫°o th√™m users m·∫´u n·∫øu c·∫ßn
    const additionalUsers = [
      {
        name: "Sample Customer 1",
        email: "customer1@example.com",
        password: "123456",
        role: "customer",
        gender: "male",
        phone: "0901234567",
        address: "123 Nguyen Hue St",
        city: "Ho Chi Minh",
        district: "District 1",
        ward: "Ben Nghe Ward",
        birth: new Date('1995-06-15')
      },
      {
        name: "Sample Customer 2", 
        email: "customer2@example.com",
        password: "123456",
        role: "customer",
        gender: "female",
        phone: "0907654321",
        address: "456 Le Loi St",
        city: "Ho Chi Minh",
        district: "District 3", 
        ward: "Ward 1",
        birth: new Date('1992-08-22')
      }
    ];

    return [...cleanedUsers, ...additionalUsers];
  }

  // ================== COLLECTION MANAGEMENT ==================
  getCollections() {
    return this.collections;
  }

  createSampleCollections() {
    const sampleCollections = [
      {
        id: "summer",
        name: "Summer Collection",
        bannerUrl: "https://images.unsplash.com/photo-1560472354-b33ff0c44a43?w=800&h=600&fit=crop",
        description: "B·ªô s∆∞u t·∫≠p m√πa h√® 2025 mang ƒë·∫øn l√†n gi√≥ m·ªõi v·ªõi nh·ªØng thi·∫øt k·∫ø tr·∫ª trung, nƒÉng ƒë·ªông v√† ƒë·∫ßy m√†u s·∫Øc, s·ª≠ d·ª•ng ch·∫•t li·ªáu nh·∫π m√°t, tho√°ng kh√≠, ph√π h·ª£p cho m·ªçi ho·∫°t ƒë·ªông ng√†y h√®.",
        products: []
      },
      {
        id: "winter", 
        name: "Winter Collection",
        bannerUrl: "https://images.unsplash.com/photo-1544966503-7cc4ac7b6201?w=800&h=600&fit=crop",
        description: "B·ªô s∆∞u t·∫≠p m√πa ƒë√¥ng 2025 l√† s·ª± k·∫øt h·ª£p gi·ªØa v·∫ª ƒë·∫πp hi·ªán ƒë·∫°i v√† c·∫£m gi√°c ·∫•m √°p, v·ªõi nh·ªØng thi·∫øt k·∫ø d√†y d·∫∑n, phom d√°ng √¥m v·ª´a v·∫∑n.",
        products: []
      },
      {
        id: "autumn",
        name: "Autumn Collection", 
        bannerUrl: "https://images.unsplash.com/photo-1515372039744-b8f02a3ae446?w=800&h=600&fit=crop",
        description: "B·ªô s∆∞u t·∫≠p m√πa thu 2025 mang ƒë·∫øn h∆°i th·ªü d·ªãu d√†ng v√† s√¢u l·∫Øng c·ªßa th·ªùi kh·∫Øc chuy·ªÉn m√πa.",
        products: []
      },
      {
        id: "spring",
        name: "Spring Collection",
        bannerUrl: "https://images.unsplash.com/photo-1469334031218-e382a71b716b?w=800&h=600&fit=crop", 
        description: "B·ªô s∆∞u t·∫≠p m√πa xu√¢n 2025 t∆∞∆°i m·ªõi v·ªõi s·∫Øc m√†u r·ª±c r·ª° v√† thi·∫øt k·∫ø nh·∫π nh√†ng.",
        products: []
      }
    ];

    return sampleCollections;
  }

  // ================== PRODUCT MANAGEMENT ==================
  getProducts() {
    return this.products;
  }

  // H√†m upload ·∫£nh l√™n Cloudinary (t√πy ch·ªçn)
  async uploadImageToCloudinary(imageUrl, folder = 'wukudada-products') {
    try {
      if (!process.env.CLOUDINARY_CLOUD_NAME) {
        console.log('‚ö†Ô∏è Cloudinary ch∆∞a ƒë∆∞·ª£c c·∫•u h√¨nh, s·ª≠ d·ª•ng URL g·ªëc t·ª´ Unsplash');
        return imageUrl;
      }

      console.log(`üì§ ƒêang upload: ${imageUrl}`);
      const result = await cloudinary.uploader.upload(imageUrl, {
        folder: folder,
        public_id: `product_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`,
        overwrite: true,
        resource_type: "image",
        transformation: [
          { width: 500, height: 600, crop: "fill" },
          { quality: "auto", format: "auto" }
        ]
      });

      console.log(`‚úÖ Upload th√†nh c√¥ng: ${result.secure_url}`);
      return result.secure_url;
    } catch (error) {
      console.error(`‚ùå L·ªói upload ·∫£nh: ${error.message}`);
      console.log(`üîÑ Fallback: s·ª≠ d·ª•ng URL g·ªëc t·ª´ Unsplash`);
      return imageUrl; // Fallback v·ªÅ URL g·ªëc t·ª´ Unsplash
    }
  }

  // X·ª≠ l√Ω ·∫£nh cho products (c√≥ th·ªÉ upload ho·∫∑c gi·ªØ nguy√™n)
  async processProductImages(products, uploadToCloudinary = false) {
    console.log(`üîÑ ƒêang x·ª≠ l√Ω ${products.length} s·∫£n ph·∫©m...`);
    
    for (let i = 0; i < products.length; i++) {
      const product = products[i];
      
      if (uploadToCloudinary && product.images && product.images.length > 0) {
        console.log(`üì∑ X·ª≠ l√Ω ·∫£nh cho s·∫£n ph·∫©m: ${product.name}`);
        
        for (let j = 0; j < product.images.length; j++) {
          const currentUrl = product.images[j].url;
          product.images[j].url = await this.uploadImageToCloudinary(currentUrl);
          
          // Th√™m delay nh·ªè ƒë·ªÉ tr√°nh rate limit
          await new Promise(resolve => setTimeout(resolve, 500));
        }
      }
    }

    return products;
  }

  // T·∫°o products v·ªõi ·∫£nh sample t·ª´ Unsplash
  createSampleProducts() {
    // L√†m s·∫°ch d·ªØ li·ªáu products hi·ªán c√≥
    const cleanedProducts = this.products.map(product => {
      const { _id, ...cleanProduct } = product; // X√≥a _id ƒë·ªÉ MongoDB t·ª± t·∫°o
      return cleanProduct;
    });

    const sampleProducts = [
      {
        name: "√Åo Thun Nam Basic Premium",
        description: "√Åo thun nam basic ch·∫•t li·ªáu cotton cao c·∫•p, form regular fit tho·∫£i m√°i, ph√π h·ª£p m·∫∑c h√†ng ng√†y v√† d·∫°o ph·ªë.",
        price: 350000,
        discountPrice: 299000,
        countInStock: 100,
        sku: `AT-NAM-${Date.now()}-001`,
        // sku: `AT-NAM-PREMIUM-${Date.now()}`, 
        category: "√Åo ph√¥ng",
        brand: "Wukudada",
        sizes: ["S", "M", "L", "XL", "XXL"],
        colors: ["ƒêen", "Tr·∫Øng", "X√°m", "Navy"],
        collection: "summer",
        material: "100% Cotton",
        gender: "Men",
        images: [
          {
            url: "https://images.unsplash.com/photo-1521572163474-6864f9cf17ab?w=500&h=600&fit=crop",
            altText: "√Åo thun nam basic ƒëen"
          },
          {
            url: "https://images.unsplash.com/photo-1583743814966-8936f37f27bf?w=500&h=600&fit=crop", 
            altText: "√Åo thun nam basic tr·∫Øng"
          }
        ],
        isFeatured: true,
        isPublished: true,
        rating: 4.5,
        numReviews: 125,
        tags: ["basic", "cotton", "nam", "h√†ng ng√†y"],
        metaTitle: "√Åo Thun Nam Basic Premium - Wukudada",
        metaDescription: "√Åo thun nam basic cotton cao c·∫•p, form regular fit tho·∫£i m√°i",
        metaKeywords: ["√°o thun nam", "basic", "cotton"],
        dimensions: {
          length: 70,
          width: 52, 
          height: 1,
          weight: 0.25
        }
      },
      {
        name: "V√°y Midi N·ªØ Elegant", 
        description: "V√°y midi n·ªØ thi·∫øt k·∫ø thanh l·ªãch, ch·∫•t li·ªáu chiffon m·ªÅm m·∫°i, form A-line t√¥n d√°ng, ph√π h·ª£p d·ª± ti·ªác.",
        price: 750000,
        discountPrice: 649000,
        countInStock: 50,
        sku: `V-NU-${Date.now()}-002`,
        category: "V√°y",
        brand: "Wukudada", 
        sizes: ["XS", "S", "M", "L", "XL"],
        colors: ["ƒêen", "Navy", "ƒê·ªè ƒë√¥"],
        collection: "autumn",
        material: "100% Chiffon",
        gender: "Women",
        images: [
          {
            url: "https://images.unsplash.com/photo-1566479179817-7c3c8c86e2e1?w=500&h=600&fit=crop",
            altText: "V√°y midi n·ªØ elegant ƒëen"
          }
        ],
        isFeatured: true,
        isPublished: true,
        rating: 4.8,
        numReviews: 89,
        tags: ["v√°y", "midi", "elegant", "chiffon"],
        metaTitle: "V√°y Midi N·ªØ Elegant - Wukudada",
        metaDescription: "V√°y midi n·ªØ chiffon m·ªÅm m·∫°i, form A-line t√¥n d√°ng",
        metaKeywords: ["v√°y midi", "elegant", "chiffon"],
        dimensions: {
          length: 85,
          width: 45,
          height: 1, 
          weight: 0.3
        }
      },
      {
        name: "Qu·∫ßn Jean Nam Slim Fit",
        description: "Qu·∫ßn jean nam form slim fit, ch·∫•t li·ªáu denim cao c·∫•p co gi√£n nh·∫π, t√¥n d√°ng v√† tho·∫£i m√°i.",
        price: 850000,
        discountPrice: 749000,
        countInStock: 75,
        sku: `QJ-NAM-${Date.now()}-003`,
        category: "Qu·∫ßn jean", 
        brand: "Wukudada",
        sizes: ["28", "29", "30", "31", "32", "33", "34"],
        colors: ["Xanh ƒë·∫≠m", "ƒêen", "Xanh nh·∫°t"],
        collection: "winter",
        material: "98% Cotton, 2% Spandex",
        gender: "Men",
        images: [
          {
            url: "https://images.unsplash.com/photo-1542272604-787c3835535d?w=500&h=600&fit=crop",
            altText: "Qu·∫ßn jean nam slim fit xanh ƒë·∫≠m"
          }
        ],
        isFeatured: false,
        isPublished: true,
        rating: 4.6,
        numReviews: 156,
        tags: ["jean", "slim fit", "nam", "denim"],
        metaTitle: "Qu·∫ßn Jean Nam Slim Fit - Wukudada", 
        metaDescription: "Qu·∫ßn jean nam slim fit denim cao c·∫•p, t√¥n d√°ng",
        metaKeywords: ["qu·∫ßn jean nam", "slim fit", "denim"],
        dimensions: {
          length: 105,
          width: 38,
          height: 2,
          weight: 0.6
        }
      }
    ];

    return [...cleanedProducts, ...sampleProducts];
  }

  // ================== MAIN PROCESSING METHODS ==================
  
  // L·∫•y t·∫•t c·∫£ d·ªØ li·ªáu ƒë√£ x·ª≠ l√Ω
  async getAllData(options = {}) {
    const {
      uploadImages = false,
      includeExistingData = true,
      createSamples = true
    } = options;

    console.log('üöÄ DataManager: B·∫Øt ƒë·∫ßu x·ª≠ l√Ω d·ªØ li·ªáu...');

    // L·∫•y users
    const users = includeExistingData ? this.getUsers() : [];
    const finalUsers = createSamples ? this.createSampleUsers() : users;

    // L·∫•y collections  
    const collections = includeExistingData ? this.getCollections() : [];
    const finalCollections = createSamples ? this.createSampleCollections() : collections;

    // L·∫•y v√† x·ª≠ l√Ω products
    const products = includeExistingData ? this.getProducts() : [];
    const sampleProducts = createSamples ? this.createSampleProducts() : [];
    const allProducts = [...products, ...sampleProducts];
    
    const finalProducts = await this.processProductImages(allProducts, uploadImages);

    console.log('‚úÖ DataManager: Ho√†n th√†nh x·ª≠ l√Ω d·ªØ li·ªáu');
    console.log(`üìä Th·ªëng k√™: ${finalUsers.length} users, ${finalCollections.length} collections, ${finalProducts.length} products`);

    return {
      users: finalUsers,
      collections: finalCollections, 
      products: finalProducts
    };
  }

  // Ph∆∞∆°ng th·ª©c l∆∞u v√†o file JSON (backup)
  async saveToFile(data, filename = 'processed-data.json') {
    try {
      const filePath = path.join(__dirname, filename);
      await fs.promises.writeFile(filePath, JSON.stringify(data, null, 2), 'utf8');
      console.log(`üíæ ƒê√£ l∆∞u d·ªØ li·ªáu v√†o: ${filePath}`);
    } catch (error) {
      console.error(`‚ùå L·ªói l∆∞u file: ${error.message}`);
    }
  }
}

module.exports = new DataManager();

===== FILE: ./backend/data/products.js =====
const products = [
  // ========== √ÅO PH√îNG NAM ==========
  {
    name: "√Åo Thun Nam Basic Cotton",
    description: "√Åo thun nam basic t·ª´ ch·∫•t li·ªáu cotton 100% tho√°ng m√°t, form regular fit tho·∫£i m√°i, ph√π h·ª£p m·∫∑c h√†ng ng√†y.",
    price: 299000,
    discountPrice: 249000,
    countInStock: 50,
    sku: "AT-NAM-BASIC-001",
    category: "√Åo ph√¥ng",
    brand: "Wukudada",
    sizes: ["S", "M", "L", "XL", "XXL"],
    colors: ["ƒêen"],
    collection: "summer",
    material: "100% Cotton",
    gender: "Men",
    images: [
      {
        url: "https://images.unsplash.com/photo-1521572163474-6864f9cf17ab?w=500&h=600&fit=crop",
        altText: "√Åo thun nam ƒëen basic"
      },
      {
        url: "https://images.unsplash.com/photo-1583743814966-8936f37f27bf?w=500&h=600&fit=crop",
        altText: "√Åo thun nam ƒëen - g√≥c nghi√™ng"
      }
    ],
    isFeatured: true,
    isPublished: true,
    rating: 4.5,
    numReviews: 89,
    tags: ["basic", "cotton", "nam", "h√†ng ng√†y"],
    metaTitle: "√Åo Thun Nam Basic Cotton - Tho·∫£i M√°i H√†ng Ng√†y",
    metaDescription: "√Åo thun nam basic cotton 100%, form regular fit, m√†u ƒëen c∆° b·∫£n, ph√π h·ª£p m·ªçi phong c√°ch.",
    metaKeywords: ["√°o thun nam", "basic", "cotton", "ƒëen"],
    dimensions: {
      length: 70,
      width: 52,
      height: 1,
      weight: 0.2
    }
  },

  // ========== TH√äM S·∫¢N PH·∫®M Summer ==========
  {
    name: "√Åo Tank Top Nam Summer",
    description: "√Åo tank top nam ch·∫•t li·ªáu cotton th·∫•m h√∫t m·ªì h√¥i, thi·∫øt k·∫ø ƒë∆°n gi·∫£n tho·∫£i m√°i cho m√πa h√®.",
    price: 199000,
    discountPrice: 169000,
    countInStock: 70,
    sku: "TT-NAM-SUM-016",
    category: "√Åo ph√¥ng",
    brand: "Wukudada",
    sizes: ["S", "M", "L", "XL", "XXL"],
    colors: ["Tr·∫Øng"],
    collection: "summer",
    material: "100% Cotton",
    gender: "Men",
    images: [
      {
        url: "https://images.unsplash.com/photo-1581803118522-7b72a50f7e9f?w=500&h=600&fit=crop",
        altText: "√Åo tank top nam tr·∫Øng"
      }
    ],
    isFeatured: true,
    isPublished: true,
    rating: 4.3,
    numReviews: 54,
    tags: ["tank top", "summer", "nam", "cotton"],
    metaTitle: "√Åo Tank Top Nam Summer - M√°t M·∫ª Tho·∫£i M√°i",
    metaDescription: "√Åo tank top nam cotton tho√°ng m√°t, thi·∫øt k·∫ø ƒë∆°n gi·∫£n cho m√πa h√®.",
    metaKeywords: ["tank top nam", "summer", "cotton", "tr·∫Øng"],
    dimensions: {
      length: 65,
      width: 50,
      height: 1,
      weight: 0.15
    }
  },

  {
    name: "Qu·∫ßn Short N·ªØ Linen Summer",
    description: "Qu·∫ßn short n·ªØ ch·∫•t li·ªáu linen tho√°ng m√°t, form A-line tho·∫£i m√°i, m√†u pastel d·ªÖ th∆∞∆°ng cho m√πa h√®.",
    price: 349000,
    discountPrice: 299000,
    countInStock: 45,
    sku: "QS-NU-LIN-017",
    category: "Qu·∫ßn short",
    brand: "Wukudada",
    sizes: ["XS", "S", "M", "L", "XL"],
    colors: ["Pastel"],
    collection: "summer",
    material: "100% Linen",
    gender: "Women",
    images: [
      {
        url: "https://images.unsplash.com/photo-1594633312681-425c7b97ccd1?w=500&h=600&fit=crop",
        altText: "Qu·∫ßn short n·ªØ linen pastel"
      }
    ],
    isFeatured: true,
    isPublished: true,
    rating: 4.6,
    numReviews: 78,
    tags: ["short", "linen", "n·ªØ", "summer"],
    metaTitle: "Qu·∫ßn Short N·ªØ Linen - M√°t M·∫ª M√πa H√®",
    metaDescription: "Qu·∫ßn short n·ªØ linen tho√°ng m√°t, form A-line tho·∫£i m√°i cho m√πa h√®.",
    metaKeywords: ["qu·∫ßn short n·ªØ", "linen", "summer", "pastel"],
    dimensions: {
      length: 38,
      width: 34,
      height: 2,
      weight: 0.2
    }
  },

  // ========== TH√äM S·∫¢N PH·∫®M WINTER COLLECTION ==========
  {
    name: "√Åo Len Nam Turtleneck",
    description: "√Åo len nam c·ªï l·ªç ·∫•m √°p, ch·∫•t li·ªáu wool blend cao c·∫•p, thi·∫øt k·∫ø sang tr·ªçng cho m√πa ƒë√¥ng.",
    price: 899000,
    discountPrice: 799000,
    countInStock: 25,
    sku: "AL-NAM-TN-018",
    category: "√Åo kho√°c",
    brand: "Wukudada",
    sizes: ["S", "M", "L", "XL", "XXL"],
    colors: ["X√°m ƒë·∫≠m"],
    collection: "winter",
    material: "70% Wool, 30% Acrylic",
    gender: "Men",
    images: [
      {
        url: "https://images.unsplash.com/photo-1617127365659-c47fa864d8bc?w=500&h=600&fit=crop",
        altText: "√Åo len nam turtleneck x√°m ƒë·∫≠m"
      }
    ],
    isFeatured: true,
    isPublished: true,
    rating: 4.8,
    numReviews: 67,
    tags: ["len", "turtleneck", "nam", "winter"],
    metaTitle: "√Åo Len Nam Turtleneck - ·∫§m √Åp M√πa ƒê√¥ng",
    metaDescription: "√Åo len nam c·ªï l·ªç wool blend, thi·∫øt k·∫ø sang tr·ªçng cho m√πa ƒë√¥ng.",
    metaKeywords: ["√°o len nam", "turtleneck", "wool", "winter"],
    dimensions: {
      length: 68,
      width: 56,
      height: 3,
      weight: 0.45
    }
  },

  // ========== TH√äM S·∫¢N PH·∫®M AUTUMN COLLECTION ==========
  {
    name: "√Åo Cardigan N·ªØ Autumn",
    description: "√Åo cardigan n·ªØ m·ªÅm m·∫°i, m√†u n√¢u ƒë·∫•t ·∫•m √°p, ph√π h·ª£p layering cho m√πa thu se l·∫°nh.",
    price: 699000,
    discountPrice: 599000,
    countInStock: 30,
    sku: "AC-NU-AUT-019",
    category: "√Åo kho√°c",
    brand: "Wukudada",
    sizes: ["XS", "S", "M", "L", "XL"],
    colors: ["N√¢u ƒë·∫•t"],
    collection: "autumn",
    material: "60% Acrylic, 40% Cotton",
    gender: "Women",
    images: [
      {
        url: "https://images.unsplash.com/photo-1544966503-7cc4ac7b6201?w=500&h=600&fit=crop",
        altText: "√Åo cardigan n·ªØ n√¢u ƒë·∫•t"
      }
    ],
    isFeatured: true,
    isPublished: true,
    rating: 4.7,
    numReviews: 89,
    tags: ["cardigan", "n·ªØ", "autumn", "layering"],
    metaTitle: "√Åo Cardigan N·ªØ Autumn - ·∫§m √Åp M√πa Thu",
    metaDescription: "√Åo cardigan n·ªØ m·ªÅm m·∫°i, m√†u n√¢u ƒë·∫•t cho m√πa thu se l·∫°nh.",
    metaKeywords: ["cardigan n·ªØ", "autumn", "n√¢u ƒë·∫•t", "layering"],
    dimensions: {
      length: 65,
      width: 52,
      height: 2,
      weight: 0.4
    }
  },
  {
    name: "√Åo Thun Nam Polo Pique",
    description: "√Åo polo nam ch·∫•t li·ªáu pique cao c·∫•p, c√≥ c·ªï b·∫ª v√† t√∫i ng·ª±c, thi·∫øt k·∫ø l·ªãch s·ª± ph√π h·ª£p ƒëi l√†m.",
    price: 449000,
    discountPrice: 399000,
    countInStock: 35,
    sku: "AT-NAM-POLO-002",
    category: "√Åo ph√¥ng",
    brand: "Wukudada",
    sizes: ["S", "M", "L", "XL", "XXL"],
    colors: ["Tr·∫Øng"],
    collection: "winter",
    material: "Pique Cotton",
    gender: "Men",
    images: [
      {
        url: "https://images.unsplash.com/photo-1594938328870-28be026b5a06?w=500&h=600&fit=crop",
        altText: "√Åo polo nam tr·∫Øng"
      }
    ],
    isFeatured: true,
    isPublished: true,
    rating: 4.3,
    numReviews: 45,
    tags: ["polo", "formal", "nam", "c√¥ng s·ªü"],
    metaTitle: "√Åo Polo Nam Pique - L·ªãch S·ª± C√¥ng S·ªü",
    metaDescription: "√Åo polo nam ch·∫•t li·ªáu pique cao c·∫•p, thi·∫øt k·∫ø l·ªãch s·ª± cho m√¥i tr∆∞·ªùng c√¥ng s·ªü.",
    metaKeywords: ["√°o polo nam", "pique", "c√¥ng s·ªü", "tr·∫Øng"],
    dimensions: {
      length: 72,
      width: 54,
      height: 1,
      weight: 0.25
    }
  },

  // ========== √ÅO PH√îNG N·ªÆ ==========
  {
    name: "√Åo Thun N·ªØ Crop Top",
    description: "√Åo thun n·ªØ form crop top trendy, ch·∫•t li·ªáu cotton pha spandex co gi√£n nh·∫π, ph√π h·ª£p ph·ªëi v·ªõi qu·∫ßn high waist.",
    price: 249000,
    discountPrice: 199000,
    countInStock: 60,
    sku: "AT-NU-CROP-003",
    category: "√Åo ph√¥ng",
    brand: "Wukudada",
    sizes: ["XS", "S", "M", "L", "XL"],
    colors: ["H·ªìng"],
    collection: "autumn",
    material: "95% Cotton, 5% Spandex",
    gender: "Women",
    images: [
      {
        url: "https://images.unsplash.com/photo-1618354691373-d851c5c3a990?w=500&h=600&fit=crop",
        altText: "√Åo crop top n·ªØ m√†u h·ªìng"
      }
    ],
    isFeatured: true,
    isPublished: true,
    rating: 4.7,
    numReviews: 76,
    tags: ["crop top", "trendy", "n·ªØ", "th·ªùi trang"],
    metaTitle: "√Åo Crop Top N·ªØ - Phong C√°ch Tr·∫ª Trung",
    metaDescription: "√Åo crop top n·ªØ cotton co gi√£n, thi·∫øt k·∫ø trendy cho phong c√°ch tr·∫ª trung, nƒÉng ƒë·ªông.",
    metaKeywords: ["crop top n·ªØ", "cotton", "trendy", "h·ªìng"],
    dimensions: {
      length: 45,
      width: 40,
      height: 1,
      weight: 0.15
    }
  },

  // ========== QU·∫¶N JEAN NAM ==========
  {
    name: "Qu·∫ßn Jean Nam Slim Fit",
    description: "Qu·∫ßn jean nam form slim fit, ch·∫•t li·ªáu denim cao c·∫•p co gi√£n nh·∫π, t√¥n d√°ng v√† tho·∫£i m√°i khi v·∫≠n ƒë·ªông.",
    price: 699000,
    discountPrice: 599000,
    countInStock: 40,
    sku: "QJ-NAM-SLIM-004",
    category: "Qu·∫ßn jean",
    brand: "Wukudada",
    sizes: ["28", "29", "30", "31", "32", "33", "34"],
    colors: ["Xanh ƒë·∫≠m"],
    collection: "man",
    material: "98% Cotton, 2% Spandex",
    gender: "Men",
    images: [
      {
        url: "https://images.unsplash.com/photo-1542272604-787c3835535d?w=500&h=600&fit=crop",
        altText: "Qu·∫ßn jean nam slim fit xanh ƒë·∫≠m"
      }
    ],
    isFeatured: true,
    isPublished: true,
    rating: 4.6,
    numReviews: 92,
    tags: ["jean", "slim fit", "nam", "denim"],
    metaTitle: "Qu·∫ßn Jean Nam Slim Fit - Phong C√°ch Hi·ªán ƒê·∫°i",
    metaDescription: "Qu·∫ßn jean nam slim fit ch·∫•t l∆∞·ª£ng cao, form chu·∫©n t√¥n d√°ng, ph√π h·ª£p m·ªçi phong c√°ch.",
    metaKeywords: ["qu·∫ßn jean nam", "slim fit", "denim", "xanh ƒë·∫≠m"],
    dimensions: {
      length: 100,
      width: 35,
      height: 2,
      weight: 0.6
    }
  },

  // ========== QU·∫¶N JEAN N·ªÆ ==========
  {
    name: "Qu·∫ßn Jean N·ªØ High Waist",
    description: "Qu·∫ßn jean n·ªØ c·∫°p cao t√¥n d√°ng, form skinny √¥m v·ª´a v·∫∑n, ph√π h·ª£p v·ªõi m·ªçi v√≥c d√°ng v√† ƒë·ªô tu·ªïi.",
    price: 649000,
    discountPrice: 549000,
    countInStock: 45,
    sku: "QJ-NU-HIGH-005",
    category: "Qu·∫ßn jean",
    brand: "Wukudada",
    sizes: ["25", "26", "27", "28", "29", "30", "31"],
    colors: ["Xanh nh·∫°t"],
    collection: "feminine",
    material: "92% Cotton, 6% Polyester, 2% Elastane",
    gender: "Women",
    images: [
      {
        url: "https://images.unsplash.com/photo-1551048632-d6b8ce3d07d1?w=500&h=600&fit=crop",
        altText: "Qu·∫ßn jean n·ªØ high waist xanh nh·∫°t"
      }
    ],
    isFeatured: true,
    isPublished: true,
    rating: 4.8,
    numReviews: 134,
    tags: ["jean", "high waist", "n·ªØ", "skinny"],
    metaTitle: "Qu·∫ßn Jean N·ªØ High Waist - T√¥n D√°ng Ho√†n H·∫£o",
    metaDescription: "Qu·∫ßn jean n·ªØ c·∫°p cao skinny fit, t√¥n d√°ng tuy·ªát ƒë·ªëi cho ph√°i ƒë·∫πp.",
    metaKeywords: ["qu·∫ßn jean n·ªØ", "high waist", "skinny", "xanh nh·∫°t"],
    dimensions: {
      length: 95,
      width: 32,
      height: 2,
      weight: 0.5
    }
  },

  // ========== √ÅO KHO√ÅC NAM ==========
  {
    name: "√Åo Kho√°c Bomber Nam",
    description: "√Åo kho√°c bomber nam phong c√°ch streetwear, ch·∫•t li·ªáu polyester ch·ªëng gi√≥ nh·∫π, thi·∫øt k·∫ø nƒÉng ƒë·ªông.",
    price: 899000,
    discountPrice: 749000,
    countInStock: 25,
    sku: "AK-NAM-BOMBER-006",
    category: "√Åo kho√°c",
    brand: "Wukudada",
    sizes: ["S", "M", "L", "XL", "XXL"],
    colors: ["ƒêen"],
    collection: "street",
    material: "100% Polyester",
    gender: "Men",
    images: [
      {
        url: "https://images.unsplash.com/photo-1551028719-00167b16eac5?w=500&h=600&fit=crop",
        altText: "√Åo kho√°c bomber nam ƒëen"
      }
    ],
    isFeatured: false,
    isPublished: true,
    rating: 4.4,
    numReviews: 58,
    tags: ["bomber", "streetwear", "nam", "kho√°c"],
    metaTitle: "√Åo Kho√°c Bomber Nam - Phong C√°ch Streetwear",
    metaDescription: "√Åo kho√°c bomber nam ch·∫•t li·ªáu cao c·∫•p, thi·∫øt k·∫ø streetwear hi·ªán ƒë·∫°i.",
    metaKeywords: ["√°o kho√°c bomber", "streetwear", "nam", "ƒëen"],
    dimensions: {
      length: 65,
      width: 58,
      height: 3,
      weight: 0.4
    }
  },

  // ========== √ÅO KHO√ÅC N·ªÆ ==========
  {
    name: "√Åo Blazer N·ªØ C√¥ng S·ªü",
    description: "√Åo blazer n·ªØ thi·∫øt k·∫ø thanh l·ªãch cho m√¥i tr∆∞·ªùng c√¥ng s·ªü, ch·∫•t li·ªáu polyester pha viscose m·ªÅm m·∫°i.",
    price: 1299000,
    discountPrice: 1099000,
    countInStock: 20,
    sku: "AK-NU-BLAZER-007",
    category: "√Åo kho√°c",
    brand: "Wukudada",
    sizes: ["XS", "S", "M", "L", "XL"],
    colors: ["X√°m"],
    collection: "office",
    material: "70% Polyester, 30% Viscose",
    gender: "Women",
    images: [
      {
        url: "https://images.unsplash.com/photo-1594633312681-425c7b97ccd1?w=500&h=600&fit=crop",
        altText: "√Åo blazer n·ªØ x√°m c√¥ng s·ªü"
      }
    ],
    isFeatured: true,
    isPublished: true,
    rating: 4.7,
    numReviews: 41,
    tags: ["blazer", "c√¥ng s·ªü", "n·ªØ", "formal"],
    metaTitle: "√Åo Blazer N·ªØ C√¥ng S·ªü - Thanh L·ªãch Chuy√™n Nghi·ªáp",
    metaDescription: "√Åo blazer n·ªØ thi·∫øt k·∫ø thanh l·ªãch, ch·∫•t li·ªáu cao c·∫•p cho m√¥i tr∆∞·ªùng c√¥ng s·ªü.",
    metaKeywords: ["√°o blazer n·ªØ", "c√¥ng s·ªü", "thanh l·ªãch", "x√°m"],
    dimensions: {
      length: 60,
      width: 48,
      height: 2,
      weight: 0.35
    }
  },

  // ========== V√ÅY N·ªÆ ==========
  {
    name: "V√°y Midi N·ªØ A-Line",
    description: "V√°y midi n·ªØ form A-line thanh l·ªãch, ch·∫•t li·ªáu chiffon nh·∫π nh√†ng, ph√π h·ª£p d·ª± ti·ªác v√† ƒëi l√†m.",
    price: 799000,
    discountPrice: 649000,
    countInStock: 30,
    sku: "V-NU-MIDI-008",
    category: "V√°y",
    brand: "Wukudada",
    sizes: ["XS", "S", "M", "L", "XL"],
    colors: ["Navy"],
    collection: "elegant",
    material: "100% Chiffon",
    gender: "Women",
    images: [
      {
        url: "https://images.unsplash.com/photo-1595777457583-95e059d581b8?w=500&h=600&fit=crop",
        altText: "V√°y midi n·ªØ A-line navy"
      }
    ],
    isFeatured: true,
    isPublished: true,
    rating: 4.9,
    numReviews: 67,
    tags: ["v√°y", "midi", "n·ªØ", "elegant"],
    metaTitle: "V√°y Midi N·ªØ A-Line - Thanh L·ªãch ƒêa D·ª•ng",
    metaDescription: "V√°y midi n·ªØ form A-line ch·∫•t li·ªáu chiffon, thi·∫øt k·∫ø thanh l·ªãch ph√π h·ª£p nhi·ªÅu d·ªãp.",
    metaKeywords: ["v√°y midi n·ªØ", "A-line", "chiffon", "navy"],
    dimensions: {
      length: 85,
      width: 45,
      height: 1,
      weight: 0.25
    }
  },

  // ========== QU·∫¶N SHORT NAM ==========
  {
    name: "Qu·∫ßn Short Nam Kaki",
    description: "Qu·∫ßn short nam ch·∫•t li·ªáu kaki tho√°ng m√°t, form regular fit tho·∫£i m√°i, ph√π h·ª£p m√πa h√® v√† d·∫°o ph·ªë.",
    price: 399000,
    discountPrice: 349000,
    countInStock: 55,
    sku: "QS-NAM-KAKI-009",
    category: "Qu·∫ßn short",
    brand: "Wukudada",
    sizes: ["S", "M", "L", "XL", "XXL"],
    colors: ["Be"],
    collection: "summer",
    material: "100% Cotton Kaki",
    gender: "Men",
    images: [
      {
        url: "https://images.unsplash.com/photo-1591195853828-11db59a44f6b?w=500&h=600&fit=crop",
        altText: "Qu·∫ßn short nam kaki m√†u be"
      }
    ],
    isFeatured: false,
    isPublished: true,
    rating: 4.2,
    numReviews: 73,
    tags: ["short", "kaki", "nam", "summer"],
    metaTitle: "Qu·∫ßn Short Nam Kaki - Tho·∫£i M√°i M√πa H√®",
    metaDescription: "Qu·∫ßn short nam kaki tho√°ng m√°t, thi·∫øt k·∫ø ƒë∆°n gi·∫£n ph√π h·ª£p m·ªçi ho·∫°t ƒë·ªông.",
    metaKeywords: ["qu·∫ßn short nam", "kaki", "m√πa h√®", "be"],
    dimensions: {
      length: 50,
      width: 35,
      height: 2,
      weight: 0.3
    }
  },

  // ========== QU·∫¶N SHORT N·ªÆ ==========
  {
    name: "Qu·∫ßn Short N·ªØ Denim",
    description: "Qu·∫ßn short n·ªØ ch·∫•t li·ªáu denim wash nh·∫π, form high waist trendy, ph·ªëi c√πng √°o crop top r·∫•t h·ª£p.",
    price: 449000,
    discountPrice: 399000,
    countInStock: 40,
    sku: "QS-NU-DENIM-010",
    category: "Qu·∫ßn short",
    brand: "Wukudada",
    sizes: ["25", "26", "27", "28", "29", "30"],
    colors: ["Xanh wash"],
    collection: "casual",
    material: "98% Cotton, 2% Elastane",
    gender: "Women",
    images: [
      {
        url: "https://images.unsplash.com/photo-1594633312681-425c7b97ccd1?w=500&h=600&fit=crop",
        altText: "Qu·∫ßn short n·ªØ denim xanh wash"
      }
    ],
    isFeatured: false,
    isPublished: true,
    rating: 4.5,
    numReviews: 86,
    tags: ["short", "denim", "n·ªØ", "casual"],
    metaTitle: "Qu·∫ßn Short N·ªØ Denim - Phong C√°ch Casual",
    metaDescription: "Qu·∫ßn short n·ªØ denim high waist, thi·∫øt k·∫ø trendy cho phong c√°ch casual.",
    metaKeywords: ["qu·∫ßn short n·ªØ", "denim", "high waist", "xanh"],
    dimensions: {
      length: 35,
      width: 32,
      height: 2,
      weight: 0.25
    }
  },

  // ========== √ÅO S∆† MI NAM ==========
  {
    name: "√Åo S∆° Mi Nam C√¥ng S·ªü",
    description: "√Åo s∆° mi nam c√¥ng s·ªü ch·∫•t li·ªáu cotton cao c·∫•p, form slim fit l·ªãch l√£m, m√†u tr·∫Øng c∆° b·∫£n d·ªÖ ph·ªëi ƒë·ªì.",
    price: 599000,
    discountPrice: 499000,
    countInStock: 35,
    sku: "ASM-NAM-CS-011",
    category: "√Åo s∆° mi",
    brand: "Wukudada",
    sizes: ["S", "M", "L", "XL", "XXL"],
    colors: ["Tr·∫Øng"],
    collection: "business",
    material: "100% Cotton",
    gender: "Men",
    images: [
      {
        url: "https://images.unsplash.com/photo-1602810318383-e386cc2a3ccf?w=500&h=600&fit=crop",
        altText: "√Åo s∆° mi nam tr·∫Øng c√¥ng s·ªü"
      }
    ],
    isFeatured: true,
    isPublished: true,
    rating: 4.6,
    numReviews: 95,
    tags: ["s∆° mi", "c√¥ng s·ªü", "nam", "business"],
    metaTitle: "√Åo S∆° Mi Nam C√¥ng S·ªü - L·ªãch L√£m Chuy√™n Nghi·ªáp",
    metaDescription: "√Åo s∆° mi nam cotton cao c·∫•p, form slim fit l·ªãch l√£m cho m√¥i tr∆∞·ªùng c√¥ng s·ªü.",
    metaKeywords: ["√°o s∆° mi nam", "c√¥ng s·ªü", "cotton", "tr·∫Øng"],
    dimensions: {
      length: 75,
      width: 55,
      height: 1,
      weight: 0.3
    }
  },

  // ========== √ÅO S∆† MI N·ªÆ ==========
  {
    name: "√Åo S∆° Mi N·ªØ Oversize",
    description: "√Åo s∆° mi n·ªØ form oversize trendy, ch·∫•t li·ªáu cotton m·ªÅm m·∫°i, c√≥ th·ªÉ m·∫∑c nh∆∞ √°o kho√°c ngo√†i.",
    price: 549000,
    discountPrice: 459000,
    countInStock: 42,
    sku: "ASM-NU-OS-012",
    category: "√Åo s∆° mi",
    brand: "Wukudada",
    sizes: ["XS", "S", "M", "L", "XL"],
    colors: ["Xanh pastel"],
    collection: "trendy",
    material: "100% Cotton",
    gender: "Women",
    images: [
      {
        url: "https://images.unsplash.com/photo-1551698618-1dfe5d97d256?w=500&h=600&fit=crop",
        altText: "√Åo s∆° mi n·ªØ oversize xanh pastel"
      }
    ],
    isFeatured: false,
    isPublished: true,
    rating: 4.4,
    numReviews: 52,
    tags: ["s∆° mi", "oversize", "n·ªØ", "trendy"],
    metaTitle: "√Åo S∆° Mi N·ªØ Oversize - Phong C√°ch Hi·ªán ƒê·∫°i",
    metaDescription: "√Åo s∆° mi n·ªØ oversize cotton, thi·∫øt k·∫ø hi·ªán ƒë·∫°i cho phong c√°ch tr·∫ª trung.",
    metaKeywords: ["√°o s∆° mi n·ªØ", "oversize", "cotton", "xanh pastel"],
    dimensions: {
      length: 70,
      width: 60,
      height: 1,
      weight: 0.28
    }
  },

  // ========== QU·∫¶N T√ÇY NAM ==========
  {
    name: "Qu·∫ßn T√¢y Nam Slim Fit",
    description: "Qu·∫ßn t√¢y nam form slim fit l·ªãch l√£m, ch·∫•t li·ªáu wool pha polyester, ph√π h·ª£p m√¥i tr∆∞·ªùng c√¥ng s·ªü v√† s·ª± ki·ªán.",
    price: 899000,
    discountPrice: 749000,
    countInStock: 28,
    sku: "QT-NAM-SLIM-014",
    category: "Qu·∫ßn t√¢y",
    brand: "Wukudada",
    sizes: ["28", "29", "30", "31", "32", "33", "34"],
    colors: ["ƒêen"],
    collection: "formal",
    material: "65% Wool, 35% Polyester",
    gender: "Men",
    images: [
      {
        url: "https://th.bing.com/th/id/OIP.rZ6xm0lw1fGWRYH6wFv30QAAAA?r=0&w=364&h=364&rs=1&pid=ImgDetMain&cb=idpwebpc1",
        altText: "Qu·∫ßn t√¢y nam slim fit ƒëen"
      }
    ],
    isFeatured: true,
    isPublished: true,
    rating: 4.7,
    numReviews: 63,
    tags: ["qu·∫ßn t√¢y", "slim fit", "nam", "formal"],
    metaTitle: "Qu·∫ßn T√¢y Nam Slim Fit - L·ªãch L√£m ƒê·∫≥ng C·∫•p",
    metaDescription: "Qu·∫ßn t√¢y nam slim fit ch·∫•t li·ªáu wool cao c·∫•p, thi·∫øt k·∫ø l·ªãch l√£m cho m√¥i tr∆∞·ªùng c√¥ng s·ªü.",
    metaKeywords: ["qu·∫ßn t√¢y nam", "slim fit", "wool", "ƒëen"],
    dimensions: {
      length: 105,
      width: 38,
      height: 2,
      weight: 0.7
    }
  },

  // ========== √ÅO THUN TR·∫∫ EM ==========
  {
    name: "√Åo Thun Tr·∫ª Em Ho·∫°t H√¨nh",
    description: "√Åo thun tr·∫ª em in ho·∫°t h√¨nh d·ªÖ th∆∞∆°ng, ch·∫•t li·ªáu cotton organic an to√†n cho da b√©, m√†u s·∫Øc t∆∞∆°i vui.",
    price: 199000,
    discountPrice: 149000,
    countInStock: 80,
    sku: "AT-TE-HH-014",
    category: "√Åo ph√¥ng",
    brand: "Wukudada Kids",
    sizes: ["2-3T", "4-5T", "6-7T", "8-9T", "10-11T"],
    colors: ["V√†ng"],
    collection: "kids",
    material: "100% Organic Cotton",
    gender: "unisex",
    images: [
      {
        url: "https://images.unsplash.com/photo-1503944583220-79d8926ad1ef?w=500&h=600&fit=crop",
        altText: "√Åo thun tr·∫ª em ho·∫°t h√¨nh v√†ng"
      }
    ],
    isFeatured: true,
    isPublished: true,
    rating: 4.8,
    numReviews: 127,
    tags: ["tr·∫ª em", "ho·∫°t h√¨nh", "organic", "kids"],
    metaTitle: "√Åo Thun Tr·∫ª Em Ho·∫°t H√¨nh - An To√†n Cho B√©",
    metaDescription: "√Åo thun tr·∫ª em cotton organic, in ho·∫°t h√¨nh d·ªÖ th∆∞∆°ng, an to√†n cho l√†n da nh·∫°y c·∫£m c·ªßa b√©.",
    metaKeywords: ["√°o thun tr·∫ª em", "organic cotton", "ho·∫°t h√¨nh", "v√†ng"],
    dimensions: {
      length: 45,
      width: 35,
      height: 1,
      weight: 0.12
    }
  },

  // ========== QU·∫¶N JEAN TR·∫∫ EM ==========
  {
    name: "Qu·∫ßn Jean Tr·∫ª Em Straight",
    description: "Qu·∫ßn jean tr·∫ª em form straight tho·∫£i m√°i, ch·∫•t li·ªáu denim m·ªÅm m·∫°i kh√¥ng g√¢y kh√≥ ch·ªãu khi v·∫≠n ƒë·ªông.",
    price: 349000,
    discountPrice: 299000,
    countInStock: 45,
    sku: "QJ-TE-STR-015",
    category: "Qu·∫ßn jean",
    brand: "Wukudada Kids",
    sizes: ["2-3T", "4-5T", "6-7T", "8-9T", "10-11T"],
    colors: ["Xanh nh·∫°t"],
    collection: "kids-casual",
    material: "98% Cotton, 2% Elastane",
    gender: "unisex",
    images: [
      {
        url: "https://images.unsplash.com/photo-1519238263530-99bdd11df2ea?w=500&h=600&fit=crop",
        altText: "Qu·∫ßn jean tr·∫ª em straight xanh nh·∫°t"
      }
    ],
    isFeatured: false,
    isPublished: true,
    rating: 4.5,
    numReviews: 89,
    tags: ["tr·∫ª em", "jean", "straight", "kids"],
    metaTitle: "Qu·∫ßn Jean Tr·∫ª Em Straight - Tho·∫£i M√°i V·∫≠n ƒê·ªông",
    metaDescription: "Qu·∫ßn jean tr·∫ª em denim m·ªÅm m·∫°i, form straight tho·∫£i m√°i cho b√© ho·∫°t ƒë·ªông.",
    metaKeywords: ["qu·∫ßn jean tr·∫ª em", "straight", "denim", "xanh nh·∫°t"],
    dimensions: {
      length: 70,
      width: 28,
      height: 2,
      weight: 0.35
    }
  }
];

module.exports = products;

===== FILE: ./backend/data/users.js =====
// backend/data/users.js
const users = [
    {
        name: 'John Doe Admin',
        email: 'john@example.com',
        password: 'admin123',
        role: 'admin',
        gender: 'male',
        phone: '1234567890',
        address: '123 Admin St',
        city: 'Admin City',
        district: 'Admin District',
        ward: 'Admin Ward',
        birth: new Date('1985-01-15')
    },
    {
        name: 'Jane Smith Customer',
        email: 'jane@example.com',
        password: 'user123',
        role: 'customer',
        gender: 'female',
        phone: '0987654321',
        address: '456 User St',
        city: 'User City',
        district: 'User District', 
        ward: 'User Ward',
        birth: new Date('1990-05-20')
    },
    {
        name: 'Mike Johnson',
        email: 'mike@example.com',
        password: 'mike123',
        role: 'customer',
        gender: 'male',
        phone: '0912345678',
        address: '789 Customer St',
        city: 'Ho Chi Minh',
        district: 'District 1',
        ward: 'Ben Nghe Ward',
        birth: new Date('1988-03-10')
    }
];

module.exports = users;

===== FILE: ./backend/debug-cart-merge.js =====
// File: debug-cart-merge.js
// Script ƒë·ªÉ test t·ª´ng b∆∞·ªõc v√† debug l·ªói cart merge

const axios = require('axios');

// C·∫•u h√¨nh base URL
const BASE_URL = 'http://localhost:9000/api'; // Thay ƒë·ªïi theo port c·ªßa b·∫°n

// Bi·∫øn l∆∞u tr·ªØ d·ªØ li·ªáu test
let adminToken = '';
let guestId = '';
let productId = '';
let testUserId = '';

// Helper function ƒë·ªÉ log response
const logResponse = (step, response) => {
    console.log(`\n=== ${step} ===`);
    console.log('Status:', response.status);
    console.log('Data:', JSON.stringify(response.data, null, 2));
};

// Helper function ƒë·ªÉ log error
const logError = (step, error) => {
    console.log(`\n‚ùå ${step} - ERROR ===`);
    if (error.response) {
        console.log('Status:', error.response.status);
        console.log('Error:', JSON.stringify(error.response.data, null, 2));
    } else {
        console.log('Error:', error.message);
    }
};

// Step 1: Login admin ƒë·ªÉ l·∫•y token
const loginAdmin = async () => {
    try {
        const response = await axios.post(`${BASE_URL}/users/login`, {
            email: 'admin@example.com',
            password: '123456'
        });
        
        adminToken = response.data.token;
        logResponse('Step 1: Login Admin', response);
        return true;
    } catch (error) {
        logError('Step 1: Login Admin', error);
        return false;
    }
};

// Step 2: L·∫•y danh s√°ch products
const getProducts = async () => {
    try {
        const response = await axios.get(`${BASE_URL}/products?limit=1`);
        
        if (response.data.products && response.data.products.length > 0) {
            productId = response.data.products[0]._id;
            logResponse('Step 2: Get Products', response);
            console.log('Selected Product ID:', productId);
            return true;
        } else {
            console.log('‚ùå No products found');
            return false;
        }
    } catch (error) {
        logError('Step 2: Get Products', error);
        return false;
    }
};

// Step 3: T·∫°o guest cart
const createGuestCart = async () => {
    try {
        // T·∫°o guestId ng·∫´u nhi√™n
        guestId = `guest_${Date.now()}`;
        
        const response = await axios.post(`${BASE_URL}/cart`, {
            productId: productId,
            quantity: 2,
            size: 'M',
            color: 'Red',
            guestId: guestId
        });
        
        logResponse('Step 3: Create Guest Cart', response);
        console.log('Guest ID:', guestId);
        return true;
    } catch (error) {
        logError('Step 3: Create Guest Cart', error);
        return false;
    }
};

// Step 4: Ki·ªÉm tra guest cart
const checkGuestCart = async () => {
    try {
        const response = await axios.get(`${BASE_URL}/cart?guestId=${guestId}`);
        logResponse('Step 4: Check Guest Cart', response);
        return true;
    } catch (error) {
        logError('Step 4: Check Guest Cart', error);
        return false;
    }
};

// Step 5: T·∫°o user m·ªõi ƒë·ªÉ test merge
const createTestUser = async () => {
    try {
        const testEmail = `testuser_${Date.now()}@example.com`;
        const response = await axios.post(`${BASE_URL}/users/register`, {
            name: 'Test User',
            email: testEmail,
            password: '123456'
        });
        
        testUserId = response.data.user.id;
        logResponse('Step 5: Create Test User', response);
        return response.data.token;
    } catch (error) {
        logError('Step 5: Create Test User', error);
        return null;
    }
};

// Step 6: Test merge cart
const testMergeCart = async (userToken) => {
    try {
        console.log('\n=== Step 6: Test Merge Cart ===');
        console.log('Using token:', userToken);
        console.log('Guest ID:', guestId);
        
        const response = await axios.post(`${BASE_URL}/cart/merge`, 
            {
                guestId: guestId
            },
            {
                headers: {
                    'Authorization': `Bearer ${userToken}`,
                    'Content-Type': 'application/json'
                }
            }
        );
        
        logResponse('Step 6: Merge Cart SUCCESS', response);
        return true;
    } catch (error) {
        logError('Step 6: Merge Cart', error);
        return false;
    }
};

// Step 7: Ki·ªÉm tra user cart sau khi merge
const checkUserCart = async (userToken) => {
    try {
        const response = await axios.get(`${BASE_URL}/cart?userId=${testUserId}`, {
            headers: {
                'Authorization': `Bearer ${userToken}`
            }
        });
        logResponse('Step 7: Check User Cart After Merge', response);
        return true;
    } catch (error) {
        logError('Step 7: Check User Cart After Merge', error);
        return false;
    }
};

// Main test function
const runTest = async () => {
    console.log('üöÄ Starting Cart Merge Debug Test...\n');
    
    // Step 1: Login admin
    if (!(await loginAdmin())) {
        console.log('‚ùå Test stopped: Cannot login admin');
        return;
    }
    
    // Step 2: Get products
    if (!(await getProducts())) {
        console.log('‚ùå Test stopped: Cannot get products');
        return;
    }
    
    // Step 3: Create guest cart
    if (!(await createGuestCart())) {
        console.log('‚ùå Test stopped: Cannot create guest cart');
        return;
    }
    
    // Step 4: Check guest cart
    if (!(await checkGuestCart())) {
        console.log('‚ùå Test stopped: Cannot check guest cart');
        return;
    }
    
    // Step 5: Create test user
    const userToken = await createTestUser();
    if (!userToken) {
        console.log('‚ùå Test stopped: Cannot create test user');
        return;
    }
    
    // Step 6: Test merge cart
    if (!(await testMergeCart(userToken))) {
        console.log('‚ùå Merge failed - checking details...');
        
        // Debug th√™m: ki·ªÉm tra guest cart c√≥ t·ªìn t·∫°i kh√¥ng
        console.log('\nüîç Debug: Checking if guest cart still exists...');
        await checkGuestCart();
        
        return;
    }
    
    // Step 7: Check final result
    await checkUserCart(userToken);
    
    console.log('\n‚úÖ All tests completed!');
};

// Ch·∫°y test
runTest().catch(console.error);

/* 
C√°ch ch·∫°y script n√†y:
1. npm install axios (n·∫øu ch∆∞a c√≥)
2. node debug-cart-merge.js

Script n√†y s·∫Ω:
- T·ª± ƒë·ªông test t·ª´ng b∆∞·ªõc
- Hi·ªÉn th·ªã chi ti·∫øt response/error ·ªü m·ªói b∆∞·ªõc
- Gi√∫p x√°c ƒë·ªãnh ch√≠nh x√°c l·ªói ·ªü ƒë√¢u
*/

===== FILE: ./backend/env.txt =====
# Server
PORT=9000
# Database
MONGO_URI=mongodb+srv://:@cluster0..mongodb.net/Wukudada?retryWrites=true&w=majority&appName=Cluster0
# JWT openssl rand -hex 64
JWT_SECRET=
# Google OAuth
GOOGLE_CLIENT_ID=-.apps.googleusercontent.com
GOOGLE_CLIENT_SECRET=GOCSPX--
GOOGLE_CALLBACK_URL=/api/auth/google/callback
# Session openssl rand -base64 64
SESSION_SECRET=/==
# Cloudinary
CLOUDINARY_CLOUD_NAME=
CLOUDINARY_API_KEY=
CLOUDINARY_API_SECRET=
FRONTEND_URL=http://localhost:5173
# NODE_ENV=development
# facebook
FACEBOOK_APP_ID=
FACEBOOK_APP_SECRET=
FACEBOOK_CALLBACK_URL=http://localhost:9000/api/auth/facebook/callback


# Cookie settings
COOKIE_MAX_AGE=604800000  # 7 days in milliseconds
COOKIE_DOMAIN=localhost   # Use your domain in production

# Rate limiting
API_RATE_LIMIT=5
API_RATE_WINDOW=900000    # 15 minutes in milliseconds

===== FILE: ./backend/middleware/authMiddleware.js =====
const jwt = require("jsonwebtoken");
const User = require("../models/User");

//Middleware to check if user is authenticated 
const authMiddleware = async (req, res, next) => {
  try {
    // ∆Øu ti√™n l·∫•y t·ª´ cookie, fallback v·ªÅ header
    let token = req.cookies?.authToken || req.headers.authorization?.split(" ")[1];

    if (!token) {
      return res.status(401).json({ message: "No token provided" });
    }

    const decoded = jwt.verify(token, process.env.JWT_SECRET || "your_jwt_secret_key");

    const user = await User.findById(decoded.id).select("-password");

    if (!user) {
      return res.status(404).json({ message: "User not found" });
    }

    req.user = user;
    next();
  } catch (error) {
    console.error(error);
    if (error.name === "TokenExpiredError") {
      // Clear expired cookie
      res.clearCookie('authToken');
      return res.status(401).json({ message: "Token expired" });
    }
    return res.status(401).json({ message: "Invalid token" });
  }
};

// Middleware to check if user is an admin
const isAdmin = (req, res, next) => {
  if (req.user && req.user.role === 'admin') {
    next();
  } else {
    return res.status(403).json({ message: "Access denied. Admin access required" });
  }
};

// Ch·ªâ export m·ªôt l·∫ßn ·ªü cu·ªëi file
module.exports = { authMiddleware, isAdmin };

===== FILE: ./backend/middleware/errorHandler.js =====
// middleware/errorHandler.js
const errorHandler = (err, req, res, next) => {
    let error = { ...err };
    error.message = err.message;

    // Log to console for dev
    console.error(err);

    // Mongoose bad ObjectId
    if (err.name === 'CastError') {
        const message = 'Resource not found';
        error = { message, statusCode: 404 };
    }

    // Mongoose duplicate key
    if (err.code === 11000) {
        const message = 'Duplicate field value entered';
        error = { message, statusCode: 400 };
    }

    // Mongoose validation error
    if (err.name === 'ValidationError') {
        const message = Object.values(err.errors).map(val => val.message).join(', ');
        error = { message, statusCode: 400 };
    }

    // JWT errors
    if (err.name === 'JsonWebTokenError') {
        const message = 'Invalid token';
        error = { message, statusCode: 401 };
    }

    if (err.name === 'TokenExpiredError') {
        const message = 'Token expired';
        error = { message, statusCode: 401 };
    }

    res.status(error.statusCode || 500).json({
        success: false,
        message: error.message || 'Server Error',
        ...(process.env.NODE_ENV === 'development' && { stack: err.stack })
    });
};

// Async error handler wrapper
const asyncHandler = fn => (req, res, next) => {
    Promise.resolve(fn(req, res, next)).catch(next);
};

module.exports = { errorHandler, asyncHandler };

===== FILE: ./backend/models/Cart.js =====
const mongoose = require('mongoose');

const cartItemSchema = new mongoose.Schema({
    productId: {
        type: mongoose.Schema.Types.ObjectId,
        ref: 'Product',
        required: true
    },
    name: {
        type: String,
        required: true
    },
    image: {
        type: String,
        required: true
    },
    price: {
        type: Number,
        required: true,
        min: 0
    },
    size: {
        type: String,
        required: true
    },
    color: {
        type: {
            name: {
                type: String,
                required: true
            },
            code: {
                type: String,
                required: true
            }
        },
        required: true
    },
    quantity: {
        type: Number,
        default: 1,
        min: 1,
        required: true
    },
}, { _id: false });

const cartSchema = new mongoose.Schema({
    user: {
        type: mongoose.Schema.Types.ObjectId,
        ref: 'User',
        default: null
    },
    guestId: {
        type: String,
        default: null
    },
    products: {
        type: [cartItemSchema],
        default: [],
        validate: {
            validator: function (products) {
                return products.length >= 0;
            },
            message: 'Products array cannot be negative length'
        }
    },
    totalPrice: {
        type: Number,
        default: 0,
        min: 0,
        required: true
    },
}, {
    timestamps: true,
    // ƒê·∫£m b·∫£o √≠t nh·∫•t c√≥ user ho·∫∑c guestId
    validate: {
        validator: function () {
            return this.user || this.guestId;
        },
        message: 'Either user or guestId must be provided'
    }
});

// Index ƒë·ªÉ t·ªëi ∆∞u performance
cartSchema.index({ user: 1 });
cartSchema.index({ guestId: 1 });
cartSchema.index({ user: 1, guestId: 1 });

// Pre-save middleware ƒë·ªÉ t√≠nh to√°n totalPrice
cartSchema.pre('save', function (next) {
    if (this.products && this.products.length > 0) {
        this.totalPrice = this.products.reduce((total, item) => {
            return total + (item.price * item.quantity);
        }, 0);
    } else {
        this.totalPrice = 0;
    }
    next();
});

// ƒê·ªÉ tr√°nh l·ªói OverwriteModelError khi require model nhi·ªÅu l·∫ßn,
// h√£y ki·ªÉm tra model ƒë√£ ƒë∆∞·ª£c khai b√°o ch∆∞a tr∆∞·ªõc khi khai b√°o m·ªõi.
let Cart;
try {
    Cart = mongoose.model('Cart');
} catch (e) {
    Cart = mongoose.model('Cart', cartSchema);
}
module.exports = Cart;

===== FILE: ./backend/models/Checkout.js =====
const mongoose = require('mongoose');

const checkoutItemSchema = new mongoose.Schema({
    productId: {
        type: mongoose.Schema.Types.ObjectId,
        ref: 'Product',
        required: true
    },
    name: {
        type: String,
        required: true
    },
    image: {
        type: String,
        required: true
    },
    price: {
        type: Number,
        required: true
    },
    size: {
        type: String
    },
    color: {
        type: {
            name: {
                type: String,
                required: true
            },
            code: {
                type: String,
                required: true
            }
        },
        required: true
    },
    quantity: {
        type: Number,
        required: true
    }
},
    { _id: false }
);

const checkoutSchema = new mongoose.Schema({
    user: {
        type: mongoose.Schema.Types.ObjectId,
        ref: 'User',
        required: true
    },
    checkoutItems: [checkoutItemSchema],
    shippingAddress: {
        address: {
            type: String,
            required: true
        },
        city: {
            type: String,
            required: true
        },
        postalCode: {
            type: String,
            required: true
        },
        country: {
            type: String,
            required: true
        }
    },
    paymentMethod: {
        type: String,
        required: true
    },
    totalPrice: {
        type: Number,
        required: true
    },
    isPaid: {
        type: Boolean,
        default: false
    },
    paidAt: {
        type: Date
    },
    paymentStatus: {
        type: String,
        default: 'Pending'
    },
    paymentDetails: {
        type: mongoose.Schema.Types.Mixed, // Can store various payment details
    },
    isFinalized: {
        type: Boolean,
        default: false
    },
    finalizedAt: {
        type: Date
    }
},
    { timestamps: true }
);

module.exports = mongoose.model('Checkout', checkoutSchema);


===== FILE: ./backend/models/Collection.js =====
const mongoose = require("mongoose");

const collectionSchema = new mongoose.Schema(
  {
    id: {
      type: String,
      required: true,
      unique: true,
      trim: true,
    },
    name: {
      type: String,
      required: true,
      trim: true,
    },
    bannerUrl: {
      type: String,
      required: true,
    },
    description: {
      type: String,
      default: "",
    },
    categories: [
      {
        type: String,
        trim: true,
      },
    ],
    status: {
      type: String,
      enum: ["active", "inactive"],
      default: "active",
    },
  },
  {
    timestamps: true,
  }
);

module.exports = mongoose.model("Collection", collectionSchema);


===== FILE: ./backend/models/Order.js =====
const mongoose = require("mongoose");

const orderItemSchema = new mongoose.Schema(
  {
    productId: {
      type: mongoose.Schema.Types.ObjectId,
      ref: "Product",
      required: true,
    },
    name: {
      type: String,
      required: true,
    },
    image: {
      type: String,
      required: true,
    },
    price: {
      type: Number,
      required: true,
    },
    size: {
      type: String,
    },
    color: {
      type: String,
    },
    quantity: {
      type: Number,
      required: true,
      //default: 1
    },
  },
  { _id: false }
);

const orderSchema = new mongoose.Schema(
  {
    user: {
      type: mongoose.Schema.Types.ObjectId,
      ref: "User",
      required: true,
    },
    orderItems: [orderItemSchema],
    shippingAddress: {
      address: {
        type: String,
        required: true,
      },
      city: {
        type: String,
        required: true,
      },
      district: {
        type: String,
        required: false,
      },
      ward: {
        type: String,
        required: false,
      },
      postalCode: {
        type: String,
        required: true,
      },
      country: {
        type: String,
        required: true,
      },
      notes: {
        type: String,
        required: false,
      },
    },
    paymentMethod: {
      type: String,
      required: true,
    },
    totalPrice: {
      type: Number,
      required: true,
    },
    isPaid: {
      type: Boolean,
      default: false,
    },
    paidAt: {
      type: Date,
    },
    isDelivered: {
      type: Boolean,
      default: false,
    },
    deliveredAt: {
      type: Date,
    },
    paymentStatus: {
      type: String,
      default: "Pending",
    },
    status: {
      type: String,
      enum: ["Processing", "Shipped", "Delivered", "Cancelled"],
      default: "Processing",
    },
  },
  { timestamps: true }
);

module.exports = mongoose.model("Order", orderSchema);


===== FILE: ./backend/models/Product.js =====
const mongoose = require("mongoose");
const productSchema = new mongoose.Schema(
  {
    name: {
      type: String,
      required: true,
      trim: true,
    },

    description: {
      type: String,
      required: true,
      // trim: true
    },

    price: {
      type: Number,
      required: true,
      min: 0,
    },

    discountPrice: {
      type: Number,
      min: 0,
    },

    countInStock: {
      type: Number,
      required: true,
      min: 0,
      default: 0,
    },

    sku: {
      type: String,
      required: true,
      unique: true,
      trim: true,
    },

    category: {
      type: String,
      trim: true,
    },

    // brand: {
    //     type: String,
    //     required: true,
    //     trim: true,
    // },

    sizes: {
      type: [String],
      required: true,
      trim: true,
    },

    colors: [
      {
        name: {
          type: String,
          required: true,
          trim: true,
        },
        code: {
          type: String,
          required: true,
          trim: true,
        },
      },
    ],

    collection: {
      type: String,
      trim: true,
    },

    material: {
      type: String,
      required: true,
      trim: true,
    },

    gender: {
      type: String,
      required: true,
      enum: ["man", "woman", "unisex"],
    },

    images: [
      {
        url: {
          type: String,
          required: true,
        },
        altText: {
          type: String,
          required: true,
        },
        isFeatured: {
          type: Boolean,
          default: false,
        },
      },
    ],

    isPublished: {
      type: Boolean,
      default: true,
    },

    rating: {
      type: Number,
      default: 0,
      min: 0,
      max: 5,
    },

    numReviews: {
      type: Number,
      default: 0,
      min: 0,
    },

    tags: [
      {
        type: String,
        trim: true,
      },
    ],

    user: {
      type: mongoose.Schema.Types.ObjectId,
      ref: "User",
      required: true,
    },

    metaTitle: {
      type: String,
      trim: true,
    },

    metaDescription: {
      type: String,
      trim: true,
    },

    metaKeywords: [
      {
        type: String,
        trim: true,
      },
    ],

    dimensions: {
      length: {
        type: Number,
        required: true,
        min: 0,
      },
      width: {
        type: Number,
        required: true,
        min: 0,
      },
      height: {
        type: Number,
        required: true,
        min: 0,
      },
      weight: {
        type: Number,
        required: true,
        min: 0,
      },
    },
  },
  {
    timestamps: true,
    suppressReservedKeysWarning: true,
  }
);

module.exports = mongoose.model("Product", productSchema);


===== FILE: ./backend/models/User.js =====
const mongoose = require("mongoose");
const bcrypt = require("bcryptjs");

const userSchema = new mongoose.Schema(
  {
    name: {
      type: String,
      required: true,
      trim: true,
    },
    email: {
      type: String,
      required: true,
      unique: true,
      trim: true,
      lowercase: true,
      match: [/.+\@.+\..+/, "Please enter a valid email address"],
    },
    password: {
      type: String,
      required: function () {
        // Password only required if no OAuth IDs
        return !this.googleId && !this.facebookId;
      },
      minlength: 6,
    },
    role: {
      type: String,
      enum: ["customer", "admin"],
      default: "customer",
    },
    gender: {
      type: String,
      enum: ["male", "female", "other"],
    },
    birth: {
      type: Date,
    },
    // Th√™m tr∆∞·ªùng m·ªõi
    address: {
      type: String,
    },
    city: {
      type: String,
      default: "",
    },
    district: {
      type: String,
      default: "",
    },
    ward: {
      type: String,
      default: "",
    },
    phone: {
      type: String,
    },
    // Th√™m fields cho Google OAuth
    googleId: {
      type: String,
      sparse: true, // Cho ph√©p null v√† unique
    },
    facebookId: {
      type: String,
      sparse: true,
    },
    profileImage: {
      type: String,
    },
    // ƒê√°nh d·∫•u account type
    accountType: {
      type: String,
      enum: ["local", "google", "facebook", "hybrid"],
      default: "local",
    },
  },
  {
    timestamps: true,
  }
);

// Hash m·∫≠t kh·∫©u tr∆∞·ªõc khi l∆∞u (ch·ªâ cho local accounts)
userSchema.pre("save", async function (next) {
  if (!this.isModified("password") || this.googleId || this.facebookId)
    return next();

  try {
    const salt = await bcrypt.genSalt(10);
    this.password = await bcrypt.hash(this.password, salt);
    next();
  } catch (err) {
    next(err);
  }
});

// C·∫≠p nh·∫≠t account type tr∆∞·ªõc khi l∆∞u
userSchema.pre("save", function (next) {
  if (
    (this.googleId || this.facebookId) &&
    this.password !== "google_oauth_user" &&
    this.password !== "facebook_oauth_user"
  ) {
    this.accountType = "hybrid";
  } else if (this.googleId) {
    this.accountType = "google";
  } else if (this.facebookId) {
    this.accountType = "facebook";
  } else {
    this.accountType = "local";
  }
  next();
});
// V·∫•n ƒë·ªÅ: comparePassword kh√¥ng x·ª≠ l√Ω tr∆∞·ªùng h·ª£p password l√† null/undefined
// Ph∆∞∆°ng th·ª©c ki·ªÉm tra m·∫≠t kh·∫©u
// userSchema.methods.comparePassword = async function (candidatePassword) {
//   // Kh√¥ng th·ªÉ so s√°nh password cho Google OAuth users
//   if (this.accountType === 'google') {
//     return false;
//   }
//   return await bcrypt.compare(candidatePassword, this.password);
// };

userSchema.methods.comparePassword = async function (candidatePassword) {
  if (
    this.accountType === "google" ||
    this.accountType === "facebook" ||
    !this.password
  ) {
    return false;
  }
  return await bcrypt.compare(candidatePassword, this.password);
};

const User = mongoose.model("User", userSchema);
module.exports = User;


===== FILE: ./backend/routes/adminOrderRoutes.js =====
const express = require("express");
const Order = require("../models/Order");
const { authMiddleware, isAdmin } = require("../middleware/authMiddleware");

const router = express.Router();

// @route  GET /api/admin/orders
// @desc   Get all orders (Only for Admin)
// @access Private/Admin
router.get("/", authMiddleware, isAdmin, async (req, res) => {
  try {
    const orders = await Order.find().populate("user", "name email"); // Populate user details
    res.json(orders);
  } catch (error) {
    console.error("Error fetching orders:", error);
    res.status(500).json({ message: "Server error" });
  }
});

// @route  PUT /api/admin/orders/:id
// @desc   Update order status by ID (Only for Admin)
// @access Private/Admin
router.put("/:id", authMiddleware, isAdmin, async (req, res) => {
  const { status, paymentStatus } = req.body;

  try {
    const order = await Order.findById(req.params.id);

    if (!order) {
      return res.status(404).json({ message: "Order not found" });
    }

    console.log("PUT order body:", req.body);
    console.log("Order paymentStatus before:", order.paymentStatus);

    if (status) {
      order.status = status;
      order.isDelivered = status === "Delivered" ? true : order.isDelivered;
      order.deliveredAt =
        status === "Delivered" ? new Date() : order.deliveredAt;
    }
    if (paymentStatus) {
      order.paymentStatus = paymentStatus;
    }

    console.log("Order paymentStatus after:", order.paymentStatus);

    const updatedOrder = await order.save();
    res.json(updatedOrder);
  } catch (error) {
    console.error("Error updating order:", error);
    res.status(500).json({ message: "Server error" });
  }
});

// @route  DELETE /api/admin/orders/:id
// @desc   Delete an order by ID (Only for Admin)
// @access Private/Admin
router.delete("/:id", authMiddleware, isAdmin, async (req, res) => {
  try {
    const order = await Order.findById(req.params.id);

    if (!order) {
      return res.status(404).json({ message: "Order not found" });
    }

    await order.deleteOne();
    res.json({ message: "Order removed successfully" });
  } catch (error) {
    console.error("Error deleting order:", error);
    res.status(500).json({ message: "Server error" });
  }
});

module.exports = router;


===== FILE: ./backend/routes/adminRoutes.js =====
const express = require('express');
const User = require('../models/User');
const { authMiddleware, isAdmin } = require('../middleware/authMiddleware');
const router = express.Router();

// @route  GET /api/admin/users
// @desc   Get all users
// @access Private/Admin
router.get("/users", authMiddleware, isAdmin, async (req, res) => {
    try {
        const users = await User.find().select("-password"); // Exclude password field
        res.json(users);
    } catch (error) {
        console.error('Error fetching users:', error);
        res.status(500).json({ message: 'Server error' });
    }
});
// @route POST /api/admin/users/
// @desc  Create a new user (admin only)
// @access Private/Admin
router.post("/", authMiddleware, isAdmin, async (req, res) => {
    const { name, email, password, role } = req.body;

    try {
        const user = new User({
            name,
            email,
            password,
            role: role || 'customer', 
            //isAdmin
        });

        const createdUser = await user.save();
        res.status(201).json({message: "User created successfully",createdUser});
    } catch (error) {
        console.error('Error creating user:', error);
        res.status(500).json({ message: 'Server error' });
    }
});

// @route PUT /api/admin/users/:id
// @desc  Update a user (admin only)
// @access Private/Admin
router.put("/:id", authMiddleware, isAdmin, async (req, res) => {
    const { name, email, password, role } = req.body;

    try {
        const user = await User.findById(req.params.id);

        if (!user) {
            return res.status(404).json({ message: 'User not found' });
        }

        user.name = name || user.name;
        user.email = email || user.email;
        if (password) {
            user.password = password; // Hashing should be handled in the User model
        }
        user.role = role || user.role;

        const updatedUser = await user.save();
        res.json({ message: "User updated successfully", updatedUser });
    } catch (error) {
        console.error('Error updating user:', error);
        res.status(500).json({ message: 'Server error' });
    }
});
// @route DELETE /api/admin/users/:id
// @desc  Delete a user (admin only)
// @access Private/Admin
router.delete("/:id", authMiddleware, isAdmin, async (req, res) => {
    try {
        const user = await User.findById(req.params.id);
        if (!user) {
            return res.status(404).json({ message: 'User not found' });
        }
        await user.deleteOne();
        res.json({ message: 'User deleted successfully' });
    } catch (error) {
        console.error('Error deleting user:', error);
        res.status(500).json({ message: 'Server error' });
    }
});
module.exports = router;

===== FILE: ./backend/routes/authRoutes.js =====
const express = require('express');
const passport = require('passport');
const jwt = require('jsonwebtoken');
const router = express.Router();
const User = require('../models/User'); // Import User model

// @route   GET /auth/google
// @desc    Authenticate with Google
// @access  Public
router.get('/google',
  passport.authenticate('google', {
    scope: ['profile', 'email']
  })
);

// @route   GET /auth/google/callback
// @desc    Google OAuth callback
// @access  Public
router.get('/google/callback',
  passport.authenticate('google', {
    failureRedirect: '/login',
    session: false
  }),
  (req, res) => {
    try {
      const frontendURL = process.env.FRONTEND_URL || 'http://localhost:5173';

      // T·∫°o JWT token
      const token = jwt.sign(
        { id: req.user._id, role: req.user.role },
        process.env.JWT_SECRET || "your_jwt_secret_key",
        { expiresIn: "7d" }
      );

      // Redirect v·ªÅ frontend v·ªõi token
      res.redirect(`${frontendURL}/auth/success?token=${token}`);

    } catch (error) {
      console.error('Google callback error:', error);
      const frontendURL = process.env.FRONTEND_URL || 'http://localhost:5173';
      res.redirect(`${frontendURL}/login?error=auth_failed`);
    }
  }
);

// @route   POST /auth/google/mobile
// @desc    Google OAuth cho mobile app (nh·∫≠n Google token t·ª´ client)
// @access  Public
router.post('/google/mobile', async (req, res) => {
  try {
    const { googleToken } = req.body;

    if (!googleToken) {
      return res.status(400).json({ message: 'Google token is required' });
    }

    // Verify Google token
    const { OAuth2Client } = require('google-auth-library');
    const client = new OAuth2Client(process.env.GOOGLE_CLIENT_ID);

    const ticket = await client.verifyIdToken({
      idToken: googleToken,
      audience: process.env.GOOGLE_CLIENT_ID,
    });

    const payload = ticket.getPayload();
    const { sub: googleId, name, email, picture } = payload;

    // T√¨m ho·∫∑c t·∫°o user
    let user = await User.findOne({ googleId });

    if (!user) {
      // Ki·ªÉm tra email ƒë√£ t·ªìn t·∫°i ch∆∞a
      const existingUser = await User.findOne({ email });
      if (existingUser) {
        // Li√™n k·∫øt account
        existingUser.googleId = googleId;
        existingUser.profileImage = picture;
        await existingUser.save();
        user = existingUser;
      } else {
        // T·∫°o user m·ªõi
        user = new User({
          googleId,
          name,
          email,
          password: 'google_oauth_user',
          gender: 'other',
          profileImage: picture
        });
        await user.save();
      }
    }

    // T·∫°o JWT token
    const token = jwt.sign(
      { id: user._id, role: user.role },
      process.env.JWT_SECRET || "your_jwt_secret_key",
      { expiresIn: "7d" }
    );

    res.status(200).json({
      message: "Google login successful",
      user: {
        id: user._id,
        name: user.name,
        email: user.email,
        role: user.role,
        profileImage: user.profileImage,
        accountType: user.accountType
      },
      token,
    });

  } catch (error) {
    console.error('Google mobile auth error:', error);
    res.status(500).json({ message: 'Google authentication failed' });
  }
});

// @route   GET /auth/facebook
// @desc    Authenticate with Facebook
// @access  Public
router.get('/facebook',
  passport.authenticate('facebook', {
    scope: ['email', 'public_profile']
  })
);

// @route   GET /auth/facebook/callback
// @desc    Facebook OAuth callback
// @access  Public
router.get('/facebook/callback',
  passport.authenticate('facebook', {
    failureRedirect: '/login',
    session: false
  }),
  (req, res) => {
    try {
      const frontendURL = process.env.FRONTEND_URL || 'http://localhost:5173';

      // Create JWT token
      const token = jwt.sign(
        { id: req.user._id, role: req.user.role },
        process.env.JWT_SECRET || "your_jwt_secret_key",
        { expiresIn: "7d" }
      );

      // Redirect to frontend with token
      res.redirect(`${frontendURL}/auth/success?token=${token}`);

    } catch (error) {
      console.error('Facebook callback error:', error);
      const frontendURL = process.env.FRONTEND_URL || 'http://localhost:5173';
      res.redirect(`${frontendURL}/login?error=auth_failed`);
    }
  }
);

// @route   POST /auth/facebook/mobile
// @desc    Facebook OAuth for mobile/web SDK (receives Facebook token from client)
// @access  Public
router.post('/facebook/mobile', async (req, res) => {
  try {
    const { accessToken } = req.body;

    if (!accessToken) {
      return res.status(400).json({ message: 'Facebook access token is required' });
    }

    // Get user profile from Facebook
    const response = await fetch(`https://graph.facebook.com/v19.0/me?fields=id,name,email,picture&access_token=${accessToken}`);
    const profile = await response.json();

    if (profile.error) {
      throw new Error(profile.error.message);
    }

    const { id: facebookId, name, email, picture } = profile;

    // Find or create user
    let user = await User.findOne({ facebookId });

    if (!user) {
      // Check if email exists
      const existingUser = await User.findOne({ email });
      if (existingUser) {
        // Link account
        existingUser.facebookId = facebookId;
        existingUser.profileImage = picture?.data?.url;
        await existingUser.save();
        user = existingUser;
      } else {
        // Create new user
        user = new User({
          facebookId,
          name,
          email: email || `${facebookId}@facebook.com`,
          password: `facebook_oauth_${Date.now()}_${Math.random().toString(36)}`,
          gender: 'other',
          profileImage: picture?.data?.url
        });
        await user.save();
      }
    }

    // Create JWT token
    const token = jwt.sign(
      { id: user._id, role: user.role },
      process.env.JWT_SECRET || "your_jwt_secret_key",
      { expiresIn: "7d" }
    );

    res.status(200).json({
      message: "Facebook login successful",
      user: {
        id: user._id,
        name: user.name,
        email: user.email,
        role: user.role,
        profileImage: user.profileImage,
        accountType: user.accountType
      },
      token,
    });

  } catch (error) {
    console.error('Facebook mobile auth error:', error);
    res.status(500).json({ message: 'Facebook authentication failed' });
  }
});

module.exports = router;

===== FILE: ./backend/routes/cartRoutes.js =====
const express = require("express");
const Cart = require("../models/Cart");
const Product = require("../models/Product");
const { authMiddleware } = require("../middleware/authMiddleware");
const mongoose = require("mongoose");

const router = express.Router();

// Helper function to validate ObjectId
const isValidObjectId = (id) => {
  return mongoose.Types.ObjectId.isValid(id);
};

// Helper function to get a cart by user ID or guest ID
const getCartByUserOrGuestId = async (userId, guestId) => {
  try {
    if (userId && isValidObjectId(userId)) {
      return await Cart.findOne({ user: userId }).populate(
        "products.productId",
        "name price images"
      );
    } else if (guestId) {
      return await Cart.findOne({ guestId: guestId }).populate(
        "products.productId",
        "name price images"
      );
    }
    return null;
  } catch (error) {
    console.error("Error in getCartByUserOrGuestId:", error);
    return null;
  }
};

// @route POST /api/cart
// @desc Add item to cart for a guest or logged-in user
// @access Public
router.post("/", async (req, res) => {
  const { productId, quantity = 1, size, color, guestId, userId } = req.body;

  try {
    // Log d·ªØ li·ªáu th√™m v√†o gi·ªè h√†ng
    console.log("[ADD TO CART]", {
      productId,
      quantity,
      size,
      color,
      guestId,
      userId,
    });

    // Input validation
    if (!productId || !size || !color) {
      return res
        .status(400)
        .json({ message: "Product ID, size, and color are required" });
    }

    if (!isValidObjectId(productId)) {
      return res.status(400).json({ message: "Invalid product ID format" });
    }

    if (quantity < 1) {
      return res.status(400).json({ message: "Quantity must be at least 1" });
    }

    if (!userId && !guestId) {
      return res
        .status(400)
        .json({ message: "Either userId or guestId must be provided" });
    }

    // Validate product existence
    const product = await Product.findById(productId);
    if (!product) {
      return res.status(404).json({ message: "Product not found" });
    }

    if (!product.isPublished) {
      return res.status(400).json({ message: "Product is not available" });
    }

    // Check if product has enough stock
    if (product.countInStock < quantity) {
      return res.status(400).json({ message: "Insufficient stock" });
    }

    // Determine if the user is logged in or a guest
    let cart = await getCartByUserOrGuestId(userId, guestId);

    // If cart exists, update it
    if (cart) {
      const productIndex = cart.products.findIndex(
        (p) =>
          p.productId._id.toString() === productId &&
          p.size === size &&
          p.color.name === color.name &&
          p.color.code === color.code
      );

      if (productIndex > -1) {
        // Check total quantity after addition
        const newQuantity = cart.products[productIndex].quantity + quantity;
        if (newQuantity > product.countInStock) {
          return res
            .status(400)
            .json({ message: "Not enough stock available" });
        }
        cart.products[productIndex].quantity = newQuantity;
      } else {
        // Add new product to cart
        cart.products.push({
          productId,
          name: product.name,
          image: product.images[0]?.url || "",
          price: product.discountPrice || product.price,
          quantity,
          size,
          color: {
            name: color.name,
            code: color.code,
          },
        });
      }

      await cart.save();
      return res.status(200).json(cart);
    } else {
      // Create new cart
      const finalGuestId =
        guestId ||
        `guest_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;

      const newCart = new Cart({
        user: userId && isValidObjectId(userId) ? userId : undefined,
        guestId: !userId ? finalGuestId : undefined,
        products: [
          {
            productId,
            name: product.name,
            image: product.images[0]?.url || "",
            price: product.discountPrice || product.price,
            quantity,
            size,
            color: {
              name: color.name,
              code: color.code,
            },
          },
        ],
      });

      await newCart.save();
      return res.status(201).json(newCart);
    }
  } catch (error) {
    console.error("Error adding item to cart:", error);
    return res
      .status(500)
      .json({ message: "Error adding item to cart", error: error.message });
  }
});

// @route PUT /api/cart
// @desc Update item in cart for a guest or logged-in user
// @access Public
router.put("/", async (req, res) => {
  const { productId, quantity, size, color, guestId, userId } = req.body;

  try {
    // Input validation
    if (!productId || !size || !color || quantity === undefined) {
      return res.status(400).json({
        message: "Product ID, size, color, and quantity are required",
      });
    }

    if (!isValidObjectId(productId)) {
      return res.status(400).json({ message: "Invalid product ID format" });
    }

    if (quantity < 0) {
      return res.status(400).json({ message: "Quantity cannot be negative" });
    }

    // Validate product existence
    const product = await Product.findById(productId);
    if (!product) {
      return res.status(404).json({ message: "Product not found" });
    }

    if (quantity > product.countInStock) {
      return res.status(400).json({ message: "Not enough stock available" });
    }

    // Get the cart
    const cart = await getCartByUserOrGuestId(userId, guestId);
    if (!cart) {
      return res.status(404).json({ message: "Cart not found" });
    }

    // Find the product in the cart
    const productIndex = cart.products.findIndex(
      (p) =>
        p.productId._id.toString() === productId &&
        p.size === size &&
        p.color.name === color.name &&
        p.color.code === color.code
    );

    if (productIndex > -1) {
      if (quantity === 0) {
        // Remove product if quantity is 0
        cart.products.splice(productIndex, 1);
      } else {
        // Update quantity
        cart.products[productIndex].quantity = quantity;
      }

      await cart.save();
      return res.status(200).json(cart);
    } else {
      return res.status(404).json({ message: "Product not found in cart" });
    }
  } catch (error) {
    console.error("Error updating item in cart:", error);
    return res
      .status(500)
      .json({ message: "Error updating item in cart", error: error.message });
  }
});

// @route DELETE /api/cart
// @desc Remove item from cart for a guest or logged-in user
// @access Public
router.delete("/", async (req, res) => {
  const { productId, size, color, guestId, userId } = req.body;

  try {
    // Input validation
    if (!productId || !size || !color) {
      return res
        .status(400)
        .json({ message: "Product ID, size, and color are required" });
    }

    if (!isValidObjectId(productId)) {
      return res.status(400).json({ message: "Invalid product ID format" });
    }

    // Get the cart
    const cart = await getCartByUserOrGuestId(userId, guestId);
    if (!cart) {
      return res.status(404).json({ message: "Cart not found" });
    }

    // Find the product in the cart
    const productIndex = cart.products.findIndex(
      (p) =>
        p.productId._id.toString() === productId &&
        p.size === size &&
        p.color.name === color.name &&
        p.color.code === color.code
    );

    if (productIndex > -1) {
      cart.products.splice(productIndex, 1);
      await cart.save();
      return res.status(200).json(cart);
    } else {
      return res.status(404).json({ message: "Product not found in cart" });
    }
  } catch (error) {
    console.error("Error removing item from cart:", error);
    return res
      .status(500)
      .json({ message: "Error removing item from cart", error: error.message });
  }
});

// @route GET /api/cart
// @desc Get cart for a guest or logged-in user
// @access Public
router.get("/", async (req, res) => {
  const { guestId, userId } = req.query;

  try {
    if (!userId && !guestId) {
      return res
        .status(400)
        .json({ message: "Either userId or guestId must be provided" });
    }

    const cart = await getCartByUserOrGuestId(userId, guestId);
    if (!cart) {
      return res.status(404).json({ message: "Cart not found" });
    }

    return res.status(200).json(cart);
  } catch (error) {
    console.error("Error fetching cart:", error);
    return res
      .status(500)
      .json({ message: "Error fetching cart", error: error.message });
  }
});

// @route POST /api/cart/merge
// @desc Merge guest cart with user cart on login
// @access Private
router.post("/merge", authMiddleware, async (req, res) => {
  const { guestId } = req.body;

  try {
    console.log("=== CART MERGE START ===");
    console.log("User ID:", req.user._id);
    console.log("Guest ID:", guestId);

    // Input validation
    if (!guestId) {
      console.log("‚ùå No guestId provided");
      return res.status(400).json({ message: "Guest ID is required" });
    }

    // Find both carts with proper error handling
    const [userCart, guestCart] = await Promise.all([
      Cart.findOne({ user: req.user._id }).catch(() => null),
      Cart.findOne({ guestId: guestId }).catch(() => null),
    ]);

    console.log("Cart status:", {
      userCartExists: !!userCart,
      userCartProductCount: userCart?.products?.length || 0,
      guestCartExists: !!guestCart,
      guestCartProductCount: guestCart?.products?.length || 0,
    });

    // Case 1: No guest cart found
    if (!guestCart) {
      console.log("‚ÑπÔ∏è No guest cart found");
      if (userCart) {
        return res.status(200).json({
          message: "No guest cart found, returning existing user cart",
          cart: userCart,
        });
      } else {
        return res.status(200).json({
          message: "No carts found",
          cart: null,
        });
      }
    }

    // Case 2: Guest cart is empty
    if (!guestCart.products || guestCart.products.length === 0) {
      console.log("‚ÑπÔ∏è Guest cart is empty");
      await Cart.findOneAndDelete({ guestId: guestId });

      return res.status(200).json({
        message: "Guest cart was empty and has been cleaned up",
        cart: userCart || null,
      });
    }

    // Validate all products in guest cart still exist and get current prices
    const productIds = guestCart.products.map((item) => item.productId);
    const existingProducts = await Product.find({
      _id: { $in: productIds },
      isPublished: true,
    }).lean();

    const productMap = new Map(
      existingProducts.map((p) => [p._id.toString(), p])
    );

    // Case 3: User has existing cart - merge products
    if (userCart) {
      console.log("üîÑ Merging into existing user cart...");

      let mergeCount = 0;
      let updateCount = 0;
      let skippedCount = 0;

      for (const guestItem of guestCart.products) {
        const productIdStr = guestItem.productId.toString();
        const currentProduct = productMap.get(productIdStr);

        if (!currentProduct) {
          console.log(
            `‚ö†Ô∏è Skipping product ${productIdStr} - no longer available`
          );
          skippedCount++;
          continue;
        }

        // Update price to current price
        const currentPrice =
          currentProduct.discountPrice || currentProduct.price;

        const existingIndex = userCart.products.findIndex(
          (userItem) =>
            userItem.productId.toString() === productIdStr &&
            userItem.size === guestItem.size &&
            userItem.color.name === guestItem.color.name &&
            userItem.color.code === guestItem.color.code
        );

        if (existingIndex > -1) {
          // Product exists - add quantities
          const newQuantity =
            userCart.products[existingIndex].quantity + guestItem.quantity;

          // Check stock limit
          if (newQuantity <= currentProduct.countInStock) {
            userCart.products[existingIndex].quantity = newQuantity;
            userCart.products[existingIndex].price = currentPrice;
            updateCount++;
          } else {
            // Set to max available stock
            userCart.products[existingIndex].quantity =
              currentProduct.countInStock;
            userCart.products[existingIndex].price = currentPrice;
            console.log(
              `‚ö†Ô∏è Limited quantity for ${guestItem.name} due to stock`
            );
            updateCount++;
          }
        } else {
          // New product - add to cart
          const quantity = Math.min(
            guestItem.quantity,
            currentProduct.countInStock
          );
          userCart.products.push({
            productId: guestItem.productId,
            name: currentProduct.name,
            image: currentProduct.images[0]?.url || guestItem.image,
            price: currentPrice,
            quantity: quantity,
            size: guestItem.size,
            color: {
              name: guestItem.color.name,
              code: guestItem.color.code,
            },
          });
          mergeCount++;
        }
      }

      // Save merged cart
      await userCart.save();

      // Delete guest cart
      await Cart.findOneAndDelete({ guestId: guestId });

      console.log("‚úÖ Merge completed:", {
        mergeCount,
        updateCount,
        skippedCount,
      });
      return res.status(200).json({
        message: `Cart merged successfully. Added ${mergeCount} new items, updated ${updateCount} existing items${
          skippedCount > 0 ? `, skipped ${skippedCount} unavailable items` : ""
        }.`,
        cart: userCart,
        stats: {
          merged: mergeCount,
          updated: updateCount,
          skipped: skippedCount,
        },
      });
    } else {
      // Case 4: No user cart - convert guest cart to user cart
      console.log("üîÑ Converting guest cart to user cart...");

      // Filter out non-existent products and update prices
      const validProducts = [];
      let skippedCount = 0;

      for (const item of guestCart.products) {
        const productIdStr = item.productId.toString();
        const currentProduct = productMap.get(productIdStr);

        if (currentProduct) {
          validProducts.push({
            productId: item.productId,
            name: currentProduct.name,
            image: currentProduct.images[0]?.url || item.image,
            price: currentProduct.discountPrice || currentProduct.price,
            quantity: Math.min(item.quantity, currentProduct.countInStock),
            size: item.size,
            color: {
              name: item.color.name,
              code: item.color.code,
            },
          });
        } else {
          skippedCount++;
        }
      }

      // Update guest cart and convert to user cart
      guestCart.user = req.user._id;
      guestCart.guestId = undefined;
      guestCart.products = validProducts;

      await guestCart.save();

      console.log("‚úÖ Guest cart converted to user cart");
      return res.status(200).json({
        message: `Guest cart converted to user cart successfully${
          skippedCount > 0
            ? `. ${skippedCount} unavailable items were removed.`
            : ""
        }.`,
        cart: guestCart,
      });
    }
  } catch (error) {
    console.error("‚ùå Error merging carts:", error);
    return res.status(500).json({
      message: "Error merging carts",
      error: error.message,
    });
  }
});

// @route DELETE /api/cart/clear
// @desc Clear entire cart
// @access Public
router.delete("/clear", async (req, res) => {
  const userId = req.body.userId || req.query.userId;
  const guestId = req.body.guestId || req.query.guestId;

  try {
    console.log("=== CLEAR CART REQUEST ===");
    console.log("Request body:", req.body);
    console.log("Request query:", req.query);
    console.log("Headers:", req.headers);

    if (!userId && !guestId) {
      console.log("‚ùå No userId or guestId provided");
      return res
        .status(400)
        .json({ message: "Either userId or guestId must be provided" });
    }

    // X√≥a theo c·∫£ hai ƒëi·ªÅu ki·ªán n·∫øu c√≥
    const query = [];
    if (userId && isValidObjectId(userId)) query.push({ user: userId });
    if (guestId) query.push({ guestId: guestId });

    console.log("Query:", query);

    let result = null;
    if (query.length === 1) {
      result = await Cart.findOneAndDelete(query[0]);
    } else if (query.length === 2) {
      // X√≥a c·∫£ hai, ∆∞u ti√™n user tr∆∞·ªõc
      result = await Cart.findOneAndDelete(query[0]);
      if (!result) result = await Cart.findOneAndDelete(query[1]);
    }

    console.log("Delete result:", result);

    if (!result) {
      console.log("‚ùå Cart not found");
      return res.status(404).json({ message: "Cart not found" });
    }

    console.log("‚úÖ Cart cleared successfully");
    return res.status(200).json({ message: "Cart cleared successfully" });
  } catch (error) {
    console.error("‚ùå Error clearing cart:", error);
    return res
      .status(500)
      .json({ message: "Error clearing cart", error: error.message });
  }
});

module.exports = router;


===== FILE: ./backend/routes/checkoutRoutes.js =====
const express = require('express');
const Checkout = require('../models/Checkout');
const { authMiddleware, isAdmin } = require('../middleware/authMiddleware');
const Cart = require('../models/Cart');
const Product = require('../models/Product');
const Order = require('../models/Order');

const router = express.Router();

// @route POST /api/checkout
// @desc Create a new checkout session
// @access Private
router.post('/', authMiddleware, async (req, res) => {
    const { checkoutItems, shippingAddress, paymentMethod, totalPrice } = req.body;

    if (!checkoutItems || checkoutItems.length === 0 || !shippingAddress || !paymentMethod || !totalPrice) {
        return res.status(400).json({ message: 'All fields are required' });
    }

    try {
        // Validate all products exist and have enough stock
        const productIds = checkoutItems.map(item => item.productId);
        const products = await Product.find({
            _id: { $in: productIds },
            isPublished: true
        });

        const productMap = new Map(
            products.map(p => [p._id.toString(), p])
        );

        // Check each item
        for (const item of checkoutItems) {
            const product = productMap.get(item.productId.toString());

            if (!product) {
                return res.status(400).json({
                    message: `Product ${item.name} is no longer available`
                });
            }

            if (product.countInStock < item.quantity) {
                return res.status(400).json({
                    message: `Not enough stock for ${item.name}. Available: ${product.countInStock}`
                });
            }
        }

        const newCheckout = await Checkout.create({
            user: req.user._id,
            checkoutItems: checkoutItems,
            shippingAddress,
            paymentMethod,
            totalPrice,
            paymentStatus: 'Pending',
            isPaid: false
        });

        console.log(`Checkout created for user: ${req.user._id}`);
        res.status(201).json(newCheckout);
    } catch (error) {
        console.error("Error Creating checkout session", error);
        return res.status(500).json({ message: 'Server error' });
    }
});

// @route PUT /api/checkout/:id/pay
// @desc Update checkout to mark as paid after successful payment
// @access Private
router.put('/:id/pay', authMiddleware, async (req, res) => {
    const { paymentStatus, paymentDetails } = req.body;

    try {
        const checkout = await Checkout.findById(req.params.id);
        if (!checkout) {
            return res.status(404).json({ message: 'Checkout not found' });
        }

        // Verify checkout belongs to user
        if (checkout.user.toString() !== req.user._id.toString()) {
            return res.status(403).json({ message: 'Not authorized' });
        }

        if (paymentStatus === 'Paid') {
            checkout.isPaid = true;
            checkout.paymentStatus = paymentStatus;
            checkout.paidAt = new Date();
            checkout.paymentDetails = paymentDetails;
            await checkout.save();
            res.status(200).json(checkout);
        } else {
            return res.status(400).json({ message: 'Invalid payment status' });
        }
    } catch (error) {
        console.error("Error updating checkout payment status", error);
        return res.status(500).json({ message: 'Server error' });
    }
});

// @route POST /api/checkout/:id/finalize
// @desc Finalize checkout and convert to order after payment confirmation
// @access Private
router.post('/:id/finalize', authMiddleware, async (req, res) => {
    try {
        const checkout = await Checkout.findById(req.params.id);
        if (!checkout) {
            return res.status(404).json({ message: 'Checkout not found' });
        }

        // Verify checkout belongs to user
        if (checkout.user.toString() !== req.user._id.toString()) {
            return res.status(403).json({ message: 'Not authorized' });
        }

        if (!checkout.isFinalized) {
            // Final validation before creating order
            const productIds = checkout.checkoutItems.map(item => item.productId);
            const products = await Product.find({
                _id: { $in: productIds },
                isPublished: true
            });

            const productMap = new Map(
                products.map(p => [p._id.toString(), p])
            );

            // Update stock for each product
            for (const item of checkout.checkoutItems) {
                const product = productMap.get(item.productId.toString());

                if (!product) {
                    return res.status(400).json({
                        message: `Product ${item.name} is no longer available`
                    });
                }

                if (product.countInStock < item.quantity) {
                    return res.status(400).json({
                        message: `Not enough stock for ${item.name}. Available: ${product.countInStock}`
                    });
                }

                // Reduce stock
                product.countInStock -= item.quantity;
                await product.save();
            }

            // T·∫°o order v·ªõi tr·∫°ng th√°i ph√π h·ª£p v·ªõi ph∆∞∆°ng th·ª©c thanh to√°n
            const isPaidOrder = checkout.paymentMethod === 'bank_transfer';

            const finalOrder = await Order.create({
                user: checkout.user,
                orderItems: checkout.checkoutItems,
                shippingAddress: checkout.shippingAddress,
                paymentMethod: checkout.paymentMethod,
                totalPrice: checkout.totalPrice,
                isPaid: isPaidOrder, // true n·∫øu l√† bank_transfer, false n·∫øu l√† COD
                paidAt: isPaidOrder ? new Date() : null,
                isDelivered: false,
                paymentStatus: isPaidOrder ? "Paid" : "Pending",
                status: 'Processing'
            });

            // Mark checkout as finalized
            checkout.isFinalized = true;
            checkout.finalizedAt = Date.now();
            await checkout.save();

            // Delete the cart
            if (checkout.user) {
                await Cart.findOneAndDelete({ user: checkout.user });
            } else if (checkout.guestId) {
                await Cart.findOneAndDelete({ guestId: checkout.guestId });
            }

            res.status(201).json(finalOrder);
        } else {
            return res.status(400).json({ message: 'Checkout already finalized' });
        }
    } catch (error) {
        console.error("Error finalizing checkout", error);
        return res.status(500).json({ message: 'Server error' });
    }
});

// @route GET /api/checkout/:id
// @desc Get checkout details
// @access Private
router.get('/:id', authMiddleware, async (req, res) => {
    try {
        const checkout = await Checkout.findById(req.params.id)
            .populate('user', 'name email')
            .populate('checkoutItems.productId', 'name price images');

        if (!checkout) {
            return res.status(404).json({ message: 'Checkout not found' });
        }

        // Verify checkout belongs to user (unless admin)
        if (checkout.user._id.toString() !== req.user._id.toString() && req.user.role !== 'admin') {
            return res.status(403).json({ message: 'Not authorized' });
        }

        res.status(200).json(checkout);
    } catch (error) {
        console.error("Error fetching checkout", error);
        return res.status(500).json({ message: 'Server error' });
    }
});

module.exports = router;

===== FILE: ./backend/routes/collectionRoutes.js =====
const express = require("express");
const router = express.Router();
const Collection = require("../models/Collection");
const Product = require("../models/Product");

// L·∫•y t·∫•t c·∫£ b·ªô s∆∞u t·∫≠p
router.get("/", async (req, res) => {
  try {
    const collections = await Collection.find();
    // V·ªõi m·ªói collection, t√¨m c√°c s·∫£n ph·∫©m thu·ªôc collection ƒë√≥
    const collectionsWithProducts = await Promise.all(
      collections.map(async (col) => {
        const products = await Product.find({
          collection: col.id,
          isPublished: true,
        });
        return { ...col.toObject(), products };
      })
    );
    res.json(collectionsWithProducts);
  } catch (err) {
    res.status(500).json({ message: err.message });
  }
});

// L·∫•y b·ªô s∆∞u t·∫≠p theo MongoDB _id
router.get("/:id", async (req, res) => {
  try {
    const collection = await Collection.findOne({ id: req.params.id });
    if (!collection)
      return res.status(404).json({ message: "Kh√¥ng t√¨m th·∫•y b·ªô s∆∞u t·∫≠p" });

    // T√¨m c√°c s·∫£n ph·∫©m thu·ªôc collection n√†y
    const products = await Product.find({
      collection: collection.id,
      isPublished: true,
    });
    res.json({ ...collection.toObject(), products });
  } catch (err) {
    res.status(500).json({ message: err.message });
  }
});

// L·∫•y s·∫£n ph·∫©m theo collection id (t·ª± nh·∫≠p)
router.get("/:id/products", async (req, res) => {
  try {
    const { color, size, material, category, price, sortBy } = req.query;
    console.log("Filter params received:", {
      color,
      size,
      material,
      category,
      price,
      sortBy,
    });

    const query = { collection: req.params.id }; // S·ª≠ d·ª•ng id t·ª± nh·∫≠p

    if (color) {
      const colors = color.split(",").map(c => c.toUpperCase());
      query["colors.code"] = {
        $in: colors.map(c => new RegExp(c.startsWith("#") ? c : `#${c}`, "i"))
      };
    }
    if (size) query.sizes = { $in: size.split(",") };
    if (material) {
      const materials = material.split(",");
      query.material = materials.length > 1 ? { $in: materials } : material;
    }
    if (category) {
      const categories = category.split(",");
      query.category = categories.length > 1 ? { $in: categories } : category;
    }
    if (price) {
      if (price.startsWith("under-")) {
        query.price = { $lt: Number(price.replace("under-", "")) * 1000 };
      } else if (price.startsWith("above-")) {
        query.price = { $gt: Number(price.replace("above-", "")) * 1000 };
      } else if (price.includes("-")) {
        const [min, max] = price.split("-").map(Number);
        query.price = { $gte: min * 1000, $lte: max * 1000 };
      }
    }

    let sortOptions = {};
    switch (sortBy) {
      case "price_asc":
        sortOptions = { price: 1 };
        break;
      case "price_desc":
        sortOptions = { price: -1 };
        break;
      case "newest":
        sortOptions = { createdAt: -1 };
        break;
      case "name_asc":
        sortOptions = { name: 1 };
        break;
      case "name_desc":
        sortOptions = { name: -1 };
        break;
    }

    const products = await Product.find(query).sort(sortOptions);
    res.json(products);
  } catch (err) {
    res.status(500).json({ message: err.message });
  }
});

// T·∫°o m·ªõi b·ªô s∆∞u t·∫≠p
router.post("/", async (req, res) => {
  try {
    const { id, name, bannerUrl, description, categories, status } = req.body;
    const collection = new Collection({
      id,
      name,
      bannerUrl,
      description,
      categories: categories || [],
      status: status || "active",
    });
    await collection.save();
    res.status(201).json(collection);
  } catch (err) {
    if (err.code === 11000) {
      // Duplicate key error
      return res.status(400).json({
        message: "ID b·ªô s∆∞u t·∫≠p ƒë√£ t·ªìn t·∫°i, vui l√≤ng ch·ªçn ID kh√°c",
      });
    }
    res.status(400).json({ message: err.message });
  }
});

// C·∫≠p nh·∫≠t b·ªô s∆∞u t·∫≠p theo _id
router.put("/:id", async (req, res) => {
  try {
    const { name, bannerUrl, description, categories, status } = req.body;
    const collection = await Collection.findOne({ id: req.params.id });
    if (!collection)
      return res.status(404).json({ message: "Kh√¥ng t√¨m th·∫•y b·ªô s∆∞u t·∫≠p" });

    if (name) collection.name = name;
    if (bannerUrl) collection.bannerUrl = bannerUrl;
    if (description) collection.description = description;
    if (categories !== undefined) {
      console.log(
        "C·∫≠p nh·∫≠t categories cho collection",
        req.params.id,
        categories
      );
      collection.categories = categories;
    }
    if (status) collection.status = status;

    await collection.save();
    res.json(collection);
  } catch (err) {
    res.status(400).json({ message: err.message });
  }
});

// X√≥a b·ªô s∆∞u t·∫≠p theo _id
router.delete("/:id", async (req, res) => {
  try {
    const collection = await Collection.findOne({ id: req.params.id });
    if (!collection)
      return res.status(404).json({ message: "Kh√¥ng t√¨m th·∫•y b·ªô s∆∞u t·∫≠p" });
    await collection.remove();
    res.json({ message: "ƒê√£ x√≥a b·ªô s∆∞u t·∫≠p" });
  } catch (err) {
    res.status(500).json({ message: err.message });
  }
});

module.exports = router;


===== FILE: ./backend/routes/orderRoutes.js =====
const express = require("express");
const Order = require("../models/Order");
const { authMiddleware, isAdmin } = require("../middleware/authMiddleware");

const router = express.Router();

// @route   GET /api/orders/my-orders
// @desc    Get logged in user's orders
// @access  Private
router.get("/my-orders", authMiddleware, async (req, res) => {
  try {
    const orders = await Order.find({ user: req.user._id }).sort({
      createdAt: -1,
    });
    res.json(orders);
  } catch (error) {
    console.error("Error fetching user orders:", error);
    res.status(500).json({ message: "Server error" });
  }
});

// @route   GET /api/orders/:id
// @desc    Get order by ID
// @access  Private
router.get("/:id", authMiddleware, async (req, res) => {
  try {
    const order = await Order.findById(req.params.id).populate(
      "user",
      "name email"
    );
    if (!order) {
      return res.status(404).json({ message: "Order not found" });
    }
    res.json(order);
  } catch (error) {
    console.error("Error fetching order:", error);
    res.status(500).json({ message: "Server error" });
  }
});

// @route   POST /api/orders
// @desc    Create a new order
// @access  Private
router.post("/", authMiddleware, async (req, res) => {
  try {
    // Nh·∫≠n to√†n b·ªô d·ªØ li·ªáu form v√† cartItems t·ª´ frontend
    const { formData, cartItems, totalPrice } = req.body;
    if (!cartItems || cartItems.length === 0) {
      return res.status(400).json({ message: "No order items" });
    }
    // Validate th√¥ng tin giao h√†ng
    if (
      !formData ||
      !formData.fullName ||
      !formData.phone ||
      !formData.address ||
      !formData.city ||
      !formData.district ||
      !formData.ward
    ) {
      return res.status(400).json({ message: "Thi·∫øu th√¥ng tin giao h√†ng" });
    }
    // Chu·∫©n h√≥a d·ªØ li·ªáu orderItems t·ª´ cartItems (l·∫•y th√¥ng tin s·∫£n ph·∫©m t·ª´ DB)
    const productIds = cartItems.map((item) => item.productId);
    const products = await require("../models/Product").find({
      _id: { $in: productIds },
    });
    const productMap = new Map(products.map((p) => [p._id.toString(), p]));
    const orderItems = cartItems.map((item) => {
      const product = productMap.get((item.productId || "").toString());
      if (!product)
        throw new Error(`Kh√¥ng t√¨m th·∫•y s·∫£n ph·∫©m v·ªõi id ${item.productId}`);
      return {
        productId: product._id,
        name: product.name,
        image: product.images?.[0]?.url || "",
        price: product.discountPrice || product.price,
        size: item.size,
        color: item.color,
        quantity: item.quantity,
      };
    });
    // ƒê·ªãa ch·ªâ giao h√†ng
    const shippingAddress = {
      address: formData.address,
      city: formData.city,
      district: formData.district,
      ward: formData.ward,
      postalCode: formData.postalCode,
      country: formData.country,
      notes: formData.notes,
    };
    // X·ª≠ l√Ω tr·∫°ng th√°i thanh to√°n ph√≠a backend
    let isPaid = false;
    let paidAt = null;
    let paymentStatus = "Pending";
    if (formData.paymentMethod === "bank_transfer") {
      isPaid = true;
      paidAt = new Date();
      paymentStatus = "Paid";
    }
    const order = new Order({
      user: req.user._id,
      orderItems,
      shippingAddress,
      paymentMethod: formData.paymentMethod,
      totalPrice,
      isPaid,
      paidAt,
      paymentStatus,
      status: "Processing",
    });
    // Ghi log chi ti·∫øt khi t·∫°o ƒë∆°n h√†ng m·ªõi
    console.log("[ORDER] D·ªØ li·ªáu nh·∫≠n t·ª´ frontend:", {
      formData,
      cartItems,
      totalPrice,
    });
    console.log("[ORDER] T·∫°o ƒë∆°n h√†ng m·ªõi:", {
      user: req.user?._id,
      orderItems,
      shippingAddress,
      paymentMethod: formData.paymentMethod,
      totalPrice,
      isPaid,
      paidAt,
      paymentStatus,
      status: "Processing",
      createdAt: new Date(),
    });
    const createdOrder = await order.save();
    res.status(201).json(createdOrder);
  } catch (error) {
    console.error("Error creating order:", error);
    // Ghi log chi ti·∫øt l·ªói ƒë·ªÉ debug
    if (error instanceof Error) {
      res.status(500).json({
        message: "Server error",
        error: error.message,
        stack: error.stack,
      });
    } else {
      res.status(500).json({ message: "Server error", error });
    }
  }
});

// @route   PUT /api/orders/:id/update-stock
// @desc    Update product stock after order is placed
// @access  Private
router.put("/:id/update-stock", authMiddleware, async (req, res) => {
  try {
    const order = await Order.findById(req.params.id);
    if (!order) {
      return res.status(404).json({ message: "Order not found" });
    }

    // Verify order belongs to user
    if (order.user.toString() !== req.user._id.toString()) {
      return res.status(403).json({ message: "Not authorized" });
    }

    // Update stock for each product in the order
    const Product = require("../models/Product");
    for (const item of order.orderItems) {
      const product = await Product.findById(item.productId);
      if (product) {
        if (product.countInStock >= item.quantity) {
          product.countInStock -= item.quantity;
          await product.save();
          console.log(
            `[STOCK] Updated product ${product.name}: -${item.quantity}, remaining: ${product.countInStock}`
          );
        } else {
          console.warn(
            `[STOCK] Insufficient stock for product ${product.name}: requested ${item.quantity}, available ${product.countInStock}`
          );
          return res.status(400).json({
            message: `Kh√¥ng ƒë·ªß h√†ng t·ªìn kho cho s·∫£n ph·∫©m ${product.name}`,
          });
        }
      } else {
        console.warn(`[STOCK] Product not found: ${item.productId}`);
        return res.status(404).json({
          message: `Kh√¥ng t√¨m th·∫•y s·∫£n ph·∫©m v·ªõi ID ${item.productId}`,
        });
      }
    }

    res.json({ message: "Stock updated successfully", order });
  } catch (error) {
    console.error("Error updating stock:", error);
    res.status(500).json({ message: "Server error", error: error.message });
  }
});

module.exports = router;


===== FILE: ./backend/routes/paymentRoutes.js =====
const express = require("express");
const router = express.Router();
const axios = require("axios");

// GET /api/payment/check?orderCode=...&amount=...&phone=...
router.get("/check", async (req, res) => {
  const { orderCode, amount, phone } = req.query;
  if (!orderCode || !amount || !phone) {
    return res.status(400).json({
      error: true,
      message: "Thi·∫øu tham s·ªë orderCode, amount ho·∫∑c phone",
    });
  }
  const API_URL =
    "https://script.google.com/macros/s/AKfycbxMRUJYZWJdNtr4k2pcD4-T7OR8k4nz8jPnDFCm2F6ChwEYP3IT6v-x0OnZIfmmPKdl/exec";
  try {
    const response = await axios.get(API_URL);
    const transactions = response.data;
    // Log giao d·ªãch l·∫•y ƒë∆∞·ª£c
    console.log("[API/payment/check] transactions:", transactions);
    // Log n·ªôi dung ƒë·ªëi chi·∫øu
    console.log("[API/payment/check] ƒê·ªëi chi·∫øu v·ªõi:", {
      orderCode,
      amount,
      phone,
    });
    res.json({ transactions });
  } catch (err) {
    console.error("[API/payment/check] L·ªói:", err);
    res.status(500).json({
      error: true,
      message: "Kh√¥ng th·ªÉ x√°c th·ª±c thanh to√°n. Vui l√≤ng th·ª≠ l·∫°i sau!",
    });
  }
});

module.exports = router;


===== FILE: ./backend/routes/productAdminRoutes.js =====
const express = require('express');
const Product = require('../models/Product');
const { authMiddleware, isAdmin } = require('../middleware/authMiddleware');
const router = express.Router();

// @route  GET /api/admin/products
// @desc   Get all products
// @access Private/Admin
router.get("/", authMiddleware, isAdmin, async (req, res) => {
    try {
        const products = await Product.find();
        res.json(products);
    } catch (error) {
        console.error('Error fetching products:', error);
        res.status(500).json({ message: 'Server error' });
    }
});

module.exports = router;

===== FILE: ./backend/routes/productRoutes.js =====
const express = require("express");
const Product = require("../models/Product");
const { authMiddleware, isAdmin } = require("../middleware/authMiddleware");
const router = express.Router();

// @route   POST /api/products
// @desc    Create a new product
// @access  Private/Admin
router.get("/search", async (req, res) => {
  const { query } = req.query;
  try {
    // T√¨m ki·∫øm kh√¥ng ph√¢n bi·ªát hoa th∆∞·ªùng, c√≥ th·ªÉ d√πng regex
    const products = await Product.find({
      name: { $regex: query, $options: "i" },
    });
    res.json({ products }); // ƒê·∫£m b·∫£o tr·∫£ v·ªÅ object c√≥ key "products"
  } catch (error) {
    res
      .status(500)
      .json({ message: "Error searching products", error: error.message });
  }
});

router.post("/", authMiddleware, isAdmin, async (req, res) => {
  try {
    const {
      name,
      description,
      price,
      discountPrice,
      countInStock,
      sku,
      category,
      // brand,
      sizes,
      colors,
      collection,
      material,
      gender,
      images,
      isFeatured,
      isPublished,
      tags,
      metaTitle,
      metaDescription,
      metaKeywords,
      dimensions,
    } = req.body;

    // Validate required fields
    if (
      !name ||
      !description ||
      !price ||
      !sku ||
      !category ||
      // !brand || !sizes || !sizes.length || !color || !collection || !material || !gender ||
      !sizes ||
      !sizes.length ||
      !colors ||
      !colors.length ||
      !collection ||
      !material ||
      !gender ||
      !images ||
      !dimensions ||
      !dimensions.weight
    ) {
      return res.status(400).json({ message: "Missing required fields" });
    }

    const product = new Product({
      name,
      description,
      price,
      discountPrice,
      countInStock,
      sku,
      category,
      // brand,
      sizes,
      colors,
      collection,
      material,
      gender,
      images,
      isFeatured,
      isPublished,
      tags,
      metaTitle,
      metaDescription,
      metaKeywords,
      dimensions,
      user: req.user._id, // Set the user who created the product
    });

    const newProduct = await product.save();
    // await product.save();
    res.status(201).json(newProduct);
  } catch (error) {
    console.error(error);
    if (error.code === 11000) {
      return res
        .status(400)
        .json({ message: "Product with this SKU already exists" });
    }
    res.status(500).json({ message: "Server error" });
  }
});

// @route   PUT /api/products/:id
// @desc    Update an existing product
// @access  Private/Admin
router.put("/:id", authMiddleware, isAdmin, async (req, res) => {
  try {
    const productId = req.params.id;

    // T√¨m s·∫£n ph·∫©m hi·ªán c√≥
    const product = await Product.findById(productId);
    if (!product) {
      return res.status(404).json({ message: "Product not found" });
    }

    // C·∫≠p nh·∫≠t ch·ªâ nh·ªØng tr∆∞·ªùng ƒë∆∞·ª£c cung c·∫•p trong request body
    Object.keys(req.body).forEach((key) => {
      // ƒê·∫£m b·∫£o ch·ªâ c·∫≠p nh·∫≠t nh·ªØng tr∆∞·ªùng h·ª£p l·ªá
      if (product.schema.paths[key]) {
        product[key] = req.body[key];
      }
    });

    const updatedProduct = await product.save();
    res.status(200).json(updatedProduct);
  } catch (error) {
    console.error(error);
    if (error.code === 11000) {
      return res
        .status(400)
        .json({ message: "Product with this SKU already exists" });
    }
    res.status(500).json({ message: "Server error" });
  }
});
// @route   DELETE /api/products/:id
// @desc    Delete a product
// @access  Private/Admin
router.delete("/:id", authMiddleware, isAdmin, async (req, res) => {
  try {
    const productId = req.params.id;

    const product = await Product.findById(productId);
    if (!product) {
      return res.status(404).json({ message: "Product not found" });
    }

    // C√°ch 1: S·ª≠ d·ª•ng deleteOne()
    await product.deleteOne();

    // HO·∫∂C C√°ch 2: S·ª≠ d·ª•ng findByIdAndDelete (kh√¥ng c·∫ßn t√¨m tr∆∞·ªõc)
    // await Product.findByIdAndDelete(productId);

    res.status(200).json({ message: "Product deleted successfully" });
  } catch (error) {
    console.error(error);
    res.status(500).json({ message: "Server error" });
  }
});

// @route   GET /api/products
// @desc    Get all products
router.get("/", async (req, res) => {
  try {
    const {
      collection,
      sizes,
      color,
      gender,
      minPrice,
      maxPrice,
      sortBy,
      search,
      category,
      material,
      brand,
      limit,
      page = 1,
      featured,
      published,
      onSale,
      fields,
    } = req.query;

    let query = {};

    // Filtering by collection (support comma-separated values)
    if (collection) {
      const collections = collection.split(",");
      query.collection =
        collections.length > 1 ? { $in: collections } : collection;
    }

    // Filtering by sizes (support comma-separated values)
    if (sizes) {
      const sizess = sizes.split(",");
      query.sizes = sizess.length > 1 ? { $in: sizess } : sizes;
    }

    // Filtering by color (support comma-separated values)
    if (color) {
      const colors = color.split(",").map(c => c.toUpperCase());
      query["colors.code"] = {
        $in: colors.map(c => new RegExp(c.startsWith("#") ? c : `#${c}`, "i"))
      };
    }

    // Filtering by gender (support comma-separated values)
    if (gender) {
      const genders = gender.split(",");
      query.gender = genders.length > 1 ? { $in: genders } : gender;
    }

    // Filtering by price (from price param: under-500, 500-1000, ...)
    if (req.query.price) {
      let min, max;
      if (req.query.price === "under-500") {
        max = 500000;
      } else if (req.query.price === "500-1000") {
        min = 500000;
        max = 1000000;
      } else if (req.query.price === "1000-1500") {
        min = 1000000;
        max = 1500000;
      } else if (req.query.price === "above-1500") {
        min = 1500000;
      }
      query.price = {};
      if (min) query.price.$gte = min;
      if (max) query.price.$lte = max;
    }

    // Filtering by price range (minPrice, maxPrice)
    if (minPrice || maxPrice) {
      query.price = query.price || {};
      if (minPrice) query.price.$gte = Number(minPrice);
      if (maxPrice) query.price.$lte = Number(maxPrice);
    }

    // Filtering by category (support comma-separated values)
    if (category) {
      const categories = category.split(",");
      query.category = categories.length > 1 ? { $in: categories } : category;
    }

    // Filtering by material (support comma-separated values)
    if (material) {
      const materials = material.split(",");
      query.material = materials.length > 1 ? { $in: materials } : material;
    }

    // Filtering by brand (support comma-separated values)
    if (brand) {
      const brands = brand.split(",");
      query.brand = brands.length > 1 ? { $in: brands } : brand;
    }

    // Filter by featured products
    if (featured !== undefined) {
      query.isFeatured = featured === "true";
    }

    // Filter by published status
    if (published !== undefined) {
      query.isPublished = published === "true";
    }

    // Filter products on sale (with discount)
    if (onSale === "true") {
      query.discountPrice = { $ne: null, $gt: 0 };
    }

    // Search by name or description
    if (search) {
      query.$or = [
        { name: { $regex: search, $options: "i" } },
        { description: { $regex: search, $options: "i" } },
      ];
    }

    // Th√™m log ƒë·ªÉ debug
    console.log("[PRODUCT SEARCH] search:", search);
    console.log("[PRODUCT SEARCH] final query:", JSON.stringify(query));

    // Sorting
    let sortOptions = {};
    if (sortBy) {
      switch (sortBy) {
        case "price_asc":
          sortOptions = { price: 1 };
          break;
        case "price_desc":
          sortOptions = { price: -1 };
          break;
        case "newest":
          sortOptions = { createdAt: -1 };
          break;
        case "popularity":
          sortOptions = { popularity: -1 };
          break;
        case "name_asc":
          sortOptions = { name: 1 };
          break;
        case "name_desc":
          sortOptions = { name: -1 };
          break;
        case "discount":
          sortOptions = { discountPrice: 1, price: -1 };
          break;
        default:
          sortOptions = { createdAt: -1 }; // Default sorting
      }
    }

    // Field selection/projection
    let projection = {};
    if (fields) {
      fields.split(",").forEach((field) => {
        projection[field] = 1;
      });
    }

    // Pagination
    const pagesizes = parseInt(limit) || 10;
    const skip = (parseInt(page) - 1) * pagesizes;

    // Execute query with pagination
    const totalProducts = await Product.countDocuments(query);
    const products = await Product.find(query, projection)
      .sort(sortOptions)
      .skip(skip)
      .limit(pagesizes);

    // Return products with pagination metadata
    res.status(200).json({
      products,
      page: parseInt(page),
      pages: Math.ceil(totalProducts / pagesizes),
      totalProducts,
      filters: {
        appliedFilters: Object.keys(query).length,
        query: query,
      },
      // message: totalProducts === 0 ? "No products found matching your criteria" : null
    });
  } catch (error) {
    console.error(error);
    if (error.name === "CastError") {
      return res.status(400).json({ message: "Invalid parameter format" });
    }
    res.status(500).json({ message: "Server error", error: error.message });
  }
});

// @route   GET /api/products/similar/:id
// @desc    Get similar products based on category, brand, or collection
// @access  Public
router.get("/similar/:id", async (req, res) => {
  try {
    const productId = req.params.id;
    const product = await Product.findById(productId);
    if (!product) {
      return res.status(404).json({ message: "Kh√¥ng t√¨m th·∫•y s·∫£n ph·∫©m" });
    }

    // T·∫°o truy v·∫•n t√¨m s·∫£n ph·∫©m t∆∞∆°ng t·ª±
    const similarQuery = {
      _id: { $ne: productId },
      isPublished: true,
      $or: [
        { category: product.category },
        { brand: product.brand },
        { collection: product.collection },
      ],
    };

    // Th√™m ƒëi·ªÅu ki·ªán v·ªÅ gender n·∫øu c√≥
    if (product.gender) {
      similarQuery.gender = product.gender;
    }

    // T√¨m v√† s·∫Øp x·∫øp s·∫£n ph·∫©m t∆∞∆°ng t·ª±
    // $facet cho ph√©p t·∫°o c√°c nh√≥m k·∫øt qu·∫£ kh√°c nhau
    const similarProducts = await Product.aggregate([
      { $match: similarQuery },
      {
        $addFields: {
          similarity: {
            $add: [
              { $cond: [{ $eq: ["$category", product.category] }, 3, 0] },
              { $cond: [{ $eq: ["$brand", product.brand] }, 2, 0] },
              { $cond: [{ $eq: ["$collection", product.collection] }, 1, 0] },
            ],
          },
        },
      },
      {
        $facet: {
          // Nh√≥m 1: S·∫£n ph·∫©m c√πng danh m·ª•c
          sameCategory: [
            { $match: { category: product.category } },
            { $sort: { createdAt: -1 } },
            { $limit: 5 },
            {
              $project: {
                name: 1,
                price: 1,
                discountPrice: 1,
                images: 1,
                category: 1,
                brand: 1,
                collection: 1,
              },
            },
          ],
          // Nh√≥m 2: S·∫£n ph·∫©m c√πng th∆∞∆°ng hi·ªáu
          sameBrand: [
            { $match: { brand: product.brand } },
            { $sort: { createdAt: -1 } },
            { $limit: 5 },
            {
              $project: {
                name: 1,
                price: 1,
                discountPrice: 1,
                images: 1,
                category: 1,
                brand: 1,
                collection: 1,
              },
            },
          ],
          // Nh√≥m 3: S·∫£n ph·∫©m t·ªïng h·ª£p theo ƒëi·ªÉm t∆∞∆°ng ƒë·ªìng
          recommended: [
            { $sort: { similarity: -1, createdAt: -1 } },
            { $limit: 10 },
            {
              $project: {
                name: 1,
                price: 1,
                discountPrice: 1,
                images: 1,
                category: 1,
                brand: 1,
                collection: 1,
                similarity: 1,
              },
            },
          ],
        },
      },
    ]);

    res.status(200).json(similarProducts[0]); // $facet lu√¥n tr·∫£ v·ªÅ m·ªôt m·∫£ng, n√™n l·∫•y ph·∫ßn t·ª≠ ƒë·∫ßu ti√™n
  } catch (error) {
    console.error(error);
    if (error.name === "CastError") {
      return res.status(400).json({ message: "ID s·∫£n ph·∫©m kh√¥ng h·ª£p l·ªá" });
    }
    res.status(500).json({ message: "L·ªói server", error: error.message });
  }
});

// @route   GET /api/products/best-sellers
// @desc    Get best-selling products rating
// @access Public
router.get("/best-sellers", async (req, res) => {
  try {
    const bestSellers = await Product.find({ isPublished: true })
      .sort({ rating: -1, numReviews: -1 }) // S·∫Øp x·∫øp theo rating v√† s·ªë l∆∞·ª£ng review
      .limit(10)
      .select("name price discountPrice images category brand collection");

    res.status(200).json(bestSellers);
  } catch (error) {
    console.error(error);
    res.status(500).json({ message: "Server error", error: error.message });
  }
});

// @route   GET /api/products/new-arrivals
// @desc    Get new arrivals products
// @access Public
router.get("/new-arrivals", async (req, res) => {
  try {
    const newArrivals = await Product.find({ isPublished: true })
      .sort({ createdAt: -1 }) // S·∫Øp x·∫øp theo ng√†y t·∫°o m·ªõi nh·∫•t
      .limit(10)
      .select("name price discountPrice images category brand collection");

    res.status(200).json(newArrivals);
  } catch (error) {
    console.error(error);
    res.status(500).json({ message: "Server error", error: error.message });
  }
});

// G·ª£i √Ω t√¨m ki·∫øm s·∫£n ph·∫©m theo t√™n
router.get("/suggest", async (req, res) => {
  try {
    const { query } = req.query;
    if (!query || query.trim() === "") {
      return res.json([]);
    }
    // T√¨m c√°c s·∫£n ph·∫©m c√≥ t√™n ch·ª©a query (kh√¥ng ph√¢n bi·ªát hoa th∆∞·ªùng)
    const suggestions = await Product.find({
      name: { $regex: query, $options: "i" },
    })
      .limit(8)
      .select("name"); // ch·ªâ l·∫•y t√™n

    res.json(suggestions.map((p) => p.name));
  } catch (error) {
    res.status(500).json({ message: "Server error" });
  }
});

// Route ƒë·ªông :id ph·∫£i ƒë·∫∑t sau t·∫•t c·∫£ c√°c route ƒë·∫∑c bi·ªát
router.get("/:id", async (req, res) => {
  try {
    const productId = req.params.id;
    const product = await Product.findById(productId).populate(
      "user",
      "name email"
    ); // Populate user details
    // .populate('category', 'name') // Populate category details
    // .populate('brand', 'name') // Populate brand details
    // .populate('collection', 'name') // Populate collection details
    // .populate('material', 'name') // Populate material details
    // .populate('sizes', 'name') // Populate sizes details
    // .populate('color', 'name'); // Populate color details
    if (!product) {
      return res.status(404).json({ message: "Product not found" });
    }
    res.status(200).json(product);
  } catch (error) {
    console.error(error);
    if (error.name === "CastError") {
      return res.status(400).json({ message: "Invalid product ID format" });
    }
    res.status(500).json({ message: "Server error", error: error.message });
  }
});

module.exports = router;


===== FILE: ./backend/routes/uploadRoutes.js =====
const express = require('express');
const multer = require('multer');
const cloudinary = require('cloudinary').v2;  
const streamifier = require('streamifier');

const router = express.Router(); 

require('dotenv').config();

// Cloudinary configuration
cloudinary.config({  
    cloud_name: process.env.CLOUDINARY_CLOUD_NAME,
    api_key: process.env.CLOUDINARY_API_KEY,
    api_secret: process.env.CLOUDINARY_API_SECRET,
});

// Multer configuration
const storage = multer.memoryStorage();
const upload = multer({ storage: storage });

router.post('/', upload.single('image'), async (req, res) => {
    try {
        if (!req.file) {
            return res.status(400).json({ message: 'No file uploaded' });
        }
        
        // Function to handle the upload to Cloudinary
        const streamUpload = (fileBuffer) => {
            return new Promise((resolve, reject) => {
                const stream = cloudinary.uploader.upload_stream((error, result) => {  
                    if (error) {
                        return reject(error);
                    }
                    resolve(result);
                });
                // Ch·ªâ gi·ªØ d√≤ng n√†y ·ªü trong Promise
                streamifier.createReadStream(fileBuffer).pipe(stream);
            });
        }
        
        // Call the streamUpload function with the file buffer
        const result = await streamUpload(req.file.buffer);
        
        // Respond with the uploaded image URL
        res.json({ imageUrl: result.secure_url });
        
    } catch (error) {
        console.error('Error uploading image:', error);
        res.status(500).json({ message: 'Server error' });
    }
});

module.exports = router;

===== FILE: ./backend/routes/userRoutes.js =====
const express = require("express");
const router = express.Router();
const User = require("../models/User");
const jwt = require("jsonwebtoken");
const { authMiddleware } = require("../middleware/authMiddleware");


// @route   POST /api/users/register
// @desc    Register a new user
// @access  Public
router.post("/register", async (req, res) => {
  try {
    const { name, email, password, gender, birth } = req.body;

    // Ki·ªÉm tra user ƒë√£ t·ªìn t·∫°i ch∆∞a
    const existingUser = await User.findOne({ email });
    if (existingUser) {
      return res.status(400).json({ message: "User already exists." });
    }

    // T·∫°o user m·ªõi
    const newUser = new User({
      name,
      email,
      password, // s·∫Ω ƒë∆∞·ª£c hash trong schema
      gender,
      birth,
    });

    await newUser.save();

    // T·∫°o token
    const token = jwt.sign(
      { id: newUser._id, role: newUser.role },
      process.env.JWT_SECRET || "your_jwt_secret_key",
      { expiresIn: "7d" }
    );

    // C·∫¢I THI·ªÜN: Set secure cookie v·ªõi c√°c options b·∫£o m·∫≠t
    const cookieOptions = {
      httpOnly: true,                    // Kh√¥ng th·ªÉ access t·ª´ JavaScript
      secure: process.env.NODE_ENV === 'production', // HTTPS only in production
      sameSite: 'lax',                   // CSRF protection
      maxAge: 7 * 24 * 60 * 60 * 1000,  // 7 ng√†y
      path: '/'                          // Available for all paths
    };

    res.cookie('authToken', token, cookieOptions);

    // Chu·∫©n b·ªã response data
    const responseData = {
      message: "User registered successfully",
      user: {
        id: newUser._id,
        name: newUser.name,
        email: newUser.email,
        role: newUser.role,
      },
      token: token
    };

    // Ch·ªâ g·ª≠i token trong response khi development (ƒë·ªÉ frontend c√≥ th·ªÉ s·ª≠ d·ª•ng)
    if (process.env.NODE_ENV === 'development') {
      responseData.token = token;
    }

    res.status(201).json(responseData);
  } catch (error) {
    console.error(error);
    res.status(500).json({ message: "Server error" });
  }
});

// @route   POST /api/users/login
// @desc    Login user
// @access  Public
router.post("/login", async (req, res) => {
  try {
    const { email, password } = req.body;

    // T√¨m user theo email
    const user = await User.findOne({ email });
    if (!user) {
      return res.status(400).json({ message: "Invalid email or password." });
    }
    // Ki·ªÉm tra m·∫≠t kh·∫©u
    const isMatch = await user.comparePassword(password);
    if (!isMatch) {
      return res.status(400).json({ message: "Invalid email or password." });
    }
    // T·∫°o token
    const token = jwt.sign(
      { id: user._id, role: user.role },
      process.env.JWT_SECRET || "your_jwt_secret_key",
      { expiresIn: "7d" }
    );
    const cookieOptions = {
      httpOnly: true,                    // Kh√¥ng th·ªÉ access t·ª´ JavaScript
      secure: process.env.NODE_ENV === 'production', // HTTPS only in production
      sameSite: 'lax',                   // CSRF protection
      maxAge: 7 * 24 * 60 * 60 * 1000,  // 7 ng√†y
      path: '/'                          // Available for all paths
    };

    res.cookie('authToken', token, cookieOptions);

    // Chu·∫©n b·ªã response data
    const responseData = {
      message: "Login successful",
      user: {
        id: user._id,
        name: user.name,
        email: user.email,
        role: user.role,
        gender: user.gender,
        birth: user.birth,
        address: user.address,
        city: user.city,
        district: user.district,
        ward: user.ward,
        phone: user.phone,
        profileImage: user.profileImage,
        accountType: user.accountType,
        createdAt: user.createdAt,
      },
    };

    // Ch·ªâ g·ª≠i token trong response khi development (ƒë·ªÉ frontend c√≥ th·ªÉ s·ª≠ d·ª•ng)
    if (process.env.NODE_ENV === 'development') {
      responseData.token = token;
    }

    res.status(200).json(responseData);
  } catch (error) {
    console.error(error);
    res.status(500).json({ message: "Server error" });
  }
});

router.post("/logout", authMiddleware, async (req, res) => {
  try {
    // Clear t·∫•t c·∫£ cookies c√≥ th·ªÉ
    const cookieOptions = {
      httpOnly: true,
      secure: process.env.NODE_ENV === 'production',
      sameSite: 'lax',
      path: '/'
    };

    res.clearCookie('authToken', cookieOptions);
    res.clearCookie('userToken', cookieOptions);
    res.clearCookie('token', cookieOptions);

    // Optional: Th√™m token v√†o blacklist n·∫øu mu·ªën
    // await addToBlacklist(req.headers.authorization?.split(" ")[1]);

    res.json({ 
      message: "ƒêƒÉng xu·∫•t th√†nh c√¥ng",
      success: true 
    });
  } catch (error) {
    console.error("Logout error:", error);
    res.status(500).json({ 
      message: "L·ªói khi ƒëƒÉng xu·∫•t",
      success: false 
    });
  }
});


// @route   GET /api/users/profile
// @desc    Get user profile
// @access  Private

// L·∫•y profile user, ƒë√£ x√°c th·ª±c qua middleware
// router.get("/profile", authMiddleware, async (req, res) => {
//   try {
//     // S·ª≠ d·ª•ng tr·ª±c ti·∫øp user ƒë√£ ƒë∆∞·ª£c t√¨m trong middleware
//     // Kh√¥ng c·∫ßn query l·∫°i database
//     res.status(200).json(req.user);
//   } catch (error) {
//     console.error(error);
//     res.status(500).json({ message: "Server error" });
//   }
// });
// @route   GET /api/users/profile
// @desc    Get user profile
// @access  Private
router.get("/profile", authMiddleware, async (req, res) => {
  try {
    // L·∫•y th√¥ng tin user t·ª´ middleware auth (req.user ch·ª©a ID)
    const user = await User.findById(req.user.id).select("-password");

    if (!user) {
      return res.status(404).json({ message: "User not found" });
    }

    // Tr·∫£ v·ªÅ ƒë·∫ßy ƒë·ªß th√¥ng tin c·∫ßn thi·∫øt
    res.status(200).json({
      id: user._id,
      name: user.name,
      email: user.email,
      role: user.role,
      gender: user.gender,
      birth: user.birth,
      address: user.address,
      city: user.city,
      district: user.district,
      ward: user.ward,
      phone: user.phone,
      profileImage: user.profileImage,
      accountType: user.accountType,
      createdAt: user.createdAt,
    });
  } catch (error) {
    console.error(error);
    res.status(500).json({ message: "Server error" });
  }
});

// Th√™m route update profile v√†o userRoutes.js
router.put("/update-profile", authMiddleware, async (req, res) => {
  try {
    const { name, gender, birth, address, phone, city, district, ward } =
      req.body;

    // T√¨m user d·ª±a v√†o ID t·ª´ middleware
    const user = await User.findById(req.user.id);

    if (!user) {
      return res.status(404).json({ message: "User not found" });
    }

    // C·∫≠p nh·∫≠t th√¥ng tin
    if (name) user.name = name;
    if (gender) user.gender = gender;
    if (birth) user.birth = birth;
    if (address) user.address = address;
    if (city) user.city = city;
    if (phone) user.phone = phone;
    if (district) user.district = district;
    if (ward) user.ward = ward;

    // L∆∞u v√†o database
    const updatedUser = await user.save();

    // Tr·∫£ v·ªÅ th√¥ng tin ƒë√£ c·∫≠p nh·∫≠t
    res.status(200).json({
      id: updatedUser._id,
      name: updatedUser.name,
      email: updatedUser.email,
      role: updatedUser.role,
      gender: updatedUser.gender,
      birth: updatedUser.birth,
      address: updatedUser.address,
      city: updatedUser.city,
      district: updatedUser.district,
      ward: updatedUser.ward,
      phone: updatedUser.phone,
      profileImage: updatedUser.profileImage,
      accountType: updatedUser.accountType,
      createdAt: updatedUser.createdAt,
    });
  } catch (error) {
    console.error(error);
    res.status(500).json({ message: "Server error" });
  }
});

module.exports = router;


===== FILE: ./backend/seeder.js =====
// const mongoose = require("mongoose");
// const dotenv = require("dotenv");
// const Product = require("./models/Product");
// const User = require("./models/User");
// const products = require("./data/products"); // D·ªØ li·ªáu s·∫£n ph·∫©m m·∫´u
// const users = require("./data/users"); // D·ªØ li·ªáu ng∆∞·ªùi d√πng m·∫´u (n·∫øu c√≥)
// const cart = require("./models/cart"); // N·∫øu c·∫ßn s·ª≠ d·ª•ng Cart
// const bcrypt = require("bcryptjs");

// // Load env vars
// dotenv.config();

// // Connect to MongoDB
// mongoose
//   .connect(process.env.MONGO_URI, {
//     useNewUrlParser: true,
//     useUnifiedTopology: true,
//   })
//   .then(() => console.log("MongoDB connected"))
//   .catch((err) => console.error("MongoDB connection error:", err));

// // Import data
// const importData = async () => {
//   try {
//     // X√≥a d·ªØ li·ªáu hi·ªán c√≥
//     await Product.deleteMany();
//     await User.deleteMany();
//     await cart.deleteMany();

//     console.log("Data deleted successfully");

//     // T·∫°o admin user
//     const adminUser = await User.create({
//       name: "Admin User",
//       email: "admin@example.com",
//       password: "123456",
//       role: "admin",
//     });

//     console.log("Admin user created");

//     // Th√™m user Id v√†o m·ªói s·∫£n ph·∫©m
//     const sampleProducts = products.map((product) => {
//       return { ...product, user: adminUser._id };
//     });

//     // Import s·∫£n ph·∫©m v√†o database
//     await Product.insertMany(sampleProducts);

//     console.log("Data imported successfully");
//     process.exit();
//   } catch (error) {
//     console.error(`Error: ${error.message}`);
//     process.exit(1);
//   }
// };

// // Destroy data
// const destroyData = async () => {
//   try {
//     await Product.deleteMany();
//     await User.deleteMany();

//     console.log("Data destroyed successfully");
//     process.exit();
//   } catch (error) {
//     console.error(`Error: ${error.message}`);
//     process.exit(1);
//   }
// };

// // X·ª≠ l√Ω tham s·ªë d√≤ng l·ªánh ƒë·ªÉ quy·∫øt ƒë·ªãnh import hay destroy
// if (process.argv[2] === "-d") {
//   destroyData();
// } else {
//   importData();
// }

// backend/seeder.js
const mongoose = require("mongoose");
const dotenv = require("dotenv");
const Product = require("./models/Product");
const User = require("./models/User");
const Collection = require("./models/Collection");
const dataManager = require("./data/dataManager");

// Load env vars
dotenv.config();

// Connect to MongoDB
mongoose
  .connect(process.env.MONGO_URI, {
    useNewUrlParser: true,
    useUnifiedTopology: true,
  })
  .then(() => console.log("MongoDB connected"))
  .catch((err) => console.error("MongoDB connection error:", err));

// Import data
const importData = async (options = {}) => {
  try {
    console.log("üöÄ B·∫Øt ƒë·∫ßu import d·ªØ li·ªáu...");

    // Parse command line options
    const uploadImages = process.argv.includes('--upload-images');
    const skipClear = process.argv.includes('--skip-clear');
    const onlyProducts = process.argv.includes('--only-products');
    const onlyUsers = process.argv.includes('--only-users');
    const onlyCollections = process.argv.includes('--only-collections');

    console.log("‚öôÔ∏è T√πy ch·ªçn:");
    console.log(`   - Upload images to Cloudinary: ${uploadImages ? '‚úÖ' : '‚ùå'}`);
    console.log(`   - Skip clearing data: ${skipClear ? '‚úÖ' : '‚ùå'}`);
    console.log(`   - Only products: ${onlyProducts ? '‚úÖ' : '‚ùå'}`);
    console.log(`   - Only users: ${onlyUsers ? '‚úÖ' : '‚ùå'}`);  
    console.log(`   - Only collections: ${onlyCollections ? '‚úÖ' : '‚ùå'}`);

    // X√≥a d·ªØ li·ªáu hi·ªán c√≥ (tr·ª´ khi skip)
    if (!skipClear) {
      console.log("üóëÔ∏è ƒêang x√≥a d·ªØ li·ªáu c≈©...");
      if (!onlyUsers && !onlyCollections) await Product.deleteMany();
      if (!onlyProducts && !onlyCollections) await User.deleteMany();
      if (!onlyProducts && !onlyUsers) await Collection.deleteMany();
      console.log("‚úÖ ƒê√£ x√≥a d·ªØ li·ªáu c≈©");
    }

    // L·∫•y d·ªØ li·ªáu t·ª´ DataManager
    const data = await dataManager.getAllData({
      uploadImages: uploadImages,
      includeExistingData: true,
      createSamples: true
    });

    let adminUser = null;

    // Import Users (n·∫øu kh√¥ng ch·ªâ products/collections)
    if (!onlyProducts && !onlyCollections) {
      console.log("üë• ƒêang import users...");
      
      // T·∫°o admin user tr∆∞·ªõc
      adminUser = await User.create({
        name: "Admin User",
        email: "admin@example.com", 
        password: "123456",
        role: "admin",
      });
      console.log("üëë Admin user ƒë√£ ƒë∆∞·ª£c t·∫°o");

      // Import c√°c users kh√°c
      if (data.users.length > 0) {
        await User.insertMany(data.users);
        console.log(`‚úÖ ƒê√£ import ${data.users.length} users`);
      }
    } else {
      // N·∫øu kh√¥ng import users, t√¨m admin user hi·ªán c√≥
      adminUser = await User.findOne({ email: "admin@example.com" });
      if (!adminUser) {
        console.log("‚ö†Ô∏è Kh√¥ng t√¨m th·∫•y admin user, t·∫°o m·ªõi...");
        adminUser = await User.create({
          name: "Admin User",
          email: "admin@example.com",
          password: "123456", 
          role: "admin",
        });
      }
    }

    // Import Collections (n·∫øu kh√¥ng ch·ªâ products/users)
    if (!onlyProducts && !onlyUsers) {
      console.log("üè∑Ô∏è ƒêang import collections...");
      if (data.collections.length > 0) {
        await Collection.insertMany(data.collections);
        console.log(`‚úÖ ƒê√£ import ${data.collections.length} collections`);
      }
    }

    // Import Products (n·∫øu kh√¥ng ch·ªâ users/collections)
    if (!onlyUsers && !onlyCollections) {
      console.log("üì¶ ƒêang import products...");
      
      // Th√™m user ID v√†o t·∫•t c·∫£ products
      const productsWithUser = data.products.map(product => ({
        ...product,
        user: adminUser._id,
        // X√≥a _id n·∫øu c√≥ ƒë·ªÉ MongoDB t·ª± t·∫°o
        _id: undefined
      }));

      if (productsWithUser.length > 0) {
        const insertedProducts = await Product.insertMany(productsWithUser);
        console.log(`‚úÖ ƒê√£ import ${insertedProducts.length} products`);
      }
    }

    // Hi·ªÉn th·ªã th·ªëng k√™ cu·ªëi c√πng
    await displayStatistics();

    // L∆∞u backup n·∫øu c·∫ßn
    if (uploadImages) {
      await dataManager.saveToFile(data, `backup-${Date.now()}.json`);
    }

    console.log("\nüéâ Import d·ªØ li·ªáu ho√†n th√†nh!");
    process.exit(0);

  } catch (error) {
    console.error(`‚ùå L·ªói: ${error.message}`);
    console.error(error);
    process.exit(1);
  }
};

// Destroy data
const destroyData = async () => {
  try {
    const confirmArgs = ['--confirm', '-y', '--yes'];
    const isConfirmed = confirmArgs.some(arg => process.argv.includes(arg));
    
    if (!isConfirmed) {
      console.log("‚ö†Ô∏è C·∫£nh b√°o: B·∫°n s·∫Øp x√≥a T·∫§T C·∫¢ d·ªØ li·ªáu!");
      console.log("Th√™m --confirm ƒë·ªÉ x√°c nh·∫≠n: npm run seed:destroy -- --confirm");
      process.exit(1);
    }

    console.log("üóëÔ∏è ƒêang x√≥a t·∫•t c·∫£ d·ªØ li·ªáu...");
    
    await Product.deleteMany();
    await User.deleteMany(); 
    await Collection.deleteMany();

    console.log("‚úÖ ƒê√£ x√≥a t·∫•t c·∫£ d·ªØ li·ªáu");
    process.exit(0);
  } catch (error) {
    console.error(`‚ùå L·ªói: ${error.message}`);
    process.exit(1);
  }
};

// Hi·ªÉn th·ªã th·ªëng k√™
const displayStatistics = async () => {
  try {
    const [userCount, productCount, collectionCount] = await Promise.all([
      User.countDocuments(),
      Product.countDocuments(), 
      Collection.countDocuments()
    ]);

    console.log("\nüìä TH·ªêNG K√ä DATABASE:");
    console.log(`   üë• Users: ${userCount}`);
    console.log(`   üì¶ Products: ${productCount}`);
    console.log(`   üè∑Ô∏è Collections: ${collectionCount}`);

    // Th·ªëng k√™ products theo collection
    if (productCount > 0) {
      const productStats = await Product.aggregate([
        {
          $group: {
            _id: "$collection",
            count: { $sum: 1 },
            avgPrice: { $avg: "$price" }
          }
        },
        { $sort: { count: -1 } }
      ]);

      console.log("\nüìà TH·ªêNG K√ä PRODUCTS THEO COLLECTION:");
      productStats.forEach(stat => {
        console.log(`   ${stat._id}: ${stat.count} s·∫£n ph·∫©m (TB: ${Math.round(stat.avgPrice).toLocaleString()}ƒë)`);
      });
    }

  } catch (error) {
    console.error("L·ªói khi hi·ªÉn th·ªã th·ªëng k√™:", error.message);
  }
};

// X·ª≠ l√Ω tham s·ªë d√≤ng l·ªánh
const action = process.argv[2];

switch (action) {
  case '-d':
  case '--destroy':
    destroyData();
    break;
  case '--stats':
    mongoose
      .connect(process.env.MONGO_URI, {
        useNewUrlParser: true,
        useUnifiedTopology: true,
      })
      .then(async () => {
        await displayStatistics();
        process.exit(0);
      })
      .catch((err) => {
        console.error("MongoDB connection error:", err);
        process.exit(1);
      });
    break;
  default:
    importData();
    break;
}

/* 
C√ÅCH S·ª¨ D·ª§NG:

1. Import t·∫•t c·∫£ d·ªØ li·ªáu (kh√¥ng upload ·∫£nh):
   npm run seed
   
2. Import t·∫•t c·∫£ d·ªØ li·ªáu + upload ·∫£nh l√™n Cloudinary:
   npm run seed -- --upload-images
   
3. Import ch·ªâ products:
   npm run seed -- --only-products
   
4. Import ch·ªâ users: 
   npm run seed -- --only-users
   
5. Import ch·ªâ collections:
   npm run seed -- --only-collections
   
6. Import m√† kh√¥ng x√≥a d·ªØ li·ªáu c≈©:
   npm run seed -- --skip-clear
   
7. X√≥a t·∫•t c·∫£ d·ªØ li·ªáu:
   npm run seed -- --destroy --confirm
   
8. Xem th·ªëng k√™:
   npm run seed -- --stats

C·∫§U H√åNH CLOUDINARY (t√πy ch·ªçn):
Th√™m v√†o file .env:
CLOUDINARY_CLOUD_NAME=your_cloud_name
CLOUDINARY_API_KEY=your_api_key  
CLOUDINARY_API_SECRET=your_api_secret
*/

===== FILE: ./backend/server.js =====
const express = require("express");
const cors = require("cors");
const dotenv = require("dotenv");
const cookieParser = require("cookie-parser");

// Load env vars first
dotenv.config();

const rateLimit = require("express-rate-limit");
const helmet = require("helmet");
const session = require("express-session");
const passport = require("passport");
const connectDB = require("./config/db");
const userRoutes = require("./routes/userRoutes");
const productRoutes = require("./routes/productRoutes");
const cartRoutes = require("./routes/cartRoutes");
const checkoutRoutes = require("./routes/checkoutRoutes");
const authRoutes = require("./routes/authRoutes");
const orderRoutes = require("./routes/orderRoutes");
const uploadRoutes = require("./routes/uploadRoutes");
const adminRoutes = require("./routes/adminRoutes");
const productAdminRoutes = require("./routes/productAdminRoutes");
const adminOrderRoutes = require("./routes/adminOrderRoutes");
const collectionRoutes = require("./routes/collectionRoutes");
const paymentRoutes = require("./routes/paymentRoutes");
const app = express();

// Connect to MongoDB
connectDB();

// Basic middleware - n√™n ƒë·∫∑t tr∆∞·ªõc c√°c middleware kh√°c
app.use(express.json());
app.use(
  cors({
    origin: ["http://localhost:5173", "http://localhost:3000"],
    credentials: true,
    methods: ["GET", "POST", "PUT", "DELETE"],
    allowedHeaders: ["Content-Type", "Authorization"],
  })
);

app.use(cookieParser());

// Security middleware
app.use(helmet());

// Rate limiting
const limiter = rateLimit({
  windowMs: 15 * 60 * 1000, // 15 minutes
  max: 100000000000000, // limit each IP to 100 requests per windowMs
  message: {
    error: "Too many authentication attempts, please try again later.",
  },
  standardHeaders: true,
  legacyHeaders: false,
});

// Apply rate limiting to all API requests
app.use("/api/", limiter);

// Session configuration for Passport
app.use(
  session({
    secret: process.env.SESSION_SECRET || "your_session_secret",
    resave: false,
    saveUninitialized: false,
    cookie: {
      secure: process.env.NODE_ENV === "production",
      maxAge: 24 * 60 * 60 * 1000, // 24 hours
    },
  })
);

// Import passport config
require("./config/passport");

// Passport middleware
app.use(passport.initialize());
app.use(passport.session());

// Routes
app.get("/", (req, res) => {
  res.send("Hello from the server!");
});

// API routes
app.use("/api/users", userRoutes);
app.use("/api/products", productRoutes);
app.use("/api/cart", cartRoutes);
app.use("/api/checkout", checkoutRoutes);
app.use("/api/auth", authRoutes);
app.use("/api/orders", orderRoutes);
app.use("/api/upload", uploadRoutes);
app.use("/api/payment", paymentRoutes);

// Admin routes
app.use("/api/admin", adminRoutes);
app.use("/api/admin/products", productAdminRoutes);
app.use("/api/admin/orders", adminOrderRoutes);

// Collection routes
app.use("/api/collections", collectionRoutes);

// Error handling middleware - ph·∫£i ƒë·∫∑t sau t·∫•t c·∫£ c√°c routes
app.use((err, req, res, next) => {
  console.error(err.stack);
  res.status(500).json({ message: "Internal Server Error" });
});

const PORT = process.env.PORT || 3000;

// Start the server
app.listen(PORT, () => {
  console.log(`Server is running on http://localhost:${PORT}`);
});


===== FILE: ./backend/vercel.json =====
{
    "version": 2,
    "name": "my-backend",
    "builds": [
        {
        "src": "server.js",
        "use": "@vercel/node"
        }
    ],
    "routes": [
        {
        "src": "/(.*)",
        "dest": "server.js"
        }
    ]
}

===== FILE: ./frontend/env.txt =====
VITE_PAYPLA_CLIENT_ID=your_paypal_client_id
# VITE_PAYPAL_SECRET=your_paypal_secret
VITE_BACKEND_URL=http://localhost:9000
# VITE_STRIPE_PUBLISHABLE_KEY=your_stripe_publishable_key
VITE_FACEBOOK_APP_ID=
# API
VITE_API_URL=http://localhost:9000

===== FILE: ./frontend/src/App.jsx =====
import React from "react";
import { BrowserRouter, Route, Routes } from "react-router-dom";
// user
import UserLayout from "./components/Layout/UserLayout";
import Home from "./pages/Home";
import MyOdersPage from "./components/profile/MyOdersPage";

import ProfileLayout from "./components/profile/ProfileLayout";
import ProfileInfo from "./components/profile/ProfileInfo";
import OrderDetailPage from "./components/profile/OrderDetailPage";
import { OrderProvider } from "./components/profile/OrderContext";
import { CartProvider } from "./components/Cart/CartContext";
import Login from "./pages/Login";
import Signup from "./pages/Signup";
import Collection from "./pages/Collection";
import { Toaster } from "sonner";
import ProductDetails from "./components/Products/ProductDetails";
import Information from "./pages/Information";
import About from "./components/information/About";
import Sponsorship from "./components/information/Sponsorship";
import Policy from "./pages/Policy";
import Cart from "./pages/Cart";
import Checkout from "./pages/Checkout";
import { Provider } from "react-redux";
import store from "./redux/store";
import GoogleCallback from "./pages/GoogleCallback";
import GenderCollection from "./pages/GenderCollection";
import CheckoutBuyNow from "./pages/CheckoutBuyNow";
// ==================================================
// admin
import AdminHomePage from "./pages/AdminHomePage";
import AdminLayout from "./components/Admin/AdminLayout";
import UserManagement from "./components/Admin/UserManagement";
import ProductManagement from "./components/Admin/ProductManagement";
import EditProductPage from "./components/Admin/EditProductPage";
import OrderManagement from "./components/Admin/OrderManagement";
import CollectionManagement from "./components/Admin/CollectionManagement";
import EditCollection from "./components/Admin/EditCollection";
// ==================================================
import PublicOnlyRoute from "./components/Auth/PublicOnlyRoute";
import PrivateRoute from "./components/Auth/PrivateRoute";
import AdminRoute from "./components/Auth/AdminRoute";
import axios from 'axios';
axios.defaults.withCredentials = true;
const App = () => {
  return (
    <Provider store={store}>
      <BrowserRouter>
        <CartProvider>
          <OrderProvider>
            <Toaster position="top-right" duration={2000} />
            <Routes>
              <Route path="/" element={<UserLayout />}>
                <Route index element={<Home />} />

                {/* Public only routes (redirect to home if logged in) */}
                <Route element={<PublicOnlyRoute />}>
                  <Route path="login" element={<Login />} />
                  <Route path="signup" element={<Signup />} />
                </Route>

                <Route path="collections/:id" element={<Collection />} />
                <Route path="gendercollections/:id" element={<GenderCollection />} />
                <Route path="product/:id" element={<ProductDetails />} />
                <Route path="cart" element={<Cart />} />

                {/* Protected routes (require authentication) */}
                <Route element={<PrivateRoute />}>
                  <Route path="checkout" element={<Checkout />} />
                  <Route path="checkout-buy-now" element={<CheckoutBuyNow />} />
                  <Route path="profile" element={<ProfileLayout />}>
                    <Route index element={<ProfileInfo />} />
                    <Route path="info" element={<ProfileInfo />} />
                    <Route path="orders" element={<MyOdersPage />} />
                    <Route path="orders/:id" element={<OrderDetailPage />} />
                  </Route>
                </Route>

                <Route path="auth/success" element={<GoogleCallback />} />
                <Route path="information" element={<Information />}>
                  <Route path="about" element={<About />} />
                  <Route path="sponsorship" element={<Sponsorship />} />
                </Route>
                <Route path="policy" element={<Policy />} />
              </Route>

              {/* Admin routes (require admin role) */}
              <Route element={<AdminRoute />}>
                <Route path="/admin" element={<AdminLayout />}>
                  <Route index element={<AdminHomePage />} />
                  <Route path="users" element={<UserManagement />} />
                  <Route path="products" element={<ProductManagement />} />
                  <Route path="products/:id" element={<EditProductPage />} />
                  <Route path="orders" element={<OrderManagement />} />
                  <Route path="collections" element={<CollectionManagement />} />
                  <Route path="collections/:id" element={<EditCollection />} />
                </Route>
              </Route>
            </Routes>
          </OrderProvider>
        </CartProvider>
      </BrowserRouter>
    </Provider>
  );
};

export default App;


===== FILE: ./frontend/src/assets/dummyData.js =====
// src/dummyData.js
import linenWomenBanner from "../assets/images/linen/banner-linen-collection-men.jpg";

function generateProducts(prefix, startIndex) {
  const products = [];
  const categories = [
    "√Åo ph√¥ng",
    "√Åo s∆° mi",
    "Qu·∫ßn t√¢y",
    "Qu·∫ßn short",
    "√Åo kho√°c",
  ];

  for (let i = 0; i < 20; i++) {
    products.push({
      _id: `${prefix}${i + 1}`,
      name: `${prefix} Product ${i + 1}`,
      price: Math.floor(Math.random() * 2000000 + 500000),
      discountPrice: Math.floor(Math.random() * 2000000 + 500000),
      category: categories[Math.floor(Math.random() * categories.length)],
      sizes: ["S", "M", "L", "XL", "XXL"],
      colors: ["red", "blue", "green", "yellow", "purple"],
      material: "cotton",
      description: "This is a description for the product",
      images: [
        {
          url: `https://picsum.photos/500/500?random=${startIndex + i}`,
          altText: `${prefix} Product ${i + 1}`,
        },
        {
          url: `https://picsum.photos/500/500?random=${startIndex + i + 75}`,
          altText: `${prefix} Product ${i + 1}`,
        },
        {
          url: `https://picsum.photos/500/500?random=${startIndex + i + 150}`,
          altText: `${prefix} Product ${i + 1}`,
        },
        {
          url: `https://picsum.photos/500/500?random=${startIndex + i + 225}`,
          altText: `${prefix} Product ${i + 1}`,
        },
      ],
      featured: i < 4, // 4 s·∫£n ph·∫©m ƒë·∫ßu l√† n·ªïi b·∫≠t
    });
  }
  return products;
}

export const collections = [
  {
    id: "summer",
    name: "Summer Collection",
    bannerUrl: linenWomenBanner,
    description: "B·ªô s∆∞u t·∫≠p m√πa h√® 2025 mang ƒë·∫øn l√†n gi√≥ m·ªõi v·ªõi nh·ªØng thi·∫øt k·∫ø tr·∫ª trung, nƒÉng ƒë·ªông v√† ƒë·∫ßy m√†u s·∫Øc, s·ª≠ d·ª•ng ch·∫•t li·ªáu nh·∫π m√°t, tho√°ng kh√≠, ph√π h·ª£p cho m·ªçi ho·∫°t ƒë·ªông ng√†y h√® ‚Äì t·ª´ d·∫°o ph·ªë, ƒëi bi·ªÉn ƒë·∫øn nh·ªØng bu·ªïi h·∫πn h√≤ ƒë·∫ßy c·∫£m h·ª©ng.",
    products: generateProducts("Summer", 1),
  },
  {
    id: "winter",
    name: "Winter Collection",
    bannerUrl: "https://picsum.photos/500/500?random=100",
    description: "B·ªô s∆∞u t·∫≠p m√πa ƒë√¥ng 2025 l√† s·ª± k·∫øt h·ª£p gi·ªØa v·∫ª ƒë·∫πp hi·ªán ƒë·∫°i v√† c·∫£m gi√°c ·∫•m √°p, v·ªõi nh·ªØng thi·∫øt k·∫ø d√†y d·∫∑n, phom d√°ng √¥m v·ª´a v·∫∑n, gam m√†u trung t√≠nh sang tr·ªçng c√πng c√°c ch·∫•t li·ªáu nh∆∞ len, d·∫°, l√¥ng v√† n·ªâ cao c·∫•p ‚Äì mang ƒë·∫øn cho b·∫°n phong c√°ch tinh t·∫ø v√† t·ª± tin trong nh·ªØng ng√†y ƒë√¥ng l·∫°nh gi√°.",
    products: generateProducts("Winter", 21),
  },
  {
    id: "autumn",
    name: "Autumn Collection",
    bannerUrl: "https://picsum.photos/500/500?random=111",
    description: "B·ªô s∆∞u t·∫≠p m√πa thu 2025 mang ƒë·∫øn h∆°i th·ªü d·ªãu d√†ng v√† s√¢u l·∫Øng c·ªßa th·ªùi kh·∫Øc chuy·ªÉn m√πa, v·ªõi nh·ªØng thi·∫øt k·∫ø tinh t·∫ø, gam m√†u ·∫•m √°p nh∆∞ n√¢u ƒë·∫•t, cam ch√°y, be nh·∫°t c√πng ch·∫•t li·ªáu m·ªÅm m·∫°i, gi·ªØ ·∫•m nh·∫π nh√†ng ‚Äì l√Ω t∆∞·ªüng cho nh·ªØng bu·ªïi chi·ªÅu se l·∫°nh ƒë·∫ßy c·∫£m x√∫c v√† phong c√°ch.",
    products: generateProducts("Autumn", 41),
  },
  {
    id: "man",
    name: "ƒê·ªì nam",
    bannerUrl: "https://picsum.photos/500/500?random=200",
    products: generateProducts("Linen", 61),
  },
  {
    id: "women",
    name: "ƒê·ªì n·ªØ",
    bannerUrl: "https://picsum.photos/500/500?random=200",
    products: generateProducts("Casual", 81),
  },
];


===== FILE: ./frontend/src/components/Admin/AdminLayout.jsx =====
import React, { useState } from 'react'
import { GrClose, GrMenu } from "react-icons/gr";
import AdminSidebar from './AdminSidebar';
import { Outlet } from 'react-router-dom';

const AdminLayout = () => {
    const [isSidebarOpen, setIsSidebarOpen] = useState(false)

    const toggleSidebar = () => {
        setIsSidebarOpen(!isSidebarOpen)
    };
    return (
        <div className='min-h-screen flex flex-col md:flex-row relative'>
            {/* mobile toggle button */}
            <div className=' flex md:hidden p-4 bg-gray-800 text-white z-20'>
                <button onClick={toggleSidebar}>
                    <GrMenu size={24} />
                </button>
                <h1 className='ml-4 text-xl font-medium'>B·∫£ng ƒëi·ªÅu khi·ªÉn</h1>
            </div>

            {/* overlay for mobile sidebar */}
            {isSidebarOpen && (
                <div
                    className='fixed inset-0 bg-black/50 z-10 md:hidden'
                    onClick={toggleSidebar}
                >

                </div>
            )}

            {/* sidebar */}
            <div className={`bg-black w-64 min-h-screen text-white absolute md:relative transform ${isSidebarOpen ? "translate-x-0" : "-translate-x-full"} transition-transform duration-300 md:translate-x-0 md:static ease-in-out z-20`}>
                {/* sidebar */}
                <AdminSidebar />
            </div>

            {/* main content */}
            <div className='flex-grow p-6 overflow-auto'>
                <Outlet />
            </div>

        </div>
    )
}

export default AdminLayout

===== FILE: ./frontend/src/components/Admin/AdminSidebar.jsx =====
import React from 'react'
import { FaBoxOpen, FaClipboardList, FaSignOutAlt, FaStore, FaUser } from 'react-icons/fa';
import { Link, NavLink, useNavigate } from 'react-router-dom';
import { BsCollectionFill } from "react-icons/bs";

const AdminSidebar = () => {
    const navigate = useNavigate();
    const handleLogout = () => {
        navigate("/");
    }
    return (
        <div className='p-6'>
            <div className='mb-3'>
                <Link to="/admin" className='text-2xl font-medium'>
                    Wukudada
                </Link>
            </div>
            <nav className='flex flex-col space-y-2'>
                {/* users */}
                <NavLink
                    to="/admin/users"
                    className={({ isActive }) =>
                        isActive
                            ? "bg-gray-800 text-white py-3 px-4 flex items-center space-x-2"
                            : "text-gray-300 hover:bg-gray-800 hover:text-white py-3 px-4 flex items-center space-x-2"}
                >
                    <FaUser size={20} />
                    <span>T√†i kho·∫£n</span>
                </NavLink>
                {/* products */}
                <NavLink
                    to="/admin/products"
                    className={({ isActive }) =>
                        isActive
                            ? "bg-gray-800 text-white py-3 px-4 flex items-center space-x-2"
                            : "text-gray-300 hover:bg-gray-800 hover:text-white py-3 px-4 flex items-center space-x-2"}
                >
                    <FaBoxOpen size={20} />
                    <span>S·∫£n ph·∫©m  </span>
                </NavLink>
                {/* collections */}
                <NavLink
                    to="/admin/collections"
                    className={({ isActive }) =>
                        isActive
                            ? "bg-gray-800 text-white py-3 px-4 flex items-center space-x-2"
                            : "text-gray-300 hover:bg-gray-800 hover:text-white py-3 px-4 flex items-center space-x-2"}
                >
                    <BsCollectionFill size={20} />
                    <span>B·ªô s∆∞u t·∫≠p  </span>
                </NavLink>
                {/* orders */}
                <NavLink
                    to="/admin/orders"
                    className={({ isActive }) => isActive
                        ? "bg-gray-800 text-white py-3 px-4 flex items-center space-x-2"
                        : "text-gray-300 hover:bg-gray-800 hover:text-white py-3 px-4 flex items-center space-x-2"}
                >
                    <FaClipboardList size={20} />
                    <span>ƒê∆°n h√†ng</span>
                </NavLink>
                {/* shop */}
                <NavLink
                    to="/"
                    className={({ isActive }) =>
                        isActive
                            ? "bg-gray-800 text-white py-3 px-4 flex items-center space-x-2"
                            : "text-gray-300 hover:bg-gray-800 hover:text-white py-3 px-4 flex items-center space-x-2"}
                >
                    <FaStore size={20} />
                    <span>C·ª≠a h√†ng</span>
                </NavLink>
            </nav>
        </div>
    )
}

export default AdminSidebar;



===== FILE: ./frontend/src/components/Admin/CollectionManagement.jsx =====
import { useEffect, useState } from "react";
import { Link } from "react-router-dom";
import axios from "axios";

const API_URL = import.meta.env.VITE_API_URL || "http://localhost:9000";

const CollectionManagement = () => {
  const [collections, setCollections] = useState([]);
  const [loading, setLoading] = useState(true);
  const [searchTerm, setSearchTerm] = useState("");
  const [filteredCollections, setFilteredCollections] = useState([]);

  useEffect(() => {
    const fetchCollections = async () => {
      try {
        const res = await axios.get(`${API_URL}/api/collections`);
        setCollections(res.data || []);
        setFilteredCollections(res.data || []);
      } catch (err) {
        setCollections([]);
        setFilteredCollections([]);
      } finally {
        setLoading(false);
      }
    };
    fetchCollections();
  }, []);

  // H√†m x·ª≠ l√Ω t√¨m ki·∫øm
  useEffect(() => {
    const searchResults = collections.filter((collection) => {
      const searchLower = searchTerm.toLowerCase();
      return (
        collection.id.toLowerCase().includes(searchLower) ||
        collection.name.toLowerCase().includes(searchLower) ||
        (collection.description || "").toLowerCase().includes(searchLower) ||
        (collection.status || "").toLowerCase().includes(searchLower) ||
        (collection.categories || []).some((cat) =>
          cat.toLowerCase().includes(searchLower)
        )
      );
    });
    setFilteredCollections(searchResults);
  }, [searchTerm, collections]);

  const handleDelete = async (id) => {
    if (window.confirm("B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a b·ªô s∆∞u t·∫≠p n√†y kh√¥ng?")) {
      try {
        const userToken =
          localStorage.getItem("userToken") || localStorage.getItem("token");
        await axios.delete(`${API_URL}/api/collections/${id}`, {
          headers: { Authorization: `Bearer ${userToken}` },
        });
        setCollections(collections.filter((c) => c._id !== id));
        alert("X√≥a b·ªô s∆∞u t·∫≠p th√†nh c√¥ng!");
      } catch (err) {
        alert("X√≥a b·ªô s∆∞u t·∫≠p th·∫•t b·∫°i!");
      }
    }
  };

  return (
    <div className="max-w-7xl mx-auto p-6">
      <div className="flex justify-between items-center mb-6">
        <h2 className="text-2xl font-bold">Qu·∫£n l√Ω b·ªô s∆∞u t·∫≠p</h2>
        <Link
          to="/admin/collections/new"
          className="bg-black text-white px-4 py-2 hover:bg-gray-700 cursor-pointer"
        >
          Th√™m b·ªô s∆∞u t·∫≠p
        </Link>
      </div>

      {/* Thanh t√¨m ki·∫øm */}
      <div className="mb-6">
        <div className="relative">
          <input
            type="text"
            placeholder="T√¨m ki·∫øm theo t√™n, ID, m√¥ t·∫£ ho·∫∑c danh m·ª•c..."
            value={searchTerm}
            onChange={(e) => setSearchTerm(e.target.value)}
            className="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
          />
          {searchTerm && (
            <button
              onClick={() => setSearchTerm("")}
              className="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-500 hover:text-gray-700"
            >
              ‚úï
            </button>
          )}
        </div>
      </div>

      <div className="overflow-x-auto">
        <table className="min-w-full text-left text-gray-500 border border-gray-100 border-collapse table-fixed">
          <thead className="text-xs text-gray-700 uppercase bg-gray-100">
            <tr>
              <th className="w-1/3 px-3 py-3">T√™n b·ªô s∆∞u t·∫≠p</th>
              <th className="w-1/3 px-3 py-3">ID</th>
              <th className="w-1/3 px-3 py-3">Thao t√°c</th>
            </tr>
          </thead>
          <tbody>
            {loading ? (
              <tr>
                <td colSpan={3} className="p-4 text-center">
                  ƒêang t·∫£i...
                </td>
              </tr>
            ) : filteredCollections.length > 0 ? (
              filteredCollections.map((collection) => (
                <tr
                  key={collection._id}
                  className="bg-white border-b border-gray-100"
                >
                  <td className="p-4 font-medium text-gray-900 whitespace-nowrap">
                    {collection.name}
                  </td>
                  <td className="p-4">{collection.id}</td>
                  <td className="p-4">
                    <Link
                      to={`/admin/collections/${collection.id}`}
                      className="inline-flex items-center bg-black text-white px-3 py-1 mr-2 hover:bg-gray-700 cursor-pointer"
                    >
                      S·ª≠a
                    </Link>
                    <button
                      onClick={() => handleDelete(collection.id)}
                      className="inline-flex items-center text-black px-3 py-1 border border-black hover:border-gray-700 hover:text-gray-700 cursor-pointer"
                    >
                      X√≥a
                    </button>
                  </td>
                </tr>
              ))
            ) : (
              <tr>
                <td colSpan={3} className="p-4 text-center">
                  {searchTerm
                    ? "Kh√¥ng t√¨m th·∫•y b·ªô s∆∞u t·∫≠p ph√π h·ª£p"
                    : "Kh√¥ng c√≥ b·ªô s∆∞u t·∫≠p n√†o."}
                </td>
              </tr>
            )}
          </tbody>
        </table>
      </div>
    </div>
  );
};

export default CollectionManagement;


===== FILE: ./frontend/src/components/Admin/EditCollection.jsx =====
import React, { useState, useEffect } from "react";
import { useParams, useNavigate } from "react-router-dom";
import axios from "axios";

const API_URL = import.meta.env.VITE_API_URL || "http://localhost:9000";

const EditCollection = () => {
  const { id } = useParams();
  const navigate = useNavigate();
  const isEdit = id && id !== "new";
  const [collectionData, setCollectionData] = useState({
    id: "",
    name: "",
    description: "",
    image: "",
    status: "active",
    categories: [],
  });
  const [loading, setLoading] = useState(true);
  const [newCategory, setNewCategory] = useState("");
  const userToken =
    localStorage.getItem("userToken") || localStorage.getItem("token") || "";

  useEffect(() => {
    if (isEdit) {
      const fetchCollection = async () => {
        try {
          const res = await axios.get(`${API_URL}/api/collections/${id}`);
          setCollectionData({
            id: res.data.id || "",
            name: res.data.name || "",
            description: res.data.description || "",
            image: res.data.bannerUrl || "",
            status: res.data.status || "active",
            categories: res.data.categories || [],
          });
        } catch (err) {
          alert("Kh√¥ng t√¨m th·∫•y b·ªô s∆∞u t·∫≠p!");
        } finally {
          setLoading(false);
        }
      };
      fetchCollection();
    } else {
      setLoading(false);
    }
  }, [id, isEdit]);

  const handleChange = (e) => {
    const { name, value } = e.target;
    setCollectionData((prevData) => ({
      ...prevData,
      [name]: value,
    }));
  };

  const handleAddCategory = () => {
    if (!newCategory.trim()) return;
    if (collectionData.categories.includes(newCategory.trim())) {
      alert("Danh m·ª•c n√†y ƒë√£ t·ªìn t·∫°i!");
      return;
    }
    setCollectionData((prev) => ({
      ...prev,
      categories: [...prev.categories, newCategory.trim()],
    }));
    setNewCategory("");
  };

  const handleRemoveCategory = (categoryToRemove) => {
    setCollectionData((prev) => ({
      ...prev,
      categories: prev.categories.filter((cat) => cat !== categoryToRemove),
    }));
  };

  const handleImageUpload = async (e) => {
    const file = e.target.files[0];
    if (!userToken) {
      alert("B·∫°n c·∫ßn ƒëƒÉng nh·∫≠p admin ƒë·ªÉ upload ·∫£nh!");
      return;
    }
    if (file) {
      const formData = new FormData();
      formData.append("image", file);
      const response = await axios.post(`${API_URL}/api/upload`, formData, {
        headers: { Authorization: `Bearer ${userToken}` },
      });
      setCollectionData((prev) => ({
        ...prev,
        image: response.data.imageUrl,
      }));
    }
  };

  const handleSubmit = async (e) => {
    e.preventDefault();
    if (!userToken) {
      alert("B·∫°n c·∫ßn ƒëƒÉng nh·∫≠p admin ƒë·ªÉ th·ª±c hi·ªán thao t√°c n√†y!");
      return;
    }
    if (!collectionData.name) {
      alert("B·∫°n ph·∫£i nh·∫≠p t√™n b·ªô s∆∞u t·∫≠p!");
      return;
    }
    if (!collectionData.image) {
      alert("B·∫°n ph·∫£i upload ·∫£nh ƒë·∫°i di·ªán cho b·ªô s∆∞u t·∫≠p!");
      return;
    }

    try {
      if (isEdit) {
        const payload = {
          name: collectionData.name,
          bannerUrl: collectionData.image,
          description: collectionData.description,
          status: collectionData.status,
          categories: collectionData.categories,
        };
        await axios.put(
          `${API_URL}/api/collections/${collectionData.id}`,
          payload,
          {
            headers: { Authorization: `Bearer ${userToken}` },
          }
        );
        alert("C·∫≠p nh·∫≠t b·ªô s∆∞u t·∫≠p th√†nh c√¥ng!");
      } else {
        if (!collectionData.id) {
          alert("B·∫°n ph·∫£i nh·∫≠p ID cho b·ªô s∆∞u t·∫≠p!");
          return;
        }
        const payload = {
          id: collectionData.id,
          name: collectionData.name,
          bannerUrl: collectionData.image,
          description: collectionData.description,
          status: collectionData.status,
          products: [],
          categories: collectionData.categories,
        };
        await axios.post(`${API_URL}/api/collections`, payload, {
          headers: { Authorization: `Bearer ${userToken}` },
        });
        alert("T·∫°o b·ªô s∆∞u t·∫≠p m·ªõi th√†nh c√¥ng!");
      }
      navigate("/admin/collections");
    } catch (err) {
      alert("Thao t√°c th·∫•t b·∫°i!");
    }
  };

  if (loading)
    return <div className="text-center mt-10">ƒêang t·∫£i b·ªô s∆∞u t·∫≠p...</div>;

  return (
    <div className="w-full mx-auto p-6">
      <form
        onSubmit={handleSubmit}
        className="flex flex-col gap-4 max-w-xl mx-auto"
      >
        {/* ID b·ªô s∆∞u t·∫≠p */}
        {!isEdit ? (
          <div>
            <label className="block font-medium text-lg">
              ID b·ªô s∆∞u t·∫≠p (ph·∫£i l√† duy nh·∫•t)
            </label>
            <input
              type="text"
              name="id"
              value={collectionData.id}
              onChange={handleChange}
              className="w-full border border-gray-300 p-2"
              required
            />
          </div>
        ) : (
          <div>
            <label className="block font-medium text-lg">ID b·ªô s∆∞u t·∫≠p</label>
            <input
              type="text"
              value={collectionData.id}
              disabled
              className="w-full border border-gray-300 p-2 bg-gray-100 text-gray-500"
            />
          </div>
        )}

        {/* T√™n b·ªô s∆∞u t·∫≠p */}
        <div>
          <label className="block font-medium text-lg">T√™n b·ªô s∆∞u t·∫≠p</label>
          <input
            type="text"
            name="name"
            value={collectionData.name}
            onChange={handleChange}
            className="w-full border border-gray-300 p-2"
            required
          />
        </div>

        {/* M√¥ t·∫£ */}
        <div>
          <label className="block font-medium text-lg">M√¥ t·∫£</label>
          <textarea
            name="description"
            value={collectionData.description}
            onChange={handleChange}
            className="w-full border border-gray-300 p-2"
            rows={4}
          />
        </div>

        {/* Danh m·ª•c s·∫£n ph·∫©m */}
        <div>
          <label className="block font-medium text-lg">Danh m·ª•c s·∫£n ph·∫©m</label>
          <div className="flex gap-2 mb-2">
            <input
              type="text"
              value={newCategory}
              onChange={(e) => setNewCategory(e.target.value)}
              placeholder="Nh·∫≠p t√™n danh m·ª•c"
              className="flex-1 border border-gray-300 p-2"
            />
            <button
              type="button"
              onClick={handleAddCategory}
              className="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700"
            >
              Th√™m
            </button>
          </div>
          <div className="flex flex-wrap gap-2">
            {collectionData.categories.map((category, index) => (
              <div
                key={index}
                className="bg-gray-100 px-3 py-1 rounded-full flex items-center gap-2"
              >
                <span>{category}</span>
                <button
                  type="button"
                  onClick={() => handleRemoveCategory(category)}
                  className="text-red-600 hover:text-red-800"
                >
                  √ó
                </button>
              </div>
            ))}
          </div>
        </div>

        {/* ·∫¢nh ƒë·∫°i di·ªán */}
        <div>
          <label className="block font-medium text-lg">·∫¢nh ƒë·∫°i di·ªán</label>
          {collectionData.image && (
            <div className="mb-2">
              <img
                src={collectionData.image}
                alt="Collection"
                className="w-32 h-32 object-cover border mb-2"
              />
              <button
                type="button"
                onClick={() =>
                  setCollectionData((prev) => ({ ...prev, image: "" }))
                }
                className="text-red-600 underline text-sm"
              >
                X√≥a ·∫£nh
              </button>
            </div>
          )}
          <div className="mb-2">
            <button
              type="button"
              onClick={() => document.getElementById("fileInput").click()}
              className="bg-gray-200 px-2 py-1 border border-gray-300 hover:bg-gray-300"
            >
              Ch·ªçn ·∫£nh
            </button>
            <input
              type="file"
              id="fileInput"
              accept="image/*"
              onChange={handleImageUpload}
              style={{ display: "none" }}
            />
          </div>
        </div>

        {/* Tr·∫°ng th√°i */}
        <div>
          <label className="block font-medium text-lg">Tr·∫°ng th√°i</label>
          <select
            name="status"
            value={collectionData.status}
            onChange={handleChange}
            className="w-full border border-gray-300 p-2"
          >
            <option value="active">Ho·∫°t ƒë·ªông</option>
            <option value="inactive">·∫®n</option>
          </select>
        </div>

        <div className="flex gap-4 mt-8">
          <button
            type="submit"
            className="bg-blue-600 text-white px-6 py-2 rounded hover:bg-blue-700"
          >
            {isEdit ? "L∆∞u thay ƒë·ªïi" : "T·∫°o m·ªõi"}
          </button>
          <button
            type="button"
            className="bg-gray-400 text-white px-6 py-2 rounded hover:bg-gray-500"
            onClick={() => navigate("/admin/collections")}
          >
            H·ªßy b·ªè
          </button>
        </div>
      </form>
    </div>
  );
};

export default EditCollection;


===== FILE: ./frontend/src/components/Admin/EditProductPage.jsx =====
import React, { useState, useEffect } from "react";
import { useParams, useNavigate } from "react-router-dom";
import axios from "axios";

const API_URL = import.meta.env.VITE_API_URL || "http://localhost:9000";
const userToken =
  localStorage.getItem("userToken") || localStorage.getItem("token") || "";

const EditProductPage = () => {
  const { id } = useParams();
  const navigate = useNavigate();
  const isEdit = id && id !== "new";
  const [productData, setProductData] = useState({
    name: "",
    description: "",
    price: 0,
    countInStock: 0,
    sku: "",
    category: "",
    sizes: [],
    colors: [],
    collection: "",
    material: "",
    gender: "",
    images: [],
    dimensions: {
      length: "",
      width: "",
      height: "",
      weight: "",
    },
  });
  const [loading, setLoading] = useState(true);
  const [collections, setCollections] = useState([]);
  const [availableCategories, setAvailableCategories] = useState([]);

  // Fetch collections
  useEffect(() => {
    const fetchCollections = async () => {
      try {
        const collectionsRes = await axios.get(`${API_URL}/api/collections`);
        setCollections(collectionsRes.data);
      } catch (err) {
        console.error("Error fetching collections:", err);
      }
    };
    fetchCollections();
  }, []);

  // Update available categories when collection changes
  useEffect(() => {
    if (productData.collection) {
      const selectedCollection = collections.find(
        (c) => c.id === productData.collection
      );
      if (selectedCollection) {
        setAvailableCategories(selectedCollection.categories || []);
        if (!selectedCollection.categories?.includes(productData.category)) {
          setProductData((prev) => ({ ...prev, category: "" }));
        }
      }
    } else {
      setAvailableCategories([]);
      setProductData((prev) => ({ ...prev, category: "" }));
    }
  }, [productData.collection, collections]);

  // L·∫•y d·ªØ li·ªáu s·∫£n ph·∫©m khi v√†o trang (ch·ªâ khi ch·ªânh s·ª≠a)
  useEffect(() => {
    if (isEdit) {
      const fetchProduct = async () => {
        try {
          const res = await axios.get(`${API_URL}/api/products/${id}`);
          setProductData({
            ...res.data,
            sizes: res.data.sizes || [],
            colors: res.data.colors || [],
            images: res.data.images || [],
            dimensions: res.data.dimensions || {
              length: "",
              width: "",
              height: "",
              weight: "",
            },
          });
        } catch (err) {
          alert("Kh√¥ng t√¨m th·∫•y s·∫£n ph·∫©m!");
        } finally {
          setLoading(false);
        }
      };
      fetchProduct();
    } else {
      setLoading(false); // N·∫øu l√† t·∫°o m·ªõi th√¨ kh√¥ng c·∫ßn loading
    }
  }, [id, isEdit]);

  const handleChange = (e) => {
    const { name, value } = e.target;
    setProductData((prevData) => ({
      ...prevData,
      [name]: value,
    }));
  };
  // X·ª≠ l√Ω upload ·∫£nh
  const handleImageUpload = async (e) => {
    const file = e.target.files[0];
    if (!userToken) {
      alert("B·∫°n c·∫ßn ƒëƒÉng nh·∫≠p admin ƒë·ªÉ upload ·∫£nh!");
      return;
    }
    if (file) {
      const formData = new FormData();
      formData.append("image", file);
      const response = await axios.post(`${API_URL}/api/upload`, formData, {
        headers: { Authorization: `Bearer ${userToken}` },
      });
      setProductData((prev) => ({
        ...prev,
        images: [
          ...prev.images,
          { url: response.data.imageUrl, alt: "Product Image" },
        ],
      }));
    }
  };
  // X·ª≠ l√Ω submit c·∫≠p nh·∫≠t s·∫£n ph·∫©m
  const handleSubmit = async (e) => {
    e.preventDefault();
    if (!userToken) {
      alert("B·∫°n c·∫ßn ƒëƒÉng nh·∫≠p admin ƒë·ªÉ th·ª±c hi·ªán thao t√°c n√†y!");
      return;
    }
    const userInfo = JSON.parse(localStorage.getItem("userInfo"));
    if (!productData.images || productData.images.length === 0) {
      alert("B·∫°n ph·∫£i upload √≠t nh·∫•t 1 ·∫£nh s·∫£n ph·∫©m!");
      return;
    }
    if (
      !productData.dimensions ||
      !productData.dimensions.length ||
      !productData.dimensions.width ||
      !productData.dimensions.height ||
      !productData.dimensions.weight
    ) {
      alert("B·∫°n ph·∫£i nh·∫≠p ƒë·∫ßy ƒë·ªß k√≠ch th∆∞·ªõc (length, width, height, weight)!");
      return;
    }
    const fixedProductData = {
      ...productData,
      user: userInfo?._id || userInfo?.id,
      price: Number(productData.price),
      discountPrice: Number(productData.discountPrice),
      countInStock: Number(productData.countInStock),
      sizes: Array.isArray(productData.sizes) ? productData.sizes : [],
      colors: Array.isArray(productData.colors) ? productData.colors : [],
      images: (productData.images || []).map((img) => ({
        url: img.url,
        altText: img.altText || img.alt || "Product Image",
      })),
      dimensions: {
        length: Number(productData.dimensions.length),
        width: Number(productData.dimensions.width),
        height: Number(productData.dimensions.height),
        weight: Number(productData.dimensions.weight),
      },
      gender:
        productData.gender === "man"
          ? "man"
          : productData.gender === "woman"
          ? "woman"
          : "",
    };
    console.log("D·ªØ li·ªáu g·ª≠i l√™n:", fixedProductData);
    console.log("C√°c tr∆∞·ªùng b·∫Øt bu·ªôc:");
    console.log("name:", fixedProductData.name);
    console.log("description:", fixedProductData.description);
    console.log(
      "price:",
      fixedProductData.price,
      typeof fixedProductData.price
    );
    console.log("sku:", fixedProductData.sku);
    console.log("category:", fixedProductData.category);
    console.log(
      "sizes:",
      fixedProductData.sizes,
      Array.isArray(fixedProductData.sizes)
    );
    console.log(
      "colors:",
      fixedProductData.colors,
      Array.isArray(fixedProductData.colors)
    );
    console.log("collection:", fixedProductData.collection);
    console.log("material:", fixedProductData.material);
    console.log("gender:", fixedProductData.gender);
    console.log(
      "images:",
      fixedProductData.images,
      Array.isArray(fixedProductData.images)
    );
    console.log("dimensions:", fixedProductData.dimensions);
    console.log("user:", fixedProductData.user);
    try {
      if (isEdit) {
        await axios.put(`${API_URL}/api/products/${id}`, fixedProductData, {
          headers: { Authorization: `Bearer ${userToken}` },
        });
        alert("C·∫≠p nh·∫≠t s·∫£n ph·∫©m th√†nh c√¥ng!");
      } else {
        await axios.post(`${API_URL}/api/products`, fixedProductData, {
          headers: { Authorization: `Bearer ${userToken}` },
        });
        alert("T·∫°o s·∫£n ph·∫©m m·ªõi th√†nh c√¥ng!");
      }
      navigate("/admin/products");
    } catch (err) {
      alert("Thao t√°c th·∫•t b·∫°i!");
    }
  };
  if (loading)
    return <div className="text-center mt-10">ƒêang t·∫£i s·∫£n ph·∫©m...</div>;
  return (
    <div className="w-full mx-auto p-6">
      <form onSubmit={handleSubmit} className="flex flex-col gap-4">
        {/* name */}
        <div className="">
          <label className="block font-medium text-lg">T√™n s·∫£n ph·∫©m</label>
          <input
            type="text"
            name="name"
            value={productData.name}
            onChange={handleChange}
            className="w-full border border-gray-300 p-2"
            required
          />
        </div>
        {/* description */}
        <div className="">
          <label className="block font-medium text-lg">M√¥ t·∫£</label>
          <textarea
            name="description"
            value={productData.description}
            onChange={handleChange}
            className="w-full border border-gray-300 p-2"
            rows={4}
            required
          />
        </div>
        {/* price */}
        <div className="">
          <label className="block font-medium text-lg">Gi√°</label>
          <input
            type="number"
            name="price"
            value={productData.price}
            onChange={handleChange}
            className="w-full border border-gray-300 p-2"
          />
        </div>
        {/* count In Stock */}
        <div className="">
          <label className="block font-medium text-lg">S·ªë l∆∞·ª£ng</label>
          <input
            type="number"
            name="countInStock"
            value={productData.countInStock}
            onChange={handleChange}
            className="w-full border border-gray-300 p-2"
          />
        </div>
        {/* SKU */}
        <div className="">
          <label className="block font-medium text-lg">M√£ s·∫£n ph·∫©m</label>
          <input
            type="text"
            name="sku"
            value={productData.sku}
            onChange={handleChange}
            className="w-full border border-gray-300 p-2"
          />
        </div>
        {/* size */}
        <div className="">
          <label className="block font-medium text-lg">
            K√≠ch th∆∞·ªõc (c√°ch nhau b·∫±ng d·∫•u ph·∫©y)
          </label>
          <input
            type="text"
            name="sizes"
            value={productData.sizes.join(", ")}
            onChange={(e) =>
              setProductData((prevData) => ({
                ...prevData,
                sizes: e.target.value
                  .split(",")
                  .map((size) => size.trim().toUpperCase()),
              }))
            }
            className="w-full border border-gray-300 p-2"
          />
        </div>
        {/* color */}
        <div className="">
          <label className="block font-medium text-lg">M√†u s·∫Øc</label>
          {productData.colors.map((color, idx) => (
            <div key={idx} className="flex gap-2 mb-2">
              <input
                type="text"
                placeholder="T√™n m√†u (VD: Navy)"
                value={color.name}
                onChange={(e) =>
                  setProductData((prevData) => {
                    const updatedColors = [...prevData.colors];
                    updatedColors[idx].name = e.target.value;
                    return { ...prevData, colors: updatedColors };
                  })
                }
                className="border p-1 w-1/2"
              />
              <input
                type="text"
                placeholder="M√£ m√†u (VD: #000080)"
                value={color.code}
                onChange={(e) =>
                  setProductData((prevData) => {
                    const updatedColors = [...prevData.colors];
                    updatedColors[idx].code = e.target.value;
                    return { ...prevData, colors: updatedColors };
                  })
                }
                className="border p-1 w-1/2"
              />
              <button
                type="button"
                onClick={() =>
                  setProductData((prevData) => ({
                    ...prevData,
                    colors: prevData.colors.filter((_, i) => i !== idx),
                  }))
                }
                className="text-red-600"
              >
                X
              </button>
            </div>
          ))}
          <button
            type="button"
            onClick={() =>
              setProductData((prevData) => ({
                ...prevData,
                colors: [...prevData.colors, { name: "", code: "" }],
              }))
            }
            className="text-blue-600"
          >
            + Th√™m m√†u
          </button>
        </div>
        {/* category */}
        <div className="">
          <label className="block font-medium text-lg">Danh m·ª•c</label>
          <select
            name="category"
            value={productData.category}
            onChange={handleChange}
            className="w-full border border-gray-300 p-2"
            disabled={!productData.collection}
          >
            <option value="">Ch·ªçn danh m·ª•c</option>
            {availableCategories.map((category) => (
              <option key={category} value={category}>
                {category}
              </option>
            ))}
          </select>
        </div>
        {/* collection */}
        <div className="">
          <label className="block font-medium text-lg">B·ªô s∆∞u t·∫≠p</label>
          <select
            name="collection"
            value={productData.collection}
            onChange={handleChange}
            className="w-full border border-gray-300 p-2"
          >
            <option value="">Ch·ªçn b·ªô s∆∞u t·∫≠p</option>
            {collections.map((collection) => (
              <option key={collection.id} value={collection.id}>
                {collection.name}
              </option>
            ))}
          </select>
        </div>
        {/* material */}
        <div className="">
          <label className="block font-medium text-lg">Ch·∫•t li·ªáu</label>
          <input
            type="text"
            name="material"
            value={productData.material}
            onChange={handleChange}
            className="w-full border border-gray-300 p-2"
            placeholder="Enter material"
            required
          />
        </div>
        {/* gender */}
        <div className="">
          <label className="block font-medium text-lg">Gi·ªõi t√≠nh</label>
          <div className="flex gap-4">
            <label className="flex items-center gap-2">
              <input
                type="checkbox"
                name="gender"
                value="men"
                checked={productData.gender === "man"}
                onChange={(e) =>
                  setProductData((prevData) => ({
                    ...prevData,
                    gender: e.target.checked ? "man" : "",
                  }))
                }
              />
              Nam
            </label>
            <label className="flex items-center gap-2">
              <input
                type="checkbox"
                name="gender"
                value="woman"
                checked={productData.gender === "woman"}
                onChange={(e) =>
                  setProductData((prevData) => ({
                    ...prevData,
                    gender: e.target.checked ? "woman" : "",
                  }))
                }
              />
              N·ªØ
            </label>
          </div>
        </div>
        {/* images */}
        <div className="">
          <label className="block font-medium text-lg">·∫¢nh</label>
          <div className="flex gap-4 mb-2">
            {productData.images.map((img, idx) => (
              <img
                key={idx}
                src={img.url}
                alt={img.alt || "Product Image"}
                className="w-20 h-20 object-cover border"
              />
            ))}
          </div>
          <input type="file" accept="image/*" onChange={handleImageUpload} />
        </div>
        {/* dimensions */}
        <div className="mb-6">
          <label className="block font-medium text-lg">K√≠ch th∆∞·ªõc (cm)</label>
          <div className="grid grid-cols-2 gap-4">
            <input
              type="number"
              name="length"
              placeholder="Chi·ªÅu d√†i"
              value={productData.dimensions?.length || ""}
              onChange={(e) =>
                setProductData((prev) => ({
                  ...prev,
                  dimensions: { ...prev.dimensions, length: e.target.value },
                }))
              }
              className="border border-gray-300 p-2"
              required
            />
            <input
              type="number"
              name="width"
              placeholder="Chi·ªÅu r·ªông"
              value={productData.dimensions?.width || ""}
              onChange={(e) =>
                setProductData((prev) => ({
                  ...prev,
                  dimensions: { ...prev.dimensions, width: e.target.value },
                }))
              }
              className="border border-gray-300 p-2"
              required
            />
            <input
              type="number"
              name="height"
              placeholder="Chi·ªÅu cao"
              value={productData.dimensions?.height || ""}
              onChange={(e) =>
                setProductData((prev) => ({
                  ...prev,
                  dimensions: { ...prev.dimensions, height: e.target.value },
                }))
              }
              className="border border-gray-300 p-2"
              required
            />
            <input
              type="number"
              name="weight"
              placeholder="Kh·ªëi l∆∞·ª£ng (kg)"
              value={productData.dimensions?.weight || ""}
              onChange={(e) =>
                setProductData((prev) => ({
                  ...prev,
                  dimensions: { ...prev.dimensions, weight: e.target.value },
                }))
              }
              className="border border-gray-300 p-2"
              required
            />
          </div>
        </div>
        <div className="flex gap-4 mt-8">
          <button
            type="submit"
            className="bg-blue-600 text-white px-6 py-2 rounded hover:bg-blue-700"
          >
            L∆∞u thay ƒë·ªïi
          </button>
          <button
            type="button"
            className="bg-gray-400 text-white px-6 py-2 rounded hover:bg-gray-500"
            onClick={() => navigate("/admin/products")}
          >
            H·ªßy b·ªè thay ƒë·ªïi
          </button>
        </div>
      </form>
    </div>
  );
};

export default EditProductPage;


===== FILE: ./frontend/src/components/Admin/OrderManagement.jsx =====
import React, { useEffect, useState } from "react";
import axios from "axios";

const API_URL = import.meta.env.VITE_API_URL || "http://localhost:9000";

const OrderManagement = () => {
  const [orders, setOrders] = useState([]);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState("");
  const [searchTerm, setSearchTerm] = useState("");
  const [filteredOrders, setFilteredOrders] = useState([]);

  useEffect(() => {
    const fetchOrders = async () => {
      setLoading(true);
      setError("");
      try {
        const userToken =
          localStorage.getItem("userToken") || localStorage.getItem("token");
        const res = await axios.get(`${API_URL}/api/admin/orders`, {
          headers: userToken ? { Authorization: `Bearer ${userToken}` } : {},
        });
        setOrders(res.data || []);
        setFilteredOrders(res.data || []);
      } catch (err) {
        setError("Kh√¥ng th·ªÉ t·∫£i danh s√°ch ƒë∆°n h√†ng!");
        setOrders([]);
        setFilteredOrders([]);
      } finally {
        setLoading(false);
      }
    };
    fetchOrders();
  }, []);

  // H√†m x·ª≠ l√Ω t√¨m ki·∫øm
  useEffect(() => {
    const searchResults = orders.filter((order) => {
      const searchLower = searchTerm.toLowerCase();
      return (
        order._id.toLowerCase().includes(searchLower) ||
        (order.user?.name || "").toLowerCase().includes(searchLower) ||
        (order.user?.email || "").toLowerCase().includes(searchLower) ||
        (order.status || "").toLowerCase().includes(searchLower) ||
        (order.paymentStatus || "").toLowerCase().includes(searchLower)
      );
    });
    setFilteredOrders(searchResults);
  }, [searchTerm, orders]);

  const handleStatusChange = async (orderId, status) => {
    try {
      const userToken =
        localStorage.getItem("userToken") || localStorage.getItem("token");
      await axios.put(
        `${API_URL}/api/admin/orders/${orderId}`,
        { status },
        { headers: { Authorization: `Bearer ${userToken}` } }
      );
      // Sau khi c·∫≠p nh·∫≠t, reload l·∫°i danh s√°ch ƒë∆°n h√†ng
      const res = await axios.get(`${API_URL}/api/admin/orders`, {
        headers: userToken ? { Authorization: `Bearer ${userToken}` } : {},
      });
      setOrders(res.data || []);
    } catch (err) {
      alert("C·∫≠p nh·∫≠t tr·∫°ng th√°i ƒë∆°n h√†ng th·∫•t b·∫°i!");
    }
  };

  const handlePaymentStatusChange = async (orderId, paymentStatus) => {
    try {
      const userToken =
        localStorage.getItem("userToken") || localStorage.getItem("token");
      await axios.put(
        `${API_URL}/api/admin/orders/${orderId}`,
        { paymentStatus },
        { headers: { Authorization: `Bearer ${userToken}` } }
      );
      // Reload l·∫°i danh s√°ch ƒë∆°n h√†ng
      const res = await axios.get(`${API_URL}/api/admin/orders`, {
        headers: userToken ? { Authorization: `Bearer ${userToken}` } : {},
      });
      setOrders(res.data || []);
    } catch (err) {
      alert("C·∫≠p nh·∫≠t tr·∫°ng th√°i thanh to√°n th·∫•t b·∫°i!");
    }
  };

  return (
    <div className="max-w-7xl mx-auto p-6">
      <h2 className="text-3xl font-bold mb-6">Qu·∫£n l√Ω ƒë∆°n h√†ng</h2>

      {/* Thanh t√¨m ki·∫øm */}
      <div className="mb-6">
        <div className="relative">
          <input
            type="text"
            placeholder="T√¨m ki·∫øm theo m√£ ƒë∆°n h√†ng, t√™n ng∆∞·ªùi d√πng, email ho·∫∑c tr·∫°ng th√°i..."
            value={searchTerm}
            onChange={(e) => setSearchTerm(e.target.value)}
            className="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
          />
          {searchTerm && (
            <button
              onClick={() => setSearchTerm("")}
              className="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-500 hover:text-gray-700"
            >
              ‚úï
            </button>
          )}
        </div>
      </div>

      <div className="overflow-x-auto">
        <table className="min-w-full text-left text-gray-600 border border-gray-100 border-collapse">
          <thead className="text-xs text-black uppercase bg-gray-100">
            <tr>
              <th className="px-4 py-3">M√£ ƒë∆°n h√†ng</th>
              <th className="px-4 py-3">Ng∆∞·ªùi d√πng</th>
              <th className="px-4 py-3">S·ªë ƒëi·ªán tho·∫°i</th>
              <th className="px-4 py-3">ƒê·ªãa ch·ªâ</th>
              <th className="px-4 py-3">Ph∆∞∆°ng th·ª©c thanh to√°n</th>
              <th className="px-4 py-3">S·∫£n ph·∫©m</th>
              <th className="px-4 py-3">T·ªïng ti·ªÅn</th>
              <th className="px-4 py-3">Tr·∫°ng th√°i</th>
              <th className="px-4 py-3">Tr·∫°ng th√°i thanh to√°n</th>
              <th className="px-4 py-3">Thao t√°c</th>
            </tr>
          </thead>
          <tbody>
            {loading ? (
              <tr>
                <td colSpan={10} className="px-4 py-6 text-center">
                  ƒêang t·∫£i...
                </td>
              </tr>
            ) : error ? (
              <tr>
                <td colSpan={10} className="px-4 py-6 text-center text-red-500">
                  {error}
                </td>
              </tr>
            ) : filteredOrders.length > 0 ? (
              filteredOrders.map((order) => (
                <tr key={order._id} className="border-b border-gray-100">
                  <td className="p-4 font-medium whitespace-nowrap">
                    #{order._id}
                  </td>
                  <td className="p-4 ">
                    {order.user?.name || order.user?.email || ""}
                  </td>
                  <td className="p-4">
                    {order.phone || order.shippingAddress?.phone || ""}
                  </td>
                  <td className="p-4">
                    {order.address || order.shippingAddress?.address || ""}
                  </td>
                  <td className="p-4">{order.paymentMethod}</td>
                  <td className="p-4">
                    {(order.products || order.orderItems || [])
                      .map((product) => product.name)
                      .join(", ")}
                  </td>
                  <td className="p-4">{order.total || order.totalPrice}</td>
                  <td className="p-4">
                    <select
                      value={order.status || "Pending"}
                      onChange={(e) =>
                        handleStatusChange(order._id, e.target.value)
                      }
                      className="p-1 border border-gray-300"
                    >
                      <option value="Pending">Pending</option>
                      <option value="Processing">Processing</option>
                      <option value="Shipped">Shipped</option>
                      <option value="Delivered">Delivered</option>
                      <option value="Cancelled">Cancelled</option>
                    </select>
                  </td>
                  <td className="p-4">
                    <select
                      value={order.paymentStatus || "Unpaid"}
                      onChange={(e) =>
                        handlePaymentStatusChange(order._id, e.target.value)
                      }
                      className="p-1 border border-gray-300"
                    >
                      <option value="Unpaid">Unpaid</option>
                      <option value="Paid">Paid</option>
                      <option value="Refunded">Refunded</option>
                    </select>
                  </td>
                  <td className="p-4">
                    <button
                      onClick={() => handleStatusChange(order._id, "Delivered")}
                      className="bg-blue-500 text-white px-3 py-1 border border-gray-300 hover:bg-blue-600 cursor-pointer w-20"
                    >
                      ƒê√£ giao
                    </button>
                  </td>
                </tr>
              ))
            ) : (
              <tr>
                <td colSpan={10} className="px-4 text-center">
                  {searchTerm
                    ? "Kh√¥ng t√¨m th·∫•y ƒë∆°n h√†ng ph√π h·ª£p"
                    : "Kh√¥ng c√≥ ƒë∆°n h√†ng"}
                </td>
              </tr>
            )}
          </tbody>
        </table>
      </div>
    </div>
  );
};

export default OrderManagement;


===== FILE: ./frontend/src/components/Admin/ProductManagement.jsx =====
import React, { useEffect, useState } from "react";
import { Link } from "react-router-dom";
import axios from "axios";

const API_URL = import.meta.env.VITE_API_URL || "http://localhost:9000";

const ProductManagement = () => {
  const [products, setProducts] = useState([]);
  const [loading, setLoading] = useState(true);
  const [selectedCategory, setSelectedCategory] = useState("all");
  const [selectedGender, setSelectedGender] = useState("all");
  const [searchQuery, setSearchQuery] = useState("");

  const categoryGroups = {
    all: "T·∫•t c·∫£",
    tops: {
      label: "√Åo",
      categories: ["√Åo s∆° mi", "√Åo hoodie", "√Åo blazer", "√Åo vest", "√Åo sweater", "√Åo henley", "√Åo kho√°c", "√Åo thun", "√Åo polo"]
    },
    bottoms: {
      label: "Qu·∫ßn",
      categories: ["Qu·∫ßn short", "Qu·∫ßn jogger", "Qu·∫ßn cargo", "Qu·∫ßn legging", "Qu·∫ßn palazzo", "Qu·∫ßn jean", "Qu·∫ßn t√¢y", "Qu·∫ßn culottes"]
    },            
    dresses: {
      label: "V√°y & ƒê·∫ßm",
      categories: ["Ch√¢n v√°y", "ƒê·∫ßm maxi", "V√°y li·ªÅn"]
    },
    accessories: {
      label: "Ph·ª• ki·ªán",
      categories: ["T√∫i x√°ch", "V√≠", "Th·∫Øt l∆∞ng", "M≈©", "KhƒÉn"]
    }
  };

  const categoryOptions = [
    { value: "all", label: "T·∫•t c·∫£" },
    { value: "tops", label: "√Åo" },
    { value: "bottoms", label: "Qu·∫ßn" },
    { value: "dresses", label: "V√°y & ƒê·∫ßm" },
    { value: "accessories", label: "Ph·ª• ki·ªán" }
  ];

  const genderOptions = [
    { value: "all", label: "T·∫•t c·∫£" },
    { value: "man", label: "Nam" },
    { value: "woman", label: "N·ªØ" },
    { value: "unisex", label: "Unisex" }
  ];

  useEffect(() => {
    const fetchProducts = async () => {
      try {
        const res = await axios.get(`${API_URL}/api/products?limit=100`);
        setProducts(res.data.products || []);
      } catch (err) {
        setProducts([]);
      } finally {
        setLoading(false);
      }
    };
    fetchProducts();
  }, []);

  const handleDelete = async (id) => {
    if (window.confirm("B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a s·∫£n ph·∫©m n√†y kh√¥ng?")) {
      try {
        const userToken =
          localStorage.getItem("userToken") || localStorage.getItem("token");
        await axios.delete(`${API_URL}/api/products/${id}`, {
          headers: { Authorization: `Bearer ${userToken}` },
        });
        setProducts(products.filter((p) => p._id !== id));
        alert("X√≥a s·∫£n ph·∫©m th√†nh c√¥ng!");
      } catch (err) {
        alert("X√≥a s·∫£n ph·∫©m th·∫•t b·∫°i!");
      }
    }
  };

  const getFilteredProducts = () => {
    let filtered = [...products];

    // L·ªçc theo t·ª´ kh√≥a t√¨m ki·∫øm
    if (searchQuery.trim()) {
      const query = searchQuery.toLowerCase().trim();
      filtered = filtered.filter(product =>
        product.name.toLowerCase().includes(query) ||
        product.sku.toLowerCase().includes(query)
      );
    }

    // L·ªçc theo danh m·ª•c
    if (selectedCategory !== "all") {
      const group = categoryGroups[selectedCategory];
      if (group) {
        filtered = filtered.filter(product =>
          group.categories.includes(product.category)
        );
      }
    }

    // L·ªçc theo gi·ªõi t√≠nh
    if (selectedGender !== "all") {
      filtered = filtered.filter(product =>
        product.gender === selectedGender
      );
    }

    return filtered;
  };

  const getGenderLabel = (gender) => {
    switch (gender) {
      case "man": return "Nam";
      case "woman": return "N·ªØ";
      case "unisex": return "Unisex";
      default: return gender;
    }
  };

  const filteredProducts = getFilteredProducts();

  return (
    <div className="max-w-7xl mx-auto p-6">
      <div className="flex justify-between items-center mb-6">
        <div className="flex items-center gap-4">
          <h2 className="text-2xl font-bold">Qu·∫£n l√Ω s·∫£n ph·∫©m</h2>
          <div className="flex gap-2">
            <input
              type="text"
              value={searchQuery}
              onChange={(e) => setSearchQuery(e.target.value)}
              placeholder="T√¨m theo t√™n ho·∫∑c SKU..."
              className="border border-gray-300 rounded px-3 py-1 min-w-[250px]"
            />
            <select
              value={selectedCategory}
              onChange={(e) => setSelectedCategory(e.target.value)}
              className="border border-gray-300 rounded px-3 py-1"
            >
              {categoryOptions.map(option => (
                <option key={option.value} value={option.value}>
                  {option.label}
                </option>
              ))}
            </select>
            <select
              value={selectedGender}
              onChange={(e) => setSelectedGender(e.target.value)}
              className="border border-gray-300 rounded px-3 py-1"
            >
              {genderOptions.map(option => (
                <option key={option.value} value={option.value}>
                  {option.label}
                </option>
              ))}
            </select>
          </div>
        </div>
        <Link
          to="/admin/products/new"
          className="bg-black text-white px-4 py-2 hover:bg-gray-700 cursor-pointer"
        >
          Th√™m s·∫£n ph·∫©m
        </Link>
      </div>
      <div className="overflow-x-auto">
        <table className="min-w-full text-left text-gray-500 border border-gray-100 border-collapse">
          <thead className="text-xs text-gray-700 uppercase bg-gray-100">
            <tr>
              <th className="px-3 py-3">T√™n s·∫£n ph·∫©m</th>
              <th className="px-3 py-3">Danh m·ª•c</th>
              <th className="px-3 py-3">Gi·ªõi t√≠nh</th>
              <th className="px-3 py-3">Gi√°</th>
              <th className="px-3 py-3">SKU</th>
              <th className="px-3 py-3">Thao t√°c</th>
            </tr>
          </thead>
          <tbody>
            {loading ? (
              <tr>
                <td colSpan={6} className="p-4 text-center">
                  ƒêang t·∫£i...
                </td>
              </tr>
            ) : filteredProducts.length > 0 ? (
              filteredProducts.map((product) => (
                <tr
                  key={product._id}
                  className="bg-white border-b border-gray-100"
                >
                  <td className="p-4 font-medium text-gray-900 whitespace-nowrap">
                    {product.name}
                  </td>
                  <td className="p-4">
                    {product.category}
                  </td>
                  <td className="p-4">
                    {getGenderLabel(product.gender)}
                  </td>
                  <td className="p-4">{product.price.toLocaleString('vi-VN')} VND</td>
                  <td className="p-4">{product.sku}</td>
                  <td className="p-4">
                    <Link
                      to={`/admin/products/${product._id}`}
                      className="inline-flex items-center bg-black text-white px-3 py-1 mr-2 hover:bg-gray-700 cursor-pointer"
                    >
                      S·ª≠a s·∫£n ph·∫©m
                    </Link>
                    <button
                      onClick={() => handleDelete(product._id)}
                      className="inline-flex items-center text-black px-3 py-1 border border-black hover:border-gray-700 hover:text-gray-700 cursor-pointer"
                    >
                      X√≥a s·∫£n ph·∫©m
                    </button>
                  </td>
                </tr>
              ))
            ) : (
              <tr>
                <td colSpan={6} className="p-4 text-center">
                  {selectedCategory === "all" && selectedGender === "all"
                    ? "Kh√¥ng t√¨m th·∫•y s·∫£n ph·∫©m n√†o"
                    : `Kh√¥ng t√¨m th·∫•y s·∫£n ph·∫©m ${selectedCategory !== "all" ? `thu·ªôc danh m·ª•c ${categoryGroups[selectedCategory]?.label}` : ''} ${selectedGender !== "all" ? `d√†nh cho ${getGenderLabel(selectedGender).toLowerCase()}` : ''}`
                  }
                </td>
              </tr>
            )}
          </tbody>
        </table>
      </div>
    </div>
  );
};

export default ProductManagement;


===== FILE: ./frontend/src/components/Admin/UserManagement.jsx =====
import React, { useState, useEffect } from 'react';
import axios from 'axios';
import { useSelector } from 'react-redux';
import { toast } from 'sonner';

const API_URL = import.meta.env.VITE_API_URL || "http://localhost:9000";

const UserManagement = () => {
    const [users, setUsers] = useState([]);
    const [loading, setLoading] = useState(true);
    const [error, setError] = useState(null);
    const { userToken } = useSelector((state) => state.auth);

    const [formData, setFormData] = useState({
        name: "",
        email: "",
        password: "",
        role: "customer",
    });

    // Fetch users
    const fetchUsers = async () => {
        try {
            const response = await axios.get(`${API_URL}/api/admin/users`, {
                headers: {
                    Authorization: `Bearer ${userToken}`,
                },
            });
            setUsers(response.data);
            setLoading(false);
        } catch (err) {
            console.error("Error fetching users:", err);
            setError("Kh√¥ng th·ªÉ t·∫£i danh s√°ch ng∆∞·ªùi d√πng");
            setLoading(false);
        }
    };

    useEffect(() => {
        fetchUsers();
    }, [userToken]);

    const handleChange = (e) => {
        setFormData({
            ...formData,
            [e.target.name]: e.target.value
        });
    };

    const handleSubmit = async (e) => {
        e.preventDefault();
        try {
            await axios.post(`${API_URL}/api/admin`, formData, {
                headers: {
                    Authorization: `Bearer ${userToken}`,
                },
            });
            toast.success("Th√™m ng∆∞·ªùi d√πng th√†nh c√¥ng!");
            // Reset form
            setFormData({
                name: "",
                email: "",
                password: "",
                role: "customer",
            });
            // Refresh user list
            fetchUsers();
        } catch (err) {
            console.error("Error creating user:", err);
            toast.error(err.response?.data?.message || "Kh√¥ng th·ªÉ t·∫°o ng∆∞·ªùi d√πng");
        }
    };

    const handleRoleChange = async (userId, newRole) => {
        try {
            await axios.put(`${API_URL}/api/admin/${userId}`,
                { role: newRole },
                {
                    headers: {
                        Authorization: `Bearer ${userToken}`,
                    },
                }
            );
            toast.success("C·∫≠p nh·∫≠t vai tr√≤ th√†nh c√¥ng!");
            // Update local state
            setUsers(users.map(user =>
                user._id === userId ? { ...user, role: newRole } : user
            ));
        } catch (err) {
            console.error("Error updating user role:", err);
            toast.error("Kh√¥ng th·ªÉ c·∫≠p nh·∫≠t vai tr√≤ ng∆∞·ªùi d√πng");
        }
    };

    const handleDelete = async (userId) => {
        if (window.confirm("B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a ng∆∞·ªùi d√πng n√†y?")) {
            try {
                await axios.delete(`${API_URL}/api/admin/${userId}`, {
                    headers: {
                        Authorization: `Bearer ${userToken}`,
                    },
                });
                toast.success("X√≥a ng∆∞·ªùi d√πng th√†nh c√¥ng!");
                // Update local state
                setUsers(users.filter(user => user._id !== userId));
            } catch (err) {
                console.error("Error deleting user:", err);
                toast.error("Kh√¥ng th·ªÉ x√≥a ng∆∞·ªùi d√πng");
            }
        }
    };

    if (loading) {
        return (
            <div className="flex justify-center items-center min-h-screen">
                <div className="animate-spin rounded-full h-8 w-8 border-t-2 border-b-2 border-gray-900"></div>
            </div>
        );
    }

    if (error) {
        return (
            <div className="max-w-7xl mx-auto p-6">
                <div className="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded">
                    {error}
                </div>
            </div>
        );
    }

    return (
        <div className='w-full mx-auto p-6 flex gap-6'>
            {/* add new user form */}
            <div className='mb-6 w-1/4'>
                <h2 className='text-2xl font-bold'>Th√™m t√†i kho·∫£n m·ªõi</h2>
                <form onSubmit={handleSubmit} className='space-y-2'>
                    <div>
                        <label className='block text-gray-700'>T√™n ng∆∞·ªùi d√πng</label>
                        <input
                            type="text"
                            name="name"
                            value={formData.name}
                            onChange={handleChange}
                            className='w-full p-2 border border-gray-300'
                            required
                        />
                    </div>
                    <div>
                        <label className='block text-gray-700'>
                            Email
                        </label>
                        <input
                            type="email"
                            name="email"
                            value={formData.email}
                            onChange={handleChange}
                            className='w-full p-2 border border-gray-300'
                            required
                        />
                    </div>
                    <div>
                        <label className='block text-gray-700'>M·∫≠t kh·∫©u</label>
                        <input
                            type="password"
                            name="password"
                            value={formData.password}
                            onChange={handleChange}
                            className='w-full p-2 border border-gray-300'
                            required
                        />
                    </div>
                    <div>
                        <label className='block text-gray-700'>Vai tr√≤</label>
                        <select name="role"
                            value={formData.role}
                            onChange={handleChange}
                            className='w-full p-2 border border-gray-300'
                            required
                        >
                            <option value="customer">Customer</option>
                            <option value="admin">Admin</option>
                        </select>
                    </div>
                    <button
                        type='submit'
                        className='bg-black text-white px-4 py-2 hover:bg-gray-700 cursor-pointer'>
                        Th√™m ng∆∞·ªùi d√πng
                    </button>
                </form>
            </div>

            {/* user list */}
            <div className='overflow-x-auto w-3/4'>
                <h2 className='text-2xl font-bold mb-6'>Qu·∫£n l√Ω t√†i kho·∫£n</h2>
                <table className='min-w-full text-left text-gray-500 border border-gray-100 border-collapse'>
                    <thead className='text-xs text-gray-700 uppercase bg-gray-100'>
                        <tr>
                            <th className='px-3 py-3'>H·ªç v√† t√™n</th>
                            <th className='px-3 py-3'>Email</th>
                            <th className='px-3 py-3'>Vai tr√≤</th>
                            <th className='px-3 py-3'>X√≥a</th>
                        </tr>
                    </thead>
                    <tbody>
                        {users.map((user) => (
                            <tr key={user._id} className='bg-white border-b border-gray-100'>
                                <td className='p-4 font-medium text-gray-900 whitespace-nowrap'>{user.name}</td>
                                <td className='p-4'>{user.email}</td>
                                <td className='p-4'>
                                    <select
                                        value={user.role}
                                        onChange={(e) => handleRoleChange(user._id, e.target.value)}
                                        className='p-2 border border-gray-300'
                                    >
                                        <option value="customer">Customer</option>
                                        <option value="admin">Admin</option>
                                    </select>
                                </td>
                                <td className='p-4'>
                                    <button
                                        onClick={() => handleDelete(user._id)}
                                        className='text-black px-2 py-1 border border-black hover:border-gray-700 hover:text-gray-700 cursor-pointer'>
                                        X√≥a
                                    </button>
                                </td>
                            </tr>
                        ))}
                    </tbody>
                </table>
            </div>
        </div>
    );
};

export default UserManagement;

===== FILE: ./frontend/src/components/Auth/AdminRoute.jsx =====
import React from 'react';
import { Navigate, Outlet, useLocation } from 'react-router-dom';
import { useSelector } from 'react-redux';

const AdminRoute = () => {
    const { userInfo } = useSelector((state) => state.auth);
    const location = useLocation();

    if (!userInfo) {
        // Save the path user was trying to access
        return <Navigate to="/login" state={{ from: location.pathname }} replace />;
    }

    // Check if user is admin
    if (userInfo.role !== 'admin') {
        // If not admin, redirect to home
        return <Navigate to="/" replace />;
    }

    return <Outlet />;
};

export default AdminRoute; 

===== FILE: ./frontend/src/components/Auth/PrivateRoute.jsx =====
import React from 'react';
import { Navigate, Outlet, useLocation } from 'react-router-dom';
import { useSelector } from 'react-redux';

const PrivateRoute = () => {
    const { userInfo } = useSelector((state) => state.auth);
    const location = useLocation();

    if (!userInfo) {
        // Save the path user was trying to access
        return <Navigate to="/login" state={{ from: location.pathname }} replace />;
    }

    return <Outlet />;
};

export default PrivateRoute; 

===== FILE: ./frontend/src/components/Auth/PublicOnlyRoute.jsx =====
import React from 'react';
import { Navigate, Outlet } from 'react-router-dom';
import { useSelector } from 'react-redux';

const PublicOnlyRoute = () => {
    const { userInfo } = useSelector((state) => state.auth);

    // If user is logged in, redirect to home page
    if (userInfo) {
        return <Navigate to="/" replace />;
    }

    // If user is not logged in, render the child routes
    return <Outlet />;
};

export default PublicOnlyRoute; 

===== FILE: ./frontend/src/components/Cart/CartContext.jsx =====
import React, { createContext, useContext, useState, useEffect } from "react";
import { toast } from "sonner";

const CartContext = createContext();

export const useCart = () => useContext(CartContext);

export const CartProvider = ({ children }) => {
  const [cartItems, setCartItems] = useState([]);
  const [isCartOpen, setIsCartOpen] = useState(false);

  // Load cart from localStorage on mount
  useEffect(() => {
    const savedCart = localStorage.getItem("cart");
    if (savedCart) {
      setCartItems(JSON.parse(savedCart));
    }
  }, []);

  // Save cart to localStorage whenever it changes
  useEffect(() => {
    localStorage.setItem("cart", JSON.stringify(cartItems));
  }, [cartItems]);

  const addToCart = (product, quantity, selectedSize, selectedColor) => {
    setCartItems((prevItems) => {
      // Check if item already exists with same size and color
      const existingItemIndex = prevItems.findIndex(
        (item) =>
          item.product._id === product._id &&
          item.size === selectedSize &&
          item.color === selectedColor
      );
      if (existingItemIndex !== -1) {
        // Update quantity of existing item
        const newItems = [...prevItems];
        newItems[existingItemIndex].quantity += quantity;
        toast.success("ƒê√£ c·∫≠p nh·∫≠t s·ªë l∆∞·ª£ng trong gi·ªè h√†ng", {
          id: "cart-update",
        });
        return newItems;
      } else {
        // Add new item
        toast.success("ƒê√£ th√™m v√†o gi·ªè h√†ng", {
          id: "cart-add",
        });
        return [
          ...prevItems,
          {
            product,
            quantity,
            size: selectedSize,
            color: selectedColor,
          },
        ];
      }
    });
  };

  const removeFromCart = (index) => {
    setCartItems((prevItems) => {
      const newItems = [...prevItems];
      newItems.splice(index, 1);
      toast.success("ƒê√£ x√≥a s·∫£n ph·∫©m kh·ªèi gi·ªè h√†ng");
      return newItems;
    });
  };

  const updateQuantity = (index, newQuantity) => {
    if (newQuantity < 1) return;
    setCartItems((prevItems) => {
      const newItems = [...prevItems];
      newItems[index].quantity = newQuantity;
      return newItems;
    });
  };

  const clearCart = () => {
    setCartItems([]);
    toast.success("ƒê√£ x√≥a gi·ªè h√†ng");
  };

  const getTotalPrice = () => {
    return cartItems.reduce((total, item) => {
      const price = item.product.discountPrice || item.product.price;
      return total + price * item.quantity;
    }, 0);
  };

  const getTotalItems = () => {
    return cartItems.reduce((total, item) => total + item.quantity, 0);
  };

  return (
    <CartContext.Provider
      value={{
        cartItems,
        isCartOpen,
        setIsCartOpen,
        addToCart,
        removeFromCart,
        updateQuantity,
        clearCart,
        getTotalPrice,
        getTotalItems,
      }}
    >
      {children}
    </CartContext.Provider>
  );
};


===== FILE: ./frontend/src/components/Common/Footer.jsx =====
import React from "react";
import { Link } from "react-router-dom";
import { FaFacebookSquare, FaInstagramSquare, FaYoutube } from "react-icons/fa";
import Newsletter from "./Newsletter";

const Footer = () => {
  return (
    <div className="flex flex-col gap-6 md:gap-[53px] bg-[#F4F4F4]">
      <div className="flex flex-col md:flex-row items-center md:items-start px-4 md:px-[50px] pt-4 md:pt-[30px] gap-6 md:gap-0">
        {/* b√™n tr√°i */}
        <div className="flex flex-col gap-[15px] flex-1 items-center md:items-start text-center md:text-left">
          <h3 className="font-semibold">V·ªÅ Wukudada.</h3>
          <Link to="information" className="text-[14px] font-light">
            Th√¥ng tin
          </Link>
          <Link to="policy" className="text-[14px] font-light">
            Ch√≠nh s√°ch
          </Link>
        </div>
        {/* ·ªü gi·ªØa */}
        <div className="flex flex-col gap-[15px] flex-1 items-center md:items-start text-center md:text-left">
          <h3 className="font-semibold">Li√™n h·ªá Wukudada.</h3>
          <div className="pr-0 md:pr-[50px]">
            <p className="text-[14px] font-light">
              Hotline:{" "}
              <a href="tel:+84567890111" className="font-normal">
                +84 567890111
              </a>
            </p>
            <p className="text-[14px] font-light">
              Email:{" "}
              <a href="mailto:wukudada@gmail.com" className="font-normal">
                wukudada@gmail.com
              </a>
            </p>
          </div>
          <p className="text-[14px] font-light">
            <span className="font-medium">ƒê·ªãa ch·ªâ:</span> 123 ƒê∆∞·ªùng ABC, TP. HCM
          </p>
        </div>
        {/* b√™n ph·∫£i */}
        <div className="flex flex-col gap-[15px] flex-1 items-center md:items-start text-center md:text-left">
          <h3 className="font-semibold">Theo d√µi Wukudada.</h3>
          <div className="flex items-center gap-[15px] justify-center md:justify-start">
            <a
              href="https://www.facebook.com/"
              target="_blank"
              rel="noopener noreferrer"
            >
              <FaFacebookSquare className="h-[30px] w-[30px] text-[#757575]" />
            </a>
            <a
              href="https://www.instagram.com/"
              target="_blank"
              rel="noopener noreferrer"
            >
              <FaInstagramSquare className="h-[30px] w-[30px] text-[#757575]" />
            </a>
            <a
              href="https://www.youtube.com/"
              target="_blank"
              rel="noopener noreferrer"
            >
              <FaYoutube className="h-[30px] w-[30px] text-[#757575]" />
            </a>
          </div>
        </div>
        <div className="hidden md:block">
          <Newsletter />
        </div>
      </div>
      <div className="flex items-center justify-center border-t-[1px] border-t-[#DCDCDC] py-[10px]">
        <p className="text-[14px] font-semibold text-center">
          B·∫£n quy·ªÅn thu·ªôc C√¥ng ty TNHH Wukudada. B·∫£o l∆∞u m·ªçi quy·ªÅn.
        </p>
      </div>
    </div>
  );
};

export default Footer;


===== FILE: ./frontend/src/components/Common/Header.jsx =====
import React from "react";
import Navbar from "./Navbar";

const Header = () => {
  return (
    <header className="fixed top-0 left-0 w-full z-10 bg-white border-b border-b-[#DCDCDC]">
      {/* navbar */}
      <Navbar />
    </header>
  );
};

export default Header;


===== FILE: ./frontend/src/components/Common/MenuSide.jsx =====
import React, { useState, useEffect } from "react";
import { Link } from "react-router-dom";
import { GrClose, GrMenu } from "react-icons/gr";
import axios from "axios";

const API_URL = import.meta.env.VITE_API_URL || "http://localhost:9000";

const MenuSide = () => {
  const [isMenuOpen, setIsMenuOpen] = useState(false);
  const [isSubMenuOpen, setIsSubMenuOpen] = useState(false);
  const [isWomanSubMenuOpen, setIsWomanSubMenuOpen] = useState(false);
  const [manCategories, setManCategories] = useState([]);
  const [womanCategories, setWomanCategories] = useState([]);

  useEffect(() => {
    const fetchCategories = async () => {
      try {
        // L·∫•y danh s√°ch s·∫£n ph·∫©m nam
        const manResponse = await axios.get(`${API_URL}/api/products`, {
          params: { gender: "man" },
        });
        // L·∫•y danh s√°ch s·∫£n ph·∫©m n·ªØ
        const womanResponse = await axios.get(`${API_URL}/api/products`, {
          params: { gender: "woman" },
        });

        // L·ªçc v√† lo·∫°i b·ªè c√°c danh m·ª•c tr√πng l·∫∑p
        const manCategories = [
          ...new Set(manResponse.data.products.map((p) => p.category)),
        ];
        const womanCategories = [
          ...new Set(womanResponse.data.products.map((p) => p.category)),
        ];

        setManCategories(manCategories);
        setWomanCategories(womanCategories);
      } catch (err) {
        console.error("Error fetching categories:", err);
      }
    };

    fetchCategories();
  }, []);

  const toggleMenu = () => {
    setIsMenuOpen(!isMenuOpen);
    setIsSubMenuOpen(false);
    setIsWomanSubMenuOpen(false);
  };

  const toggleSubMenu = () => {
    setIsSubMenuOpen(!isSubMenuOpen);
  };

  const toggleWomanSubMenu = () => {
    setIsWomanSubMenuOpen(!isWomanSubMenuOpen);
  };

  const closeMenu = () => {
    setIsMenuOpen(false);
    setIsSubMenuOpen(false);
    setIsWomanSubMenuOpen(false);
  };

  useEffect(() => {
    if (isMenuOpen) {
      document.body.classList.add("overflow-hidden");
    } else {
      document.body.classList.remove("overflow-hidden");
    }

    return () => {
      document.body.classList.remove("overflow-hidden");
    };
  }, [isMenuOpen]);

  return (
    <>
      <div className="relative z-50">
        <button
          onClick={toggleMenu}
          className="flex items-center gap-2.5 cursor-pointer"
          aria-label={isMenuOpen ? "ƒê√≥ng menu" : "M·ªü menu"}
        >
          {isMenuOpen ? (
            <GrClose className="text-[20px]" />
          ) : (
            <GrMenu className="text-[20px]" />
          )}
          <div className="overflow-hidden h-[20px] relative">
            <div
              className={`flex flex-col transition-transform duration-300 ease-in-out ${
                isMenuOpen ? "-translate-y-[20px]" : "translate-y-0"
              }`}
            >
              <span className="text-[14px] font-normal h-[20px] hidden md:flex items-center justify-center">
                Menu
              </span>
              <span className="text-[14px] font-normal h-[20px] hidden md:flex items-center justify-center">
                ƒê√≥ng
              </span>
            </div>
          </div>
        </button>
      </div>
      {/* N·ªÅn t·ªëi */}
      <div
        className={`fixed inset-0 w-screen h-full bg-black/75 z-30 transition-[opacity,visibility] duration-200 ease-in-out ${
          isMenuOpen
            ? "opacity-100 visible"
            : "opacity-0 invisible pointer-events-none"
        }`}
        onClick={closeMenu}
      />
      {/* Menu ch√≠nh */}
      <div
        className={`fixed top-0 left-0 w-[300px] h-full bg-white shadow-lg z-40 transition-all duration-300 ease-in-out transform overflow-y-auto ${
          isMenuOpen ? "translate-x-0" : "-translate-x-full"
        }`}
      >
        <div className="flex flex-col gap-4 mt-[88px]">
          {/* ƒê·ªì Nam v·ªõi submenu */}
          <div className="relative">
            <div className="flex items-center justify-between pl-[50px] pr-[20px]">
              <Link
                to="gendercollections/man"
                className="text-[20px] font-normal hover:underline underline-offset-4"
                onClick={closeMenu}
              >
                ƒê·ªì Nam
              </Link>
              <button
                onClick={toggleSubMenu}
                className="text-[16px] font-normal hover:text-gray-600 transition-transform duration-200"
                style={{
                  transform: isSubMenuOpen ? "rotate(180deg)" : "rotate(0deg)",
                }}
              >
                ‚ñº
              </button>
            </div>
            {/* Submenu danh m·ª•c */}
            <div
              className={`overflow-hidden transition-all duration-300 ease-in-out ${
                isSubMenuOpen ? "opacity-100" : "max-h-0 opacity-0"
              }`}
            >
              <div className="flex flex-col gap-2 mt-2 pl-[70px] pr-[20px]">
                {manCategories.map((category, index) => (
                  <Link
                    key={index}
                    to={`gendercollections/man?category=${encodeURIComponent(
                      category
                    )}`}
                    className="text-[16px] font-normal text-gray-600 hover:text-black hover:underline underline-offset-2 py-1"
                    onClick={closeMenu}
                  >
                    {category}
                  </Link>
                ))}
              </div>
            </div>
          </div>

          {/* ƒê·ªì N·ªØ v·ªõi submenu */}
          <div className="relative">
            <div className="flex items-center justify-between pl-[50px] pr-[20px]">
              <Link
                to="gendercollections/women"
                className="text-[20px] font-normal hover:underline underline-offset-4"
                onClick={closeMenu}
              >
                ƒê·ªì N·ªØ
              </Link>
              <button
                onClick={toggleWomanSubMenu}
                className="text-[16px] font-normal hover:text-gray-600 transition-transform duration-200"
                style={{
                  transform: isWomanSubMenuOpen
                    ? "rotate(180deg)"
                    : "rotate(0deg)",
                }}
              >
                ‚ñº
              </button>
            </div>

            {/* Submenu danh m·ª•c */}
            <div
              className={`overflow-hidden transition-all duration-300 ease-in-out ${
                isWomanSubMenuOpen ? "opacity-100" : "max-h-0 opacity-0"
              }`}
            >
              <div className="flex flex-col gap-2 mt-2 pl-[70px] pr-[20px]">
                {womanCategories.map((category, index) => (
                  <Link
                    key={index}
                    to={`gendercollections/women?category=${encodeURIComponent(
                      category
                    )}`}
                    className="text-[16px] font-normal text-gray-600 hover:text-black hover:underline underline-offset-2 py-1"
                    onClick={closeMenu}
                  >
                    {category}
                  </Link>
                ))}
              </div>
            </div>
          </div>
        </div>
      </div>
    </>
  );
};

export default MenuSide;


===== FILE: ./frontend/src/components/Common/Navbar.jsx =====
import React, { useState, useRef, useEffect } from "react";
import { Link, useNavigate } from "react-router-dom";
import { IoMdHeartEmpty } from "react-icons/io";
import { PiShoppingCartSimple } from "react-icons/pi";
import { AiOutlineUser } from "react-icons/ai";
import { FiLogOut } from "react-icons/fi";
import { logoutUser } from "../../redux/slices/authSlice";
import { CgProfile } from "react-icons/cg";
import { RiAdminLine } from "react-icons/ri";
import { useSelector, useDispatch } from "react-redux";
import { logout } from "../../redux/slices/authSlice";
import { toast } from "sonner";

import MenuSide from "./MenuSide";
import SearchBar from "./SearchBar";
import { useCart } from "../Cart/CartContext";

const Navbar = () => {
  const { getTotalItems } = useCart();
  const { userInfo } = useSelector((state) => state.auth);
  const [showDropdown, setShowDropdown] = useState(false);
  const dropdownRef = useRef(null);
  const dispatch = useDispatch();
  const navigate = useNavigate();

  const { cart } = useSelector((state) => state.cart);
  const uniqueProductCount = cart?.products?.length || 0;

  // Ki·ªÉm tra quy·ªÅn admin
  const isAdmin = userInfo?.role === "admin";

  // ƒê√≥ng dropdown khi click outside
  useEffect(() => {
    const handleClickOutside = (event) => {
      if (dropdownRef.current && !dropdownRef.current.contains(event.target)) {
        setShowDropdown(false);
      }
    };

    document.addEventListener("mousedown", handleClickOutside);
    return () => {
      document.removeEventListener("mousedown", handleClickOutside);
    };
  }, []);

  // H√†m x·ª≠ l√Ω ƒëƒÉng xu·∫•t
  const handleLogout = async () => {
    try {
      // G·ªçi async logout
      await dispatch(logoutUser()).unwrap();
      
      toast.success("ƒêƒÉng xu·∫•t th√†nh c√¥ng!");
      navigate("/");
      setShowDropdown(false);
    } catch (error) {
      // D√π c√≥ l·ªói v·∫´n logout v√† hi·ªÉn th·ªã th√¥ng b√°o
      toast.success("ƒêƒÉng xu·∫•t th√†nh c√¥ng!");
      navigate("/");
      setShowDropdown(false);
    }
  };

  return (
    <>
      <nav className="relative flex items-center justify-between h-16 md:h-[88px] px-4 md:px-[50px]">
        {/* Menu + SearchBar lu√¥n n·∫±m c√πng 1 h√†ng ngang */}
        <div className="flex items-center gap-2 md:gap-[20px]">
          <MenuSide />
          <div className="flex items-center">
            <SearchBar hideTextOnMobile />
          </div>
        </div>

        {/* Logo */}
        <div className="absolute left-1/2 -translate-x-1/2">
          <button
            type="button"
            className="text-xl md:text-[30px] font-medium font-Jost focus:outline-none cursor-pointer"
            onClick={() => {
              if (window.location.pathname === "/") {
                window.scrollTo({ top: 0, behavior: "smooth" });
              } else {
                navigate("/");
              }
            }}
          >
            Wukudada.
          </button>
        </div>

        {/* t√†i kho·∫£n + gi·ªè h√†ng */}
        <div className="flex items-center gap-2 md:gap-[20px]">
          {/* Admin button - ch·ªâ hi·ªÉn th·ªã cho admin tr√™n desktop */}
          {isAdmin && (
            <Link
              to="/admin"
              className="flex items-center gap-1 bg-black text-white text-sm px-4 py-2 rounded hover:bg-gray-800 transition-colors"
            >
              <RiAdminLine className="text-[16px]" />
              <span className="hidden md:inline">Admin</span>
            </Link>
          )}
          {userInfo ? (
            // N·∫øu ƒë√£ ƒëƒÉng nh·∫≠p, hi·ªÉn th·ªã avatar v·ªõi dropdown
            <div className="relative" ref={dropdownRef}>
              <div
                className="flex items-center gap-[10px] cursor-pointer"
                onClick={() => setShowDropdown(!showDropdown)}
              >
                {userInfo.profileImage ? (
                  <img
                    src={userInfo.profileImage}
                    alt={userInfo.name}
                    className="w-[24px] h-[24px] md:w-[30px] md:h-[30px] rounded-full object-cover"
                  />
                ) : (
                  <AiOutlineUser className="text-[18px] md:text-[20px]" />
                )}
                <span className="hidden md:inline text-sm truncate max-w-[120px]">
                  {userInfo.name || "T√†i kho·∫£n"}
                </span>
              </div>
              {/* Dropdown Menu */}
              {showDropdown && (
                <div className="absolute z-10 right-0 mt-2 w-48 bg-white border border-gray-200 rounded-md shadow-lg py-1 animate-fadeIn">
                  <Link
                    to="/profile"
                    className="flex items-center px-4 py-2 text-sm text-gray-700 hover:bg-gray-100"
                    onClick={() => setShowDropdown(false)}
                  >
                    <CgProfile className="mr-2" /> H·ªì s∆° c·ªßa t√¥i
                  </Link>
                  <Link
                    to="/profile/orders"
                    className="flex items-center px-4 py-2 text-sm text-gray-700 hover:bg-gray-100"
                    onClick={() => setShowDropdown(false)}
                  >
                    <svg
                      className="w-4 h-4 mr-2"
                      fill="none"
                      stroke="currentColor"
                      viewBox="0 0 24 24"
                      xmlns="http://www.w3.org/2000/svg"
                    >
                      <path
                        strokeLinecap="round"
                        strokeLinejoin="round"
                        strokeWidth={2}
                        d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z"
                      />
                    </svg>
                    ƒê∆°n h√†ng c·ªßa t√¥i
                  </Link>
                  {/* Admin menu item */}
                  {isAdmin && (
                    <Link
                      to="/admin"
                      className="flex items-center px-4 py-2 text-sm text-gray-700 hover:bg-gray-100"
                      onClick={() => setShowDropdown(false)}
                    >
                      <RiAdminLine className="mr-2" /> Qu·∫£n tr·ªã
                    </Link>
                  )}
                  <button
                    onClick={handleLogout}
                    className="w-full text-left flex items-center px-4 py-2 text-sm text-red-600 hover:bg-gray-100"
                  >
                    <FiLogOut className="mr-2" /> ƒêƒÉng xu·∫•t
                  </button>
                </div>
              )}
            </div>
          ) : (
            // N·∫øu ch∆∞a ƒëƒÉng nh·∫≠p, hi·ªÉn th·ªã link ƒë·∫øn trang ƒëƒÉng nh·∫≠p
            <Link to="/login" className="flex items-center gap-[10px]">
              <AiOutlineUser className="text-[20px]" />
              <span className="hidden md:inline text-sm">T√†i kho·∫£n</span>
            </Link>
          )}
          <Link to="/cart" className="flex items-center gap-[10px] relative">
            {/* Icon gi·ªè h√†ng */}
            <div className="relative">
              <PiShoppingCartSimple className="text-[20px] md:text-[24px]" />
              {uniqueProductCount > 0 && (
                <span className="absolute -top-2 -right-2 w-4 h-4 md:w-5 md:h-5 bg-red-500 text-white text-[10px] md:text-xs rounded-full flex items-center justify-center">
                  {uniqueProductCount}
                </span>
              )}
            </div>
            <span className="hidden md:inline text-sm">Gi·ªè h√†ng</span>
          </Link>
        </div>
      </nav>
    </>
  );
};

export default Navbar;


===== FILE: ./frontend/src/components/Common/Newsletter.jsx =====
import React, { useState } from "react";
import { toast } from "sonner";

const Newsletter = () => {
  const [email, setEmail] = useState("");
  const [errors, setErrors] = useState({});

  const validateForm = () => {
    if (!email) {
      setErrors({ email: "Vui l√≤ng nh·∫≠p email" });
      return false;
    } else if (!/\S+@\S+\.\S+/.test(email)) {
      setErrors({ email: "Email kh√¥ng h·ª£p l·ªá" });
      return false;
    }
    return true;
  };

  const handleSubmit = (e) => {
    e.preventDefault();
    if (validateForm()) {
      toast.success("C·∫£m ∆°n b·∫°n ƒë√£ ƒëƒÉng k√Ω!");
      setEmail("");
    }
  };

  return (
    <div className="flex flex-col gap-[15px] flex-1">
      <h3 className="font-semibold">ƒêƒÉng K√Ω Nh·∫≠n Tin</h3>
      <form onSubmit={handleSubmit} className="max-w-md">
        <div className="flex gap-4">
          <input
            type="email"
            value={email}
            onChange={(e) => setEmail(e.target.value)}
            placeholder="Nh·∫≠p email c·ªßa b·∫°n"
            className="flex-1 px-2 py-2 text-[14px] border border-gray-300 focus:outline-none focus:ring-1 focus:ring-gray-500"
          />
          <button
            type="submit"
            className="px-6 py-2 text-[14px] bg-black text-white hover:bg-gray-800 transition duration-300"
          >
            ƒêƒÉng K√Ω
          </button>
        </div>
        {errors.email && (
          <span className="text-red-500 text-sm mt-1">{errors.email}</span>
        )}
      </form>
    </div>
  );
};

export default Newsletter;


===== FILE: ./frontend/src/components/Common/PaymentStatus.jsx =====


===== FILE: ./frontend/src/components/Common/ScrollToTop.jsx =====
import { useEffect } from "react";
import { useLocation } from "react-router-dom";

const ScrollToTop = () => {
  const { pathname } = useLocation();

  useEffect(() => {
    window.scrollTo(0, 0);
  }, [pathname]);

  return null;
};

export default ScrollToTop;


===== FILE: ./frontend/src/components/Common/SearchBar.jsx =====
import React, { useState, useEffect } from "react";
import { GrSearch, GrClose } from "react-icons/gr";
import { useNavigate } from "react-router-dom";
import ProductGrid from "../Products/ProductGrid";
import axios from "axios";

const SearchBar = ({ hideTextOnMobile }) => {
  const [searchTerm, setSearchTerm] = useState("");
  const [isOpen, setIsOpen] = useState(false);
  const [searchResults, setSearchResults] = useState([]);
  const [loading, setLoading] = useState(false);
  const [suggestions, setSuggestions] = useState([]);
  const [showSuggestions, setShowSuggestions] = useState(false);
  const navigate = useNavigate();

  const API_URL = import.meta.env.VITE_BACKEND_URL || "http://localhost:9000";

  const toggleSearch = () => setIsOpen((prev) => !prev);
  const clearSearch = () => {
    setSearchTerm("");
    setSearchResults([]);
  };

  // Debounce search
  useEffect(() => {
    const timer = setTimeout(async () => {
      if (searchTerm.trim()) {
        try {
          setLoading(true);
          // G·ªçi API t√¨m ki·∫øm s·∫£n ph·∫©m
          const response = await axios.get(`${API_URL}/api/products`, {
            params: {
              search: searchTerm,
              limit: 12,
            },
          });
          setSearchResults(response.data.products || []);
        } catch (error) {
          console.error("Error searching products:", error);
          setSearchResults([]);
        } finally {
          setLoading(false);
        }
      } else {
        setSearchResults([]);
      }
    }, 300);
    return () => clearTimeout(timer);
  }, [searchTerm, API_URL]);

  // Debounce suggest
  useEffect(() => {
    if (!searchTerm.trim()) {
      setSuggestions([]);
      setShowSuggestions(false);
      return;
    }
    const timer = setTimeout(async () => {
      try {
        const res = await axios.get(`${API_URL}/api/products/suggest`, {
          params: { query: searchTerm },
        });
        setSuggestions(res.data || []);
        setShowSuggestions(true);
      } catch {
        setSuggestions([]);
        setShowSuggestions(false);
      }
    }, 250);
    return () => clearTimeout(timer);
  }, [searchTerm, API_URL]);

  // Disable body scroll when search is open
  useEffect(() => {
    if (isOpen) {
      document.body.classList.add("overflow-hidden");
    } else {
      document.body.classList.remove("overflow-hidden");
    }
    return () => {
      document.body.classList.remove("overflow-hidden");
    };
  }, [isOpen]);

  return (
    <>
      {!isOpen && (
        <button
          onClick={toggleSearch}
          className="flex items-center gap-2.5 cursor-pointer z-10 relative"
          aria-label="M·ªü t√¨m ki·∫øm"
        >
          <GrSearch className="text-[20px]" />
          <span
            className={
              hideTextOnMobile ? "hidden md:inline text-sm" : "text-sm"
            }
          >
            T√¨m ki·∫øm
          </span>
        </button>
      )}

      <div
        className={`fixed top-0 left-0 w-full h-screen bg-white z-50 transition-transform duration-200 ease-in-out ${
          isOpen ? "translate-y-0" : "-translate-y-full"
        }`}
      >
        <div className="flex flex-col w-full h-full overflow-y-auto">
          {/* Header t√¨m ki·∫øm */}
          <div className="w-full bg-white sticky top-0 z-20">
            <div className="flex items-center justify-between gap-4 flex-wrap px-4 md:px-0">
              {/* Input t√¨m ki·∫øm */}
              <div className="relative flex-1 min-w-[250px] max-w-[600px] mt-6 md:mt-10 mx-auto">
                <input
                  type="text"
                  placeholder="T√¨m s·∫£n ph·∫©m"
                  value={searchTerm}
                  onChange={(e) => setSearchTerm(e.target.value)}
                  className="bg-gray-100 h-10 px-4 py-2 pl-7 pr-20 rounded-full w-full placeholder:text-gray-700 focus:outline-none text-sm md:text-base"
                  onFocus={() => setShowSuggestions(true)}
                  autoComplete="off"
                />
                {searchTerm && (
                  <button
                    type="button"
                    onClick={clearSearch}
                    className="absolute right-2 top-1/2 transform -translate-y-1/2 h-8 p-2 rounded-full bg-gray-100 text-gray-500 text-xs md:text-sm font-medium cursor-pointer hover:bg-gray-200 transition-colors"
                  >
                    X√≥a
                  </button>
                )}
                {/* G·ª£i √Ω t√¨m ki·∫øm */}
                {showSuggestions && suggestions.length > 0 && (
                  <ul className="absolute left-0 right-0 bg-white border rounded shadow z-50 mt-1 max-h-60 overflow-y-auto">
                    {suggestions.map((s, idx) => (
                      <li
                        key={idx}
                        className="px-4 py-2 cursor-pointer hover:bg-gray-100"
                        onClick={() => {
                          setSearchTerm(s);
                          setShowSuggestions(false);
                        }}
                      >
                        {s}
                      </li>
                    ))}
                  </ul>
                )}
              </div>

              {/* N√∫t ƒë√≥ng */}
              <button
                type="button"
                onClick={toggleSearch}
                className="absolute top-2 right-2 p-2 rounded-full hover:bg-gray-100 cursor-pointer"
                aria-label="ƒê√≥ng t√¨m ki·∫øm"
              >
                <GrClose className="text-[16px] text-gray-500" />
              </button>
            </div>

            {/* Loading indicator */}
            {loading && (
              <div className="flex justify-center my-4">
                <div className="animate-spin rounded-full h-6 w-6 md:h-8 md:w-8 border-b-2 border-gray-900"></div>
              </div>
            )}

            {/* Ti√™u ƒë·ªÅ k·∫øt qu·∫£ n·∫øu c√≥ */}
            {searchResults.length > 0 && !loading && (
              <h3 className="text-base md:text-lg font-normal my-2 px-4 md:mx-[50px]">
                K·∫øt qu·∫£ t√¨m ki·∫øm ({searchResults.length}):
              </h3>
            )}

            {/* No results message */}
            {searchTerm && !loading && searchResults.length === 0 && (
              <div className="text-center my-4 mx-[50px]">
                <p className="text-gray-500">
                  Kh√¥ng t√¨m th·∫•y s·∫£n ph·∫©m n√†o cho "{searchTerm}"
                </p>
              </div>
            )}
          </div>

          {/* Danh s√°ch k·∫øt qu·∫£ */}
          {searchResults.length > 0 && !loading && (
            <div className="w-full px-4 md:px-[50px] mb-10">
              <ProductGrid
                products={searchResults}
                onClick={(product) => {
                  setIsOpen(false);
                  navigate(`/products/${product._id}`);
                }}
              />
            </div>
          )}

          {/* Popular searches or suggestions when no search term */}
          {!searchTerm && !loading && (
            <div className="w-full px-4 md:px-[50px] mb-10">
              <h3 className="text-base md:text-lg font-normal my-2">
                G·ª£i √Ω t√¨m ki·∫øm:
              </h3>
              <div className="flex flex-wrap gap-2 mt-4">
                {["√Åo ph√¥ng", "Qu·∫ßn jean", "√Åo kho√°c", "V√°y", "Gi√†y"].map(
                  (suggestion) => (
                    <button
                      key={suggestion}
                      onClick={() => {
                        setSearchTerm(suggestion);
                      }}
                      className="px-4 py-2 bg-gray-100 rounded-full hover:bg-gray-200 transition-colors text-sm"
                    >
                      {suggestion}
                    </button>
                  )
                )}
              </div>
            </div>
          )}
        </div>
      </div>
    </>
  );
};

export default SearchBar;


===== FILE: ./frontend/src/components/Layout/Hero.jsx =====
import React from 'react'
import { Link } from 'react-router-dom'
import heroVideo from '../../assets/videos/Hero_Edit_pc.mp4'

const Hero = () => {
    return (
        <section className='relative'>
            <video src={heroVideo} autoPlay muted loop className='w-full h-[400px] md:h-[600px] lg:h-[800px] object-cover' />
            {/* <img src="https://images4.alphacoders.com/915/thumb-1920-915356.jpg" alt="zerotwo"
                className='w-full h-[400px] md:h-[600px] lg:h-[750px] object-cover' /> */}
            <div className='absolute inset-0 bg-black/25 flex items-center justify-center'>
                <div className='text-center text-white p-6'>
                    <h1 className='text-4xl md:text-9xl font-bold tracking-tighter mb-20'>Wukudada.</h1>
                    <p className='text-sm md:text-lg mb-6'>B·ªô s∆∞u t·∫≠p Wukudada</p>
                    <Link to="#" className='bg-white text-black px-6 py-3 rounded-sm text-sm md:text-lg font-semibold hover:bg-gray-200 transition duration-300'>
                        Kh√°m Ph√° Ngay
                    </Link>
                </div>
            </div>
        </section>
    )
}

export default Hero

===== FILE: ./frontend/src/components/Layout/UserLayout.jsx =====
import React from 'react'
import Header from '../Common/Header'
import Footer from '../Common/Footer'
import { Outlet } from 'react-router-dom'
import ScrollToTop from '../Common/ScrollToTop'

const UserLayout = () => {
    return (
        <div className="min-h-screen flex flex-col">
            <ScrollToTop />
            {/* Header */}
            <Header />

            {/* Main Content */}
            <main className="flex-grow pt-[88px]">
                <Outlet />
            </main>

            {/* Footer */}
            <Footer />
        </div>
    )
}

export default UserLayout

===== FILE: ./frontend/src/components/Products/FeaturedCollection.jsx =====
import React from "react";
import { Link } from "react-router-dom";

const FeaturedCollection = ({ collections }) => {
  return (
    <div className="flex flex-col items-center">
      <div className="w-full grid grid-cols-1 gap-8">
        {collections.map((col) => {
          const featured = col.products.filter((p) => p.isFeatured);
          // if (featured.length === 0) return null;
          return (
            <div key={col.id} className="featured-collection overflow-hidden">
              <Link to={`/collections/${col.id}`}>
                <div className="relative">
                  <img
                    src={col.bannerUrl}
                    alt={col.name}
                    className="w-full h-48 sm:h-72 md:h-[400px] lg:h-[600px] xl:h-[750px] object-cover"
                  />
                  <div className="absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/70 to-transparent p-4 sm:p-6">
                    <h2 className="text-lg sm:text-2xl font-bold text-white">
                      {col.name}
                    </h2>
                  </div>
                </div>
              </Link>
              <div className="px-2 sm:px-8 md:px-20 lg:px-[150px] pt-5">
                <div className="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-3 sm:gap-4 ">
                  {featured.map((p) => (
                    <Link
                      key={p._id}
                      to={`/product/${p._id}`}
                      className="group cursor-pointer"
                    >
                      <div className="flex flex-col justify-between w-full aspect-[3/4]">
                        {/* ·∫£nh */}
                        <div className="h-[80%] overflow-hidden">
                          <img
                            src={p.images[0].url}
                            alt={p.images[0].altText || p.name}
                            className="w-full h-full object-cover"
                          />
                        </div>
                        {/* m√¥ t·∫£ */}
                        <div className="flex flex-col gap-1 p-4">
                          <h3 className="text-sm group-hover:underline transition-colors duration-300">
                            {p.name}
                          </h3>
                          <p className="text-black font-medium text-lg">
                            {p.discountPrice
                              ? p.discountPrice.toLocaleString("vi-VN", {
                                style: "currency",
                                currency: "VND",
                              })
                              : p.price.toLocaleString("vi-VN", {
                                style: "currency",
                                currency: "VND",
                              })}
                          </p>
                        </div>
                      </div>
                    </Link>
                  ))}
                </div>
              </div>
            </div>
          );
        })}
      </div>
    </div>
  );
};

export default FeaturedCollection;


===== FILE: ./frontend/src/components/Products/FilterSidebar.jsx =====
import React, { useState, useEffect } from "react";
import { useSearchParams } from "react-router-dom";
import axios from "axios";

const API_URL = import.meta.env.VITE_API_URL || "http://localhost:9000";

const FilterSidebar = () => {
  const [searchParams, setSearchParams] = useSearchParams();
  const [filters, setFilters] = useState({
    color: [],
    size: [],
    price: [],
    material: [],
    category: [],
  });
  const [colorOptions, setColorOptions] = useState([]);
  const [materialOptions, setMaterialOptions] = useState([]);
  const [categoryOptions, setCategoryOptions] = useState([]);

  const size = ["S", "M", "L", "XL", "XXL"];

  const price = [
    { name: "D∆∞·ªõi 500.000ƒë", value: "under-500" },
    { name: "500.000ƒë - 1.000.000ƒë", value: "500-1000" },
    { name: "1.000.000ƒë - 1.500.000ƒë", value: "1000-1500" },
    { name: "Tr√™n 1.500.000ƒë", value: "above-1500" },
  ];

  useEffect(() => {
    const fetchOptions = async () => {
      try {
        const res = await axios.get(`${API_URL}/api/products`);
        const products = res.data.products || [];

        const uniqueColors = new Map();
        const materialSet = new Set();
        const categorySet = new Set();

        products.forEach((product) => {
          (product.colors || []).forEach((color) => {
            if (color.name && color.code) {
              uniqueColors.set(color.code, {
                name: color.name,
                code: color.code
              });
            }
          });
          if (product.material) materialSet.add(product.material);
          if (product.category) categorySet.add(product.category);
        });

        setColorOptions(Array.from(uniqueColors.values()));
        setMaterialOptions(Array.from(materialSet));
        setCategoryOptions(Array.from(categorySet));
      } catch (err) {
        console.error("Error fetching filter options:", err);
        setColorOptions([]);
        setMaterialOptions([]);
        setCategoryOptions([]);
      }
    };
    fetchOptions();
  }, []);

  useEffect(() => {
    const params = Object.fromEntries(searchParams);

    let colors = [];
    if (params.color) {
      const colorCodes = params.color.split(",");
      colors = colorCodes
        .map(code => {
          // Chu·∫©n h√≥a m√£ m√†u
          const normalizedCode = code.startsWith("#") ? code.toUpperCase() : `#${code.toUpperCase()}`;
          const foundColor = colorOptions.find(c => c.code.toUpperCase() === normalizedCode);
          return foundColor ? { name: foundColor.name, code: foundColor.code } : null;
        })
        .filter(Boolean);
    }

    setFilters({
      color: colors,
      size: params.size ? params.size.split(",") : [],
      price: params.price ? [params.price] : [],
      material: params.material ? params.material.split(",") : [],
      category: params.category ? params.category.split(",") : [],
    });
  }, [searchParams, colorOptions]);

  const handleFilterChange = (type, value) => {
    const newFilters = { ...filters };

    if (type === "price") {
      newFilters.price = [value];
    } else if (type === "color") {
      const existingColor = newFilters.color.find(c => c.code.toUpperCase() === value.code.toUpperCase());
      if (existingColor) {
        newFilters.color = newFilters.color.filter(c => c.code.toUpperCase() !== value.code.toUpperCase());
      } else {
        newFilters.color = [...newFilters.color, value];
      }
    } else {
      if (newFilters[type].includes(value)) {
        newFilters[type] = newFilters[type].filter((v) => v !== value);
      } else {
        newFilters[type] = [...newFilters[type], value];
      }
    }

    setFilters(newFilters);

    // C·∫≠p nh·∫≠t URL params
    const newParams = { ...Object.fromEntries(searchParams) };

    // Update filter params
    Object.entries(newFilters).forEach(([key, values]) => {
      if (values && values.length > 0) {
        if (key === "color") {
          // G·ª≠i m√£ m√†u kh√¥ng c√≥ d·∫•u # v√† in hoa
          newParams[key] = values.map(c => c.code.replace("#", "").toUpperCase()).join(",");
        } else if (key === "price" && values.length === 1) {
          newParams[key] = values[0];
        } else {
          newParams[key] = values.join(",");
        }
      } else {
        delete newParams[key];
      }
    });

    setSearchParams(newParams);
  };

  const clearFilters = () => {
    setFilters({
      color: [],
      size: [],
      price: [],
      material: [],
      category: [],
    });

    // Preserve non-filter params
    const newParams = { ...Object.fromEntries(searchParams) };
    Object.keys(filters).forEach(key => {
      delete newParams[key];
    });
    setSearchParams(newParams);
  };

  return (
    <div className="p-4">
      <div className="flex justify-between items-center mb-6">
        <h3 className="text-xl font-medium">B·ªô l·ªçc</h3>
        {Object.values(filters).some((arr) => arr.length > 0) && (
          <button
            onClick={clearFilters}
            className="text-sm text-gray-500 hover:text-gray-700"
          >
            X√≥a t·∫•t c·∫£
          </button>
        )}
      </div>

      <div className="mb-6">
        <label className="block font-medium text-gray-700 mb-3">M√†u s·∫Øc</label>
        <div className="flex flex-wrap gap-2">
          {colorOptions.map((color) => (
            <button
              key={color.code}
              onClick={() => handleFilterChange("color", color)}
              className={`w-8 h-8 rounded-full border-2 cursor-pointer ${filters.color.some(c => c.code === color.code)
                ? "border-black"
                : "border-gray-300"
                }`}
              style={{ backgroundColor: color.code }}
              title={color.name}
            >
              {/* {filters.color.some(c => c.code === color.code) && (
                <span className="absolute -top-1 -right-1 w-3 h-3 bg-black rounded-full border-2 border-white" />
              )} */}
            </button>
          ))}
        </div>
      </div>

      {/* K√≠ch th∆∞·ªõc */}
      <div className="mb-6">
        <label className="block font-medium text-gray-700 mb-3">
          K√≠ch th∆∞·ªõc
        </label>
        <div className="flex flex-wrap gap-2">
          {size.map((s) => (
            <button
              key={s}
              onClick={() => handleFilterChange("size", s)}
              className={`w-10 h-10 flex items-center justify-center border ${filters.size.includes(s)
                ? "border-black"
                : "border-gray-300 hover:border-black"
                }`}
            >
              {s}
            </button>
          ))}
        </div>
      </div>

      {/* Gi√° */}
      <div className="mb-6">
        <label className="block font-medium text-gray-700 mb-3">Gi√°</label>
        <div className="space-y-2">
          {price.map((p) => (
            <label
              key={p.value}
              className="flex items-center cursor-pointer group"
            >
              <input
                type="radio"
                name="price"
                className="w-4 h-4 rounded border-gray-300 accent-black text-black focus:ring-black"
                checked={filters.price[0] === p.value}
                onChange={() => handleFilterChange("price", p.value)}
              />
              <span className="ml-2 text-gray-600 group-hover:text-gray-900">
                {p.name}
              </span>
            </label>
          ))}
        </div>
      </div>

      {/* Ch·∫•t li·ªáu */}
      <div className="mb-6">
        <label className="block font-medium text-gray-700 mb-3">
          Ch·∫•t li·ªáu
        </label>
        <div className="space-y-2">
          {materialOptions.map((m, idx) => (
            <label
              key={m + "-" + idx}
              className="flex items-center cursor-pointer group"
            >
              <input
                type="checkbox"
                className="w-4 h-4 rounded border-gray-300 accent-black text-black focus:ring-black"
                checked={filters.material.includes(m)}
                onChange={() => handleFilterChange("material", m)}
              />
              <span className="ml-2 text-gray-600 group-hover:text-gray-900">
                {m}
              </span>
            </label>
          ))}
        </div>
      </div>

      {/* Danh m·ª•c */}
      <div className="mb-6">
        <label className="block font-medium text-gray-700 mb-3">Danh m·ª•c</label>
        <div className="space-y-2">
          {categoryOptions.map((cat, idx) => (
            <label
              key={cat + "-" + idx}
              className="flex items-center cursor-pointer group"
            >
              <input
                type="checkbox"
                className="w-4 h-4 rounded border-gray-300 accent-black text-black focus:ring-black"
                checked={filters.category.includes(cat)}
                onChange={() => handleFilterChange("category", cat)}
              />
              <span className="ml-2 text-gray-600 group-hover:text-gray-900">
                {cat}
              </span>
            </label>
          ))}
        </div>
      </div>

      {/* Active Filters Summary */}
      {Object.values(filters).some((arr) => arr.length > 0) && (
        <div className="mt-8 pt-6 border-t">
          <h4 className="font-medium text-gray-700 mb-3">B·ªô l·ªçc ƒë√£ ch·ªçn</h4>
          <div className="flex flex-wrap gap-2">
            {/* M√†u s·∫Øc ƒë√£ ch·ªçn */}
            {filters.color.length > 0 && (
              <div className="flex flex-wrap gap-2">
                {filters.color.map((color) => (
                  <button
                    key={color.code}
                    onClick={() => handleFilterChange("color", color)}
                    className="px-2 py-1 rounded-full bg-gray-100 text-gray-800 text-sm flex items-center gap-1 hover:bg-gray-200"
                  >
                    <span
                      className="w-3 h-3 rounded-full"
                      style={{ backgroundColor: color.code }}
                    />
                    <span>{color.name}</span>
                    <svg
                      xmlns="http://www.w3.org/2000/svg"
                      viewBox="0 0 20 20"
                      fill="currentColor"
                      className="w-4 h-4"
                    >
                      <path d="M6.28 5.22a.75.75 0 00-1.06 1.06L8.94 10l-3.72 3.72a.75.75 0 101.06 1.06L10 11.06l3.72 3.72a.75.75 0 101.06-1.06L11.06 10l3.72-3.72a.75.75 0 00-1.06-1.06L10 8.94 6.28 5.22z" />
                    </svg>
                  </button>
                ))}
              </div>
            )}

            {/* K√≠ch th∆∞·ªõc ƒë√£ ch·ªçn */}
            {filters.size.length > 0 && (
              <div className="flex flex-wrap gap-2">
                {filters.size.map((s) => (
                  <button
                    key={s}
                    onClick={() => handleFilterChange("size", s)}
                    className="px-2 py-1 rounded-full bg-gray-100 text-gray-800 text-sm flex items-center gap-1 hover:bg-gray-200"
                  >
                    <span>{s}</span>
                    <svg
                      xmlns="http://www.w3.org/2000/svg"
                      viewBox="0 0 20 20"
                      fill="currentColor"
                      className="w-4 h-4"
                    >
                      <path d="M6.28 5.22a.75.75 0 00-1.06 1.06L8.94 10l-3.72 3.72a.75.75 0 101.06 1.06L10 11.06l3.72 3.72a.75.75 0 101.06-1.06L11.06 10l3.72-3.72a.75.75 0 00-1.06-1.06L10 8.94 6.28 5.22z" />
                    </svg>
                  </button>
                ))}
              </div>
            )}

            {/* Gi√° ƒë√£ ch·ªçn */}
            {filters.price.length > 0 && (
              <div className="flex flex-wrap gap-2">
                {filters.price.map((p) => (
                  <button
                    key={p}
                    onClick={() => handleFilterChange("price", p)}
                    className="px-2 py-1 rounded-full bg-gray-100 text-gray-800 text-sm flex items-center gap-1 hover:bg-gray-200"
                  >
                    <span>{price.find(item => item.value === p)?.name || p}</span>
                    <svg
                      xmlns="http://www.w3.org/2000/svg"
                      viewBox="0 0 20 20"
                      fill="currentColor"
                      className="w-4 h-4"
                    >
                      <path d="M6.28 5.22a.75.75 0 00-1.06 1.06L8.94 10l-3.72 3.72a.75.75 0 101.06 1.06L10 11.06l3.72 3.72a.75.75 0 101.06-1.06L11.06 10l3.72-3.72a.75.75 0 00-1.06-1.06L10 8.94 6.28 5.22z" />
                    </svg>
                  </button>
                ))}
              </div>
            )}

            {/* Ch·∫•t li·ªáu ƒë√£ ch·ªçn */}
            {filters.material.length > 0 && (
              <div className="flex flex-wrap gap-2">
                {filters.material.map((m) => (
                  <button
                    key={m}
                    onClick={() => handleFilterChange("material", m)}
                    className="px-2 py-1 rounded-full bg-gray-100 text-gray-800 text-sm flex items-center gap-1 hover:bg-gray-200"
                  >
                    <span>{m}</span>
                    <svg
                      xmlns="http://www.w3.org/2000/svg"
                      viewBox="0 0 20 20"
                      fill="currentColor"
                      className="w-4 h-4"
                    >
                      <path d="M6.28 5.22a.75.75 0 00-1.06 1.06L8.94 10l-3.72 3.72a.75.75 0 101.06 1.06L10 11.06l3.72 3.72a.75.75 0 101.06-1.06L11.06 10l3.72-3.72a.75.75 0 00-1.06-1.06L10 8.94 6.28 5.22z" />
                    </svg>
                  </button>
                ))}
              </div>
            )}

            {/* Danh m·ª•c ƒë√£ ch·ªçn */}
            {filters.category.length > 0 && (
              <div className="flex flex-wrap gap-2">
                {filters.category.map((c) => (
                  <button
                    key={c}
                    onClick={() => handleFilterChange("category", c)}
                    className="px-2 py-1 rounded-full bg-gray-100 text-gray-800 text-sm flex items-center gap-1 hover:bg-gray-200"
                  >
                    <span>{c}</span>
                    <svg
                      xmlns="http://www.w3.org/2000/svg"
                      viewBox="0 0 20 20"
                      fill="currentColor"
                      className="w-4 h-4"
                    >
                      <path d="M6.28 5.22a.75.75 0 00-1.06 1.06L8.94 10l-3.72 3.72a.75.75 0 101.06 1.06L10 11.06l3.72 3.72a.75.75 0 101.06-1.06L11.06 10l3.72-3.72a.75.75 0 00-1.06-1.06L10 8.94 6.28 5.22z" />
                    </svg>
                  </button>
                ))}
              </div>
            )}
          </div>
        </div>
      )}
    </div>
  );
};

export default FilterSidebar;


===== FILE: ./frontend/src/components/Products/ProductDetails.jsx =====
// import products from '../../data/sample-products.json';


import React, { useState, useEffect } from "react";
import { useParams, useNavigate } from "react-router-dom";
import { toast } from "sonner";
import ProductGrid from "./ProductGrid";
// import { useCart } from "../Cart/CartContext";
import { addToCart } from "../../redux/slices/cartSlice";
import { useDispatch, useSelector } from "react-redux";
import { PiShoppingCartSimple, PiCoins } from "react-icons/pi";


import {
  fetchProductById,
  fetchSimilarProducts,
} from "../../redux/slices/productsSlice";
import { setBuyNowItem } from "../../redux/slices/checkoutSlice";

const ProductDetails = ({ productId }) => {
  const { id } = useParams();
  const productFetchId = productId || id;

  const dispatch = useDispatch();
  const navigate = useNavigate();

  // const { addToCart } = useCart();
  // ƒë√¢y ƒë·ªÉ test, khi ƒë√£ c√≥ backend th√¨ x√≥a d√≤ng n√†y
  // const selectedProduct = products.find(
  //   (p) => p._id.$oid === productFetchId
  // );
  // // L·∫•y c√°c s·∫£n ph·∫©m c√πng category, lo·∫°i tr√πng ch√≠nh n√≥
  // const similarProducts = products.filter(
  //   (p) => p.category === selectedProduct.category && p._id.$oid !== selectedProduct._id.$oid
  // );


  const { selectedProduct, similarProducts, loading, error } = useSelector(
    (state) => state.products
  );
  const { user, guestId } = useSelector((state) => state.auth);

  const [mainImage, setMainImage] = useState("");
  const [selectedSize, setSelectedSize] = useState("");
  const [selectedColor, setSelectedColor] = useState(null);
  const [quantity, setQuantity] = useState(1);
  const [isButtonDisabled, setIsButtonDisabled] = useState(false);
  const [newReviewRating, setNewReviewRating] = useState(0);
  const [newReviewComment, setNewReviewComment] = useState("");


  useEffect(() => {
    if (productFetchId) {
      dispatch(fetchProductById(productFetchId));
      dispatch(fetchSimilarProducts(productFetchId));
    }
  }, [dispatch, productFetchId]);

  const [expandedSections, setExpandedSections] = useState({
    details: false,
    material: false,
    care: false,
  });

  useEffect(() => {
    if (selectedProduct?.images?.length) {
      setMainImage(selectedProduct.images[0].url);
    }
  }, [selectedProduct]);

  if (loading) {
    return <div className="text-center p-10">ƒêang t·∫£i...</div>;
  }

  if (error) {
    return <div className="text-center text-red-500 p-10">{error}</div>;
  }

  if (!selectedProduct) {
    return (
      <div className="text-center text-xl p-10 text-red-500">
        Kh√¥ng t√¨m th·∫•y s·∫£n ph·∫©m v·ªõi id: {id}
      </div>
    );
  }

  const handleQuantityChange = (action) => {
    setQuantity((prev) =>
      action === "plus" ? prev + 1 : Math.max(1, prev - 1)
    );
  };

  // const handleAddToCart = () => {
  //   if (!selectedSize || !selectedColor) {
  //     toast.error("Vui l√≤ng ch·ªçn k√≠ch th∆∞·ªõc v√† m√†u s·∫Øc");
  //     return;
  //   }
  const handleAddToCart = () => {
    if (!selectedSize || !selectedColor) {
      toast.error("Vui l√≤ng ch·ªçn k√≠ch th∆∞·ªõc v√† m√†u s·∫Øc");
      return;
    }

    setIsButtonDisabled(true);

    dispatch(
      addToCart({
        productId: productFetchId,
        quantity,
        size: selectedSize,
        color: {
          name: selectedColor.name,
          code: selectedColor.code,
        },
        userId: user?._id,
        guestId,
      })
    )
      .unwrap()
      .then(() => {
        toast.success("ƒê√£ th√™m v√†o gi·ªè h√†ng", {
          duration: 1000,
        });
      })
      .catch((error) => {
        toast.error(error?.message || "C√≥ l·ªói x·∫£y ra khi th√™m v√†o gi·ªè h√†ng");
      })
      .finally(() => {
        setIsButtonDisabled(false);
      });
  };

  const handleBuyNow = async () => {
    if (!selectedSize || !selectedColor) {
      toast.error("Vui l√≤ng ch·ªçn k√≠ch th∆∞·ªõc v√† m√†u s·∫Øc");
      return;
    }

    const item = {
      productId: productFetchId,
      name: selectedProduct.name,
      image: selectedProduct.images?.[0]?.url || "",
      price: selectedProduct.discountPrice || selectedProduct.price,
      quantity,
      size: selectedSize,
      color: selectedColor,
    };

    dispatch(setBuyNowItem(item));
    navigate("/checkout-buy-now");
  };


  return (
    <div className="pt-6">
      {selectedProduct && (
        <div className="mx-[50px] bg-white">
          <div className="flex flex-col md:flex-row gap-8">
            {/* left thumbnail */}
            <div className="md:w-2/3 w-full flex flex-col gap-4">
              {/* Desktop: 2 columns, 3 rows grid for images */}
              <div className="hidden md:grid grid-cols-2 w-full">
                {selectedProduct.images.slice(0, 6).map((image, index) => (
                  <div
                    key={index}
                    className="relative w-full aspect-[3/4] bg-gray-100 overflow-hidden"
                  >
                    <img
                      src={image.url}
                      alt={image.altText || `thumbnail ${index + 1}`}
                      className="w-full h-full object-cover"
                    />
                  </div>
                ))}
              </div>
              {/* Mobile: horizontal scrollable thumbnails */}
              <div className="md:hidden flex overflow-x-auto snap-x snap-mandatory">
                {selectedProduct.images.map((image, index) => (
                  <div key={index} className="flex-none w-full snap-center">
                    <img
                      src={image.url}
                      alt={image.altText || `thumbnail ${index + 1}`}
                      className="w-full h-[400px] object-cover"
                    />
                  </div>
                ))}
              </div>
              {/* Product Description */}
              <div className="mt-8 pt-6">
                <div className="flex flex-col gap-2 border-b-2 border-gray-300 pb-4">
                  <h2 className="text-4xl font-normal">M√¥ t·∫£</h2>
                  <p className="text-gray-500 text-base">
                    {/* M√£ s·∫£n ph·∫©m: {selectedProduct._id|| "ƒêang c·∫≠p nh·∫≠t"} */}
                    M√£ s·∫£n ph·∫©m: {selectedProduct._id.$oid || "ƒêang c·∫≠p nh·∫≠t"}
                  </p>
                </div>

                {/* Details Section */}
                <div className="border-b border-gray-300">
                  <button
                    onClick={() =>
                      setExpandedSections((prev) => ({
                        ...prev,
                        details: !prev.details,
                      }))
                    }
                    className="w-full py-3 flex justify-between items-center text-left"
                  >
                    <span className="font-normal text-lg">Chi ti·∫øt</span>
                    <span className="text-xl">
                      {expandedSections.details ? "‚àí" : "+"}
                    </span>
                  </button>
                  <div
                    className={`overflow-hidden transition-all duration-300 ${expandedSections.details
                      ? "max-h-[500px] pb-4"
                      : "max-h-0"
                      }`}
                  >
                    <div className="space-y-2 text-gray-600">
                      <p className="text-base">{selectedProduct.description}</p>
                      {selectedProduct.details &&
                        selectedProduct.details.length > 0 && (
                          <ul className="list-disc pl-5 mt-2">
                            {selectedProduct.details.map((detail, idx) => (
                              <li key={idx} className="text-sm">
                                {detail}
                              </li>
                            ))}
                          </ul>
                        )}
                    </div>
                  </div>
                </div>

                {/* Material Section */}
                <div className="border-b border-gray-300">
                  <button
                    onClick={() =>
                      setExpandedSections((prev) => ({
                        ...prev,
                        material: !prev.material,
                      }))
                    }
                    className="w-full py-3 flex justify-between items-center text-left"
                  >
                    <span className="font-normal text-lg">Ch·∫•t li·ªáu</span>
                    <span className="text-xl">
                      {expandedSections.material ? "‚àí" : "+"}
                    </span>
                  </button>
                  <div
                    className={`overflow-hidden transition-all duration-300 ${expandedSections.material
                      ? "max-h-[500px] pb-4"
                      : "max-h-0"
                      }`}
                  >
                    <div className="space-y-2 text-gray-600">
                      <p className="text-sm">
                        {selectedProduct.material || "ƒêang c·∫≠p nh·∫≠t"}
                      </p>
                    </div>
                  </div>
                </div>

                {/* Care Instructions Section */}
                <div className="border-b border-gray-300">
                  <button
                    onClick={() =>
                      setExpandedSections((prev) => ({
                        ...prev,
                        care: !prev.care,
                      }))
                    }
                    className="w-full py-3 flex justify-between items-center text-left"
                  >
                    <span className="font-normal text-lg">
                      H∆∞·ªõng d·∫´n b·∫£o qu·∫£n
                    </span>
                    <span className="text-xl">
                      {expandedSections.care ? "‚àí" : "+"}
                    </span>
                  </button>
                  <div
                    className={`overflow-hidden transition-all duration-300 ${expandedSections.care ? "max-h-[500px] pb-4" : "max-h-0"
                      }`}
                  >
                    <div className="space-y-2 text-gray-600">
                      <p className="text-sm">
                        {selectedProduct.care || "ƒêang c·∫≠p nh·∫≠t"}
                      </p>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            {/* right side */}
            <div className="flex flex-col gap-6 md:w-1/3 md:sticky md:top-[88px] md:self-start">
              <h1 className="text-2xl md:text-3xl">{selectedProduct.name}</h1>
              {selectedProduct.discountPrice ? (
                <>
                  <p className="text-lg text-gray-600 line-through">
                    {selectedProduct.price.toLocaleString("vi-VN")} VND
                  </p>
                  <p className="text-xl font-bold text-red-600">
                    {selectedProduct.discountPrice.toLocaleString("vi-VN")} VND
                  </p>
                </>
              ) : (
                <p className="text-xl font-bold text-black">
                  {selectedProduct.price.toLocaleString("vi-VN")} VND
                </p>
              )}
              {/* Color */}
              <div>
                <p className="text-black font-medium">
                  M√†u s·∫Øc: <span className="text-black font-light">{selectedColor ? selectedColor.name : ''}</span>
                </p>
                <div className="flex gap-3 mt-2">
                  {selectedProduct.colors.map((colorObj) => (
                    <button
                      key={colorObj.name}
                      onClick={() => setSelectedColor(colorObj)}
                      className={`w-10 h-10 rounded-full cursor-pointer ${selectedColor?.name === colorObj.name
                        ? "ring-2 ring-offset-2 ring-black"
                        : "border-2 border-gray-500"
                        }`}
                      style={{
                        backgroundColor: colorObj.code,
                        // filter: "brightness(0.9)",
                      }}
                    />
                  ))}
                </div>
              </div>

              {/* Size */}
              <div>
                <p className="text-black font-medium">K√≠ch c·ª°:</p>
                <div className="flex flex-wrap gap-3 mt-2">
                  {selectedProduct.sizes.map((size) => (
                    <button
                      key={size}
                      onClick={() => setSelectedSize(size)}
                      className={`w-10 h-10 flex items-center justify-center border cursor-pointer text-sm font-medium ${selectedSize === size
                        ? "ring-2 ring-offset-2 font-bold"
                        : "border-gray-400 text-gray-400"
                        }`}
                    >
                      {size}
                    </button>
                  ))}
                </div>
              </div>

              {/* Quantity */}
              <div className="flex flex-col items-start gap-2">
                <div className="flex justify-between w-full items-center">
                  <p className="text-gray-700 font-medium">S·ªë l∆∞·ª£ng:</p>
                  <p className="text-sm text-gray-500">
                    {selectedProduct.countInStock > 10
                      ? "C√≤n h√†ng"
                      : selectedProduct.countInStock > 0
                        ? `C√≤n ${selectedProduct.countInStock} s·∫£n ph·∫©m`
                        : "H·∫øt h√†ng"}
                  </p>
                </div>
                <div className="flex items-center w-[30%] py-2 bg-gray-100 rounded-full">
                  <button
                    onClick={() => handleQuantityChange("minus")}
                    className="w-[30%] text-center hover:font-bold cursor-pointer"
                  >
                    <span>‚àí</span>
                  </button>
                  <input
                    min="1"
                    value={quantity}
                    onChange={(e) => {
                      const value = parseInt(e.target.value);
                      if (!isNaN(value) && value >= 1) {
                        setQuantity(value);
                      } else {
                        setQuantity(1);
                      }
                    }}
                    className="w-[40%] text-center bg-gray-100 text-lg outline-none"
                  />
                  <button
                    onClick={() => handleQuantityChange("plus")}
                    className="w-[30%] text-center hover:font-bold cursor-pointer"
                  >
                    <span>+</span>
                  </button>
                </div>
              </div>

              {/* Add to Cart or Buy Now */}
              <div className="flex gap-2">
                <button
                  onClick={handleAddToCart}
                  disabled={isButtonDisabled}
                  className={`bg-black text-lg text-white flex items-center justify-center gap-2 py-2 w-full cursor-pointer ${isButtonDisabled ? "opacity-50 cursor-not-allowed" : "hover:bg-gray-800"
                    }`}
                >
                  {isButtonDisabled ? "ƒêang th√™m..." : (
                    <>
                      <PiShoppingCartSimple className="inline size-5 text-white" />
                      <p className="text-sm">Th√™m v√†o gi·ªè h√†ng </p>
                    </>
                  )}
                </button>
                <button
                  onClick={handleBuyNow}
                  disabled={isButtonDisabled}
                  className={`bg-white text-lg text-black flex items-center justify-center gap-2 py-2 w-full  cursor-pointer border border-black ${isButtonDisabled ? "opacity-50 cursor-not-allowed" : "hover:bg-gray-100"
                    }`}
                >
                  {isButtonDisabled ? "ƒêang x·ª≠ l√Ω..." : (
                    <>
                      <PiCoins className="inline size-5 text-black" />
                      <p className="text-sm">Mua ngay </p>
                    </>
                  )}
                </button>
              </div>
            </div>
          </div>
          <div className="mt-20 mb-10 mx-[50px]">
            <h2 className="text-2xl text-center font-medium mb-4">
              S·∫£n ph·∫©m t∆∞∆°ng t·ª±
            </h2>
            {similarProducts &&
              selectedProduct &&
              (() => {
                // G·ªôp t·∫•t c·∫£ s·∫£n ph·∫©m li√™n quan th√†nh 1 m·∫£ng
                const allRelated = [
                  ...(similarProducts.sameCategory || []),
                  ...(similarProducts.sameBrand || []),
                  ...(similarProducts.recommended || []),
                ];
                // Lo·∫°i tr√πng v√† lo·∫°i s·∫£n ph·∫©m hi·ªán t·∫°i
                const uniqueRelated = allRelated
                  .filter((p) => p._id !== selectedProduct._id)
                  .filter(
                    (p, idx, arr) =>
                      arr.findIndex((x) => x._id === p._id) === idx
                  );

                if (uniqueRelated.length === 0) return null;

                return (
                  <div className="mt-12">
                    <h2 className="text-2xl font-semibold mb-4 text-left">
                      S·∫£n ph·∫©m t∆∞∆°ng t·ª±
                    </h2>
                    <ProductGrid products={uniqueRelated} />
                  </div>
                );
              })()}
          </div>
        </div>
      )}
    </div>
  );
};

export default ProductDetails;


===== FILE: ./frontend/src/components/Products/ProductGrid.jsx =====
import React from "react";
import { Link } from "react-router-dom";

const ProductGrid = ({ products, onClick }) => {
  if (!Array.isArray(products)) {
    return <div className="text-center p-4">Kh√¥ng c√≥ s·∫£n ph·∫©m n√†o.</div>;
  }

  return (
    <div className="grid grid-cols-2 lg:grid-cols-4">
      {products.map((product) => (
        <Link
          key={product._id}
          to={`/product/${product._id}`}
          className="block group"
          onClick={onClick}
        >
          {/* Ph·∫ßn ·∫£nh */}
          <div className="flex flex-col justify-between w-full aspect-[3/4]">
            <div className="h-[80%] overflow-hidden">
              <img
                src={
                  product.images[0]?.url || "https://via.placeholder.com/500"
                }
                alt={product.images[0]?.altText || product.name}
                className="w-full h-full object-cover"
              />
            </div>
            {/* Ph·∫ßn m√¥ t·∫£ */}
            <div className="flex flex-col gap-1 p-4">
              <h3 className="text-sm group-hover:underline transition-colors duration-300">
                {product.name}
              </h3>
              <div>
                {product.discountPrice ? (
                  <>
                    <p className="text-gray-500 line-through text-sm">
                      {product.price.toLocaleString("vi-VN")} VND
                    </p>
                    <p className="text-red-600 font-medium">
                      {product.discountPrice.toLocaleString("vi-VN")} VND
                    </p>
                  </>
                ) : (
                  <p className="text-black font-medium">
                    {product.price.toLocaleString("vi-VN")} VND
                  </p>
                )}
              </div>
            </div>
          </div>
        </Link>
      ))}
    </div>
  );
};

export default ProductGrid;


===== FILE: ./frontend/src/components/Products/SortOptions.jsx =====
import React from "react";
import { useSearchParams } from "react-router-dom";

const SortOptions = () => {
  const [searchParams, setSearchParams] = useSearchParams();

  const handleSortChange = (e) => {
    const sortBy = e.target.value;
    // T·∫°o m·ªôt object m·ªõi t·ª´ t·∫•t c·∫£ c√°c params hi·ªán t·∫°i
    const currentParams = {};
    searchParams.forEach((value, key) => {
      currentParams[key] = value;
    });

    // C·∫≠p nh·∫≠t ho·∫∑c th√™m m·ªõi param sortBy
    if (sortBy === "default") {
      delete currentParams.sortBy;
    } else {
      currentParams.sortBy = sortBy;
    }

    // Set l·∫°i t·∫•t c·∫£ params
    setSearchParams(currentParams);
  };

  return (
    <div className="flex items-center justify-end">
      <select
        id="sort"
        onChange={handleSortChange}
        value={searchParams.get("sortBy") || "default"}
        className="border border-gray-300 text-sm p-2 cursor-pointer"
      >
        <option value="default">M·∫∑c ƒë·ªãnh</option>
        <option value="price_asc">Gi√°: TƒÉng d·∫ßn</option>
        <option value="price_desc">Gi√°: Gi·∫£m d·∫ßn</option>
        <option value="name_asc">T√™n: A-Z</option>
        <option value="name_desc">T√™n: Z-A</option>
      </select>
    </div>
  );
};

export default SortOptions;


===== FILE: ./frontend/src/components/information/About.jsx =====
import React from "react";

const About = () => (
  <div className="mb-6 text-gray-800">
    <div className="mb-4">
      T·ª´ ng√†y 2 th√°ng 10 nƒÉm 2018
      <br />
      C√îNG TY TNHH WUKUDADA VI·ªÜT NAM
    </div>
    <div className="font-bold mb-1">T√äN C√îNG TY</div>
    <div className="mb-4">C√îNG TY TNHH WUKUDADA VI·ªÜT NAM</div>
    <div className="font-bold mb-1">TH√ÄNH L·∫¨P</div>
    <div className="mb-4">2 th√°ng 10, 2018</div>
    <div className="font-bold mb-1">V·ªä TR√ç</div>
    <div className="mb-4">
      ƒê·ªãa ch·ªâ ƒëƒÉng k√Ω: T·∫ßng 26, T√≤a nh√† Viettel, S·ªë 285, ƒê∆∞·ªùng C√°ch M·∫°ng Th√°ng
      T√°m, Ph∆∞·ªùng 12, Qu·∫≠n 10, Th√†nh ph·ªë H·ªì Ch√≠ Minh, Vi·ªát Nam
    </div>
    <div className="font-bold mb-1">NG√ÄNH NGH·ªÄ KINH DOANH</div>
    <div className="mb-4">
      B√°n l·∫ª s·∫£n ph·∫©m th·ªùi trang thi·∫øt k·∫ø nh√£n hi·ªáu WUKUDADA t·∫°i Vi·ªát Nam
    </div>
    <div className="font-bold mb-1">S·ªê C·ª¨A H√ÄNG</div>
    <div>8 c·ª≠a h√†ng (T√≠nh ƒë·∫øn th√°ng 8 nƒÉm 2021)</div>
  </div>
);

export default About;


===== FILE: ./frontend/src/components/information/Sponsorship.jsx =====
import React from "react";
import { FaFacebookSquare, FaInstagram, FaYoutube } from "react-icons/fa";

const SPONSORS = [
  {
    name: "TR·ªäNH TR·∫¶N PH∆Ø∆†NG TU·∫§N (JACK)",
    image:
      "https://cdnphoto.dantri.com.vn/BWnuv5garDlUBKjRSZrItt4qfWk=/thumb_w/1020/2025/05/26/jack1-1748272770861.jpg",
    description:
      "Sinh ng√†y 12/04/1997, qu√™ B·∫øn Tre, Vi·ªát Nam. Jack l√† ca sƒ©, nh·∫°c sƒ© n·ªïi ti·∫øng v·ªõi nhi·ªÅu b·∫£n hit v√† ƒë·∫°t nhi·ªÅu gi·∫£i th∆∞·ªüng l·ªõn trong l√†ng nh·∫°c Vi·ªát.",
    socials: [
      {
        label: "FACEBOOK",
        url: "https://www.facebook.com/jackphuongtuan.official/",
      },
      {
        label: "YOUTUBE",
        url: "https://www.youtube.com/c/J97Official",
      },
      {
        label: "INSTAGRAM",
        url: "https://www.instagram.com/jackj97/",
      },
    ],
  },
  {
    name: "ƒê·∫∂NG TI·∫æN HO√ÄNG (VIRUSS)",
    image:
      "https://th.bing.com/th/id/OIP.p0zYlMV4xYqqLoY90GsbBAHaD4?w=320&h=180&c=7&r=0&o=5&cb=iwc2&dpr=1.4&pid=1.7",
    description:
      "Sinh ng√†y 01/05/1990, qu√™ H√† N·ªôi, Vi·ªát Nam. ViruSs l√† streamer, nh·∫°c sƒ©, nh√† s·∫£n xu·∫•t √¢m nh·∫°c n·ªïi ti·∫øng, c√≥ s·ª©c ·∫£nh h∆∞·ªüng l·ªõn trong c·ªông ƒë·ªìng m·∫°ng Vi·ªát Nam.",
    socials: [
      { label: "FACEBOOK", url: "https://www.facebook.com/viruss.official/" },
      { label: "YOUTUBE", url: "https://www.youtube.com/c/ViruSsOfficial/" },
      { label: "INSTAGRAM", url: "https://www.instagram.com/viruss.official/" },
    ],
  },
  {
    name: "PH·∫†M THO·∫†I",
    image:
      "https://gamehow.net/upload/suckhoe_post/images/2023/03/03/643/pham-thoai-7.jpg",
    description:
      "Sinh ng√†y 16/01/1996, qu√™ H·∫£i Ph√≤ng, Vi·ªát Nam. Ph·∫°m Tho·∫°i l√† TikToker, KOL n·ªïi ti·∫øng v·ªõi phong c√°ch h√†i h∆∞·ªõc, s√°ng t·∫°o v√† c√≥ s·ª©c ·∫£nh h∆∞·ªüng l·ªõn tr√™n m·∫°ng x√£ h·ªôi.",
    socials: [
      {
        label: "FACEBOOK",
        url: "https://www.facebook.com/PhamThoai.Official/",
      },
      { label: "YOUTUBE", url: "https://www.youtube.com/@phamthoai" },
      {
        label: "INSTAGRAM",
        url: "https://www.instagram.com/phamthoai.official/",
      },
    ],
  },
  {
    name: "NGUY·ªÑN TH√öC THU·ª∂ TI√äN (THU·ª∂ TI√äN)",
    image:
      "https://xinhstar.vn/wp-content/uploads/2021/12/xinhstar-nhan-sac-doi-thuong-cua-hoa-hau-hoa-binh-quoc-te-nguyen-thuc-thuy-tien2.jpg",
    description:
      "Sinh ng√†y 12/08/1998, qu√™ TP. H·ªì Ch√≠ Minh, Vi·ªát Nam. Nguy·ªÖn Th√∫c Th√πy Ti√™n l√† Hoa h·∫≠u H√≤a b√¨nh Qu·ªëc t·∫ø 2021, n·ªïi ti·∫øng v·ªõi c√°c ho·∫°t ƒë·ªông thi·ªán nguy·ªán v√† truy·ªÅn c·∫£m h·ª©ng t√≠ch c·ª±c cho gi·ªõi tr·∫ª.",
    socials: [
      { label: "FACEBOOK", url: "https://www.facebook.com/thuytienofficial/" },
      { label: "YOUTUBE", url: "https://www.youtube.com/@thuytienofficial" },
      {
        label: "INSTAGRAM",
        url: "https://www.instagram.com/thuytienofficial/",
      },
    ],
  },
  {
    name: "QUANG LINH VLOG",
    image:
      "https://tudienwiki.com/wp-content/uploads/2023/04/300095820_500185375441609_5755206151203271073_n.jpg",
    description:
      "Sinh ng√†y 11/12/1997, qu√™ Ngh·ªá An, Vi·ªát Nam. Quang Linh l√† YouTuber n·ªïi ti·∫øng v·ªõi c√°c ho·∫°t ƒë·ªông thi·ªán nguy·ªán t·∫°i ch√¢u Phi, truy·ªÅn c·∫£m h·ª©ng t√≠ch c·ª±c ƒë·∫øn c·ªông ƒë·ªìng.",
    socials: [
      {
        label: "FACEBOOK",
        url: "https://www.facebook.com/quanglinhvlogafrica/",
      },
      { label: "YOUTUBE", url: "https://www.youtube.com/@quanglinhvlog" },
      { label: "INSTAGRAM", url: "https://www.instagram.com/quanglinhvlog/" },
    ],
  },
];

const Sponsorship = () => (
  <div>
    <h1 className="text-4xl font-bold mb-6">ƒê·∫†I S·ª® TH∆Ø∆†NG HI·ªÜU</h1>
    <div className="mb-4 text-base">
      WUKUDADA t·ª± h√†o h·ª£p t√°c v·ªõi c√°c KOL h√†ng ƒë·∫ßu Vi·ªát Nam
      <br />
    </div>

    <div className="divide-y">
      {SPONSORS.map((s, idx) => (
        <div
          key={s.name}
          className="py-8 flex flex-col md:flex-row gap-6 items-start"
        >
          <img
            src={s.image}
            alt={s.name}
            className="w-48 h-48 object-cover rounded mb-4 md:mb-0"
          />
          <div className="flex-1">
            <div className="flex flex-col md:flex-row md:items-center md:justify-between">
              <h2 className="text-2xl font-bold mb-2 md:mb-0">{s.name}</h2>
              <div className="flex flex-col md:items-end gap-1">
                {s.socials.map((soc) => {
                  let Icon = null;
                  if (soc.label === "FACEBOOK") Icon = FaFacebookSquare;
                  if (soc.label === "YOUTUBE") Icon = FaYoutube;
                  if (soc.label === "INSTAGRAM") Icon = FaInstagram;
                  return (
                    <a
                      key={soc.label}
                      href={soc.url}
                      target="_blank"
                      rel="noopener noreferrer"
                      className="text-black text-2xl hover:text-blue-600 flex items-center gap-2"
                      title={soc.label}
                    >
                      {Icon && <Icon />}
                      <span className="sr-only">{soc.label}</span>
                    </a>
                  );
                })}
              </div>
            </div>
            <div className="mt-2 text-base text-black">{s.description}</div>
          </div>
        </div>
      ))}
    </div>
  </div>
);

export default Sponsorship;


===== FILE: ./frontend/src/components/profile/MyOdersPage.jsx =====
import React from "react";
import { useNavigate } from "react-router-dom";
import { useOrders } from "./OrderContext";

const MyOdersPage = () => {
  const { orders, loading, error } = useOrders();
  const navigate = useNavigate();

  // Helper function ƒë·ªÉ format gi√° ti·ªÅn
  const formatPrice = (price) => {
    return new Intl.NumberFormat("vi-VN", {
      style: "currency",
      currency: "VND",
    }).format(price);
  };

  // Helper function ƒë·ªÉ translate status
  const getStatusLabel = (status) => {
    const statusMap = {
      Processing: "ƒêang x·ª≠ l√Ω",
      Shipped: "ƒêang giao",
      Delivered: "ƒê√£ giao",
      Cancelled: "ƒê√£ h·ªßy",
      preparing: "ƒêang chu·∫©n b·ªã",
      shipping: "ƒêang giao",
      delivered: "ƒê√£ giao",
    };
    return statusMap[status] || status;
  };

  // Helper function ƒë·ªÉ get status color
  const getStatusColor = (status) => {
    const colorMap = {
      Processing: "text-yellow-600 bg-yellow-100",
      preparing: "text-yellow-600 bg-yellow-100",
      Shipped: "text-blue-600 bg-blue-100",
      shipping: "text-blue-600 bg-blue-100",
      Delivered: "text-green-600 bg-green-100",
      delivered: "text-green-600 bg-green-100",
      Cancelled: "text-red-600 bg-red-100",
    };
    return colorMap[status] || "text-gray-600 bg-gray-100";
  };

  if (loading) {
    return (
      <div className="bg-white border border-gray-200 p-4 sm:p-6 md:p-8">
        <h3 className="text-xl sm:text-2xl font-medium mb-3 sm:mb-4 text-center md:text-left md:mb-10">
          ƒê∆†N H√ÄNG C·ª¶A T√îI
        </h3>
        <div className="flex justify-center items-center py-8">
          <div className="animate-spin rounded-full h-8 w-8 border-b-2 border-gray-900"></div>
          <span className="ml-2">ƒêang t·∫£i ƒë∆°n h√†ng...</span>
        </div>
      </div>
    );
  }

  if (error) {
    return (
      <div className="bg-white border border-gray-200 p-4 sm:p-6 md:p-8">
        <h3 className="text-xl sm:text-2xl font-medium mb-3 sm:mb-4 text-center md:text-left md:mb-10">
          ƒê∆†N H√ÄNG C·ª¶A T√îI
        </h3>
        <div className="text-center py-8">
          <div className="text-red-500 mb-2">‚ùå {error}</div>
          <button
            onClick={() => window.location.reload()}
            className="px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600"
          >
            Th·ª≠ l·∫°i
          </button>
        </div>
      </div>
    );
  }

  return (
    <div className="bg-white border border-gray-200 p-4 sm:p-6 md:p-8">
      <h3 className="text-xl sm:text-2xl font-medium mb-3 sm:mb-4 text-center md:text-left md:mb-10">
        ƒê∆†N H√ÄNG C·ª¶A T√îI
      </h3>
      <div className="relative border border-gray-200 overflow-x-auto">
        <div className="w-full min-w-[520px] sm:min-w-[700px]">
          <table className="min-w-full text-left text-gray-500 text-[11px] sm:text-xs md:text-sm">
            <thead className="bg-gray-100 text-[10px] sm:text-xs uppercase text-gray-700">
              <tr>
                <th className="py-1 px-1 sm:px-4 sm:py-3 whitespace-nowrap">
                  M√£ ƒë∆°n
                </th>
                <th className="py-1 px-1 sm:px-4 sm:py-3 whitespace-nowrap">
                  Ng√†y t·∫°o
                </th>
                <th className="py-1 px-1 sm:px-4 sm:py-3 whitespace-nowrap">
                  S·∫£n ph·∫©m
                </th>
                <th className="py-1 px-1 sm:px-4 sm:py-3 whitespace-nowrap">
                  T·ªïng ti·ªÅn
                </th>
                <th className="py-1 px-1 sm:px-4 sm:py-3 whitespace-nowrap">
                  Giao h√†ng
                </th>
                <th className="py-1 px-1 sm:px-4 sm:py-3 whitespace-nowrap">
                  Thanh to√°n
                </th>
              </tr>
            </thead>
            <tbody>
              {orders.length > 0 ? (
                orders.map((order) => (
                  <tr
                    key={order._id}
                    className="border-b hover:bg-gray-50 cursor-pointer"
                    onClick={() => navigate(`/profile/orders/${order._id}`)}
                  >
                    <td className="py-2 px-2 sm:px-4 sm:py-4 font-medium text-gray-900 whitespace-nowrap text-xs sm:text-sm">
                      #{order._id.slice(-6)}
                    </td>
                    <td className="py-2 px-4 text-xs sm:text-sm">
                      {new Date(
                        order.createdAt || order.createAt
                      ).toLocaleDateString("vi-VN")}
                    </td>
                    <td className="py-2 px-4 text-xs sm:text-sm">
                      {(order.orderItems || order.oderItems || []).map(
                        (item, index) => (
                          <div key={index} className="mb-1">
                            {item.name || item.product?.name} (x{item.quantity})
                          </div>
                        )
                      )}
                    </td>
                    <td className="py-2 px-4 text-xs sm:text-sm font-medium">
                      {formatPrice(order.totalPrice)}
                    </td>
                    <td className="py-2 px-4">
                      <span
                        className={`flex items-center gap-1 w-max px-2 py-1 rounded-full text-xs sm:text-sm font-medium whitespace-nowrap ${getStatusColor(
                          order.status || order.deliveryStatus
                        )}`}
                      >
                        {getStatusLabel(order.status || order.deliveryStatus)}
                      </span>
                    </td>
                    <td className="py-2 px-4">
                      <span
                        className={`flex items-center gap-1 w-max px-2 py-1 rounded-full text-xs sm:text-sm font-medium whitespace-nowrap ${
                          order.paymentStatus === "Paid"
                            ? "bg-green-100 text-green-700"
                            : order.paymentStatus === "Refunded"
                            ? "bg-yellow-100 text-yellow-700"
                            : "bg-red-100 text-red-700"
                        }`}
                      >
                        {order.paymentStatus === "Paid"
                          ? "ƒê√£ thanh to√°n"
                          : order.paymentStatus === "Refunded"
                          ? "ƒê√£ ho√†n ti·ªÅn"
                          : "Ch∆∞a thanh to√°n"}
                      </span>
                    </td>
                  </tr>
                ))
              ) : (
                <tr>
                  <td
                    colSpan={6}
                    className="text-center py-8 px-4 text-gray-500 text-sm"
                  >
                    <div className="flex flex-col items-center">
                      <svg
                        className="w-12 h-12 text-gray-300 mb-2"
                        fill="none"
                        stroke="currentColor"
                        viewBox="0 0 24 24"
                      >
                        <path
                          strokeLinecap="round"
                          strokeLinejoin="round"
                          strokeWidth={2}
                          d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z"
                        />
                      </svg>
                      <p>B·∫°n ch∆∞a c√≥ ƒë∆°n h√†ng n√†o</p>
                      <button
                        onClick={() => navigate("/")}
                        className="mt-2 px-4 py-2 bg-black text-white text-sm rounded hover:bg-gray-800 transition-colors"
                      >
                        Mua s·∫Øm ngay
                      </button>
                    </div>
                  </td>
                </tr>
              )}
            </tbody>
          </table>
        </div>
      </div>
    </div>
  );
};

export default MyOdersPage;


===== FILE: ./frontend/src/components/profile/OrderContext.jsx =====
import React, { createContext, useContext, useState, useEffect } from "react";
import axios from "axios";
import { getAuthToken, removeAuthTokens } from "../../utils/auth";

const API_URL = import.meta.env.VITE_API_URL || "http://localhost:9000";

// T·∫°o context
const OrderContext = createContext();

export const useOrders = () => useContext(OrderContext);

export const OrderProvider = ({ children }) => {
  const [orders, setOrders] = useState([]);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState(null); // H√†m fetch ƒë∆°n h√†ng t·ª´ API
  const fetchOrders = async () => {
    try {
      setLoading(true);
      setError(null);

      const token = getAuthToken();
      if (!token) {
        console.warn("No auth token found");
        console.log(
          "To test orders functionality, please login first or check localStorage for userToken"
        );
        console.log("Using fallback mock data for demo purposes");
        setOrders(getMockOrders());
        setLoading(false);
        return;
      }

      const response = await axios.get(`${API_URL}/api/orders/my-orders`, {
        headers: {
          Authorization: `Bearer ${token}`,
          "Content-Type": "application/json",
        },
      });

      console.log("Orders fetched successfully:", response.data);
      setOrders(response.data || []);
    } catch (error) {
      console.error("Error fetching orders:", error); // N·∫øu token h·∫øt h·∫°n ho·∫∑c kh√¥ng h·ª£p l·ªá
      if (error.response?.status === 401) {
        console.warn("Token expired or invalid");
        removeAuthTokens();
        setOrders([]);
      } else {
        setError(
          error.response?.data?.message || "C√≥ l·ªói x·∫£y ra khi t·∫£i ƒë∆°n h√†ng"
        );

        // Fallback to mock data n·∫øu server kh√¥ng c√≥ data
        if (error.response?.status === 500 || !error.response) {
          console.warn("Using fallback mock data");
          setOrders(getMockOrders());
        }
      }
    } finally {
      setLoading(false);
    }
  };

  // Mock data l√†m fallback
  const getMockOrders = () => {
    const deliveryStatuses = ["preparing", "shipping", "delivered"];
    const getRandomStatus = () =>
      deliveryStatuses[Math.floor(Math.random() * deliveryStatuses.length)];

    return [
      {
        _id: "mock-12345",
        createdAt: new Date().toISOString(),
        shippingAddress: {
          address: "123 Main St",
          city: "Ho Chi Minh",
          country: "Viet Nam",
          postalCode: "700000",
        },
        orderItems: [
          {
            productId: "prod1",
            name: "√Åo Thun Nam Basic Cotton",
            image:
              "https://images.unsplash.com/photo-1521572163474-6864f9cf17ab?w=500&h=600&fit=crop",
            quantity: 2,
            price: 299000,
            size: "M",
            color: "ƒêen",
          },
          {
            productId: "prod2",
            name: "Qu·∫ßn Jean Nam Slim Fit",
            image:
              "https://images.unsplash.com/photo-1541099649105-f69ad21f3246?w=500&h=600&fit=crop",
            quantity: 1,
            price: 750000,
            size: "32",
            color: "Xanh",
          },
        ],
        totalPrice: 1348000,
        isPaid: true,
        isDelivered: false,
        status: getRandomStatus(),
        paymentMethod: "Credit Card",
      },
      {
        _id: "mock-23456",
        createdAt: new Date(Date.now() - 86400000).toISOString(), // 1 day ago
        shippingAddress: {
          address: "456 Nguyen Hue St",
          city: "Ha Noi",
          country: "Viet Nam",
          postalCode: "100000",
        },
        orderItems: [
          {
            productId: "prod3",
            name: "V√°y Midi N·ªØ Elegant",
            image:
              "https://images.unsplash.com/photo-1566479179817-7c3c8c86e2e1?w=500&h=600&fit=crop",
            quantity: 1,
            price: 680000,
            size: "M",
            color: "ƒêen",
          },
        ],
        totalPrice: 680000,
        isPaid: false,
        isDelivered: false,
        status: getRandomStatus(),
        paymentMethod: "Cash on Delivery",
      },
    ];
  };

  useEffect(() => {
    fetchOrders();
  }, []);

  // H√†m refresh ƒë∆°n h√†ng
  const refreshOrders = () => {
    fetchOrders();
  };

  // H√†m c·∫≠p nh·∫≠t m·ªôt ƒë∆°n h√†ng c·ª• th·ªÉ
  const updateOrder = (orderId, updatedData) => {
    setOrders((prevOrders) =>
      prevOrders.map((order) =>
        order._id === orderId ? { ...order, ...updatedData } : order
      )
    );
  };

  const value = {
    orders,
    loading,
    error,
    setOrders,
    refreshOrders,
    updateOrder,
    fetchOrders,
  };

  return (
    <OrderContext.Provider value={value}>{children}</OrderContext.Provider>
  );
};


===== FILE: ./frontend/src/components/profile/OrderDetailPage.jsx =====
import React, { useState, useEffect } from "react";
import { useNavigate, useParams } from "react-router-dom";
import { useOrders } from "./OrderContext";
import axios from "axios";
import { getAuthToken } from "../../utils/auth";

const API_URL = import.meta.env.VITE_API_URL || "http://localhost:9000";

const OrderDetailPage = () => {
  const { orders, loading } = useOrders();
  const navigate = useNavigate();
  const { id } = useParams();
  const [order, setOrder] = useState(null);
  const [orderLoading, setOrderLoading] = useState(false);
  const [orderError, setOrderError] = useState(null);

  // Helper function ƒë·ªÉ format gi√° ti·ªÅn
  const formatPrice = (price) => {
    return new Intl.NumberFormat("vi-VN", {
      style: "currency",
      currency: "VND",
    }).format(price);
  };

  // Helper function ƒë·ªÉ translate status
  const getStatusLabel = (status) => {
    const statusMap = {
      Processing: "ƒêang x·ª≠ l√Ω",
      Shipped: "ƒêang giao",
      Delivered: "ƒê√£ giao",
      Cancelled: "ƒê√£ h·ªßy",
      preparing: "ƒêang chu·∫©n b·ªã",
      shipping: "ƒêang giao",
      delivered: "ƒê√£ giao",
    };
    return statusMap[status] || status;
  };

  // L·∫•y chi ti·∫øt ƒë∆°n h√†ng t·ª´ API n·∫øu c·∫ßn
  useEffect(() => {
    const foundOrder = orders?.find((o) => o._id === id);
    if (foundOrder) {
      setOrder(foundOrder);
    } else if (!loading && orders.length > 0) {
      // N·∫øu kh√¥ng t√¨m th·∫•y trong context, g·ªçi API ƒë·ªÉ l·∫•y chi ti·∫øt
      fetchOrderDetail();
    }
  }, [id, orders, loading]);
  const fetchOrderDetail = async () => {
    try {
      setOrderLoading(true);
      const token = getAuthToken();
      if (!token) {
        setOrderError("Vui l√≤ng ƒëƒÉng nh·∫≠p ƒë·ªÉ xem ƒë∆°n h√†ng");
        return;
      }

      const response = await axios.get(`${API_URL}/api/orders/${id}`, {
        headers: {
          Authorization: `Bearer ${token}`,
          "Content-Type": "application/json",
        },
      });

      setOrder(response.data);
    } catch (error) {
      console.error("Error fetching order detail:", error);
      setOrderError("Kh√¥ng th·ªÉ t·∫£i chi ti·∫øt ƒë∆°n h√†ng");
    } finally {
      setOrderLoading(false);
    }
  };

  if (loading || orderLoading) {
    return (
      <div className="max-w-2xl mx-auto bg-white rounded-lg shadow-lg p-4 sm:p-8 mt-4">
        <div className="flex justify-center items-center py-8">
          <div className="animate-spin rounded-full h-8 w-8 border-b-2 border-gray-900"></div>
          <span className="ml-2">ƒêang t·∫£i chi ti·∫øt ƒë∆°n h√†ng...</span>
        </div>
      </div>
    );
  }

  if (!order || orderError) {
    return (
      <div className="max-w-2xl mx-auto bg-white rounded-lg shadow-lg p-4 sm:p-8 mt-4">
        <button
          className="mb-4 px-4 py-2 bg-gray-200 hover:bg-gray-300 rounded text-sm"
          onClick={() => navigate(-1)}
        >
          ‚Üê Quay l·∫°i danh s√°ch ƒë∆°n h√†ng
        </button>
        <div className="text-red-500 font-semibold">
          {orderError || "Kh√¥ng t√¨m th·∫•y ƒë∆°n h√†ng!"}
        </div>
      </div>
    );
  }

  const orderItems = order.orderItems || order.oderItems || [];

  return (
    <div className="max-w-5xl mx-auto bg-white rounded-lg shadow-lg p-2 sm:p-4 md:p-8 mt-2 sm:mt-4 grid grid-cols-1 md:grid-cols-3 gap-4 md:gap-8 text-sm sm:text-base">
      {/* C·ªôt tr√°i: S·∫£n ph·∫©m trong ƒë∆°n h√†ng */}
      <div className="md:col-span-1 border-b md:border-b-0 md:border-r border-gray-200 pr-0 md:pr-4 pb-4 md:pb-0">
        <h4 className="font-bold text-sm sm:text-base mb-2 sm:mb-4">
          ƒê∆°n h√†ng c·ªßa b·∫°n
        </h4>
        <div className="divide-y divide-gray-200">
          {orderItems.map((item, idx) => (
            <div
              key={idx}
              className="flex flex-col sm:flex-row items-start sm:items-center gap-2 sm:gap-4 py-2 sm:py-4"
            >
              <img
                src={
                  item.image ||
                  item.product?.imageUrl ||
                  "https://via.placeholder.com/150"
                }
                alt={item.name || item.product?.name}
                className="w-20 h-20 sm:w-16 sm:h-16 object-cover rounded border"
              />
              <div className="flex-1">
                <div className="font-medium text-gray-900 text-xs sm:text-sm">
                  {item.name || item.product?.name}
                </div>
                <div className="text-gray-600 text-xs">
                  Gi√°: {formatPrice(item.price)}
                </div>
                {item.size && (
                  <div className="text-gray-600 text-xs">Size: {item.size}</div>
                )}
                {item.color && (
                  <div className="text-gray-600 text-xs">M√†u: {item.color}</div>
                )}{" "}
                <div className="text-gray-600 text-xs">
                  S·ªë l∆∞·ª£ng: {item.quantity}
                </div>
              </div>
            </div>
          ))}
        </div>
      </div>
      {/* C·ªôt gi·ªØa: ƒê·ªãa ch·ªâ giao h√†ng v√† thanh to√°n */}
      <div className="md:col-span-1 flex flex-col gap-4 md:gap-6">
        <div className="bg-gray-50 rounded border border-gray-200 p-2 sm:p-4">
          <div className="font-semibold mb-1 text-xs sm:text-sm">
            ƒê·ªãa ch·ªâ giao h√†ng
          </div>
          <div className="text-xs sm:text-sm">
            {order.shippingAddress?.detail}
          </div>
          <div className="text-xs sm:text-sm">
            {order.shippingAddress?.city}, {order.shippingAddress?.country}
          </div>
        </div>
        <div className="bg-gray-50 rounded border border-gray-200 p-2 sm:p-4">
          <div className="font-semibold mb-2 text-xs sm:text-sm">
            Thanh to√°n
          </div>
          <div className="mb-1 text-gray-700 text-xs sm:text-sm">
            <span className="font-semibold">Tr·∫°ng th√°i:</span>{" "}
            {order.isPaid ? "ƒê√£ thanh to√°n" : "Ch∆∞a thanh to√°n"}
          </div>
          <div className="mb-1 text-gray-700 text-xs sm:text-sm">
            <span className="font-semibold">Ng√†y t·∫°o:</span>{" "}
            {new Date(order.createAt).toLocaleString("vi-VN")}
          </div>
          <div className="mb-1 text-gray-700 text-xs sm:text-sm">
            <span className="font-semibold">Tr·∫°ng th√°i giao h√†ng:</span>{" "}
            {order.deliveryStatus === "delivered"
              ? "Giao h√†ng th√†nh c√¥ng"
              : order.deliveryStatus === "shipping"
              ? "ƒêang giao h√†ng"
              : "ƒêang chu·∫©n b·ªã h√†ng"}
          </div>
        </div>
      </div>
      {/* C·ªôt ph·∫£i: T·ªïng ƒë∆°n h√†ng */}
      <div className="md:col-span-1 border-t md:border-t-0 md:border-l border-gray-200 pl-0 md:pl-4 pt-4 md:pt-0 flex flex-col gap-4 md:gap-6">
        <div className="bg-gray-50 rounded border border-gray-200 p-2 sm:p-4">
          <div className="font-bold mb-2 text-xs sm:text-sm">T·ªîNG ƒê∆†N H√ÄNG</div>
          <div className="flex justify-between text-xs mb-1">
            <span>T·ªïng c·ªông</span>
            <span>
              {order.totalPrice.toLocaleString("vi-VN", {
                style: "currency",
                currency: "VND",
              })}
            </span>
          </div>
          {/* C√≥ th·ªÉ th√™m ph√≠ v·∫≠n chuy·ªÉn, m√£ gi·∫£m gi√° n·∫øu mu·ªën */}
          <div className="flex justify-between text-xs mb-1">
            <span>Ph√≠ v·∫≠n chuy·ªÉn</span>
            <span>50.000 VND</span>
          </div>
          <div className="flex justify-between text-sm font-semibold mt-2">
            <span>T·ªîNG</span>
            <span>
              {(order.totalPrice + 50000).toLocaleString("vi-VN", {
                style: "currency",
                currency: "VND",
              })}
            </span>
          </div>
        </div>
        <button
          className="w-full bg-black text-white py-2 sm:py-3 rounded font-semibold hover:bg-gray-900 transition text-xs sm:text-sm"
          onClick={() => navigate(-1)}
        >
          Quay l·∫°i danh s√°ch ƒë∆°n h√†ng
        </button>
      </div>
    </div>
  );
};

export default OrderDetailPage;


===== FILE: ./frontend/src/components/profile/OrderSearch.jsx =====


===== FILE: ./frontend/src/components/profile/ProfileInfo.jsx =====
import React, { useState, useEffect } from "react";
import { useSelector, useDispatch } from "react-redux";
import { Navigate } from "react-router-dom";
import axios from "axios";
import { toast } from "sonner";
import { getUserProfile } from "../../redux/slices/authSlice";
import { fetchCities, fetchDistricts, fetchWards } from "../../utils/wards";

const ProfileInfo = () => {
  const [isEdit, setIsEdit] = useState(false);
  const [form, setForm] = useState({
    email: "",
    name: "",
    phone: "",
    birthday: "",
    gender: "",
    address: "",
    city: "",
    district: "",
    ward: "",
  });

  const [errors, setErrors] = useState({});
  const [loading, setLoading] = useState(false);
  // State cho dropdown ƒë·ªãa ch·ªâ
  const [cities, setCities] = useState([]);
  const [districts, setDistricts] = useState([]);
  const [wards, setWards] = useState([]);
  const [selectedCityCode, setSelectedCityCode] = useState(null);
  const [selectedDistrictCode, setSelectedDistrictCode] = useState(null);

  // L·∫•y th√¥ng tin user t·ª´ Redux store
  const { userInfo, userToken } = useSelector((state) => state.auth);
  const API_URL = import.meta.env.VITE_BACKEND_URL || "http://localhost:9000";
  const dispatch = useDispatch();

  // Redirect to login if not authenticated
  const token = userToken || localStorage.getItem("userToken") || localStorage.getItem("token");
  if (!token || !userInfo) {
    return <Navigate to="/login" replace />;
  }

  // C·∫≠p nh·∫≠t form v·ªõi th√¥ng tin ng∆∞·ªùi d√πng t·ª´ Redux
  useEffect(() => {
    if (userInfo) {
      setForm({
        email: userInfo.email || "",
        name: userInfo.name || "",
        phone: userInfo.phone || "",
        birthday: userInfo.birth
          ? new Date(userInfo.birth).toLocaleDateString("vi-VN")
          : "",
        gender:
          userInfo.gender === "male"
            ? "Nam"
            : userInfo.gender === "female"
            ? "N·ªØ"
            : "Kh√°c",
        address: userInfo.address || "",
        city: userInfo.city || "",
        district: userInfo.district || "",
        ward: userInfo.ward || "",
      });
    }
  }, [userInfo]);

  // L·∫•y danh s√°ch t·ªânh/th√†nh khi m·ªü form
  useEffect(() => {
    fetchCities().then((data) => setCities(data));
  }, []);

  // Khi userInfo thay ƒë·ªïi ho·∫∑c cities ƒë√£ load, t·ª± ƒë·ªông set code cho city n·∫øu c√≥
  useEffect(() => {
    if (userInfo && cities.length > 0) {
      const cityObj = cities.find((c) => c.name === userInfo.city);
      if (cityObj) setSelectedCityCode(cityObj.code);
    }
  }, [userInfo, cities]);

  // Fetch districts khi ch·ªçn city
  useEffect(() => {
    if (selectedCityCode) {
      fetchDistricts(selectedCityCode).then((data) => setDistricts(data));
    } else {
      setDistricts([]);
      setWards([]);
    }
  }, [selectedCityCode]);

  // Khi userInfo thay ƒë·ªïi ho·∫∑c districts ƒë√£ load, t·ª± ƒë·ªông set code cho district n·∫øu c√≥
  useEffect(() => {
    if (userInfo && districts.length > 0) {
      const districtObj = districts.find((d) => d.name === userInfo.district);
      if (districtObj) setSelectedDistrictCode(districtObj.code);
    }
  }, [userInfo, districts]);

  // Fetch wards khi ch·ªçn district
  useEffect(() => {
    if (selectedDistrictCode) {
      fetchWards(selectedDistrictCode).then((data) => setWards(data));
    } else {
      setWards([]);
    }
  }, [selectedDistrictCode]);

  const validate = () => {
    const newErrors = {};
    if (!form.email) {
      newErrors.email = "Vui l√≤ng nh·∫≠p email";
    } else if (!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(form.email)) {
      newErrors.email = "Email kh√¥ng h·ª£p l·ªá";
    }

    if (!form.name) newErrors.name = "Vui l√≤ng nh·∫≠p t√™n";
    if (!form.address) newErrors.address = "Vui l√≤ng nh·∫≠p ƒë·ªãa ch·ªâ";
    if (!form.city) newErrors.city = "Vui l√≤ng nh·∫≠p th√†nh ph·ªë";
    if (!form.district) newErrors.district = "Vui l√≤ng nh·∫≠p qu·∫≠n/huy·ªán";
    if (!form.ward) newErrors.ward = "Vui l√≤ng nh·∫≠p ph∆∞·ªùng/x√£";
    if (!form.phone) {
      newErrors.phone = "Vui l√≤ng nh·∫≠p s·ªë ƒëi·ªán tho·∫°i";
    } else if (!/^\d{9,11}$/.test(form.phone)) {
      newErrors.phone = "S·ªë ƒëi·ªán tho·∫°i kh√¥ng h·ª£p l·ªá";
    }
    if (!form.birthday) newErrors.birthday = "Vui l√≤ng nh·∫≠p ng√†y sinh";
    if (!form.gender) newErrors.gender = "Vui l√≤ng ch·ªçn gi·ªõi t√≠nh";
    setErrors(newErrors);
    return Object.keys(newErrors).length === 0;
  };

  const handleChange = (e) => {
    const { name, value } = e.target;
    setForm((prev) => ({ ...prev, [name]: value }));
  };

  const handleSave = async (e) => {
    e.preventDefault();
    if (!validate()) return;

    setLoading(true);

    try {
      // Chuy·ªÉn ƒë·ªïi gi·ªõi t√≠nh v·ªÅ d·∫°ng l∆∞u trong database
      const genderMapping = {
        Nam: "male",
        N·ªØ: "female",
        Kh√°c: "other",
      };

      // Chuy·ªÉn ƒë·ªïi ng√†y sinh v·ªÅ ƒë·ªãnh d·∫°ng ISO
      let birthDate = form.birthday;
      if (form.birthday && form.birthday.includes("/")) {
        const parts = form.birthday.split("/");
        if (parts.length === 3) {
          birthDate = `${parts[2]}-${parts[1]}-${parts[0]}`;
        }
      }

      const userData = {
        name: form.name,
        gender: genderMapping[form.gender] || "other",
        birth: birthDate,
        address: form.address,
        city: form.city,
        district: form.district,
        ward: form.ward,
        phone: form.phone,
      };

      const response = await axios.put(
        `${API_URL}/api/users/update-profile`,
        userData,
        {
          headers: {
            "Content-Type": "application/json",
            Authorization: `Bearer ${userToken}`,
          },
        }
      );

      toast.success("C·∫≠p nh·∫≠t th√¥ng tin th√†nh c√¥ng!");
      setIsEdit(false);

      // C·∫≠p nh·∫≠t l·∫°i profile t·ª´ backend v√† Redux
      await dispatch(getUserProfile());
    } catch (error) {
      console.error("L·ªói khi c·∫≠p nh·∫≠t th√¥ng tin:", error);
      toast.error("C√≥ l·ªói x·∫£y ra khi c·∫≠p nh·∫≠t th√¥ng tin!");
    } finally {
      setLoading(false);
    }
  };

  return (
    <section className="bg-white border border-gray-200 p-4 sm:p-6 md:p-8 mb-8">
      <div className="flex flex-col sm:flex-row sm:justify-between sm:items-center gap-4 mb-6">
        <h3 className="text-xl sm:text-2xl font-medium">H·ªí S∆† C√Å NH√ÇN</h3>
        {isEdit ? (
          <button
            className=""
            onClick={() => setIsEdit(false)}
            disabled={loading}
          >
            H·ªßy
          </button>
        ) : (
          <button
            className="px-4 py-2 bg-black text-white rounded hover:bg-gray-800 w-full sm:w-auto"
            onClick={() => setIsEdit(true)}
          >
            S·ª≠a th√¥ng tin
          </button>
        )}
      </div>
      {isEdit ? (
        <form
          className="grid grid-cols-1 md:grid-cols-2 gap-4 md:gap-6 mb-6"
          onSubmit={handleSave}
        >
          <div>
            <div className="mb-2 text-gray-600 font-semibold">
              ƒê·ªäA CH·ªà EMAIL
            </div>
            <input
              type="email"
              name="email"
              value={form.email}
              onChange={handleChange}
              className={`mb-1 w-full border rounded px-3 py-2 ${
                errors.email ? "border-red-500" : ""
              }`}
              disabled={true} // Email kh√¥ng th·ªÉ thay ƒë·ªïi
              required
            />
            {errors.email && (
              <div className="text-red-500 text-sm mb-3">{errors.email}</div>
            )}
            <div className="mb-2 text-gray-600 font-semibold">T√äN</div>
            <input
              type="text"
              name="name"
              value={form.name}
              onChange={handleChange}
              className={`mb-1 w-full border rounded px-3 py-2 ${
                errors.name ? "border-red-500" : ""
              }`}
              required
            />
            {errors.name && (
              <div className="text-red-500 text-sm mb-3">{errors.name}</div>
            )}
            <div className="mb-2 text-gray-600 font-semibold">ƒê·ªäA CH·ªà</div>
            <input
              type="text"
              name="address"
              value={form.address}
              onChange={handleChange}
              className={`mb-1 w-full border rounded px-3 py-2 ${
                errors.address ? "border-red-500" : ""
              }`}
              required
            />
            {errors.address && (
              <div className="text-red-500 text-sm mb-3">{errors.address}</div>
            )}
            {/* Th√†nh ph·ªë */}
            <div className="mb-2 text-gray-600 font-semibold">TH√ÄNH PH·ªê</div>
            <select
              name="city"
              value={form.city}
              onChange={(e) => {
                const cityName = e.target.options[e.target.selectedIndex].text;
                setForm((prev) => ({
                  ...prev,
                  city: cityName,
                  district: "",
                  ward: "",
                }));
                const cityObj = cities.find((c) => c.name === cityName);
                setSelectedCityCode(cityObj ? cityObj.code : null);
                setSelectedDistrictCode(null);
              }}
              className={`mb-1 w-full border rounded px-3 py-2 ${
                errors.city ? "border-red-500" : ""
              }`}
              required
            >
              <option value="">Ch·ªçn th√†nh ph·ªë</option>
              {cities.map((city) => (
                <option key={city.code} value={city.name}>
                  {city.name}
                </option>
              ))}
            </select>
            {errors.city && (
              <div className="text-red-500 text-sm mb-3">{errors.city}</div>
            )}
            {/* Qu·∫≠n/huy·ªán */}
            <div className="mb-2 text-gray-600 font-semibold">QU·∫¨N/HUY·ªÜN</div>
            <select
              name="district"
              value={form.district}
              onChange={(e) => {
                const districtName =
                  e.target.options[e.target.selectedIndex].text;
                setForm((prev) => ({
                  ...prev,
                  district: districtName,
                  ward: "",
                }));
                const districtObj = districts.find(
                  (d) => d.name === districtName
                );
                setSelectedDistrictCode(districtObj ? districtObj.code : null);
              }}
              className={`mb-1 w-full border rounded px-3 py-2 ${
                errors.district ? "border-red-500" : ""
              }`}
              required
              disabled={!selectedCityCode || districts.length === 0}
            >
              <option value="">Ch·ªçn qu·∫≠n/huy·ªán</option>
              {districts.map((d) => (
                <option key={d.code} value={d.name}>
                  {d.name}
                </option>
              ))}
            </select>
            {errors.district && (
              <div className="text-red-500 text-sm mb-3">{errors.district}</div>
            )}
            {/* Ph∆∞·ªùng/x√£ */}
            <div className="mb-2 text-gray-600 font-semibold">PH∆Ø·ªúNG/X√É</div>
            <select
              name="ward"
              value={form.ward}
              onChange={(e) => {
                const wardName = e.target.options[e.target.selectedIndex].text;
                setForm((prev) => ({ ...prev, ward: wardName }));
              }}
              className={`mb-1 w-full border rounded px-3 py-2 ${
                errors.ward ? "border-red-500" : ""
              }`}
              required
              disabled={!selectedDistrictCode || wards.length === 0}
            >
              <option value="">Ch·ªçn ph∆∞·ªùng/x√£</option>
              {wards.map((w) => (
                <option key={w.code} value={w.name}>
                  {w.name}
                </option>
              ))}
            </select>
            {errors.ward && (
              <div className="text-red-500 text-sm mb-3">{errors.ward}</div>
            )}
          </div>
          <div>
            <div className="mb-2 text-gray-600 font-semibold">
              ƒêI·ªÜN THO·∫†I DI ƒê·ªòNG
            </div>
            <input
              type="text"
              name="phone"
              value={form.phone}
              onChange={handleChange}
              className={`mb-1 w-full border rounded px-3 py-2 ${
                errors.phone ? "border-red-500" : ""
              }`}
              required
            />
            {errors.phone && (
              <div className="text-red-500 text-sm mb-3">{errors.phone}</div>
            )}
            <div className="mb-2 text-gray-600 font-semibold">SINH NH·∫¨T</div>
            <input
              type="date"
              name="birthday"
              value={form.birthday.split("/").reverse().join("-")}
              onChange={(e) => {
                const val = e.target.value;
                setForm((prev) => ({
                  ...prev,
                  birthday: val.split("-").reverse().join("/"),
                }));
              }}
              className={`mb-1 w-full border rounded px-3 py-2 ${
                errors.birthday ? "border-red-500" : ""
              }`}
              required
            />
            {errors.birthday && (
              <div className="text-red-500 text-sm mb-3">{errors.birthday}</div>
            )}
            <div className="mb-2 text-gray-600 font-semibold">GI·ªöI T√çNH</div>
            <select
              name="gender"
              value={form.gender}
              onChange={handleChange}
              className={`mb-1 w-full border rounded px-3 py-2 ${
                errors.gender ? "border-red-500" : ""
              }`}
              required
            >
              <option value="">Ch·ªçn gi·ªõi t√≠nh</option>
              <option value="Nam">Nam</option>
              <option value="N·ªØ">N·ªØ</option>
              <option value="Kh√°c">Kh√°c</option>
            </select>
            {errors.gender && (
              <div className="text-red-500 text-sm mb-3">{errors.gender}</div>
            )}
          </div>
          <div className="col-span-1 md:col-span-2 flex flex-col md:flex-row justify-end gap-3 mt-2">
            <button
              type="submit"
              className="px-6 py-2 bg-black text-white rounded hover:bg-gray-800 w-full md:w-auto"
              disabled={loading}
            >
              {loading ? "ƒêang l∆∞u..." : "L∆∞u"}
            </button>
          </div>
        </form>
      ) : (
        <div className="grid grid-cols-1 md:grid-cols-2 gap-4 md:gap-6 mb-6">
          <div>
            <div className="mb-2 text-gray-600 font-semibold">
              ƒê·ªäA CH·ªà EMAIL
            </div>
            <div className="mb-4">{form.email}</div>
            <div className="mb-2 text-gray-600 font-semibold">T√äN</div>
            <div className="mb-4">{form.name}</div>
            <div className="mb-2 text-gray-600 font-semibold">ƒê·ªäA CH·ªà</div>
            <div className="mb-4">{form.address}</div>
            <div className="mb-2 text-gray-600 font-semibold">TH√ÄNH PH·ªê</div>
            <div className="mb-4">{form.city}</div>
            <div className="mb-2 text-gray-600 font-semibold">QU·∫¨N/HUY·ªÜN</div>
            <div className="mb-4">{form.district}</div>
            <div className="mb-2 text-gray-600 font-semibold">PH∆Ø·ªúNG/X√É</div>
            <div className="mb-4">{form.ward}</div>
          </div>
          <div>
            <div className="mb-2 text-gray-600 font-semibold">
              ƒêI·ªÜN THO·∫†I DI ƒê·ªòNG
            </div>
            <div className="mb-4">{form.phone}</div>
            <div className="mb-2 text-gray-600 font-semibold">SINH NH·∫¨T</div>
            <div className="mb-4">{form.birthday}</div>
            <div className="mb-2 text-gray-600 font-semibold">GI·ªöI T√çNH</div>
            <div className="mb-4">{form.gender}</div>
          </div>
        </div>
      )}
    </section>
  );
};

export default ProfileInfo;


===== FILE: ./frontend/src/components/profile/ProfileLayout.jsx =====
import React from "react";
import { NavLink, Outlet } from "react-router-dom";

const ProfileLayout = () => {
  return (
    <div className="bg-white mx-2 sm:mx-8 md:mx-20 lg:mx-[150px] my-6 md:my-[50px]">
      <h2 className="text-base sm:text-2xl font-medium mb-3 sm:mb-4 text-center md:text-left md:mb-10">
        TH√îNG TIN T√ÄI KHO·∫¢N
      </h2>
      <div className="flex flex-col md:flex-row max-w-6xl mx-auto w-full gap-1">
        {/* Sidebar */}{" "}
        <aside className="md:w-[25%] border-gray-200 pr-0 md:pr-4 mb-3 md:mb-0 flex-shrink-0">
          <nav className="flex flex-row md:flex-col gap-2 text-[15px] justify-center md:justify-start">
            <NavLink
              to="info"
              className={({ isActive }) =>
                `text-lg hover:underline px-2 py-1 md:px-0 md:py-0 text-center md:text-left ${
                  isActive ? "font-medium" : "font-normal"
                }`
              }
              end
            >
              H·ªì s∆° c√° nh√¢n
            </NavLink>
            <NavLink
              to="orders"
              className={({ isActive }) =>
                `text-lg hover:underline px-2 py-1 md:px-0 md:py-0 text-center md:text-left ${
                  isActive ? "font-medium" : "font-normal"
                }`
              }
            >
              L·ªãch s·ª≠ ƒë∆°n h√†ng
            </NavLink>
          </nav>
        </aside>
        {/* Main content */}
        <main className="flex-1 w-full">
          <Outlet />
        </main>
      </div>
    </div>
  );
};

export default ProfileLayout;


===== FILE: ./frontend/src/hooks/usePaymentChecker.js =====


===== FILE: ./frontend/src/main.jsx =====
import { StrictMode } from "react";
import { createRoot } from "react-dom/client";
import { BrowserRouter } from "react-router-dom";
import "./index.css";
import App from "./App.jsx";

createRoot(document.getElementById("root")).render(
  <StrictMode>
    <App />
  </StrictMode>
);


===== FILE: ./frontend/src/pages/About.jsx =====
import React from "react";

const About = () => (
  <div className="mb-6 text-gray-800">
    <div className="mb-4">
      T·ª´ ng√†y 2 th√°ng 10 nƒÉm 2018
      <br />
      C√îNG TY TNHH WUKUDADA VI·ªÜT NAM
    </div>
    <div className="font-bold mb-1">T√äN C√îNG TY</div>
    <div className="mb-4">C√îNG TY TNHH WUKUDADA VI·ªÜT NAM</div>
    <div className="font-bold mb-1">TH√ÄNH L·∫¨P</div>
    <div className="mb-4">2 th√°ng 10, 2018</div>
    <div className="font-bold mb-1">V·ªä TR√ç</div>
    <div className="mb-4">
      ƒê·ªãa ch·ªâ ƒëƒÉng k√Ω: T·∫ßng 26, T√≤a nh√† Viettel, S·ªë 285, ƒê∆∞·ªùng C√°ch M·∫°ng Th√°ng
      T√°m, Ph∆∞·ªùng 12, Qu·∫≠n 10, Th√†nh ph·ªë H·ªì Ch√≠ Minh, Vi·ªát Nam
    </div>
    <div className="font-bold mb-1">NG√ÄNH NGH·ªÄ KINH DOANH</div>
    <div className="mb-4">
      B√°n l·∫ª s·∫£n ph·∫©m th·ªùi trang thi·∫øt k·∫ø nh√£n hi·ªáu WUKUDADA t·∫°i Vi·ªát Nam
    </div>
    <div className="font-bold mb-1">S·ªê C·ª¨A H√ÄNG</div>
    <div>8 c·ª≠a h√†ng (T√≠nh ƒë·∫øn th√°ng 8 nƒÉm 2021)</div>
  </div>
);

export default About;


===== FILE: ./frontend/src/pages/AdminHomePage.jsx =====
import React, { useState, useEffect } from "react";
import { Link } from "react-router-dom";
import axios from "axios";
import { useSelector } from "react-redux";

const API_URL = import.meta.env.VITE_API_URL || "http://localhost:9000";

const AdminHomePage = () => {
  const [orders, setOrders] = useState([]);
  const [products, setProducts] = useState([]);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState(null);
  const [stats, setStats] = useState({
    totalRevenue: 0,
    totalOrders: 0,
    totalProducts: 0,
  });

  // Get auth token from Redux state
  const { userToken } = useSelector((state) => state.auth);

  useEffect(() => {
    const fetchData = async () => {
      try {
        setLoading(true);
        // Fetch orders
        const ordersResponse = await axios.get(`${API_URL}/api/admin/orders`, {
          headers: {
            Authorization: `Bearer ${userToken}`,
          },
        });
        const ordersData = ordersResponse.data;
        setOrders(ordersData);

        // Fetch products
        const productsResponse = await axios.get(`${API_URL}/api/admin/products`, {
          headers: {
            Authorization: `Bearer ${userToken}`,
          },
        });
        const productsData = productsResponse.data;
        setProducts(productsData);

        // Calculate statistics
        const totalRevenue = ordersData.reduce((acc, order) => {
          if (order.paymentStatus === "Paid") {
            return acc + order.totalPrice;
          }
          return acc;
        }, 0);

        setStats({
          totalRevenue,
          totalOrders: ordersData.length,
          totalProducts: productsData.length,
        });

        setLoading(false);
      } catch (err) {
        console.error("Error fetching admin data:", err);
        setError("Kh√¥ng th·ªÉ t·∫£i d·ªØ li·ªáu. Vui l√≤ng th·ª≠ l·∫°i sau.");
        setLoading(false);
      }
    };

    fetchData();
  }, [userToken]);

  if (loading) {
    return (
      <div className="flex justify-center items-center min-h-screen">
        <div className="animate-spin rounded-full h-8 w-8 border-t-2 border-b-2 border-gray-900"></div>
      </div>
    );
  }

  if (error) {
    return (
      <div className="max-w-7xl mx-auto p-6">
        <div className="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded">
          {error}
        </div>
      </div>
    );
  }

  // Format currency
  const formatCurrency = (amount) => {
    return new Intl.NumberFormat("vi-VN", {
      style: "currency",
      currency: "VND",
    }).format(amount);
  };

  return (
    <div className="max-w-7xl mx-auto p-6">
      <h1 className="text-2xl font-bold mb-6">B·∫£ng ƒëi·ªÅu khi·ªÉn</h1>
      <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
        <div className="bg-white p-6 rounded-lg shadow-md">
          <h2 className="text-lg font-semibold mb-4">Doanh thu</h2>
          <p className="text-2xl">{formatCurrency(stats.totalRevenue)}</p>
        </div>
        <div className="bg-white p-6 rounded-lg shadow-md">
          <h2 className="text-lg font-semibold mb-4">T·ªïng ƒë∆°n h√†ng</h2>
          <p className="text-2xl">{stats.totalOrders}</p>
          <Link to="/admin/orders" className="text-blue-500 hover:underline">
            Qu·∫£n l√Ω ƒë∆°n h√†ng
          </Link>
        </div>
        <div className="bg-white p-6 rounded-lg shadow-md">
          <h2 className="text-lg font-semibold mb-4">T·ªïng s·∫£n ph·∫©m</h2>
          <p className="text-2xl">{stats.totalProducts}</p>
          <Link to="/admin/products" className="text-blue-500 hover:underline">
            Qu·∫£n l√Ω s·∫£n ph·∫©m
          </Link>
        </div>
      </div>
      <div className="mt-6">
        <h2 className="text-lg font-bold mb-4">ƒê∆°n h√†ng g·∫ßn nh·∫•t</h2>
        <div className="overflow-x-auto">
          <table className="min-w-full text-left text-gray-600 border border-gray-100 border-collapse">
            <thead className="text-xs text-black uppercase bg-gray-100">
              <tr>
                <th scope="col" className="px-3 py-3">
                  M√£ ƒë∆°n h√†ng
                </th>
                <th scope="col" className="px-3 py-3">
                  Ng∆∞·ªùi d√πng
                </th>
                <th scope="col" className="px-3 py-3">
                  T·ªïng ti·ªÅn
                </th>
                <th scope="col" className="px-3 py-3">
                  Tr·∫°ng th√°i
                </th>
              </tr>
            </thead>
            <tbody>
              {orders.length > 0 ? (
                orders.slice(0, 5).map((order) => (
                  <tr key={order._id} className="border-b border-gray-100">
                    <td className="px-3 py-3">{order._id}</td>
                    <td className="px-3 py-3">{order.user?.name || "N/A"}</td>
                    <td className="px-3 py-3">{formatCurrency(order.totalPrice)}</td>
                    <td className="px-3 py-3">{order.status}</td>
                  </tr>
                ))
              ) : (
                <tr>
                  <td colSpan={4} className="px-3 py-3 text-center">
                    Kh√¥ng c√≥ ƒë∆°n h√†ng
                  </td>
                </tr>
              )}
            </tbody>
          </table>
        </div>
      </div>
    </div>
  );
};

export default AdminHomePage;


===== FILE: ./frontend/src/pages/Cart.jsx =====
import React, { useEffect, useState } from "react";
import { Link, useNavigate } from "react-router-dom";
import { useDispatch, useSelector } from "react-redux";
import {
  clearCart,
  removeFromCart,
  updateCartItemQuantity,
  fetchCart,
  clearCartServer,
} from "../redux/slices/cartSlice";

const Cart = () => {
  const navigate = useNavigate();
  const { userInfo, guestId } = useSelector((state) => state.auth);
  const { cart, loading, error } = useSelector((state) => state.cart);
  const [shippingCost, setShippingCost] = useState(0);

  const userId = userInfo ? userInfo._id : null;
  const dispatch = useDispatch();
  useEffect(() => {
    console.log("Auth state:", { userInfo, guestId });
    console.log("User ID:", userId);
    console.log("User structure:", userInfo);

    // Ki·ªÉm tra localStorage
    const userFromStorage = localStorage.getItem("userInfo");
    const tokenFromStorage = localStorage.getItem("userToken");

    console.log("UserInfo from localStorage:", userFromStorage);
    console.log("Token from localStorage:", tokenFromStorage);

    if (userFromStorage) {
      try {
        const parsedUser = JSON.parse(userFromStorage);
        console.log("Parsed user:", parsedUser);
      } catch (e) {
        console.error("Error parsing user from localStorage:", e);
      }
    }
  }, [userInfo, guestId, userId]);
  // Fetch cart khi component mount
  useEffect(() => {
    if (userId || guestId) {
      dispatch(fetchCart({ userId, guestId }));
    }
  }, [dispatch, userId, guestId]);

  const calculateShippingCost = (city) => {
    if (!city) return 30000; // M·∫∑c ƒë·ªãnh l√† 30.000 VND n·∫øu ch∆∞a c√≥ th√†nh ph·ªë
    return city.trim().toLowerCase().includes("h·ªì ch√≠ minh") ? 0 : 30000;
  };

  const getShippingCost = () => {
    return calculateShippingCost(userInfo?.city);
  };

  const getTotalAmount = () => {
    return getTotalPrice() + getShippingCost();
  };

  const getTotalPrice = () => {
    if (!cart?.products || cart.products.length === 0) return 0;

    return cart.products.reduce((total, item) => {
      const product = item.productId || item.product;
      const price = product?.discountPrice || product?.price || item.price || 0;
      return total + price * item.quantity;
    }, 0);
  };

  const handleCheckout = () => {
    if (!userInfo) {
      navigate("/login?redirect=checkout");
      return;
    }
    navigate("/checkout");
  };

  const handleAddToCart = (productId, quantity, size, color, delta) => {
    const newQuantity = quantity + delta;
    if (newQuantity >= 1) {
      dispatch(
        updateCartItemQuantity({
          productId,
          quantity: newQuantity,
          size,
          color,
          userId,
          guestId,
        })
      );
    }
  };

  const handleRemoveFromCart = (productId, size, color) => {
    dispatch(removeFromCart({ productId, size, color, userId, guestId }));
  };

  const handleClearCart = () => {
    if (userId || guestId) {
      dispatch(clearCartServer({ userId, guestId }));
    } else {
      dispatch(clearCart());
    }
  };

  // X·ª≠ l√Ω tr∆∞·ªùng h·ª£p error
  if (error && error !== "Cart not found") {
    return (
      <div className="max-w-7xl mx-auto px-4 py-8">
        <div className="text-center text-red-500">
          <p>C√≥ l·ªói x·∫£y ra: {error}</p>
          <button
            onClick={() => window.location.reload()}
            className="mt-4 px-4 py-2 bg-blue-500 text-white rounded"
          >
            Th·ª≠ l·∫°i
          </button>
        </div>
      </div>
    );
  }

  // X·ª≠ l√Ω tr∆∞·ªùng h·ª£p cart ch∆∞a ƒë∆∞·ª£c kh·ªüi t·∫°o ho·∫∑c cart not found (coi nh∆∞ gi·ªè h√†ng tr·ªëng)
  if (!cart || !cart.products || error === "Cart not found") {
    return (
      <div className="max-w-7xl mx-auto px-4 py-8">
        <div className="flex flex-col items-center justify-center py-12">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            fill="none"
            viewBox="0 0 24 24"
            strokeWidth={1.5}
            stroke="currentColor"
            className="w-16 h-16 text-gray-400 mb-4"
          >
            <path
              strokeLinecap="round"
              strokeLinejoin="round"
              d="M15.75 10.5V6a3.75 3.75 0 10-7.5 0v4.5m11.356-1.993l1.263 12c.07.665-.45 1.243-1.119 1.243H4.25a1.125 1.125 0 01-1.12-1.243l1.264-12A1.125 1.125 0 015.513 7.5h12.974c.576 0 1.059.435 1.119 1.007zM8.625 10.5a.375.375 0 11-.75 0 .375.375 0 01.75 0zm7.5 0a.375.375 0 11-.75 0 .375.375 0 01.75 0z"
            />
          </svg>
          <p className="text-gray-500 mb-4">Gi·ªè h√†ng c·ªßa b·∫°n ƒëang tr·ªëng</p>
          <Link
            to="/"
            className="px-6 py-2 bg-black text-white rounded-full hover:bg-gray-800"
          >
            Ti·∫øp t·ª•c mua s·∫Øm
          </Link>
        </div>
      </div>
    );
  }

  return (
    <div className="max-w-7xl mx-auto px-4 py-8">
      <h1 className="text-2xl font-medium mb-8">
        Gi·ªè h√†ng ({cart.products?.length || 0})
      </h1>

      {loading ? (
        <div className="flex items-center justify-center py-12">
          <div className="animate-spin rounded-full h-8 w-8 border-b-2 border-gray-900"></div>
        </div>
      ) : cart.products.length === 0 ? (
        <div className="flex flex-col items-center justify-center py-12">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            fill="none"
            viewBox="0 0 24 24"
            strokeWidth={1.5}
            stroke="currentColor"
            className="w-16 h-16 text-gray-400 mb-4"
          >
            <path
              strokeLinecap="round"
              strokeLinejoin="round"
              d="M15.75 10.5V6a3.75 3.75 0 10-7.5 0v4.5m11.356-1.993l1.263 12c.07.665-.45 1.243-1.119 1.243H4.25a1.125 1.125 0 01-1.12-1.243l1.264-12A1.125 1.125 0 015.513 7.5h12.974c.576 0 1.059.435 1.119 1.007zM8.625 10.5a.375.375 0 11-.75 0 .375.375 0 01.75 0zm7.5 0a.375.375 0 11-.75 0 .375.375 0 01.75 0z"
            />
          </svg>
          <p className="text-gray-500 mb-4">Gi·ªè h√†ng c·ªßa b·∫°n ƒëang tr·ªëng</p>
          <Link
            to="/"
            className="px-6 py-2 bg-black text-white rounded-full hover:bg-gray-800"
          >
            Ti·∫øp t·ª•c mua s·∫Øm
          </Link>
        </div>
      ) : (
        <div className="grid grid-cols-1 lg:grid-cols-3 gap-8">
          {/* Cart items */}
          <div className="lg:col-span-2 space-y-4">
            {cart.products.map((item, index) => {
              // S·ª¨A: X·ª≠ l√Ω c·∫£ hai c·∫•u tr√∫c d·ªØ li·ªáu c√≥ th·ªÉ c√≥
              const product = item.productId || item.product;
              const productId = product?._id || item.productId;

              // N·∫øu kh√¥ng c√≥ th√¥ng tin s·∫£n ph·∫©m, b·ªè qua item n√†y
              if (!product) {
                console.warn("Missing product data for cart item:", item);
                return null;
              }

              return (
                <div
                  key={`${productId}-${item.size}-${item.color}-${index}`}
                  className="flex gap-4 p-4 bg-white border border-[#DCDCDC]"
                >
                  {/* Product image */}
                  <Link
                    to={`/product/${productId}`}
                    className="w-32 flex-shrink-0"
                  >
                    <img
                      src={
                        product.images?.[0]?.url ||
                        item.image ||
                        "/placeholder-image.jpg"
                      }
                      alt={product.name || item.name}
                      className="w-full h-full object-cover"
                      onError={(e) => {
                        e.target.src = "/placeholder-image.jpg";
                      }}
                    />
                  </Link>

                  <div className="flex-1 flex flex-col justify-between">
                    {/* Product details */}
                    <div className="flex justify-between items-start">
                      <div>
                        <Link
                          to={`/product/${productId}`}
                          className="text-xl font-medium hover:underline"
                        >
                          {product.name || item.name}
                        </Link>
                        <div className="text-lg text-gray-500 mt-1">
                          <p>M√†u: {item.color?.name || "N/A"}</p>
                          <p>Size: {item.size}</p>
                        </div>
                      </div>
                      <button
                        onClick={() =>
                          handleRemoveFromCart(productId, item.size, item.color)
                        }
                        className="text-red-500 hover:text-red-600"
                      >
                        X√≥a
                      </button>
                    </div>
                    {/* Price and quantity */}
                    <div className="flex items-center justify-between mt-4">
                      {/* Quantity */}
                      <div className="flex items-center space-x-2">
                        <button
                          onClick={() =>
                            handleAddToCart(
                              productId,
                              item.quantity,
                              item.size,
                              item.color,
                              -1
                            )
                          }
                          className="w-8 h-8 flex items-center justify-center hover:bg-gray-100 cursor-pointer"
                        >
                          -
                        </button>
                        <span className="w-8 text-center">{item.quantity}</span>
                        <button
                          onClick={() =>
                            handleAddToCart(
                              productId,
                              item.quantity,
                              item.size,
                              item.color,
                              1
                            )
                          }
                          className="w-8 h-8 flex items-center justify-center hover:bg-gray-100 cursor-pointer"
                        >
                          +
                        </button>
                      </div>
                      {/* Price */}
                      <div className="text-right">
                        <p className="font-medium">
                          {(
                            (product.discountPrice ||
                              product.price ||
                              item.price ||
                              0) * item.quantity
                          ).toLocaleString("vi-VN")}{" "}
                          VND
                        </p>
                      </div>
                    </div>
                  </div>
                </div>
              );
            })}
          </div>

          {/* Order summary */}
          <div className="lg:col-span-1">
            <div className="bg-white border border-[#DCDCDC] p-6 sticky top-4">
              <h2 className="text-2xl font-medium mb-4">T·ªïng ƒë∆°n h√†ng</h2>

              <div className="space-y-2 mb-4">
                <div className="flex justify-between">
                  <span>T·∫°m t√≠nh</span>
                  <span>{getTotalPrice().toLocaleString("vi-VN")} VND</span>
                </div>
                <div className="flex justify-between">
                  <span>Ph√≠ v·∫≠n chuy·ªÉn</span>
                  <span>
                    {getShippingCost() === 0 ? (
                      <span className="text-green-600 font-bold">Mi·ªÖn ph√≠</span>
                    ) : (
                      <span>
                        {getShippingCost().toLocaleString("vi-VN")} VND
                      </span>
                    )}
                  </span>
                </div>
                <div className="border-t pt-2 mt-2">
                  <div className="flex justify-between font-medium">
                    <span>T·ªïng ti·ªÅn</span>
                    <span>{getTotalAmount().toLocaleString("vi-VN")} VND</span>
                  </div>
                </div>
              </div>

              <div className="space-y-2">
                <button
                  onClick={handleCheckout}
                  className="block w-full py-2 px-4 bg-red-500 text-white text-center hover:bg-red-400"
                >
                  Thanh to√°n
                </button>
                <button
                  onClick={handleClearCart}
                  className="block w-full py-2 px-4 border border-black text-black text-center hover:bg-gray-100"
                >
                  X√≥a gi·ªè h√†ng
                </button>
              </div>
            </div>
          </div>
        </div>
      )}
    </div>
  );
};

export default Cart;


===== FILE: ./frontend/src/pages/Checkout.jsx =====
import React, { useState, useEffect } from "react";
import { useSelector, useDispatch } from "react-redux";
import { createCheckoutSession } from "../redux/slices/checkoutSlice";
import { useNavigate } from "react-router-dom";
import { toast } from "sonner";
import {
  BANK_INFO,
  generateVietQRUrl,
  generateOrderCode,
  QR_FALLBACK_SVG,
  fetchRecentTransactionsAndCheckPayment,
} from "../utils/bankInfo";
import {
  clearCart,
  clearCartServer,
  fetchCart,
} from "../redux/slices/cartSlice";
import { useCart } from "../components/Cart/CartContext";
import axios from "axios";

const Checkout = () => {
  const navigate = useNavigate();
  const dispatch = useDispatch();
  const { cart } = useSelector((state) => state.cart);
  const cartItems = cart?.products || [];
  const getTotalPrice = () => {
    if (!cartItems || cartItems.length === 0) return 0;
    return cartItems.reduce((total, item) => {
      const product = item.productId || item.product;
      const price = product?.discountPrice || product?.price || item.price || 0;
      return total + price * item.quantity;
    }, 0);
  };
  const { loading, error } = useSelector((state) => state.checkout);
  const { userInfo, guestId } = useSelector((state) => state.auth);
  const userId = userInfo ? userInfo.id || userInfo._id : null;
  const { clearCart: clearCartContext } = useCart();

  // Helper function to parse address from user profile
  const parseAddress = (addressString) => {
    if (!addressString)
      return { address: "", city: "", district: "", ward: "" };

    // Try to parse Vietnamese address format: "street, district, city"
    const parts = addressString.split(",").map((part) => part.trim());

    if (parts.length >= 3) {
      return {
        address: parts[0] || "",
        district: parts[1] || "",
        city: parts[2] || "",
        ward: parts.length > 3 ? parts.slice(1, -2).join(", ") : "",
      };
    } else if (parts.length === 2) {
      return {
        address: parts[0] || "",
        city: parts[1] || "",
        district: "",
        ward: "",
      };
    } else {
      return {
        address: addressString,
        city: "",
        district: "",
        ward: "",
      };
    }
  };
  // Initialize form with user data from Redux store
  const initializeFormData = () => {
    const user = userInfo || {};
    const parsedAddress = parseAddress(user.address);
    // Chu·∫©n h√≥a ng√†y sinh v·ªÅ yyyy-MM-dd n·∫øu c√≥
    let birth = "";
    if (user.birth) {
      const d = new Date(user.birth);
      if (!isNaN(d.getTime())) {
        const yyyy = d.getFullYear();
        const mm = String(d.getMonth() + 1).padStart(2, "0");
        const dd = String(d.getDate()).padStart(2, "0");
        birth = `${yyyy}-${mm}-${dd}`;
      }
    }
    return {
      fullName: user.name || "",
      email: user.email || "",
      phone: user.phone || "",
      address: parsedAddress.address,
      city: user.city || parsedAddress.city || "",
      district: user.district || parsedAddress.district || "",
      ward: user.ward || parsedAddress.ward || "",
      postalCode: "700000",
      country: "Vietnam",
      paymentMethod: "cod",
      notes: "",
      birth, // th√™m birth n·∫øu c·∫ßn d√πng cho input type="date"
    };
  };
  // Form state
  const [formData, setFormData] = useState(initializeFormData());
  const [errors, setErrors] = useState({});
  const [isProcessing, setIsProcessing] = useState(false);
  const [isPaymentVerified, setIsPaymentVerified] = useState(false);
  const [isCheckingPayment, setIsCheckingPayment] = useState(false);
  const [paymentCheckResult, setPaymentCheckResult] = useState(null);
  // Calculate shipping cost (free for HCM, otherwise 30000)
  const [shippingCost, setShippingCost] = useState(0);
  useEffect(() => {
    if (
      formData.city &&
      formData.city.trim().toLowerCase().includes("h·ªì ch√≠ minh")
    ) {
      setShippingCost(0);
    } else {
      setShippingCost(30000);
    }
  }, [formData.city]);
  const totalAmount = getTotalPrice() + shippingCost;

  // Redirect if cart is empty
  useEffect(() => {
    if (!cartItems || cartItems.length === 0) {
      toast.error("Gi·ªè h√†ng c·ªßa b·∫°n ƒëang tr·ªëng!");
      navigate("/cart");
    }
  }, [cartItems, navigate]); // Handle input changes (only for payment method and notes)
  const handleInputChange = (e) => {
    const { name, value } = e.target;
    setFormData((prev) => ({
      ...prev,
      [name]: value,
    }));

    // Ki·ªÉm tra th√¥ng tin khi chuy·ªÉn sang ph∆∞∆°ng th·ª©c chuy·ªÉn kho·∫£n
    if (name === "paymentMethod" && value === "bank_transfer") {
      const requiredFields = [
        { field: "fullName", label: "H·ªç v√† t√™n" },
        { field: "email", label: "Email" },
        { field: "phone", label: "S·ªë ƒëi·ªán tho·∫°i" },
        { field: "address", label: "ƒê·ªãa ch·ªâ" },
        { field: "city", label: "Th√†nh ph·ªë" },
        { field: "district", label: "Qu·∫≠n/Huy·ªán" },
        { field: "ward", label: "Ph∆∞·ªùng/X√£" },
      ];

      const missingFields = requiredFields.filter(
        ({ field }) => !formData[field] || formData[field].trim() === ""
      );

      if (missingFields.length > 0) {
        toast.error(
          `Vui l√≤ng c·∫≠p nh·∫≠t ƒë·∫ßy ƒë·ªß th√¥ng tin: ${missingFields
            .map(({ label }) => label)
            .join(", ")} trong h·ªì s∆° c√° nh√¢n!`
        );
      }
    }
  };

  // Validate form
  const validateForm = () => {
    const newErrors = {};
    if (!formData.fullName.trim())
      newErrors.fullName = "Vui l√≤ng c·∫≠p nh·∫≠t t√™n trong h·ªì s∆°";
    if (!formData.email.trim())
      newErrors.email = "Vui l√≤ng c·∫≠p nh·∫≠t email trong h·ªì s∆°";
    if (!formData.phone.trim())
      newErrors.phone = "Vui l√≤ng c·∫≠p nh·∫≠t s·ªë ƒëi·ªán tho·∫°i trong h·ªì s∆°";
    if (!formData.address.trim())
      newErrors.address = "Vui l√≤ng c·∫≠p nh·∫≠t ƒë·ªãa ch·ªâ trong h·ªì s∆°";

    // Email validation (only if email exists)
    if (formData.email && formData.email.trim()) {
      const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
      if (!emailRegex.test(formData.email)) {
        newErrors.email = "Email trong h·ªì s∆° kh√¥ng h·ª£p l·ªá";
      }
    }

    // Phone validation (only if phone exists)
    if (formData.phone && formData.phone.trim()) {
      const phoneRegex = /^[0-9]{10,11}$/;
      if (!phoneRegex.test(formData.phone.replace(/\s/g, ""))) {
        newErrors.phone = "S·ªë ƒëi·ªán tho·∫°i trong h·ªì s∆° kh√¥ng h·ª£p l·ªá";
      }
    }

    setErrors(newErrors);
    if (Object.keys(newErrors).length > 0) {
      toast.error(
        "Vui l√≤ng nh·∫≠p ƒë·∫ßy ƒë·ªß th√¥ng tin giao h√†ng trong h·ªì s∆° c√° nh√¢n!"
      );
    }
    return Object.keys(newErrors).length === 0;
  };
  // Handle form submission
  const handleSubmit = async (e) => {
    e.preventDefault();
    if (!validateForm()) {
      toast.error("Vui l√≤ng ki·ªÉm tra l·∫°i th√¥ng tin ƒë∆°n h√†ng!");
      return;
    }

    const requiredFields = [
      "address",
      "city",
      "district",
      "ward",
      "postalCode",
      "country",
    ];
    for (const field of requiredFields) {
      if (!formData[field] || formData[field].trim() === "") {
        toast.error(`Thi·∫øu th√¥ng tin: ${field}`);
        return;
      }
    }

    setIsProcessing(true);
    try {
      // Prepare order data cho flow c≈©, ch·ªâ g·ª≠i productId
      const orderData = {
        formData: {
          fullName: formData.fullName,
          email: formData.email,
          phone: formData.phone,
          address: formData.address,
          city: formData.city,
          district: formData.district,
          ward: formData.ward,
          postalCode: formData.postalCode,
          country: formData.country,
          notes: formData.notes,
          paymentMethod: formData.paymentMethod, // Th√™m paymentMethod v√†o formData
        },
        cartItems: cartItems.map((item) => ({
          productId: item.productId?._id || item.productId || item.product?._id,
          size: item.size,
          color: item.color,
          quantity: item.quantity,
        })),
        totalPrice: getTotalPrice() + shippingCost,
      };
      // Log d·ªØ li·ªáu g·ª≠i l√™n ƒë·ªÉ ki·ªÉm tra
      console.log("orderData g·ª≠i l√™n:", orderData);
      // Create order
      const response = await axios.post(
        `${import.meta.env.VITE_API_URL}/api/orders`,
        orderData,
        {
          headers: {
            Authorization: `Bearer ${
              localStorage.getItem("userToken") || localStorage.getItem("token")
            }`,
          },
        }
      );
      if (response.data) {
        // X·ª≠ l√Ω h√†ng t·ªìn kho v√† c·∫≠p nh·∫≠t s·ªë l∆∞·ª£ng s·∫£n ph·∫©m
        try {
          const token =
            localStorage.getItem("userToken") || localStorage.getItem("token");

          // G·ªçi API ƒë·ªÉ c·∫≠p nh·∫≠t h√†ng t·ªìn kho cho c√°c s·∫£n ph·∫©m trong ƒë∆°n h√†ng
          await axios.post(
            `${import.meta.env.VITE_API_URL}/api/orders/${
              response.data._id
            }/update-stock`,
            {},
            {
              headers: {
                Authorization: `Bearer ${token}`,
              },
            }
          );
          console.log("‚úÖ ƒê√£ c·∫≠p nh·∫≠t h√†ng t·ªìn kho th√†nh c√¥ng");
        } catch (stockError) {
          console.error("‚ùå L·ªói khi c·∫≠p nh·∫≠t h√†ng t·ªìn kho:", stockError);
          toast.warning(
            "ƒê·∫∑t h√†ng th√†nh c√¥ng nh∆∞ng c√≥ l·ªói khi c·∫≠p nh·∫≠t t·ªìn kho!"
          );
        }

        // ‚úÖ Xo√° gi·ªè h√†ng
        try {
          clearCartContext();
          localStorage.removeItem("cart");
          dispatch(clearCart());

          if (userId || guestId) {
            const token =
              localStorage.getItem("userToken") ||
              localStorage.getItem("token");
            await axios.delete(
              `${import.meta.env.VITE_API_URL}/api/cart/clear`,
              {
                data: { userId, guestId },
                headers: {
                  Authorization: `Bearer ${token}`,
                },
              }
            );
            await dispatch(fetchCart({ userId, guestId }));
          }

          dispatch({ type: "cart/clearCart" });
          toast.success("ƒê·∫∑t h√†ng th√†nh c√¥ng! Gi·ªè h√†ng ƒë√£ ƒë∆∞·ª£c x√≥a.");
        } catch (error) {
          console.error("L·ªói khi x√≥a gi·ªè h√†ng:", error);
          toast.error("ƒê·∫∑t h√†ng th√†nh c√¥ng nh∆∞ng c√≥ l·ªói khi x√≥a gi·ªè h√†ng.");
        }

        // ‚úÖ ƒêi·ªÅu h∆∞·ªõng tu·ª≥ theo ph∆∞∆°ng th·ª©c thanh to√°n
        if (formData.paymentMethod === "bank_transfer") {
          toast.success(
            "ƒê·∫∑t h√†ng th√†nh c√¥ng! ƒê∆°n h√†ng ƒë√£ ƒë∆∞·ª£c ghi nh·∫≠n l√† ƒê√É THANH TO√ÅN."
          );
          setIsPaymentVerified(true);
          return;
        } else {
          toast.success("ƒê·∫∑t h√†ng th√†nh c√¥ng!");
          navigate("/");
        }
      }
    } catch (error) {
      console.log("[DEBUG] error:", error);
      toast.error(error.message || "C√≥ l·ªói x·∫£y ra khi ƒë·∫∑t h√†ng!");
    } finally {
      setIsProcessing(false);
    }
  };
  // Check payment status
  const handleCheckPayment = async () => {
    // Ki·ªÉm tra th√¥ng tin ProfileInfo tr∆∞·ªõc khi cho ph√©p ki·ªÉm tra thanh to√°n
    if (!validateForm()) {
      toast.error(
        "Vui l√≤ng c·∫≠p nh·∫≠t ƒë·∫ßy ƒë·ªß th√¥ng tin giao h√†ng trong h·ªì s∆° c√° nh√¢n tr∆∞·ªõc khi ki·ªÉm tra thanh to√°n!"
      );
      return;
    }

    // Ki·ªÉm tra c√°c tr∆∞·ªùng b·∫Øt bu·ªôc
    const requiredFields = [
      { field: "fullName", label: "H·ªç v√† t√™n" },
      { field: "email", label: "Email" },
      { field: "phone", label: "S·ªë ƒëi·ªán tho·∫°i" },
      { field: "address", label: "ƒê·ªãa ch·ªâ" },
      { field: "city", label: "Th√†nh ph·ªë" },
      { field: "district", label: "Qu·∫≠n/Huy·ªán" },
      { field: "ward", label: "Ph∆∞·ªùng/X√£" },
    ];

    const missingFields = requiredFields.filter(
      ({ field }) => !formData[field] || formData[field].trim() === ""
    );

    if (missingFields.length > 0) {
      toast.error(
        `Vui l√≤ng c·∫≠p nh·∫≠t ƒë·∫ßy ƒë·ªß th√¥ng tin: ${missingFields
          .map(({ label }) => label)
          .join(", ")} trong h·ªì s∆° c√° nh√¢n!`
      );
      return;
    }

    // Ki·ªÉm tra ƒë·ªãnh d·∫°ng email
    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    if (!emailRegex.test(formData.email)) {
      toast.error("Email kh√¥ng h·ª£p l·ªá!");
      return;
    }

    // Ki·ªÉm tra ƒë·ªãnh d·∫°ng s·ªë ƒëi·ªán tho·∫°i
    const phoneRegex = /^[0-9]{10,11}$/;
    if (!phoneRegex.test(formData.phone.replace(/\s/g, ""))) {
      toast.error("S·ªë ƒëi·ªán tho·∫°i kh√¥ng h·ª£p l·ªá!");
      return;
    }

    setIsCheckingPayment(true);
    setPaymentCheckResult(null);
    setIsPaymentVerified(false);
    const orderCode =
      document
        .querySelector(".font-mono.text-xs.bg-white.p-2.border.rounded.mt-1")
        ?.textContent?.split(" ")[0] || generateOrderCode();
    const amount = getTotalPrice() + shippingCost;
    // L·∫•y phone t·ª´ userInfo n·∫øu c√≥, fallback r·ªóng
    const phone = userInfo?.phone || formData.phone || "";
    const result = await fetchRecentTransactionsAndCheckPayment(
      orderCode,
      amount,
      phone
    );
    setIsCheckingPayment(false);
    if (result) {
      setIsPaymentVerified(true);
      setPaymentCheckResult({
        success: true,
        message: "ƒê√£ x√°c nh·∫≠n thanh to√°n th√†nh c√¥ng!",
      });
      toast.success("ƒê√£ x√°c nh·∫≠n thanh to√°n th√†nh c√¥ng!");
    } else {
      setIsPaymentVerified(false);
      setPaymentCheckResult({
        success: false,
        message:
          "Ch∆∞a t√¨m th·∫•y giao d·ªãch ph√π h·ª£p. Vui l√≤ng ki·ªÉm tra l·∫°i sau khi chuy·ªÉn kho·∫£n!",
      });
      toast.error("Ch∆∞a t√¨m th·∫•y giao d·ªãch ph√π h·ª£p.");
    }
  };

  if (!cartItems || cartItems.length === 0) {
    return null; // Will be redirected by useEffect
  }
  return (
    <div className="bg-white min-h-screen flex flex-col items-center justify-center py-6 mx-20 sm:px-4">
      <div className="flex flex-col md:flex-row gap-6 md:gap-8 w-full ">
        {/* Payment Method & Form */}
        <div className="flex-1 border p-4 sm:p-6 md:p-8 bg-white min-w-0">
          <h2 className="text-lg sm:text-xl font-bold mb-4 sm:mb-6 uppercase tracking-wide">
            PH∆Ø∆†NG TH·ª®C THANH TO√ÅN
          </h2>{" "}
          <div className="flex flex-col items-start sm:flex-row sm:items-center mb-4 sm:mb-6 gap-4 sm:gap-8">
            <label className="flex items-center font-medium text-base">
              <input
                type="radio"
                name="paymentMethod"
                value="cod"
                checked={formData.paymentMethod === "cod"}
                onChange={handleInputChange}
                className="mr-2 accent-black"
              />
              <span className="text-sm sm:text-base">
                Thanh to√°n khi giao h√†ng
              </span>
            </label>
            <label className="flex items-center font-medium text-base">
              <input
                type="radio"
                name="paymentMethod"
                value="bank_transfer"
                checked={formData.paymentMethod === "bank_transfer"}
                onChange={handleInputChange}
                className="mr-2 accent-black"
              />
              <span className="text-sm sm:text-base">
                Chuy·ªÉn kho·∫£n ng√¢n h√†ng
              </span>{" "}
            </label>{" "}
          </div>
          {/* Bank Transfer Information with VietQR */}
          {formData.paymentMethod === "bank_transfer" && (
            <div className="space-y-4 mb-6 p-4 border border-gray-300 rounded-lg bg-gray-50">
              <h3 className="font-bold text-lg mb-3">TH√îNG TIN CHUY·ªÇN KHO·∫¢N</h3>{" "}
              {/* Bank Information */}
              <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div className="space-y-2">
                  <div className="text-sm">
                    <span className="font-semibold">Ng√¢n h√†ng:</span>{" "}
                    {BANK_INFO.bankName}
                  </div>
                  <div className="text-sm">
                    <span className="font-semibold">S·ªë t√†i kho·∫£n:</span>{" "}
                    {BANK_INFO.accountNumber}
                  </div>
                  <div className="text-sm">
                    <span className="font-semibold">T√™n t√†i kho·∫£n:</span>{" "}
                    {BANK_INFO.accountName}
                  </div>
                  <div className="text-sm">
                    <span className="font-semibold">S·ªë ti·ªÅn:</span>
                    <span className="font-bold text-red-600 ml-1">
                      {(getTotalPrice() + shippingCost).toLocaleString("vi-VN")}{" "}
                      VND
                    </span>
                  </div>{" "}
                  <div className="text-sm">
                    <span className="font-semibold">
                      N·ªôi dung chuy·ªÉn kho·∫£n:
                    </span>{" "}
                    <div className="font-mono text-xs bg-white p-2 border rounded mt-1">
                      {generateOrderCode()}{" "}
                      {userInfo?.phone || formData.phone || ""}
                    </div>
                  </div>
                </div>{" "}
                {/* VietQR Code */}
                <div className="flex flex-col items-center">
                  <div className="text-sm font-semibold mb-2">
                    Qu√©t m√£ QR ƒë·ªÉ chuy·ªÉn kho·∫£n
                  </div>
                  <div className="bg-white p-4 border border-gray-300 rounded">
                    {" "}
                    <img
                      src={generateVietQRUrl(
                        getTotalPrice() + shippingCost,
                        generateOrderCode(),
                        userInfo?.phone || formData.phone || ""
                      )}
                      alt="VietQR Code"
                      className="w-56 h-56 object-contain"
                      onError={(e) => {
                        e.target.src = QR_FALLBACK_SVG;
                      }}
                    />
                  </div>
                  <div className="text-xs text-gray-600 mt-2 text-center">
                    S·ª≠ d·ª•ng app ng√¢n h√†ng ƒë·ªÉ qu√©t m√£ QR
                  </div>
                </div>
              </div>{" "}
              {/* Important Notes */}
              <div className="bg-yellow-50 border border-yellow-200 rounded p-3 mt-4">
                <div className="text-sm text-yellow-800">
                  <div className="font-semibold mb-1">üìã L∆∞u √Ω quan tr·ªçng:</div>
                  <ul className="list-disc list-inside space-y-1 text-xs">
                    <li>
                      Vui l√≤ng chuy·ªÉn kho·∫£n ƒë√∫ng s·ªë ti·ªÅn v√† n·ªôi dung nh∆∞ tr√™n
                    </li>
                    <li>
                      ƒê∆°n h√†ng s·∫Ω ƒë∆∞·ª£c x√°c nh·∫≠n sau khi ch√∫ng t√¥i nh·∫≠n ƒë∆∞·ª£c ti·ªÅn
                    </li>
                    <li>Th·ªùi gian x·ª≠ l√Ω: {BANK_INFO.contact.processingTime}</li>
                    <li>
                      Li√™n h·ªá hotline: {BANK_INFO.contact.hotline} n·∫øu c·∫ßn h·ªó
                      tr·ª£
                    </li>
                  </ul>
                </div>
              </div>
              {/* N√∫t ki·ªÉm tra thanh to√°n v√† tr·∫°ng th√°i */}
              <div className="mt-4">
                <button
                  type="button"
                  onClick={handleCheckPayment}
                  disabled={isCheckingPayment}
                  className="px-4 py-2 bg-blue-600 text-white text-sm rounded hover:bg-blue-700 transition-colors flex items-center"
                >
                  {isCheckingPayment ? (
                    <span className="animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"></span>
                  ) : (
                    <svg
                      className="w-4 h-4 mr-2"
                      fill="none"
                      stroke="currentColor"
                      viewBox="0 0 24 24"
                    >
                      <path
                        strokeLinecap="round"
                        strokeLinejoin="round"
                        strokeWidth={2}
                        d="M14.828 14.828a4 4 0 01-5.656 0M9 10h1m4 0h1m-7 4h12l-1 1H6l-1-1z"
                      />
                    </svg>
                  )}
                  Ki·ªÉm tra thanh to√°n
                </button>
                {paymentCheckResult && (
                  <div
                    className={`mt-2 text-sm ${
                      paymentCheckResult.success
                        ? "text-green-600"
                        : "text-red-600"
                    }`}
                  >
                    {paymentCheckResult.message}
                  </div>
                )}
              </div>
            </div>
          )}
          {/* Shipping Information for COD */}
          {formData.paymentMethod === "cod" && (
            <div className="space-y-4 mb-6 p-4 border border-gray-300 rounded-lg bg-gray-50">
              <h3 className="font-bold text-lg mb-3">TH√îNG TIN GIAO H√ÄNG</h3>
              <div className="text-sm">
                <span className="font-semibold">H·ªç v√† t√™n:</span>
                <span className="ml-2">{formData.fullName}</span>
              </div>
              <div className="text-sm">
                <span className="font-semibold">ƒê·ªãa ch·ªâ giao h√†ng:</span>
                <span className="ml-2">
                  {formData.address}, {formData.ward}, {formData.district},{" "}
                  {formData.city}
                </span>
              </div>
              <div className="text-sm">
                <span className="font-semibold">S·ªë ƒëi·ªán tho·∫°i:</span>
                <span className="ml-2">{formData.phone}</span>
              </div>
              <div className="text-sm">
                <span className="font-semibold">Ph∆∞∆°ng th·ª©c thanh to√°n:</span>
                <span className="ml-2 text-green-600 font-medium">
                  Thanh to√°n khi giao h√†ng
                </span>
              </div>
              <div className="mt-4 bg-yellow-50 border border-yellow-200 rounded p-3">
                <div className="text-sm text-yellow-800">
                  <div className="font-semibold mb-1">üìã L∆∞u √Ω:</div>
                  <ul className="list-disc list-inside space-y-1 text-xs">
                    <li>B·∫°n s·∫Ω thanh to√°n khi nh·∫≠n ƒë∆∞·ª£c h√†ng</li>
                    <li>Vui l√≤ng ki·ªÉm tra h√†ng tr∆∞·ªõc khi thanh to√°n</li>
                    <li>ƒê∆°n h√†ng s·∫Ω ƒë∆∞·ª£c giao trong v√≤ng 2-3 ng√†y l√†m vi·ªác</li>
                  </ul>
                </div>
              </div>
            </div>
          )}
          <button
            type="submit"
            onClick={handleSubmit}
            disabled={
              isProcessing ||
              loading ||
              (formData.paymentMethod === "bank_transfer" && !isPaymentVerified)
            }
            className="w-full sm:w-48 h-12 bg-red-600 hover:bg-red-700 text-white font-bold text-base sm:text-lg uppercase transition-colors duration-150 mt-2"
            style={{ letterSpacing: 1 }}
          >
            ƒê·∫∂T H√ÄNG
          </button>
        </div>

        {/* Order Summary */}
        <div className="flex-1 border p-4 sm:p-6 md:p-8 bg-white max-w-full md:max-w-md mt-8 md:mt-0">
          <div className="flex flex-col sm:flex-row sm:justify-between sm:items-center mb-4 gap-2">
            <span className="font-bold uppercase text-base sm:text-lg tracking-wide">
              T·ªîNG ƒê∆†N H√ÄNG
            </span>
            <span className="font-bold text-sm sm:text-base">
              {cartItems.length} S·∫¢N PH·∫®M
            </span>
          </div>
          <div className="mb-2 flex justify-between text-xs sm:text-sm">
            <span>T·ªïng c·ªông</span>
            <span>{getTotalPrice().toLocaleString("vi-VN")} VND</span>
          </div>
          <div className="mb-2 flex justify-between text-xs sm:text-sm">
            <span>Ph√≠ v·∫≠n chuy·ªÉn</span>
            {shippingCost === 0 ? (
              <span className="text-green-600 font-bold">Mi·ªÖn ph√≠</span>
            ) : (
              <span>{shippingCost.toLocaleString("vi-VN")} VND</span>
            )}
          </div>
          <div className="border-t border-black my-2"></div>
          <div className="mb-2 flex justify-between items-center text-base sm:text-lg font-bold">
            <span>T·ªîNG</span>
            <span>{totalAmount.toLocaleString("vi-VN")} VND</span>
          </div>
          <div className="text-xs text-gray-500 mb-2">
            ƒê√£ bao g·ªìm thu·∫ø gi√° tr·ªã gia tƒÉng
            <span className="float-right">
              {Math.round(totalAmount / 11).toLocaleString("vi-VN")} VND
            </span>
          </div>
          <div className="border-t border-black my-2"></div>
          <div className="mb-2 flex justify-between items-center text-xs sm:text-base font-bold">
            <span>T·ªîNG ƒê∆†N ƒê·∫∂T H√ÄNG</span>
            <span>{totalAmount.toLocaleString("vi-VN")} VND</span>
          </div>
        </div>
      </div>
    </div>
  );
};

export default Checkout;


===== FILE: ./frontend/src/pages/CheckoutBuyNow.jsx =====
import React, { useState, useEffect } from "react";
import { useSelector, useDispatch } from "react-redux";
import {
  createCheckoutSession,
  clearCheckout,
} from "../redux/slices/checkoutSlice";
import { useNavigate, useLocation } from "react-router-dom";
import { toast } from "sonner";
import {
  BANK_INFO,
  generateVietQRUrl,
  generateOrderCode,
  QR_FALLBACK_SVG,
  fetchRecentTransactionsAndCheckPayment,
} from "../utils/bankInfo";
import axios from "axios";

const CheckoutBuyNow = () => {
  const navigate = useNavigate();
  const location = useLocation();
  const dispatch = useDispatch();
  const { buyNowItem } = useSelector((state) => state.checkout);
  const { userInfo } = useSelector((state) => state.auth);

  const cartItems = buyNowItem ? [buyNowItem] : [];

  // Calculate shipping cost
  const calculateShippingCost = (city) => {
    if (city && city.trim().toLowerCase().includes("h·ªì ch√≠ minh")) {
      return 0;
    }
    return 30000;
  };

  const getTotalPrice = () => {
    if (!cartItems || cartItems.length === 0) return 0;
    return cartItems.reduce((total, item) => {
      return total + item.price * item.quantity;
    }, 0);
  };

  const getShippingCost = () => {
    return calculateShippingCost(formData.city);
  };

  const getTotalAmount = () => {
    return getTotalPrice() + getShippingCost();
  };

  // Check login status and redirect if needed
  useEffect(() => {
    if (!userInfo) {
      // Save current path for redirect after login
      const returnUrl = encodeURIComponent(location.pathname);
      toast.error("Vui l√≤ng ƒëƒÉng nh·∫≠p ƒë·ªÉ ti·∫øp t·ª•c mua h√†ng!");
      navigate(`/login?returnUrl=${returnUrl}`);
      return;
    }
  }, [userInfo, navigate, location]);

  // Redirect if no buy now item
  useEffect(() => {
    if (!buyNowItem) {
      toast.error("Kh√¥ng c√≥ s·∫£n ph·∫©m ƒë·ªÉ mua ngay");
      navigate("/");
    }
  }, [buyNowItem, navigate]);

  // Helper function to parse address from user profile
  const parseAddress = (addressString) => {
    if (!addressString)
      return { address: "", city: "", district: "", ward: "" };

    const parts = addressString.split(",").map((part) => part.trim());

    if (parts.length >= 3) {
      return {
        address: parts[0] || "",
        district: parts[1] || "",
        city: parts[2] || "",
        ward: parts.length > 3 ? parts.slice(1, -2).join(", ") : "",
      };
    } else if (parts.length === 2) {
      return {
        address: parts[0] || "",
        city: parts[1] || "",
        district: "",
        ward: "",
      };
    } else {
      return {
        address: addressString,
        city: "",
        district: "",
        ward: "",
      };
    }
  };

  // Initialize form with user data
  const initializeFormData = () => {
    const user = userInfo || {};
    const parsedAddress = parseAddress(user.address);
    let birth = "";
    if (user.birth) {
      const d = new Date(user.birth);
      if (!isNaN(d.getTime())) {
        const yyyy = d.getFullYear();
        const mm = String(d.getMonth() + 1).padStart(2, "0");
        const dd = String(d.getDate()).padStart(2, "0");
        birth = `${yyyy}-${mm}-${dd}`;
      }
    }
    return {
      fullName: user.name || "",
      email: user.email || "",
      phone: user.phone || "",
      address: parsedAddress.address,
      city: user.city || parsedAddress.city || "",
      district: user.district || parsedAddress.district || "",
      ward: user.ward || parsedAddress.ward || "",
      postalCode: "700000",
      country: "Vietnam",
      paymentMethod: "cod",
      notes: "",
      birth,
    };
  };

  // Form state
  const [formData, setFormData] = useState(initializeFormData());
  const [errors, setErrors] = useState({});
  const [isProcessing, setIsProcessing] = useState(false);
  const [isPaymentVerified, setIsPaymentVerified] = useState(false);
  const [isCheckingPayment, setIsCheckingPayment] = useState(false);
  const [paymentCheckResult, setPaymentCheckResult] = useState(null);

  // Handle input changes
  const handleInputChange = (e) => {
    const { name, value } = e.target;
    setFormData((prev) => ({
      ...prev,
      [name]: value,
    }));

    // Ki·ªÉm tra th√¥ng tin khi chuy·ªÉn sang ph∆∞∆°ng th·ª©c chuy·ªÉn kho·∫£n
    if (name === "paymentMethod" && value === "bank_transfer") {
      const requiredFields = [
        { field: "fullName", label: "H·ªç v√† t√™n" },
        { field: "email", label: "Email" },
        { field: "phone", label: "S·ªë ƒëi·ªán tho·∫°i" },
        { field: "address", label: "ƒê·ªãa ch·ªâ" },
        { field: "city", label: "Th√†nh ph·ªë" },
        { field: "district", label: "Qu·∫≠n/Huy·ªán" },
        { field: "ward", label: "Ph∆∞·ªùng/X√£" },
      ];

      const missingFields = requiredFields.filter(
        ({ field }) => !formData[field] || formData[field].trim() === ""
      );

      if (missingFields.length > 0) {
        toast.error(
          `Vui l√≤ng c·∫≠p nh·∫≠t ƒë·∫ßy ƒë·ªß th√¥ng tin: ${missingFields
            .map(({ label }) => label)
            .join(", ")} trong h·ªì s∆° c√° nh√¢n!`
        );
      }
    }
  };

  // Validate form
  const validateForm = () => {
    const newErrors = {};
    if (!formData.fullName.trim())
      newErrors.fullName = "Vui l√≤ng c·∫≠p nh·∫≠t t√™n trong h·ªì s∆°";
    if (!formData.email.trim())
      newErrors.email = "Vui l√≤ng c·∫≠p nh·∫≠t email trong h·ªì s∆°";
    if (!formData.phone.trim())
      newErrors.phone = "Vui l√≤ng c·∫≠p nh·∫≠t s·ªë ƒëi·ªán tho·∫°i trong h·ªì s∆°";
    if (!formData.address.trim())
      newErrors.address = "Vui l√≤ng c·∫≠p nh·∫≠t ƒë·ªãa ch·ªâ trong h·ªì s∆°";

    // Ki·ªÉm tra ƒë·ªãnh d·∫°ng email
    if (formData.email && formData.email.trim()) {
      const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
      if (!emailRegex.test(formData.email)) {
        newErrors.email = "Email trong h·ªì s∆° kh√¥ng h·ª£p l·ªá";
      }
    }

    // Ki·ªÉm tra ƒë·ªãnh d·∫°ng s·ªë ƒëi·ªán tho·∫°i
    if (formData.phone && formData.phone.trim()) {
      const phoneRegex = /^[0-9]{10,11}$/;
      if (!phoneRegex.test(formData.phone.replace(/\s/g, ""))) {
        newErrors.phone = "S·ªë ƒëi·ªán tho·∫°i trong h·ªì s∆° kh√¥ng h·ª£p l·ªá";
      }
    }

    setErrors(newErrors);
    if (Object.keys(newErrors).length > 0) {
      toast.error(
        "Vui l√≤ng nh·∫≠p ƒë·∫ßy ƒë·ªß th√¥ng tin giao h√†ng trong h·ªì s∆° c√° nh√¢n!"
      );
    }
    return Object.keys(newErrors).length === 0;
  };

  // Handle form submission
  const handleSubmit = async (e) => {
    e.preventDefault();
    if (!validateForm()) {
      toast.error("Vui l√≤ng ki·ªÉm tra l·∫°i th√¥ng tin ƒë∆°n h√†ng!");
      return;
    }

    const requiredFields = [
      "address",
      "city",
      "district",
      "ward",
      "postalCode",
      "country",
    ];
    for (const field of requiredFields) {
      if (!formData[field] || formData[field].trim() === "") {
        toast.error(`Thi·∫øu th√¥ng tin: ${field}`);
        return;
      }
    }

    setIsProcessing(true);
    try {
      const orderData = {
        checkoutItems: cartItems.map((item) => ({
          ...item,
          productId: item.productId,
        })),
        shippingAddress: {
          address: formData.address,
          city: formData.city,
          district: formData.district,
          ward: formData.ward,
          postalCode: formData.postalCode,
          country: formData.country,
          fullName: formData.fullName,
          phone: formData.phone,
          email: formData.email,
          notes: formData.notes,
        },
        paymentMethod: formData.paymentMethod,
        totalPrice: getTotalAmount(),
      };

      const response = await dispatch(
        createCheckoutSession(orderData)
      ).unwrap();

      if (response) {
        // Finalize checkout
        try {
          const token =
            localStorage.getItem("userToken") || localStorage.getItem("token");
          const finalizeRes = await axios.post(
            `${import.meta.env.VITE_API_URL}/api/checkout/${
              response._id
            }/finalize`,
            {},
            {
              headers: {
                Authorization: `Bearer ${token}`,
              },
            }
          );
          console.log("‚úÖ Finalized checkout:", finalizeRes.data);
        } catch (finalizeError) {
          console.error("‚ùå L·ªói khi finalize checkout:", finalizeError);
          toast.error("ƒê·∫∑t h√†ng th√†nh c√¥ng nh∆∞ng c√≥ l·ªói khi x·ª≠ l√Ω t·ªìn kho!");
        }

        // Clear checkout data
        dispatch(clearCheckout());

        // Handle payment method specific actions
        if (formData.paymentMethod === "bank_transfer") {
          toast.success(
            "ƒê·∫∑t h√†ng th√†nh c√¥ng! ƒê∆°n h√†ng ƒë√£ ƒë∆∞·ª£c ghi nh·∫≠n l√† ƒê√É THANH TO√ÅN."
          );
          setIsPaymentVerified(true);
          return;
        } else {
          toast.success("ƒê·∫∑t h√†ng th√†nh c√¥ng!");
          navigate("/");
        }
      }
    } catch (error) {
      console.log("[DEBUG] error:", error);
      toast.error(error.message || "C√≥ l·ªói x·∫£y ra khi ƒë·∫∑t h√†ng!");
    } finally {
      setIsProcessing(false);
    }
  };

  // Check payment status
  const handleCheckPayment = async () => {
    // Ki·ªÉm tra th√¥ng tin ProfileInfo tr∆∞·ªõc khi cho ph√©p ki·ªÉm tra thanh to√°n
    if (!validateForm()) {
      toast.error(
        "Vui l√≤ng c·∫≠p nh·∫≠t ƒë·∫ßy ƒë·ªß th√¥ng tin giao h√†ng trong h·ªì s∆° c√° nh√¢n tr∆∞·ªõc khi ki·ªÉm tra thanh to√°n!"
      );
      return;
    }

    // Ki·ªÉm tra c√°c tr∆∞·ªùng b·∫Øt bu·ªôc
    const requiredFields = [
      { field: "fullName", label: "H·ªç v√† t√™n" },
      { field: "email", label: "Email" },
      { field: "phone", label: "S·ªë ƒëi·ªán tho·∫°i" },
      { field: "address", label: "ƒê·ªãa ch·ªâ" },
      { field: "city", label: "Th√†nh ph·ªë" },
      { field: "district", label: "Qu·∫≠n/Huy·ªán" },
      { field: "ward", label: "Ph∆∞·ªùng/X√£" },
    ];

    const missingFields = requiredFields.filter(
      ({ field }) => !formData[field] || formData[field].trim() === ""
    );

    if (missingFields.length > 0) {
      toast.error(
        `Vui l√≤ng c·∫≠p nh·∫≠t ƒë·∫ßy ƒë·ªß th√¥ng tin: ${missingFields
          .map(({ label }) => label)
          .join(", ")} trong h·ªì s∆° c√° nh√¢n!`
      );
      return;
    }

    // Ki·ªÉm tra ƒë·ªãnh d·∫°ng email
    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    if (!emailRegex.test(formData.email)) {
      toast.error("Email kh√¥ng h·ª£p l·ªá!");
      return;
    }

    // Ki·ªÉm tra ƒë·ªãnh d·∫°ng s·ªë ƒëi·ªán tho·∫°i
    const phoneRegex = /^[0-9]{10,11}$/;
    if (!phoneRegex.test(formData.phone.replace(/\s/g, ""))) {
      toast.error("S·ªë ƒëi·ªán tho·∫°i kh√¥ng h·ª£p l·ªá!");
      return;
    }

    setIsCheckingPayment(true);
    setPaymentCheckResult(null);
    setIsPaymentVerified(false);
    const orderCode = generateOrderCode();
    const amount = getTotalAmount();
    const phone = userInfo?.phone || formData.phone || "";
    const result = await fetchRecentTransactionsAndCheckPayment(
      orderCode,
      amount,
      phone
    );
    setIsCheckingPayment(false);
    if (result) {
      setIsPaymentVerified(true);
      setPaymentCheckResult({
        success: true,
        message: "ƒê√£ x√°c nh·∫≠n thanh to√°n th√†nh c√¥ng!",
      });
      toast.success("ƒê√£ x√°c nh·∫≠n thanh to√°n th√†nh c√¥ng!");
    } else {
      setIsPaymentVerified(false);
      setPaymentCheckResult({
        success: false,
        message:
          "Ch∆∞a t√¨m th·∫•y giao d·ªãch ph√π h·ª£p. Vui l√≤ng ki·ªÉm tra l·∫°i sau khi chuy·ªÉn kho·∫£n!",
      });
      toast.error("Ch∆∞a t√¨m th·∫•y giao d·ªãch ph√π h·ª£p.");
    }
  };

  if (!cartItems || cartItems.length === 0) {
    return null; // Will be redirected by useEffect
  }

  return (
    <div className="bg-white min-h-screen flex flex-col items-center justify-center py-6 mx-20 sm:px-4">
      <div className="flex flex-col items-start md:flex-row gap-6 md:gap-8 w-full">
        {/* Payment Method & Form */}
        <div className="flex-1 border p-4 sm:p-6 md:p-8 bg-white min-w-0">
          <h2 className="text-lg sm:text-xl font-bold mb-4 sm:mb-6 uppercase tracking-wide">
            PH∆Ø∆†NG TH·ª®C THANH TO√ÅN
          </h2>
          <div className="flex flex-col sm:flex-row sm:items-center mb-4 sm:mb-6 gap-4 sm:gap-8">
            <label className="flex items-center font-medium text-base">
              <input
                type="radio"
                name="paymentMethod"
                value="cod"
                checked={formData.paymentMethod === "cod"}
                onChange={handleInputChange}
                className="mr-2 accent-black"
              />
              <span className="text-sm sm:text-base">
                Thanh to√°n khi giao h√†ng
              </span>
            </label>
            <label className="flex items-center font-medium text-base">
              <input
                type="radio"
                name="paymentMethod"
                value="bank_transfer"
                checked={formData.paymentMethod === "bank_transfer"}
                onChange={handleInputChange}
                className="mr-2 accent-black"
              />
              <span className="text-sm sm:text-base">
                Chuy·ªÉn kho·∫£n ng√¢n h√†ng
              </span>
            </label>
          </div>

          {/* Bank Transfer Information */}
          {formData.paymentMethod === "bank_transfer" && (
            <div className="space-y-4 mb-6 p-4 border border-gray-300 rounded-lg bg-gray-50">
              <h3 className="font-bold text-lg mb-3">TH√îNG TIN CHUY·ªÇN KHO·∫¢N</h3>
              <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div className="space-y-2">
                  <div className="text-sm">
                    <span className="font-semibold">Ng√¢n h√†ng:</span>{" "}
                    {BANK_INFO.bankName}
                  </div>
                  <div className="text-sm">
                    <span className="font-semibold">S·ªë t√†i kho·∫£n:</span>{" "}
                    {BANK_INFO.accountNumber}
                  </div>
                  <div className="text-sm">
                    <span className="font-semibold">T√™n t√†i kho·∫£n:</span>{" "}
                    {BANK_INFO.accountName}
                  </div>
                  <div className="text-sm">
                    <span className="font-semibold">S·ªë ti·ªÅn:</span>
                    <span className="font-bold text-red-600 ml-1">
                      {getTotalAmount().toLocaleString("vi-VN")} VND
                    </span>
                  </div>
                  <div className="text-sm">
                    <span className="font-semibold">
                      N·ªôi dung chuy·ªÉn kho·∫£n:
                    </span>
                    <div className="font-mono text-xs bg-white p-2 border rounded mt-1">
                      {generateOrderCode()}{" "}
                      {userInfo?.phone || formData.phone || ""}
                    </div>
                  </div>
                </div>

                {/* VietQR Code */}
                <div className="flex flex-col items-center">
                  <div className="text-sm font-semibold mb-2">
                    Qu√©t m√£ QR ƒë·ªÉ chuy·ªÉn kho·∫£n
                  </div>
                  <div className="bg-white p-4 border border-gray-300 rounded">
                    <img
                      src={generateVietQRUrl(
                        getTotalAmount(),
                        generateOrderCode(),
                        userInfo?.phone || formData.phone || ""
                      )}
                      alt="VietQR Code"
                      className="w-56 h-56 object-contain"
                      onError={(e) => {
                        e.target.src = QR_FALLBACK_SVG;
                      }}
                    />
                  </div>
                  <div className="text-xs text-gray-600 mt-2 text-center">
                    S·ª≠ d·ª•ng app ng√¢n h√†ng ƒë·ªÉ qu√©t m√£ QR
                  </div>
                </div>
              </div>

              {/* Important Notes */}
              <div className="bg-yellow-50 border border-yellow-200 rounded p-3 mt-4">
                <div className="text-sm text-yellow-800">
                  <div className="font-semibold mb-1">üìã L∆∞u √Ω quan tr·ªçng:</div>
                  <ul className="list-disc list-inside space-y-1 text-xs">
                    <li>
                      Vui l√≤ng chuy·ªÉn kho·∫£n ƒë√∫ng s·ªë ti·ªÅn v√† n·ªôi dung nh∆∞ tr√™n
                    </li>
                    <li>
                      ƒê∆°n h√†ng s·∫Ω ƒë∆∞·ª£c x√°c nh·∫≠n sau khi ch√∫ng t√¥i nh·∫≠n ƒë∆∞·ª£c ti·ªÅn
                    </li>
                    <li>Th·ªùi gian x·ª≠ l√Ω: {BANK_INFO.contact.processingTime}</li>
                    <li>
                      Li√™n h·ªá hotline: {BANK_INFO.contact.hotline} n·∫øu c·∫ßn h·ªó
                      tr·ª£
                    </li>
                  </ul>
                </div>
              </div>

              {/* Payment Check Button */}
              <div className="mt-4">
                <button
                  type="button"
                  onClick={handleCheckPayment}
                  disabled={isCheckingPayment}
                  className="px-4 py-2 bg-blue-600 text-white text-sm rounded hover:bg-blue-700 transition-colors flex items-center"
                >
                  {isCheckingPayment ? (
                    <span className="animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"></span>
                  ) : (
                    <svg
                      className="w-4 h-4 mr-2"
                      fill="none"
                      stroke="currentColor"
                      viewBox="0 0 24 24"
                    >
                      <path
                        strokeLinecap="round"
                        strokeLinejoin="round"
                        strokeWidth={2}
                        d="M14.828 14.828a4 4 0 01-5.656 0M9 10h1m4 0h1m-7 4h12l-1 1H6l-1-1z"
                      />
                    </svg>
                  )}
                  Ki·ªÉm tra thanh to√°n
                </button>
                {paymentCheckResult && (
                  <div
                    className={`mt-2 text-sm ${
                      paymentCheckResult.success
                        ? "text-green-600"
                        : "text-red-600"
                    }`}
                  >
                    {paymentCheckResult.message}
                  </div>
                )}
              </div>
            </div>
          )}

          {/* Shipping Information for COD */}
          {formData.paymentMethod === "cod" && (
            <div className="space-y-4 mb-6 p-4 border border-gray-300 rounded-lg bg-gray-50">
              <h3 className="font-bold text-lg mb-3">TH√îNG TIN GIAO H√ÄNG</h3>
              <div className="text-sm">
                <span className="font-semibold">H·ªç v√† t√™n:</span>
                <span className="ml-2">{formData.fullName}</span>
              </div>
              <div className="text-sm">
                <span className="font-semibold">ƒê·ªãa ch·ªâ giao h√†ng:</span>
                <span className="ml-2">
                  {formData.address}, {formData.ward}, {formData.district},{" "}
                  {formData.city}
                </span>
              </div>
              <div className="text-sm">
                <span className="font-semibold">S·ªë ƒëi·ªán tho·∫°i:</span>
                <span className="ml-2">{formData.phone}</span>
              </div>
              <div className="text-sm">
                <span className="font-semibold">Ph∆∞∆°ng th·ª©c thanh to√°n:</span>
                <span className="ml-2 text-green-600 font-medium">
                  Thanh to√°n khi giao h√†ng
                </span>
              </div>
              <div className="mt-4 bg-yellow-50 border border-yellow-200 rounded p-3">
                <div className="text-sm text-yellow-800">
                  <div className="font-semibold mb-1">üìã L∆∞u √Ω:</div>
                  <ul className="list-disc list-inside space-y-1 text-xs">
                    <li>B·∫°n s·∫Ω thanh to√°n khi nh·∫≠n ƒë∆∞·ª£c h√†ng</li>
                    <li>Vui l√≤ng ki·ªÉm tra h√†ng tr∆∞·ªõc khi thanh to√°n</li>
                    <li>ƒê∆°n h√†ng s·∫Ω ƒë∆∞·ª£c giao trong v√≤ng 2-3 ng√†y l√†m vi·ªác</li>
                    <li>
                      Ph√≠ v·∫≠n chuy·ªÉn:{" "}
                      {getShippingCost() === 0 ? (
                        <span className="text-green-600 font-bold">
                          Mi·ªÖn ph√≠
                        </span>
                      ) : (
                        <span>
                          {getShippingCost().toLocaleString("vi-VN")} VND
                        </span>
                      )}
                    </li>
                  </ul>
                </div>
              </div>
            </div>
          )}

          <button
            type="submit"
            onClick={handleSubmit}
            disabled={
              isProcessing ||
              (formData.paymentMethod === "bank_transfer" && !isPaymentVerified)
            }
            className="w-full sm:w-48 h-12 bg-red-600 hover:bg-red-700 text-white font-bold text-base sm:text-lg uppercase transition-colors duration-150 mt-2"
            style={{ letterSpacing: 1 }}
          >
            ƒê·∫∂T H√ÄNG
          </button>
        </div>

        {/* Order Summary */}
        <div className="flex-1 border p-4 sm:p-6 md:p-8 bg-white max-w-full md:max-w-md mt-8 md:mt-0">
          <div className="flex flex-col sm:flex-row sm:justify-between sm:items-center mb-4 gap-2">
            <span className="font-bold uppercase text-base sm:text-lg tracking-wide">
              T·ªîNG ƒê∆†N H√ÄNG
            </span>
            <span className="font-bold text-sm sm:text-base">
              {cartItems.length} S·∫¢N PH·∫®M
            </span>
          </div>
          <div className="mb-2 flex justify-between text-xs sm:text-sm">
            <span>T·ªïng c·ªông</span>
            <span>{getTotalPrice().toLocaleString("vi-VN")} VND</span>
          </div>
          <div className="mb-2 flex justify-between text-xs sm:text-sm">
            <span>Ph√≠ v·∫≠n chuy·ªÉn</span>
            {formData.city &&
            formData.city.trim().toLowerCase().includes("h·ªì ch√≠ minh") ? (
              <span className="text-green-600 font-bold">Mi·ªÖn ph√≠</span>
            ) : (
              <span>30.000 VND</span>
            )}
          </div>
          <div className="border-t border-black my-2"></div>
          <div className="mb-2 flex justify-between items-center text-base sm:text-lg font-bold">
            <span>T·ªîNG</span>
            <span>
              {(
                getTotalPrice() +
                (formData.city &&
                formData.city.trim().toLowerCase().includes("h·ªì ch√≠ minh")
                  ? 0
                  : 30000)
              ).toLocaleString("vi-VN")}{" "}
              VND
            </span>
          </div>
          <div className="text-xs text-gray-500 mb-2">
            ƒê√£ bao g·ªìm thu·∫ø gi√° tr·ªã gia tƒÉng
            <span className="float-right">
              {Math.round(getTotalAmount() / 11).toLocaleString("vi-VN")} VND
            </span>
          </div>
          <div className="border-t border-black my-2"></div>
          <div className="mb-2 flex justify-between items-center text-xs sm:text-base font-bold">
            <span>T·ªîNG ƒê∆†N ƒê·∫∂T H√ÄNG</span>
            <span>{getTotalAmount().toLocaleString("vi-VN")} VND</span>
          </div>
        </div>
      </div>
    </div>
  );
};

export default CheckoutBuyNow;


===== FILE: ./frontend/src/pages/Collection.jsx =====
import { useParams, useSearchParams } from "react-router-dom";
import { useRef, useState, useEffect } from "react";
import axios from "axios";
import ProductGrid from "../components/Products/ProductGrid";
import FilterSidebar from "../components/Products/FilterSidebar";
import SortOptions from "../components/Products/SortOptions";

const API_URL = import.meta.env.VITE_API_URL || "http://localhost:9000";

function Collection() {
  const { id } = useParams();
  const [searchParams] = useSearchParams();
  const [collection, setCollection] = useState(null);
  const [products, setProducts] = useState([]);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState(null);

  const sidebarRef = useRef(null);
  const [isSidebarOpen, setIsSidebarOpen] = useState(false);

  useEffect(() => {
    const fetchCollectionAndProducts = async () => {
      try {
        // T√¨m collection theo id (string)
        const collections = await axios.get(`${API_URL}/api/collections`);
        const collection = collections.data.find((c) => c.id === id);

        if (!collection) {
          setError("Kh√¥ng t√¨m th·∫•y b·ªô s∆∞u t·∫≠p");
          setLoading(false);
          return;
        }

        setCollection(collection);

        // L·∫•y params filter t·ª´ URL
        const params = Object.fromEntries(searchParams.entries());

        // G·ªçi API l·∫•y s·∫£n ph·∫©m theo collection id
        const productsRes = await axios.get(
          `${API_URL}/api/collections/${id}/products`,
          { params }
        );
        setProducts(productsRes.data);
        setLoading(false);
      } catch (err) {
        setError("Kh√¥ng th·ªÉ t·∫£i d·ªØ li·ªáu b·ªô s∆∞u t·∫≠p");
        setLoading(false);
      }
    };
    fetchCollectionAndProducts();
  }, [id, searchParams]);

  const toggleSidebar = () => {
    setIsSidebarOpen(!isSidebarOpen);
  };

  const handleOutsideClick = (e) => {
    if (sidebarRef.current && !sidebarRef.current.contains(e.target)) {
      setIsSidebarOpen(false);
    }
  };

  useEffect(() => {
    if (isSidebarOpen) {
      document.body.classList.add("overflow-hidden");
    } else {
      document.body.classList.remove("overflow-hidden");
    }
    document.addEventListener("mousedown", handleOutsideClick);
    return () => {
      document.body.classList.remove("overflow-hidden");
      document.removeEventListener("mousedown", handleOutsideClick);
    };
  }, [isSidebarOpen]);

  if (loading) return <div className="text-center mt-10">ƒêang t·∫£i...</div>;
  if (error)
    return <div className="text-center text-red-500 mt-10">{error}</div>;
  if (!collection) return <h2>Kh√¥ng t√¨m th·∫•y b·ªô s∆∞u t·∫≠p!</h2>;

  console.log("collection state:", collection);

  return (
    <div className="flex flex-col">
      {/* banner */}
      <div className="w-full px-4 md:px-[100px] my-6 md:my-[50px]">
        <div className="flex flex-row justify-center items-center border w-full border-gray-400">
          <div className="flex flex-col w-1/2 p-6 md:p-10 gap-2 justify-center">
            <h2 className="text-xl md:text-4xl font-medium uppercase">
              {collection.name}
            </h2>
            <p className="text-xs md:text-xl font-light">
              {collection.description}
            </p>
          </div>
          <img
            src={collection.bannerUrl}
            alt={collection.name}
            className="w-full md:w-1/2 h-[300px] md:h-[500px] items-center object-cover overflow-hidden"
          />
        </div>
      </div>
      {/* filter and sort */}
      <div className="w-full h-10 px-[50px] flex items-center justify-between">
        <button
          onClick={toggleSidebar}
          className="filter-button flex items-center gap-2 rounded-full border border-black px-4 py-1.5 transition-all hover:shadow-[inset_0_0_0_1px_black] cursor-pointer"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            fill="none"
            viewBox="0 0 24 24"
            strokeWidth={1.5}
            stroke="currentColor"
            className="w-5 h-5"
          >
            <path
              strokeLinecap="round"
              strokeLinejoin="round"
              d="M10.5 6h9.75M10.5 6a1.5 1.5 0 1 1-3 0m3 0a1.5 1.5 0 1 0-3 0M3.75 6H7.5m3 12h9.75m-9.75 0a1.5 1.5 0 0 1-3 0m3 0a1.5 1.5 0 0 0-3 0m-3.75 0H7.5m9-6h3.75m-3.75 0a1.5 1.5 0 0 1-3 0m3 0a1.5 1.5 0 0 0-3 0m-9.75 0h9.75"
            />
          </svg>
          <span className="text-sm">B·ªô l·ªçc</span>
        </button>
        {/* overlay */}
        <div
          className={`fixed inset-0 w-screen h-full bg-black/75 z-50 transition-[opacity,visibility] duration-200 ease-in-out ${
            isSidebarOpen
              ? "opacity-100 visible"
              : "opacity-0 invisible pointer-events-none"
          }`}
          onClick={() => setIsSidebarOpen(false)}
        />
        {/* filter sidebar */}
        <div
          ref={sidebarRef}
          className={`${
            isSidebarOpen ? "translate-x-0" : "-translate-x-full"
          } fixed inset-y-0 z-50 left-0 w-80 overflow-y-auto transition-transform duration-300 ease-in-out bg-white`}
        >
          <FilterSidebar />
        </div>
        {/* sort options */}
        <div>
          <SortOptions />
        </div>
      </div>
      <p className="text-black text-[20px] font-medium my-2 px-[50px]">
        {products.length} s·∫£n ph·∫©m
      </p>
      {console.log("products state:", products)}
      {/* Hi·ªÉn th·ªã "Kh√¥ng t√¨m th·∫•y s·∫£n ph·∫©m" n·∫øu kh√¥ng c√≥ k·∫øt qu·∫£ */}
      {products.length === 0 ? (
        <div className="w-full px-[50px] text-center py-10">
          <p className="text-gray-500">
            Kh√¥ng t√¨m th·∫•y s·∫£n ph·∫©m ph√π h·ª£p v·ªõi b·ªô l·ªçc ƒë√£ ch·ªçn
          </p>
        </div>
      ) : (
        <div className="w-full px-[50px]">
          <ProductGrid products={products} />
        </div>
      )}
    </div>
  );
}

export default Collection;


===== FILE: ./frontend/src/pages/GenderCollection.jsx =====
import { useParams, useSearchParams } from "react-router-dom";
import { useRef, useState, useEffect } from "react";
import axios from "axios";
import { getProducts } from "../services/productService";
import ProductGrid from "../components/Products/ProductGrid";
import FilterSidebar from "../components/Products/FilterSidebar";
import SortOptions from "../components/Products/SortOptions";

const API_URL = import.meta.env.VITE_API_URL || "http://localhost:9000";

function GenderCollection() {
  const { id } = useParams();
  const [searchParams] = useSearchParams();
  const [products, setProducts] = useState([]);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState(null);

  const sidebarRef = useRef(null);
  const [isSidebarOpen, setIsSidebarOpen] = useState(false);

  useEffect(() => {
    const fetchProducts = async () => {
      try {
        // L·∫•y s·∫£n ph·∫©m theo gender (v√† c√°c filter kh√°c)
        const filters = { gender: id === "women" ? "woman" : id };
        const color = searchParams.get("color");
        const size = searchParams.get("size");
        const material = searchParams.get("material");
        const category = searchParams.get("category");
        const sortBy = searchParams.get("sort");
        const price = searchParams.get("price");
        const search = searchParams.get("search");

        if (color) filters.color = color;
        if (size) filters.sizes = size;
        if (material) filters.material = material;
        if (category) filters.category = category;
        if (sortBy) filters.sortBy = sortBy;
        if (price) filters.price = price;
        if (search) filters.search = search;

        const response = await getProducts(filters);
        setProducts(response.products || []);
        setLoading(false);
      } catch (err) {
        setError("Kh√¥ng th·ªÉ t·∫£i d·ªØ li·ªáu s·∫£n ph·∫©m");
        setLoading(false);
      }
    };
    fetchProducts();
  }, [id, searchParams]);

  const toggleSidebar = () => {
    setIsSidebarOpen(!isSidebarOpen);
  };

  const handleOutsideClick = (e) => {
    if (sidebarRef.current && !sidebarRef.current.contains(e.target)) {
      setIsSidebarOpen(false);
    }
  };

  useEffect(() => {
    document.addEventListener("mousedown", handleOutsideClick);
    return () => {
      document.removeEventListener("mousedown", handleOutsideClick);
    };
  }, []);

  if (loading) return <div className="text-center mt-10">ƒêang t·∫£i...</div>;
  if (error)
    return <div className="text-center text-red-500 mt-10">{error}</div>;

  return (
    <div className="flex flex-col items-center justify-center">
      <div className="w-full px-4 md:px-[50px]">
        <h2 className="text-xl md:text-2xl text-left font-medium mb-4 md:mb-6 mt-6 md:mt-10">
          {id === "man"
            ? "Th·ªùi Trang Nam"
            : id === "woman"
            ? "Th·ªùi Trang N·ªØ"
            : "Th·ªùi Trang"}
        </h2>
      </div>
      {/* filter sidebar */}
      <div className="w-full px-4 md:px-[50px] flex justify-between items-center">
        <button
          onClick={toggleSidebar}
          className="filter-button flex items-center gap-2 rounded-full border border-gray-300 px-3 md:px-4 py-1 md:py-1.5 hover:bg-gray-50 transition-colors"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            fill="none"
            viewBox="0 0 24 24"
            strokeWidth={1.5}
            stroke="currentColor"
            className="w-4 h-4 md:w-5 md:h-5"
          >
            <path
              strokeLinecap="round"
              strokeLinejoin="round"
              d="M10.5 6h9.75M10.5 6a1.5 1.5 0 1 1-3 0m3 0a1.5 1.5 0 1 0-3 0M3.75 6H7.5m3 12h9.75m-9.75 0a1.5 1.5 0 0 1-3 0m3 0a1.5 1.5 0 0 0-3 0m-3.75 0H7.5m9-6h3.75m-3.75 0a1.5 1.5 0 0 1-3 0m3 0a1.5 1.5 0 0 0-3 0m-9.75 0h9.75"
            />
          </svg>
          <span className="text-sm md:text-base">Filters</span>
        </button>
        {/* overlay */}
        <div
          className={`fixed inset-0 w-screen h-full bg-black/75 z-50 transition-[opacity,visibility] duration-200 ease-in-out ${
            isSidebarOpen
              ? "opacity-100 visible"
              : "opacity-0 invisible pointer-events-none"
          }`}
          onClick={() => setIsSidebarOpen(false)}
        />
        {/* filter sidebar */}
        <div
          ref={sidebarRef}
          className={`${
            isSidebarOpen ? "translate-x-0" : "-translate-x-full"
          } fixed inset-y-0 z-50 left-0 w-[280px] md:w-80 overflow-y-auto transition-transform duration-300 ease-in-out bg-white`}
        >
          <FilterSidebar />
        </div>
        {/* sort options */}
        <div>
          <SortOptions />
        </div>
      </div>
      {/* Hi·ªÉn th·ªã s·ªë l∆∞·ª£ng s·∫£n ph·∫©m */}
      <p className="text-black text-base md:text-[20px] font-medium my-2 px-4 md:px-[50px]">
        {products.length} s·∫£n ph·∫©m
      </p>
      {/* Hi·ªÉn th·ªã "Kh√¥ng t√¨m th·∫•y s·∫£n ph·∫©m" n·∫øu kh√¥ng c√≥ k·∫øt qu·∫£ */}
      {products.length === 0 ? (
        <div className="w-full px-4 md:px-[50px] text-center py-6 md:py-10">
          <p className="text-gray-500 text-sm md:text-base">
            Kh√¥ng t√¨m th·∫•y s·∫£n ph·∫©m ph√π h·ª£p v·ªõi b·ªô l·ªçc ƒë√£ ch·ªçn
          </p>
        </div>
      ) : (
        <div className="w-full px-4 md:px-[50px]">
          <ProductGrid products={products} />
        </div>
      )}
    </div>
  );
}

export default GenderCollection;


===== FILE: ./frontend/src/pages/GoogleCallback.jsx =====
import React, { useEffect } from "react";
import { useSearchParams, useNavigate } from "react-router-dom";
import { useDispatch } from "react-redux";
import { toast } from "sonner";
import axios from "axios";

const GoogleCallback = () => {
  const [searchParams] = useSearchParams();
  const navigate = useNavigate();
  const dispatch = useDispatch();

  const API_URL = import.meta.env.VITE_BACKEND_URL || "http://localhost:9000";

  useEffect(() => {
    const handleGoogleCallback = async () => {
      const token = searchParams.get("token");
      const error = searchParams.get("error");

      if (token) {
        try {
          // L∆∞u token v√†o localStorage
          localStorage.setItem("userToken", token);

          // L·∫•y th√¥ng tin ng∆∞·ªùi d√πng t·ª´ API
          const response = await axios.get(`${API_URL}/api/users/profile`, {
            headers: {
              Authorization: `Bearer ${token}`,
            },
          });

          const data = response.data;
          // Chuy·ªÉn ƒë·ªïi ƒë·ªãnh d·∫°ng d·ªØ li·ªáu n·∫øu c·∫ßn
          if (data.birth) {
            // Format date ƒë·ªÉ hi·ªÉn th·ªã ƒë√∫ng
            data.birth = new Date(data.birth).toLocaleDateString("vi-VN");
          }

          // L∆∞u th√¥ng tin ng∆∞·ªùi d√πng v√†o localStorage
          localStorage.setItem("userInfo", JSON.stringify(data));

          // C·∫≠p nh·∫≠t Redux state - th√™m skipToast ƒë·ªÉ ngƒÉn toast k√©p
          dispatch({
            type: "auth/loginSuccess",
            payload: {
              userInfo: {
                ...data,
                skipToast: true, // Th√™m flag ƒë·ªÉ tr√°nh hi·ªÉn th·ªã toast tr√πng l·∫∑p
              },
              userToken: token,
            },
          });

          toast.success("ƒêƒÉng nh·∫≠p Google th√†nh c√¥ng!");
          navigate("/");
        } catch (error) {
          console.error("Error fetching user profile:", error);
          toast.error("L·ªói khi l·∫•y th√¥ng tin ng∆∞·ªùi d√πng");
          navigate("/login");
        }
      } else if (error) {
        toast.error("ƒêƒÉng nh·∫≠p Google th·∫•t b·∫°i");
        navigate("/login");
      } else {
        navigate("/login");
      }
    };

    handleGoogleCallback();
  }, [searchParams, navigate, dispatch]);

  return (
    <div className="flex items-center justify-center min-h-screen bg-gray-50">
      <div className="bg-white p-8 rounded-lg shadow-md">
        <div className="text-center">
          <h2 className="text-2xl font-semibold mb-4">
            ƒêang x·ª≠ l√Ω ƒëƒÉng nh·∫≠p...
          </h2>
          <div className="flex justify-center mb-4">
            <div className="animate-spin rounded-full h-12 w-12 border-b-2 border-gray-900"></div>
          </div>
          <p className="text-gray-600">Vui l√≤ng ƒë·ª£i trong gi√¢y l√°t</p>
        </div>
      </div>
    </div>
  );
};

export default GoogleCallback;


===== FILE: ./frontend/src/pages/Home.jsx =====
import React, { useState, useEffect } from "react";
import Hero from "../components/Layout/Hero";
import FeaturedCollection from "../components/Products/FeaturedCollection";
import { getProducts } from "../services/productService";
import axios from "axios";

const API_URL = import.meta.env.VITE_API_URL || "http://localhost:9000";

const Home = () => {
  const [collections, setCollections] = useState([]);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState(null);

  useEffect(() => {
    const fetchCollections = async () => {
      try {
        // L·∫•y t·∫•t c·∫£ s·∫£n ph·∫©m
        const response = await getProducts();
        const products = response.products || [];
        // L·∫•y danh s√°ch collection t·ª´ API
        const collectionsRes = await axios.get(`${API_URL}/api/collections`);
        const collectionsData = collectionsRes.data;
        // Map s·∫£n ph·∫©m v√†o t·ª´ng collection
        const collectionsMap = {};
        collectionsData.forEach((col) => {
          collectionsMap[col.id] = {
            ...col,
            products: [],
          };
        });
        products.forEach((product) => {
          if (collectionsMap[product.collection]) {
            collectionsMap[product.collection].products.push(product);
          }
        });
        const collections = Object.values(collectionsMap);
        setCollections(collections);
        setLoading(false);
      } catch (err) {
        setError("Kh√¥ng th·ªÉ t·∫£i d·ªØ li·ªáu b·ªô s∆∞u t·∫≠p");
        setLoading(false);
      }
    };
    fetchCollections();
  }, []);

  if (loading) return <div className="text-center mt-10">ƒêang t·∫£i...</div>;
  if (error)
    return <div className="text-center text-red-500 mt-10">{error}</div>;

  return (
    <>
      {/* <Hero />
      <h1 className="text-center text-4xl font-normal  mb-6 mt-10">
        Kh√°m ph√° b·ªô s∆∞u t·∫≠p ƒë·ªôc ƒë√°o c·ªßa Wukudada
      </h1> */}
      <div className="mb-[50px]">
        <FeaturedCollection
          collections={collections.filter((col) => col.status === "active")}
        />
      </div>
    </>
  );
};

export default Home;


===== FILE: ./frontend/src/pages/Information.jsx =====
import React, { useEffect } from "react";
import { NavLink, Outlet, useLocation, useNavigate } from "react-router-dom";

const Information = () => {
  const location = useLocation();
  const navigate = useNavigate();

  useEffect(() => {
    if (
      location.pathname === "/information" ||
      location.pathname === "/information/"
    ) {
      navigate("about", { replace: true });
    }
  }, [location, navigate]);

  return (
    <div className="max-w-6xl mx-auto px-4 py-8">
      <h1 className="text-4xl font-bold mb-8">TH√îNG TIN</h1>
      <div className="flex flex-col md:flex-row gap-6 md:gap-10">
        {/* Sidebar */}
        <aside className="md:w-1/4 w-full mb-4 md:mb-0">
          <ul className="bg-white border rounded p-4 md:p-0 md:border-0 md:bg-transparent">
            <li>
              <NavLink
                to="about"
                className={({ isActive }) =>
                  `mb-2 block text-gray-700 hover:underline px-0 py-1 text-base${
                    isActive ? " font-bold" : "font-normal"
                  }`
                }
                end
              >
                Th√¥ng tin ho·∫°t ƒë·ªông
              </NavLink>
            </li>
            <li>
              <NavLink
                to="sponsorship"
                className={({ isActive }) =>
                  `mb-2 block text-gray-700 hover:underline px-0 py-1 text-base${
                    isActive ? " font-bold" : "font-normal"
                  }`
                }
              >
                ƒê·∫°i s·ª© Th∆∞∆°ng hi·ªáu
              </NavLink>
            </li>
          </ul>
        </aside>
        {/* Main content */}
        <section className="flex-1 bg-white border rounded p-6 min-h-[300px]">
          <Outlet />
        </section>
      </div>
    </div>
  );
};

export default Information;


===== FILE: ./frontend/src/pages/Login.jsx =====
import React, { useState, useEffect } from 'react';
import { Link, useNavigate, useLocation } from 'react-router-dom';
import { FcGoogle } from 'react-icons/fc';
import { FaFacebook } from 'react-icons/fa';
import { loginUser, clearError, clearSuccess } from '../redux/slices/authSlice';
import { useDispatch, useSelector } from 'react-redux';
import { toast } from 'sonner';
import FacebookLogin from '@greatsumini/react-facebook-login';
import axios from 'axios';

const Login = () => {
    const [formData, setFormData] = useState({
        email: '',
        password: '',
    });
    const [showPassword, setShowPassword] = useState(false);
    const [errors, setErrors] = useState({});

    const dispatch = useDispatch();
    const navigate = useNavigate();
    const location = useLocation();

    // Get the return URL from query parameters or location state
    const searchParams = new URLSearchParams(location.search);
    const returnUrl = searchParams.get('returnUrl') || location.state?.from || '/';

    // Get auth state from Redux
    const { loading, error, success, userInfo } = useSelector((state) => state.auth);

    // Redirect to returnUrl if already logged in
    useEffect(() => {
        if (userInfo) {
            navigate(returnUrl, { replace: true });
        }
    }, [userInfo, navigate, returnUrl]);

    // Handle navigation after successful login
    useEffect(() => {
        if (success && userInfo) {
            if (!userInfo.skipToast) {
                toast.success('ƒêƒÉng nh·∫≠p th√†nh c√¥ng!');
            }
            dispatch(clearSuccess());
            // Navigate to the returnUrl
            navigate(returnUrl);
        }
    }, [success, userInfo, navigate, dispatch, returnUrl]);

    // Handle error display
    useEffect(() => {
        if (error) {
            toast.error(error);
            dispatch(clearError());
        }
    }, [error, dispatch]);

    const validateForm = () => {
        const newErrors = {};

        if (!formData.email) {
            newErrors.email = 'Vui l√≤ng nh·∫≠p ƒë·ªãa ch·ªâ email';
        } else if (!/\S+@\S+\.\S+/.test(formData.email)) {
            newErrors.email = 'Email kh√¥ng h·ª£p l·ªá';
        }

        if (!formData.password) {
            newErrors.password = 'Vui l√≤ng nh·∫≠p m·∫≠t kh·∫©u';
        } else if (formData.password.length < 6) {
            newErrors.password = 'M·∫≠t kh·∫©u ph·∫£i c√≥ √≠t nh·∫•t 6 k√Ω t·ª±';
        }

        setErrors(newErrors);
        return Object.keys(newErrors).length === 0;
    };

    const handleSubmit = async (e) => {
        e.preventDefault();
        if (validateForm()) {
            dispatch(loginUser({
                email: formData.email,
                password: formData.password
            }));
        }
    };

    const handleChange = (e) => {
        const { name, value } = e.target;
        setFormData(prev => ({
            ...prev,
            [name]: value
        }));
        // Clear error for this field
        if (errors[name]) {
            setErrors(prev => ({
                ...prev,
                [name]: ''
            }));
        }
    };

    // Google OAuth handler
    const handleGoogleLogin = () => {
        window.location.href = `${import.meta.env.VITE_BACKEND_URL || 'http://localhost:9000'}/api/auth/google`;
    };

    const handleFacebookLogin = async (response) => {
        try {
            // Get the access token from the response
            const { accessToken } = response;

            // Send the token to your backend
            const backendResponse = await axios.post(
                `${import.meta.env.VITE_BACKEND_URL || 'http://localhost:9000'}/api/auth/facebook/mobile`,
                { accessToken }
            );

            const { user, token } = backendResponse.data;

            // Save to localStorage
            localStorage.setItem('userInfo', JSON.stringify(user));
            localStorage.setItem('userToken', token);

            // Update Redux state
            dispatch({
                type: 'auth/loginSuccess',
                payload: {
                    userInfo: {
                        ...user,
                        skipToast: true,
                    },
                    userToken: token,
                },
            });

            toast.success('ƒêƒÉng nh·∫≠p Facebook th√†nh c√¥ng!');
            navigate(returnUrl);
        } catch (error) {
            console.error('Facebook login error:', error);
            toast.error('ƒêƒÉng nh·∫≠p Facebook th·∫•t b·∫°i. Vui l√≤ng th·ª≠ l·∫°i.');
        }
    };

    return (
        <div className="flex px-23 pt-[50px] pb-[150px] bg-white max-md:p-8 max-sm:px-2.5 max-sm:py-5">
            <div className="flex gap-10 justify-between w-full max-md:flex-col max-md:gap-8 border-[2px] border-[#DCDCDC] p-5">
                <div className="flex flex-col flex-1">
                    <h2 className="text-3xl font-medium text-black mb-5">ƒêƒÇNG NH·∫¨P</h2>
                    <p className='mb-4'>ƒêƒÉng nh·∫≠p b·∫±ng ƒë·ªãa ch·ªâ email v√† m·∫≠t kh·∫©u c·ªßa b·∫°n.</p>
                    <form onSubmit={handleSubmit} noValidate className="flex flex-col items-start gap-5">
                        <div className='w-full'>
                            <label htmlFor="email" className="block text-xl font-medium text-black mb-2">
                                ƒê·ªäA CH·ªà EMAIL
                            </label>
                            <div className="flex flex-col">
                                <input
                                    id="email"
                                    name="email"
                                    type="email"
                                    required
                                    disabled={loading}
                                    className="w-full h-12 placeholder-gray-500 px-3 py-2 border-b-2 border-b-[#898989] bg-[#F5F5F5]
                                    focus:bg-white focus:outline-none focus:ring-1 focus:ring-offset-2 focus:ring-black
                                    disabled:opacity-50 disabled:cursor-not-allowed"
                                    value={formData.email}
                                    onChange={handleChange}
                                    placeholder='Nh·∫≠p email h·ª£p l·ªá'
                                />
                                {errors.email && <span className="text-red-500 text-sm mt-1">{errors.email}</span>}
                            </div>
                        </div>

                        <div className='w-full'>
                            <label htmlFor="password" className="block text-xl font-medium text-black mb-2">
                                M·∫¨T KH·∫®U
                            </label>
                            <div className="flex flex-col">
                                <input
                                    id="password"
                                    name="password"
                                    type={showPassword ? "text" : "password"}
                                    required
                                    disabled={loading}
                                    className="w-full h-12 placeholder-gray-500 px-3 py-2 border-b-2 border-b-[#898989] bg-[#F5F5F5]
                                    focus:bg-white focus:outline-none focus:ring-1 focus:ring-offset-2 focus:ring-black
                                    disabled:opacity-50 disabled:cursor-not-allowed"
                                    value={formData.password}
                                    onChange={handleChange}
                                    placeholder='Nh·∫≠p m·∫≠t kh·∫©u'
                                />
                                {errors.password && <span className="text-red-500 text-sm mt-1">{errors.password}</span>}
                            </div>
                        </div>

                        <div className="flex items-center">
                            <input
                                id="showPassword"
                                name="showPassword"
                                type="checkbox"
                                checked={showPassword}
                                onChange={() => setShowPassword(!showPassword)}
                                className="h-5 w-5 accent-black border-[#FFFFFF]"
                            />
                            <label htmlFor="showPassword" className="ml-2 block text-[16px] text-gray-700">
                                Hi·ªán m·∫≠t kh·∫©u
                            </label>
                        </div>

                        <div className='flex flex-col gap-2'>
                            <button
                                type="submit"
                                disabled={loading}
                                className="w-full flex justify-center py-[10px] px-25 border border-transparent text-[20px] font-medium text-white bg-black hover:bg-[#404040] cursor-pointer disabled:opacity-50 disabled:cursor-not-allowed"
                            >
                                {loading ? 'ƒêang ƒëƒÉng nh·∫≠p...' : 'ƒêƒÇNG NH·∫¨P'}
                            </button>

                            <Link to="/forgot-password" className="block text-[16px] font-medium text-black hover:text-[#444444]">
                                Qu√™n m·∫≠t kh·∫©u?
                            </Link>
                        </div>
                        <div className='w-full'>
                            <div className="relative mb-2">
                                <div className="absolute inset-0 flex items-center">
                                    <div className="w-full border-t border-gray-300" />
                                </div>
                                <div className="relative flex justify-center text-sm">
                                    <span className="px-2 bg-white text-gray-500">Ho·∫∑c ƒëƒÉng nh·∫≠p v·ªõi</span>
                                </div>
                            </div>

                            <div className="grid grid-cols-2 gap-3">
                                <button
                                    type="button"
                                    onClick={handleGoogleLogin}
                                    disabled={loading}
                                    className="flex items-center justify-center px-4 py-[10px] border border-gray-300 text-[20px] font-medium text-gray-700 bg-white hover:bg-gray-100 disabled:opacity-50 disabled:cursor-not-allowed"
                                >
                                    <FcGoogle className="h-5 w-5 mr-2" />
                                    Google
                                </button>

                            </div>
                        </div>
                    </form>
                </div>

                <div className="w-[1px] my-[50px] bg-[#DCDCDC]"></div>

                <div className="flex flex-col flex-1 items-start">
                    <h2 className="mb-5 text-3xl font-semibold text-black">
                        T·∫†O M·ªòT T√ÄI KHO·∫¢N
                    </h2>
                    <p className="mb-4 text-base text-black">
                        H√£y t·∫°o t√†i kho·∫£n ngay ! B·∫°n c√≥ th·ªÉ nh·∫≠n ƒë∆∞·ª£c c√°c d·ªãch v·ª• ƒë·∫∑c bi·ªát cho
                        ri√™ng b·∫°n nh∆∞ ki·ªÉm tra l·ªãch s·ª≠ mua h√†ng v√† nh·∫≠n phi·∫øu gi·∫£m gi√° cho th√†nh
                        vi√™n. ƒêƒÉng k√Ω mi·ªÖn ph√≠ ngay h√¥m nay!
                    </p>
                    <Link to="/signup">
                        <button className="flex justify-center py-[10px] px-25 text-[20px] font-medium text-black border-2 border-black border-solid cursor-pointer hover:text-[#404040] hover:border-[#404040]">
                            T·∫†O T√ÄI KHO·∫¢N
                        </button>
                    </Link>
                </div>
            </div>
        </div>
    )
}

export default Login

===== FILE: ./frontend/src/pages/Policy.jsx =====
import React from "react";

const Policy = () => {
  return (
    <div className="max-w-4xl mx-auto px-4 py-10">
      <h1 className="text-4xl font-bold mb-8">Ch√≠nh s√°ch ƒë·ªïi tr·∫£</h1>
      <div className="border p-6 bg-white text-black text-base rounded">
        <p>
          Ch√∫ng t√¥i cam k·∫øt mang ƒë·∫øn tr·∫£i nghi·ªám mua s·∫Øm t·ªët nh·∫•t cho kh√°ch
          h√†ng. N·∫øu s·∫£n ph·∫©m kh√¥ng ph√π h·ª£p, qu√Ω kh√°ch c√≥ th·ªÉ ƒë·ªïi/tr·∫£ theo c√°c
          ƒëi·ªÅu ki·ªán d∆∞·ªõi ƒë√¢y.
        </p>
        <ol className="list-decimal ml-6 mt-4 space-y-2">
          <li>
            <b>ƒêi·ªÅu ki·ªán √°p d·ª•ng ƒë·ªïi/tr·∫£</b>
            <ul className="list-disc ml-6 mt-1">
              <li>
                S·∫£n ph·∫©m ch∆∞a qua s·ª≠ d·ª•ng, ch∆∞a gi·∫∑t ·ªßi, c√≤n nguy√™n tem m√°c,
                nguy√™n ki·ªán bao b√¨ nh∆∞ ban ƒë·∫ßu.
              </li>
              <li>
                S·∫£n ph·∫©m kh√¥ng b·ªã d∆° b·∫©n, kh√¥ng c√≥ m√πi l·∫°, kh√¥ng b·ªã r√°ch ho·∫∑c h∆∞
                h·ªèng do t√°c ƒë·ªông t·ª´ kh√°ch h√†ng.
              </li>
              <li>C√≥ h√≥a ƒë∆°n mua h√†ng ho·∫∑c b·∫±ng ch·ª©ng giao d·ªãch h·ª£p l·ªá.</li>
              <li>
                √Åp d·ª•ng cho s·∫£n ph·∫©m mua t·∫°i Luon VuiTuoi, kh√¥ng √°p d·ª•ng cho s·∫£n
                ph·∫©m t·ª´ b√™n th·ª© ba ho·∫∑c nh√† b√°n h√†ng kh√°c.
              </li>
            </ul>
          </li>
          <li>
            <b>H√¨nh th·ª©c ƒë·ªïi/tr·∫£</b>
            <ul className="list-disc ml-6 mt-1">
              <li>
                <b>ƒê·ªïi h√†ng:</b> ƒê∆∞·ª£c ƒë·ªïi sang s·∫£n ph·∫©m kh√°c c√πng lo·∫°i (m√†u s·∫Øc,
                k√≠ch c·ª°) ho·∫∑c s·∫£n ph·∫©m kh√°c c√≥ gi√° tr·ªã t∆∞∆°ng ƒë∆∞∆°ng ho·∫∑c cao h∆°n
                (b√π ph·∫ßn ch√™nh l·ªách).
              </li>
              <li>
                <b>Tr·∫£ h√†ng & ho√†n ti·ªÅn:</b>
                <ul className="list-disc ml-6 mt-1">
                  <li>
                    Ch·ªâ √°p d·ª•ng khi s·∫£n ph·∫©m b·ªã l·ªói t·ª´ nh√† s·∫£n xu·∫•t ho·∫∑c giao
                    sai h√†ng.
                  </li>
                  <li>
                    Ti·ªÅn ho√†n tr·∫£ qua chuy·ªÉn kho·∫£n ng√¢n h√†ng ho·∫∑c voucher mua
                    s·∫Øm trong v√≤ng 07 ng√†y sau khi x√°c nh·∫≠n s·∫£n ph·∫©m h·ª£p l·ªá.
                  </li>
                </ul>
              </li>
            </ul>
          </li>
          <li>
            <b>Quy tr√¨nh ƒë·ªïi/tr·∫£</b>
            <ul className="list-disc ml-6 mt-1">
              <li>
                Li√™n h·ªá v·ªõi b·ªô ph·∫≠n chƒÉm s√≥c kh√°ch h√†ng qua hotline: 0901 234
                567 ho·∫∑c email: support@luonvuituoi.com ƒë·ªÉ g·ª≠i y√™u c·∫ßu ƒë·ªïi/tr·∫£.
              </li>
              <li>
                ƒê√≥ng g√≥i s·∫£n ph·∫©m v√† g·ª≠i v·ªÅ ƒë·ªãa ch·ªâ 123 ƒê∆∞·ªùng ABC, TP. HCM ho·∫∑c
                c·ª≠a h√†ng g·∫ßn nh·∫•t theo h∆∞·ªõng d·∫´n.
              </li>
              <li>
                Ch√∫ng t√¥i ki·ªÉm tra s·∫£n ph·∫©m v√† x·ª≠ l√Ω ƒë·ªïi/tr·∫£ trong v√≤ng 3 - 5
                ng√†y l√†m vi·ªác.
              </li>
            </ul>
          </li>
          <li>
            <b>S·∫£n ph·∫©m kh√¥ng √°p d·ª•ng ƒë·ªïi/tr·∫£</b>
            <ul className="list-disc ml-6 mt-1">
              <li>
                S·∫£n ph·∫©m thu·ªôc danh m·ª•c ƒë·ªì l√≥t, ƒë·ªì b∆°i, t·∫•t/v·ªõ, ho·∫∑c c√°c s·∫£n
                ph·∫©m gi·∫£m gi√° ƒë·∫∑c bi·ªát.
              </li>
              <li>
                S·∫£n ph·∫©m ƒë√£ qua s·ª≠ d·ª•ng, gi·∫∑t ·ªßi, b·ªã r√°ch, b·ªã h∆∞ h·ªèng do kh√°ch
                h√†ng.
              </li>
              <li>
                S·∫£n ph·∫©m kh√¥ng c√≥ h√≥a ƒë∆°n ho·∫∑c b·∫±ng ch·ª©ng mua h√†ng h·ª£p l·ªá.
              </li>
            </ul>
          </li>
          <li>
            <b>Chi ph√≠ ƒë·ªïi/tr·∫£</b>
            <ul className="list-disc ml-6 mt-1">
              <li>
                N·∫øu ƒë·ªïi/tr·∫£ do l·ªói nh√† s·∫£n xu·∫•t ho·∫∑c sai s√≥t trong ƒë∆°n h√†ng,
                ch√∫ng t√¥i s·∫Ω h·ªó tr·ª£ to√†n b·ªô chi ph√≠ v·∫≠n chuy·ªÉn.
              </li>
              <li>
                N·∫øu kh√°ch h√†ng ch·ªß ƒë·ªông mu·ªën ƒë·ªïi √Ω, kh√°ch h√†ng s·∫Ω t·ª± ch·ªãu chi
                ph√≠ v·∫≠n chuy·ªÉn.
              </li>
            </ul>
          </li>
        </ol>
      </div>
    </div>
  );
};

export default Policy;


===== FILE: ./frontend/src/pages/Signup.jsx =====
import React, { useState, useEffect } from 'react';
import { useNavigate } from 'react-router-dom';
import { useDispatch, useSelector } from 'react-redux';
import { registerUser, clearError, clearSuccess } from '../redux/slices/authSlice';
import { toast } from 'sonner';

const Signup = () => {
    const [formData, setFormData] = useState({
        name: '',
        email: '',
        password: '',
        birth: '',
        gender: '',
        agreeToTerms: false
    });

    const [showPassword, setShowPassword] = useState(false);
    const [errors, setErrors] = useState({});

    const dispatch = useDispatch();
    const navigate = useNavigate();

    const { loading, error, success, userInfo } = useSelector((state) => state.auth);

    // Redirect to home if already logged in
    useEffect(() => {
        if (userInfo) {
            navigate('/', { replace: true });
        }
    }, [userInfo, navigate]);

    // Handle navigation after successful registration
    useEffect(() => {
        if (success && userInfo) {
            toast.success('ƒêƒÉng k√Ω th√†nh c√¥ng!');
            dispatch(clearSuccess());
            navigate('/');
        }
    }, [success, userInfo, navigate, dispatch]);

    // Handle error display
    useEffect(() => {
        if (error) {
            toast.error(error);
            dispatch(clearError());
        }
    }, [error, dispatch]);

    const validateForm = () => {
        const newErrors = {};

        // Name validation
        if (!formData.name) {
            newErrors.name = 'Vui l√≤ng nh·∫≠p h·ªç t√™n';
        }

        // Email validation
        if (!formData.email) {
            newErrors.email = 'Vui l√≤ng nh·∫≠p ƒë·ªãa ch·ªâ email';
        } else if (!/\S+@\S+\.\S+/.test(formData.email)) {
            newErrors.email = 'Email kh√¥ng h·ª£p l·ªá';
        }

        // Password validation
        if (!formData.password) {
            newErrors.password = 'Vui l√≤ng nh·∫≠p m·∫≠t kh·∫©u';
        } else if (formData.password.length < 6) {
            newErrors.password = 'M·∫≠t kh·∫©u ph·∫£i c√≥ √≠t nh·∫•t 6 k√Ω t·ª±';
        }

        // Birth date validation
        if (!formData.birth) {
            newErrors.birth = 'Vui l√≤ng ch·ªçn ng√†y sinh';
        }

        // Gender validation
        if (!formData.gender) {
            newErrors.gender = 'Vui l√≤ng ch·ªçn gi·ªõi t√≠nh';
        }

        // Terms agreement validation
        if (!formData.agreeToTerms) {
            newErrors.agreeToTerms = 'Vui l√≤ng ƒë·ªìng √Ω v·ªõi ƒëi·ªÅu kho·∫£n s·ª≠ d·ª•ng';
        }

        setErrors(newErrors);
        return Object.keys(newErrors).length === 0;
    };

    const handleChange = (e) => {
        const { name, value, type, checked } = e.target;
        setFormData(prev => ({
            ...prev,
            [name]: type === 'checkbox' ? checked : value
        }));
        // Clear error for this field
        if (errors[name]) {
            setErrors(prev => ({
                ...prev,
                [name]: ''
            }));
        }
    };

    const handleSubmit = async (e) => {
        e.preventDefault();

        if (validateForm()) {
            dispatch(registerUser({
                name: formData.name,
                email: formData.email,
                password: formData.password,
                gender: formData.gender,
                birth: formData.birth
            }));
        }
    };

    return (
        <div className="ml-24 mt-12 mb-36">
            <h2 className="text-3xl font-medium text-black mb-16">T·∫†O M·ªòT T√ÄI KHO·∫¢N</h2>
            <form onSubmit={handleSubmit} noValidate className="flex flex-col gap-6 items-start border border-[#DCDCDC] p-5 w-[55%]">
                <p className='w-3/4'>Ch√∫ng t√¥i s·∫Ω g·ª≠i th∆∞ x√°c nh·∫≠n ƒë·∫øn ƒë·ªãa ch·ªâ email ƒë∆∞·ª£c li√™n k·∫øt v·ªõi t√†i kho·∫£n c·ªßa b·∫°n. H√£y ki·ªÉm tra email ƒë·∫øn t·ª´ ch√∫ng t√¥i.</p>

                {/* Name */}
                <div className="flex items-baseline gap-5 w-full">
                    <label htmlFor="name" className="w-1/4 text-xl font-medium text-black">
                        H·ªå T√äN
                    </label>
                    <div className="w-3/4 flex flex-col">
                        <input
                            id="name"
                            name="name"
                            type="text"
                            value={formData.name}
                            onChange={handleChange}
                            required
                            disabled={loading}
                            placeholder="Nh·∫≠p h·ªç t√™n"
                            className="w-full h-12 px-3 py-2 border-b-2 border-b-[#898989] bg-[#F5F5F5] placeholder-gray-500 focus:outline-none focus:ring-1 focus:ring-offset-2 focus:ring-black disabled:opacity-50"
                        />
                        {errors.name && <span className="text-red-500 text-sm mt-1">{errors.name}</span>}
                    </div>
                </div>

                {/* Email */}
                <div className="flex items-baseline gap-5 w-full">
                    <label htmlFor="email" className="w-1/4 text-xl font-medium text-black">
                        ƒê·ªäA CH·ªà EMAIL
                    </label>
                    <div className="w-3/4 flex flex-col">
                        <input
                            id="email"
                            name="email"
                            type="email"
                            value={formData.email}
                            onChange={handleChange}
                            required
                            disabled={loading}
                            placeholder="Nh·∫≠p email h·ª£p l·ªá"
                            className="w-full h-12 px-3 py-2 border-b-2 border-b-[#898989] bg-[#F5F5F5] placeholder-gray-500 focus:outline-none focus:ring-1 focus:ring-offset-2 focus:ring-black disabled:opacity-50"
                        />
                        {errors.email && <span className="text-red-500 text-sm mt-1">{errors.email}</span>}
                    </div>
                </div>

                {/* Password */}
                <div className="flex items-baseline gap-5 w-full">
                    <label htmlFor="password" className="w-1/4 text-xl font-medium text-black">
                        M·∫¨T KH·∫®U
                    </label>
                    <div className="w-3/4 flex flex-col">
                        <input
                            id="password"
                            name="password"
                            type={showPassword ? "text" : "password"}
                            value={formData.password}
                            onChange={handleChange}
                            required
                            disabled={loading}
                            placeholder="Nh·∫≠p m·∫≠t kh·∫©u"
                            className="w-full h-12 px-3 py-2 border-b-2 border-b-[#898989] bg-[#F5F5F5] placeholder-gray-500 focus:outline-none focus:ring-1 focus:ring-offset-2 focus:ring-black disabled:opacity-50"
                        />
                        {errors.password && <span className="text-red-500 text-sm mt-1">{errors.password}</span>}
                    </div>
                </div>

                <div className="flex items-center">
                    <input
                        id="showPassword"
                        name="showPassword"
                        type="checkbox"
                        checked={showPassword}
                        onChange={() => setShowPassword(!showPassword)}
                        className="h-5 w-5 accent-black border-[#FFFFFF]"
                    />
                    <label htmlFor="showPassword" className="ml-2 block text-[16px] text-gray-700">
                        Hi·ªán m·∫≠t kh·∫©u
                    </label>
                </div>

                {/* Birth Date */}
                <div className="flex items-baseline gap-5 w-full">
                    <label htmlFor="birth" className="w-1/4 text-xl font-medium text-black">
                        NG√ÄY SINH
                    </label>
                    <div className="w-3/4 flex flex-col">
                        <input
                            id="birth"
                            name="birth"
                            type="date"
                            value={formData.birth}
                            onChange={handleChange}
                            required
                            disabled={loading}
                            className="w-full h-12 px-3 py-2 border-b-2 border-b-[#898989] bg-[#F5F5F5] placeholder-gray-500 focus:outline-none focus:ring-1 focus:ring-offset-2 focus:ring-black disabled:opacity-50"
                        />
                        {errors.birth && <span className="text-red-500 text-sm mt-1">{errors.birth}</span>}
                    </div>
                </div>

                {/* Gender */}
                <div className="flex items-center gap-5 w-full">
                    <label className="w-1/4 text-xl font-medium text-black">
                        GI·ªöI T√çNH
                    </label>
                    <div className="w-3/4 flex gap-10">
                        <label className="flex items-center">
                            <input
                                type="radio"
                                name="gender"
                                value="male"
                                checked={formData.gender === 'male'}
                                onChange={handleChange}
                                disabled={loading}
                                className="h-5 w-5 accent-black"
                            />
                            <span className="ml-2">Nam</span>
                        </label>
                        <label className="flex items-center">
                            <input
                                type="radio"
                                name="gender"
                                value="female"
                                checked={formData.gender === 'female'}
                                onChange={handleChange}
                                disabled={loading}
                                className="h-5 w-5 accent-black"
                            />
                            <span className="ml-2">N·ªØ</span>
                        </label>
                        <label className="flex items-center">
                            <input
                                type="radio"
                                name="gender"
                                value="other"
                                checked={formData.gender === 'other'}
                                onChange={handleChange}
                                disabled={loading}
                                className="h-5 w-5 accent-black"
                            />
                            <span className="ml-2">B·ªè qua</span>
                        </label>
                        {errors.gender && <span className="text-red-500 text-sm">{errors.gender}</span>}
                    </div>
                </div>

                {/* Terms Agreement */}
                <div className="flex items-center">
                    <div className="flex items-center">
                        <input
                            id="agreeToTerms"
                            name="agreeToTerms"
                            type="checkbox"
                            checked={formData.agreeToTerms}
                            onChange={handleChange}
                            disabled={loading}
                            className="h-5 w-5 accent-black border-[#FFFFFF]"
                        />
                        <label htmlFor="agreeToTerms" className="ml-2 block text-[16px] text-gray-700">
                            T√¥i ƒë·ªìng √Ω v·ªõi ƒêI·ªÄU KHO·∫¢N S·ª¨ D·ª§NG v√† CH√çNH S√ÅCH B·∫¢O M·∫¨T c·ªßa Wukudada.
                        </label>
                    </div>
                </div>
                {errors.agreeToTerms && <span className="text-red-500 text-sm">{errors.agreeToTerms}</span>}

                {/* Submit */}
                <button
                    type="submit"
                    disabled={loading}
                    className="flex justify-center py-[10px] px-25 border border-transparent text-[20px] font-medium text-white bg-black hover:bg-[#404040] cursor-pointer disabled:opacity-50 disabled:cursor-not-allowed"
                >
                    {loading ? 'ƒêang x·ª≠ l√Ω...' : 'ƒêƒÇNG K√ù'}
                </button>
            </form>
        </div>
    )
}

export default Signup

===== FILE: ./frontend/src/redux/slices/adminOrderSlice.js =====
import { createAsyncThunk, createSlice } from '@reduxjs/toolkit';
import axios from 'axios';

// Fetch all orders (admin only)
export const fetchAllOrders = createAsyncThunk(
    'adminOrder/fetchAllOrders',
    async (_, { rejectWithValue }) => {
        try {
            const response = await axios.get(`${import.meta.env.VITE_API_URL}/api/admin/orders`, {
                headers: {
                    Authorization: `Bearer ${localStorage.getItem('token')}`
                }
            });
            return response.data;
        } catch (error) {
            console.error("Error fetching orders:", error);
            return rejectWithValue(error.response?.data || error.message || 'Unknown error');
        }
    }
);

// Fetch order details by order ID (admin only)
export const fetchOrderDetails = createAsyncThunk(
    'adminOrder/fetchOrderDetails',
    async ({ orderId }, { rejectWithValue }) => {
        try {
            const response = await axios.get(`${import.meta.env.VITE_API_URL}/api/admin/orders/${orderId}`, {
                headers: {
                    Authorization: `Bearer ${localStorage.getItem('token')}`
                }
            });
            return response.data;
        } catch (error) {
            console.error("Error fetching order details:", error);
            return rejectWithValue(error.response?.data || error.message || 'Unknown error');
        }
    }
);
// Update order status (admin only)
export const updateOrderStatus = createAsyncThunk(
    'adminOrder/updateOrderStatus',
    async ({ orderId, status }, { rejectWithValue }) => {
        try {
            const response = await axios.put(`${import.meta.env.VITE_API_URL}/api/admin/orders/${orderId}`, { status }, {
                headers: {
                    Authorization: `Bearer ${localStorage.getItem('token')}`
                }
            });
            return response.data;
        } catch (error) {
            console.error("Error updating order status:", error);
            return rejectWithValue(error.response?.data || error.message || 'Unknown error');
        }
    }
);
// Delete an order (admin only)
export const deleteOrder = createAsyncThunk(
    'adminOrder/deleteOrder',
    async ({ orderId }, { rejectWithValue }) => {
        try {
            const response = await axios.delete(`${import.meta.env.VITE_API_URL}/api/admin/orders/${orderId}`, {
                headers: {
                    Authorization: `Bearer ${localStorage.getItem('token')}`
                }
            });
            return response.data;
        } catch (error) {
            console.error("Error deleting order:", error);
            return rejectWithValue(error.response?.data || error.message || 'Unknown error');
        }
    }
);

// Admin order slice
const adminOrderSlice = createSlice({
    name: 'adminOrder',
    initialState: {
        orders: [],
        orderDetails: null,
        loading: false,
        error: null,
    },
    reducers: {},
    extraReducers: (builder) => {
        builder
            .addCase(fetchAllOrders.pending, (state) => {
                state.loading = true;
                state.error = null;
            })
            .addCase(fetchAllOrders.fulfilled, (state, action) => {
                state.loading = false;
                state.orders = action.payload;
            })
            .addCase(fetchAllOrders.rejected, (state, action) => {
                state.loading = false;
                state.error = action.payload || 'Failed to fetch orders';
            })
            .addCase(fetchOrderDetails.pending, (state) => {
                state.loading = true;
                state.error = null;
            })
            .addCase(fetchOrderDetails.fulfilled, (state, action) => {
                state.loading = false;
                state.orderDetails = action.payload;
            })
            .addCase(fetchOrderDetails.rejected, (state, action) => {
                state.loading = false;
                state.error = action.payload || 'Failed to fetch order details';
            })
            .addCase(updateOrderStatus.pending, (state) => {
                state.loading = true;
                state.error = null;
            })
            .addCase(updateOrderStatus.fulfilled, (state, action) => {
                state.loading = false;
                const updatedOrderIndex = state.orders.findIndex(order => order._id === action.payload._id);
                if (updatedOrderIndex !== -1) {
                    state.orders[updatedOrderIndex] = action.payload;
                }
            })
            .addCase(updateOrderStatus.rejected, (state, action) => {
                state.loading = false;
                state.error = action.payload || 'Failed to update order status';
            })
            .addCase(deleteOrder.pending, (state) => {
                state.loading = true;
                state.error = null;
            })
            .addCase(deleteOrder.fulfilled, (state, action) => {
                state.loading = false;
                const deletedOrderId = action.payload._id;
                state.orders = state.orders.filter(order => order._id !== deletedOrderId);
            })
            .addCase(deleteOrder.rejected, (state, action) => {
                state.loading = false;
                state.error = action.payload || 'Failed to delete order';
            });
    }
});
export default adminOrderSlice.reducer;

===== FILE: ./frontend/src/redux/slices/adminProductSlice.js =====
import { createAsyncThunk, createSlice } from '@reduxjs/toolkit';
import axios from 'axios';

// Async thunk to fetch all products (admin only)
export const fetchAllProducts = createAsyncThunk(
    'adminProduct/fetchAllProducts',
    async (_, { rejectWithValue }) => {
        try {
            const response = await axios.get(`${import.meta.env.VITE_API_URL}/api/admin/products`, {
                headers: {
                    Authorization: `Bearer ${localStorage.getItem('token')}`
                }
            });
            return response.data;
        } catch (error) {
            console.error("Error fetching products:", error);
            return rejectWithValue(error.response?.data || error.message || 'Unknown error');
        }
    }
);

// Async function to create a new product (admin only)
export const createProduct = createAsyncThunk(
    'adminProduct/createProduct',
    async (productData, { rejectWithValue }) => {
        try {
            const response = await axios.post(`${import.meta.env.VITE_API_URL}/api/admin/products`, productData, {
                headers: {
                    Authorization: `Bearer ${localStorage.getItem('token')}`
                }
            });
            return response.data;
        } catch (error) {
            console.error("Error creating product:", error);
            return rejectWithValue(error.response?.data || error.message || 'Unknown error');
        }
    }
);

// Async function to update an existing product (admin only)
export const updateProduct = createAsyncThunk(
    'adminProduct/updateProduct',
    async ({ id, productData }, { rejectWithValue }) => {
        try {
            const response = await axios.put(`${import.meta.env.VITE_API_URL}/api/admin/products/${id}`, productData, {
                headers: {
                    Authorization: `Bearer ${localStorage.getItem('token')}`
                }
            });
            return response.data;
        } catch (error) {
            console.error("Error updating product:", error);
            return rejectWithValue(error.response?.data || error.message || 'Unknown error');
        }
    }
);

// Async function to delete a product (admin only)
export const deleteProduct = createAsyncThunk(
    'adminProduct/deleteProduct',
    async (id, { rejectWithValue }) => {
        try {
            const response = await axios.delete(`${import.meta.env.VITE_API_URL}/api/admin/products/${id}`, {
                headers: {
                    Authorization: `Bearer ${localStorage.getItem('token')}`
                }
            });
            return response.data;
        } catch (error) {
            console.error("Error deleting product:", error);
            return rejectWithValue(error.response?.data || error.message || 'Unknown error');
        }
    }
);

const adminProductSlice = createSlice({
    name: 'adminProduct',
    initialState: {
        products: [],
        loading: false,
        error: null,
    },
    reducers: {},
    extraReducers: (builder) => {
        builder
            .addCase(fetchAllProducts.pending, (state) => {
                state.loading = true;
                state.error = null;
            })
            .addCase(fetchAllProducts.fulfilled, (state, action) => {
                state.loading = false;
                state.products = action.payload;
            })
            .addCase(fetchAllProducts.rejected, (state, action) => {
                state.loading = false;
                state.error = action.payload || 'Failed to fetch products';
            })
            .addCase(createProduct.pending, (state) => {
                state.loading = true;
                state.error = null;
            })
            .addCase(createProduct.fulfilled, (state, action) => {
                state.loading = false;
                state.products.push(action.payload);
            })
            .addCase(createProduct.rejected, (state, action) => {
                state.loading = false;
                state.error = action.payload || 'Failed to create product';
            })
            .addCase(updateProduct.pending, (state) => {
                state.loading = true;
                state.error = null;
            })
            .addCase(updateProduct.fulfilled, (state, action) => {
                state.loading = false;
                const index = state.products.findIndex(product => product.id === action.payload.id);
                if (index !== -1) {
                    state.products[index] = action.payload;
                }
            })
            .addCase(updateProduct.rejected, (state, action) => {
                state.loading = false;
                state.error = action.payload || 'Failed to update product';
            })
            .addCase(deleteProduct.pending, (state) => {
                state.loading = true;
                state.error = null;
            })
            .addCase(deleteProduct.fulfilled, (state, action) => {
                state.loading = false;
                const index = state.products.findIndex(product => product.id === action.payload.id);
                if (index !== -1) {
                    state.products.splice(index, 1);
                }
            })
            .addCase(deleteProduct.rejected, (state, action) => {
                state.loading = false;
                state.error = action.payload || 'Failed to delete product';
            });
    },
});

export default adminProductSlice.reducer;

===== FILE: ./frontend/src/redux/slices/adminSlice.js =====
import { createSlice, createAsyncThunk } from '@reduxjs/toolkit';
import axios from 'axios';

// fetch all users (admin only)
export const fetchAllUsers = createAsyncThunk(
    'admin/fetchAllUsers',
    async () => {
        try {
            const response = await axios.get(`${import.meta.env.VITE_API_URL}/api/admin/users`, {
                headers: {
                    Authorization: `Bearer ${localStorage.getItem('token')}`
                }
            });
            return response.data;
        } catch (error) {
            console.error("Error fetching users:", error);
            throw error;
        }
    }
);

// Add a new user (admin only)
export const addUser = createAsyncThunk(
    'admin/addUser',
    async (userData) => {
        try {
            const response = await axios.post(`${import.meta.env.VITE_API_URL}/api/admin/users`, userData, {
                headers: {
                    Authorization: `Bearer ${localStorage.getItem('token')}`
                }
            });
            return response.data;
        } catch (error) {
            console.error("Error adding user:", error);
            throw error;
        }
    }
);

// Update user details (admin only)
export const updateUser = createAsyncThunk(
    'admin/updateUser',
    async ({ id, name, email, role }) => {
        try {
            const response = await axios.put(
                `${import.meta.env.VITE_API_URL}/api/admin/users/${id}`,
                { name, email, role },
                {
                    headers: {
                        Authorization: `Bearer ${localStorage.getItem('token')}`
                    }
                }
            );
            return response.data;
        } catch (error) {
            console.error("Error updating user:", error);
            throw error;
        }
    }
);

// Delete a user (admin only)
export const deleteUser = createAsyncThunk(
    'admin/deleteUser',
    async (userId) => {
        try {
            const response = await axios.delete(`${import.meta.env.VITE_API_URL}/api/admin/users/${userId}`, {
                headers: {
                    Authorization: `Bearer ${localStorage.getItem('token')}`
                }
            });
            return response.data;
        } catch (error) {
            console.error("Error deleting user:", error);
            throw error;
        }
    }
);

const adminSlice = createSlice({
    name: 'admin',
    initialState: {
        users: [],
        loading: false,
        error: null,
    },
    reducers: {},
    extraReducers: (builder) => {
        builder
            .addCase(fetchAllUsers.pending, (state) => {
                state.loading = true;
                state.error = null;
            })
            .addCase(fetchAllUsers.fulfilled, (state, action) => {
                state.loading = false;
                state.users = action.payload;
            })
            .addCase(fetchAllUsers.rejected, (state, action) => {
                state.loading = false;
                state.error = action.error.message || 'Failed to fetch users';
            })
            .addCase(addUser.pending, (state) => {
                state.loading = true;
                state.error = null;
            })
            .addCase(addUser.fulfilled, (state, action) => {
                state.loading = false;
                state.users.push(action.payload);
            })
            .addCase(addUser.rejected, (state, action) => {
                state.loading = false;
                state.error = action.error.message || 'Failed to add user';
            })
            .addCase(updateUser.pending, (state) => {
                state.loading = true;
                state.error = null;
            })
            .addCase(updateUser.fulfilled, (state, action) => {
                state.loading = false;
                const index = state.users.findIndex(user => user.id === action.payload.id);
                if (index !== -1) {
                    state.users[index] = action.payload;
                }
            })
            .addCase(updateUser.rejected, (state, action) => {
                state.loading = false;
                state.error = action.error.message || 'Failed to update user';
            })
            .addCase(deleteUser.pending, (state) => {
                state.loading = true;
                state.error = null;
            })
            .addCase(deleteUser.fulfilled, (state, action) => {
                state.loading = false;
                const userId = action.meta.arg;
                const index = state.users.findIndex(user => user.id === userId);
                if (index !== -1) {
                    state.users.splice(index, 1);
                }
            })
            .addCase(deleteUser.rejected, (state, action) => {
                state.loading = false;
                state.error = action.error.message || 'Failed to delete user';
            });
    },
});
export default adminSlice.reducer;

===== FILE: ./frontend/src/redux/slices/authSlice.js =====
import { createSlice, createAsyncThunk } from "@reduxjs/toolkit";
import axios from "axios";

// Base URL for API
const API_URL = import.meta.env.VITE_BACKEND_URL || "http://localhost:9000";

// Retrieve user info and token from localStorage if available
const userFromStorage = localStorage.getItem("userInfo")
  ? JSON.parse(localStorage.getItem("userInfo"))
  : null;

const tokenFromStorage = localStorage.getItem("userToken") || null;

// Check for an existing token in localStorage or generate a new one
const initialGuestId =
  localStorage.getItem("guestId") ||
  `guest_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;
localStorage.setItem("guestId", initialGuestId);

// Initialize state with user info and guest ID
const initialState = {
  userInfo: userFromStorage,
  userToken: tokenFromStorage,
  guestId: initialGuestId,
  loading: false,
  error: null,
  success: false,
};

// Async thunk for user login
export const loginUser = createAsyncThunk(
  "auth/loginUser",
  async (userData, { rejectWithValue }) => {
    try {
      const config = {
        headers: {
          "Content-Type": "application/json",
        },
      };

      // ƒê√∫ng endpoint: /api/users/login
      const response = await axios.post(
        `${API_URL}/api/users/login`,
        userData,
        config
      );

      // L∆∞u th√¥ng tin v√†o localStorage
      localStorage.setItem("userInfo", JSON.stringify(response.data.user));
      localStorage.setItem("userToken", response.data.token);

      return response.data; // Return c·∫£ user v√† token
    } catch (error) {
      // Handle error response
      if (error.response && error.response.data.message) {
        return rejectWithValue(error.response.data.message);
      } else {
        return rejectWithValue(error.message);
      }
    }
  }
);

export const logoutUser = createAsyncThunk(
  "auth/logoutUser",
  async (_, { rejectWithValue }) => {
    try {
      const token = localStorage.getItem("userToken") || localStorage.getItem("token");
      
      if (token) {
        // G·ªçi API logout backend
        await axios.post(
          `${API_URL}/api/users/logout`,
          {},
          {
            headers: {
              Authorization: `Bearer ${token}`,
              "Content-Type": "application/json",
            },
          }
        );
      }

      // X√≥a t·∫•t c·∫£ d·ªØ li·ªáu trong localStorage
      localStorage.removeItem("userInfo");
      localStorage.removeItem("userToken");
      localStorage.removeItem("token");
      localStorage.removeItem("cart");
      
      return { message: "ƒêƒÉng xu·∫•t th√†nh c√¥ng" };
    } catch (error) {
      // D√π c√≥ l·ªói API v·∫´n x√≥a localStorage
      localStorage.removeItem("userInfo");
      localStorage.removeItem("userToken");
      localStorage.removeItem("token");
      localStorage.removeItem("cart");
      
      console.error("Logout error:", error);
      return rejectWithValue(error.response?.data?.message || "L·ªói khi ƒëƒÉng xu·∫•t");
    }
  }
);

// Async thunk for user Registration
export const registerUser = createAsyncThunk(
  "auth/registerUser",
  async (userData, { rejectWithValue }) => {
    try {
      const config = {
        headers: {
          "Content-Type": "application/json",
        },
      };

      // ƒê√∫ng endpoint: /api/users/register
      const response = await axios.post(
        `${API_URL}/api/users/register`,
        userData,
        config
      );

      // L∆∞u th√¥ng tin v√†o localStorage
      localStorage.setItem("userInfo", JSON.stringify(response.data.user));
      localStorage.setItem("userToken", response.data.token);

      return response.data; // Return c·∫£ user v√† token
    } catch (error) {
      // Handle error response
      if (error.response && error.response.data.message) {
        return rejectWithValue(error.response.data.message);
      } else {
        return rejectWithValue(error.message);
      }
    }
  }
);

// Async thunk for getting user profile
export const getUserProfile = createAsyncThunk(
  "auth/getUserProfile",
  async (_, { getState, rejectWithValue }) => {
    try {
      const token = getState().auth.userToken;

      const config = {
        headers: {
          Authorization: `Bearer ${token}`,
        },
      };

      const response = await axios.get(`${API_URL}/api/users/profile`, config);

      return response.data;
    } catch (error) {
      if (error.response && error.response.data.message) {
        return rejectWithValue(error.response.data.message);
      } else {
        return rejectWithValue(error.message);
      }
    }
  }
);

// Slice
const authSlice = createSlice({
  name: "auth",
  initialState,
  reducers: {
    logout: (state) => {
      // Force clear t·∫•t c·∫£
      localStorage.removeItem("userInfo");
      localStorage.removeItem("userToken");
      localStorage.removeItem("token");
      localStorage.removeItem("cart");
      
      state.userInfo = null;
      state.userToken = null;
      state.loading = false;
      state.error = null;
      state.success = false;
      
      // Generate new guest ID on logout
      state.guestId = `guest_${Date.now()}_${Math.random()
        .toString(36)
        .substr(2, 9)}`;
      localStorage.setItem("guestId", state.guestId);
    },
    loginSuccess: (state, action) => {
      state.loading = false;
      state.userInfo = action.payload.userInfo;
      state.userToken = action.payload.userToken;
      state.success = true;
      state.error = null;
    },
    clearError: (state) => {
      state.error = null;
    },
    clearSuccess: (state) => {
      state.success = false;
    },
    generateNewGuestId: (state) => {
      state.guestId = `guest_${Date.now()}_${Math.random()
        .toString(36)
        .substr(2, 9)}`;
      localStorage.setItem("guestId", state.guestId);
    },
  },
  extraReducers: (builder) => {
    builder
      // Login cases
      .addCase(loginUser.pending, (state) => {
        state.loading = true;
        state.error = null;
        state.success = false;
      })
      .addCase(loginUser.fulfilled, (state, action) => {
        state.loading = false;
        state.userInfo = action.payload.user;
        state.userToken = action.payload.token;
        state.success = true;
        state.error = null;
        state.loading = false;
        // ƒê·∫£m b·∫£o sync localStorage
        localStorage.setItem("userInfo", JSON.stringify(action.payload.user));
        localStorage.setItem("userToken", action.payload.token);
      })
      .addCase(loginUser.rejected, (state, action) => {
        state.loading = false;
        state.error = action.payload;
        state.success = false;
      })
      // Register cases
      .addCase(registerUser.pending, (state) => {
        state.loading = true;
        state.error = null;
        state.success = false;
      })
      .addCase(registerUser.fulfilled, (state, action) => {
        state.loading = false;
        state.userInfo = action.payload.user;
        state.userToken = action.payload.token;
        state.success = true;
        state.error = null;
      })
      .addCase(registerUser.rejected, (state, action) => {
        state.loading = false;
        state.error = action.payload;
        state.success = false;
      })
      .addCase(logoutUser.pending, (state) => {
        state.loading = true;
        state.error = null;
      })
      .addCase(logoutUser.fulfilled, (state, action) => {
        state.loading = false;
        state.userInfo = null;
        state.userToken = null;
        state.error = null;
        state.success = false;
        
        // Generate new guest ID
        state.guestId = `guest_${Date.now()}_${Math.random()
          .toString(36)
          .substr(2, 9)}`;
        localStorage.setItem("guestId", state.guestId);
      })
      .addCase(logoutUser.rejected, (state, action) => {
        state.loading = false;
        // V·∫´n logout d√π c√≥ l·ªói
        state.userInfo = null;
        state.userToken = null;
        state.error = null;
        
        // Generate new guest ID
        state.guestId = `guest_${Date.now()}_${Math.random()
          .toString(36)
          .substr(2, 9)}`;
        localStorage.setItem("guestId", state.guestId);
      })
      // Get profile cases
      .addCase(getUserProfile.pending, (state) => {
        state.loading = true;
        state.error = null;
      })
      .addCase(getUserProfile.fulfilled, (state, action) => {
        state.loading = false;
        state.userInfo = action.payload;
        state.error = null;
        // L∆∞u l·∫°i userInfo v√†o localStorage ƒë·ªÉ ƒë·ªìng b·ªô khi reload
        localStorage.setItem("userInfo", JSON.stringify(action.payload));
      })
      .addCase(getUserProfile.rejected, (state, action) => {
        state.loading = false;
        state.error = action.payload;
      });
  },
});

export const { logout, clearError, clearSuccess, generateNewGuestId } =
  authSlice.actions;
export default authSlice.reducer;


===== FILE: ./frontend/src/redux/slices/cartSlice.js =====
import { createSlice, createAsyncThunk } from "@reduxjs/toolkit";
import axios from "axios";

const API_URL = import.meta.env.VITE_API_URL || "http://localhost:9000";

// Helper function to load cart from localStorage
const loadCartFromStorage = () => {
  const storedCart = localStorage.getItem("cart");
  return storedCart ? JSON.parse(storedCart) : { products: [] };
};

// Helper function to save cart to localStorage
const saveCartToStorage = (cart) => {
  localStorage.setItem("cart", JSON.stringify(cart));
};

// Fetch cart for a user or guest
export const fetchCart = createAsyncThunk(
  "cart/fetchCart",
  async ({ userId, guestId }, { rejectWithValue }) => {
    try {
      const response = await axios.get(`${API_URL}/api/cart`, {
        params: { userId, guestId },
      });
      return response.data;
    } catch (error) {
      if (error.response && error.response.status === 404) {
        // Kh√¥ng c√≥ cart, tr·∫£ v·ªÅ cart r·ªóng
        return { products: [] };
      }
      console.error("Error fetching cart:", error);
      return rejectWithValue(error.response?.data || error.message);
    }
  }
);

// Add an item to the cart for a user or guest
export const addToCart = createAsyncThunk(
  "cart/addToCart",
  async (
    { productId, quantity, size, color, guestId, userId },
    { rejectWithValue }
  ) => {
    try {
      const response = await axios.post(`${API_URL}/api/cart`, {
        productId,
        quantity,
        size,
        color,
        guestId,
        userId,
      });
      return response.data;
    } catch (error) {
      console.error("Error adding to cart:", error);
      return rejectWithValue(error.response?.data || error.message);
    }
  }
);

// Update the quantity of an item in the cart - S·ª¨A L·ªñI ·ªû ƒê√ÇY
export const updateCartItemQuantity = createAsyncThunk(
  "cart/updateCartItemQuantity",
  async (
    { productId, quantity, guestId, userId, size, color },
    { rejectWithValue }
  ) => {
    try {
      // S·ª¨A: S·ª≠ d·ª•ng ƒë√∫ng endpoint - b·ªè /${productId} ra kh·ªèi URL
      const response = await axios.put(`${API_URL}/api/cart`, {
        productId,
        quantity,
        guestId,
        userId,
        size,
        color,
      });
      return response.data;
    } catch (error) {
      console.error("Error updating cart item:", error);
      return rejectWithValue(error.response?.data || error.message);
    }
  }
);

// Remove an item from the cart
export const removeFromCart = createAsyncThunk(
  "cart/removeFromCart",
  async ({ productId, guestId, userId, size, color }, { rejectWithValue }) => {
    try {
      const response = await axios({
        method: "DELETE",
        url: `${API_URL}/api/cart`,
        data: {
          productId,
          guestId,
          userId,
          size,
          color,
        },
      });
      return response.data;
    } catch (error) {
      console.error("Error removing from cart:", error);
      return rejectWithValue(error.response?.data || error.message);
    }
  }
);

// Merge guest cart with user cart
export const mergeCart = createAsyncThunk(
  "cart/mergeCart",
  async ({ userId, guestId }, { rejectWithValue }) => {
    try {
      const response = await axios.post(
        `${API_URL}/api/cart/merge`,
        {
          userId,
          guestId,
        },
        {
          headers: {
            Authorization: `Bearer ${localStorage.getItem("token")}`,
          },
        }
      );
      return response.data;
    } catch (error) {
      console.error("Error merging cart:", error);
      return rejectWithValue(error.response?.data || error.message);
    }
  }
);

// Clear entire cart on server
export const clearCartServer = createAsyncThunk(
  "cart/clearCartServer",
  async ({ userId, guestId }, { rejectWithValue }) => {
    try {
      const response = await axios.delete(`${API_URL}/api/cart/clear`, {
        data: { userId, guestId },
      });
      // Tr·∫£ v·ªÅ cart r·ªóng
      return { products: [] };
    } catch (error) {
      console.error("Error clearing cart on server:", error);
      return rejectWithValue(error.response?.data || error.message);
    }
  }
);

const cartSlice = createSlice({
  name: "cart",
  initialState: {
    cart: loadCartFromStorage(),
    loading: false,
    error: null,
  },
  reducers: {
    clearCart: (state) => {
      state.cart = { products: [] };
      localStorage.removeItem("cart");
    },
  },
  extraReducers: (builder) => {
    builder
      .addCase(fetchCart.pending, (state) => {
        state.loading = true;
        state.error = null;
      })
      .addCase(fetchCart.fulfilled, (state, action) => {
        state.loading = false;
        state.cart = action.payload;
        saveCartToStorage(action.payload); // S·ª¨A: action.payload thay v√¨ state.payload
      })
      .addCase(fetchCart.rejected, (state, action) => {
        state.loading = false;
        state.error =
          action.payload?.message ||
          action.error.message ||
          "Failed to fetch cart";
      })

      .addCase(addToCart.pending, (state) => {
        state.loading = true;
        state.error = null;
      })
      .addCase(addToCart.fulfilled, (state, action) => {
        state.loading = false;
        state.cart = action.payload;
        saveCartToStorage(action.payload); // S·ª¨A: action.payload thay v√¨ state.payload
      })
      .addCase(addToCart.rejected, (state, action) => {
        state.loading = false;
        state.error = action.payload?.message || "Failed to add to cart";
      })

      .addCase(removeFromCart.pending, (state) => {
        state.loading = true;
        state.error = null;
      })
      .addCase(removeFromCart.fulfilled, (state, action) => {
        state.loading = false;
        state.cart = action.payload;
        saveCartToStorage(action.payload); // S·ª¨A: action.payload thay v√¨ state.payload
      })
      .addCase(removeFromCart.rejected, (state, action) => {
        state.loading = false;
        state.error = action.payload?.message || "Failed to remove from cart";
      })

      .addCase(mergeCart.pending, (state) => {
        state.loading = true;
        state.error = null;
      })
      .addCase(mergeCart.fulfilled, (state, action) => {
        state.loading = false;
        state.cart = action.payload.cart || action.payload; // S·ª¨A: X·ª≠ l√Ω c·∫£ hai tr∆∞·ªùng h·ª£p
        saveCartToStorage(state.cart);
      })
      .addCase(mergeCart.rejected, (state, action) => {
        state.loading = false;
        state.error = action.payload?.message || "Failed to merge cart";
      })

      .addCase(updateCartItemQuantity.pending, (state) => {
        state.loading = true;
        state.error = null;
      })
      .addCase(updateCartItemQuantity.fulfilled, (state, action) => {
        state.loading = false;
        state.cart = action.payload;
        saveCartToStorage(action.payload); // S·ª¨A: action.payload thay v√¨ state.payload
      })
      .addCase(updateCartItemQuantity.rejected, (state, action) => {
        state.loading = false;
        state.error =
          action.payload?.message || "Failed to update cart item quantity";
      })

      .addCase(clearCartServer.pending, (state) => {
        state.loading = true;
        state.error = null;
      })
      .addCase(clearCartServer.fulfilled, (state, action) => {
        state.loading = false;
        state.cart = { products: [] };
        localStorage.removeItem("cart");
      })
      .addCase(clearCartServer.rejected, (state, action) => {
        state.loading = false;
        state.error =
          action.payload?.message || "Failed to clear cart on server";
      });
  },
});

export const { clearCart } = cartSlice.actions;
export default cartSlice.reducer;


===== FILE: ./frontend/src/redux/slices/checkoutSlice.js =====
import { createSlice, createAsyncThunk } from "@reduxjs/toolkit";
import axios from "axios";

// Async thunk to create a checkout session
export const createCheckoutSession = createAsyncThunk(
  "checkout/createCheckoutSession",
  async (orderData, { rejectWithValue }) => {
    try {
      const response = await axios.post(
        `${import.meta.env.VITE_API_URL}/api/checkout`,
        orderData,
        {
          headers: {
            Authorization: `Bearer ${localStorage.getItem("userToken") || localStorage.getItem("token")}`,
          },
        }
      );
      return response.data;
    } catch (error) {
      console.error("Error creating order:", error);
      return rejectWithValue(
        error.response?.data?.message || error.message || "Unknown error"
      );
    }
  }
);

const checkoutSlice = createSlice({
  name: "checkout",
  initialState: {
    checkout: null,
    loading: false,
    error: null,
    sessionId: null,
    buyNowItem: null, // ‚úÖ th√™m bi·∫øn n√†y
  },

  reducers: {
    clearCheckout: (state) => {
      state.checkout = null;
      state.sessionId = null;
      state.error = null;
      state.buyNowItem = null; // ‚úÖ reset lu√¥n buyNowItem
    },
    setBuyNowItem: (state, action) => {
      state.buyNowItem = action.payload; // ‚úÖ th√™m setter
    },
  },

  extraReducers: (builder) => {
    builder
      .addCase(createCheckoutSession.pending, (state) => {
        state.loading = true;
        state.error = null;
      })
      .addCase(createCheckoutSession.fulfilled, (state, action) => {
        state.loading = false;
        state.checkout = action.payload;
        state.sessionId = action.payload._id;
      })
      .addCase(createCheckoutSession.rejected, (state, action) => {
        state.loading = false;
        state.error = action.payload || "Failed to create order";
      });
  },
});

// ‚úÖ Export ƒë·∫ßy ƒë·ªß c·∫£ 2 action
export const { clearCheckout, setBuyNowItem } = checkoutSlice.actions;

export default checkoutSlice.reducer;


===== FILE: ./frontend/src/redux/slices/orderSlice.js =====
import {createSlice, createAsyncThunk} from '@reduxjs/toolkit';
import axios from 'axios';

// Async thunk for fetching user orders
export const fetchUserOrders = createAsyncThunk(
    'order/fetchUserOrders',
    async ({userId}, {rejectWithValue}) => {
        try {
            const response = await axios.get(`${import.meta.env.VITE_API_URL}/api/orders`, {
                params: { userId },
                headers: {
                    Authorization: localStorage.getItem('token') ? `Bearer ${localStorage.getItem('token')}` : ''
                }
            });
            return response.data;
        } catch (error) {
            console.error("Error fetching user orders:", error);
            return rejectWithValue(error.response?.data || error.message || 'Unknown error');
        }
    }
);

// Async thunk for fetching order details by order ID
export const fetchOrderDetails = createAsyncThunk(
    'order/fetchOrderDetails',
    async ({orderId}, {rejectWithValue}) => {
        try {
            const response = await axios.get(`${import.meta.env.VITE_API_URL}/api/orders/${orderId}`, {
                headers: {
                    Authorization: `Bearer ${localStorage.getItem('token')}`
                }
            });
            return response.data;
        } catch (error) {
            console.error("Error fetching order details:", error);
            return rejectWithValue(error.response?.data || error.message || 'Unknown error');
        }
    }
);

const orderSlice = createSlice({
    name: 'order',
    initialState: {
        orders: [],
        orderDetails: null,
        totalOrders: 0,
        loading: false,
        error: null,
    },
    reducers: {},
    extraReducers: (builder) => {
        builder
            .addCase(fetchUserOrders.pending, (state) => {
                state.loading = true;
                state.error = null;
            })
            .addCase(fetchUserOrders.fulfilled, (state, action) => {
                state.loading = false;
                state.orders = action.payload;
            })
            .addCase(fetchUserOrders.rejected, (state, action) => {
                state.loading = false;
                state.error = action.payload || 'Failed to fetch user orders';
            })
            .addCase(fetchOrderDetails.pending, (state) => {
                state.loading = true;
                state.error = null;
            })
            .addCase(fetchOrderDetails.fulfilled, (state, action) => {
                state.loading = false;
                state.orderDetails = action.payload;
            })
            .addCase(fetchOrderDetails.rejected, (state, action) => {
                state.loading = false;
                state.error = action.payload || 'Failed to fetch order details';
            });
    },
});

export default orderSlice.reducer;

===== FILE: ./frontend/src/redux/slices/productsSlice.js =====
import { createSlice, createAsyncThunk } from '@reduxjs/toolkit';
import * as productService from '../../services/productService';

// Async thunk to fetch products by filter
export const fetchProductsByFilter = createAsyncThunk("products/fetchByFilter", async (filters) => {
    const response = await productService.getProducts(filters);
    return response;
});

// Async thunk to fetch a single product by ID
export const fetchProductById = createAsyncThunk("products/fetchProductDetails", async (id) => {
    const response = await productService.getProductById(id);
    return response;
});

// Async thunk to fetch similar products
export const fetchSimilarProducts = createAsyncThunk("products/fetchSimilarProducts", async (id) => {
    const response = await productService.getSimilarProducts(id);
    return response;
});

// Async thunk to fetch best sellers
export const fetchBestSellers = createAsyncThunk("products/fetchBestSellers", async () => {
    const response = await productService.getBestSellers();
    return response;
});

// Async thunk to fetch new arrivals
export const fetchNewArrivals = createAsyncThunk("products/fetchNewArrivals", async () => {
    const response = await productService.getNewArrivals();
    return response;
});

const productsSlice = createSlice({
    name: 'products',
    initialState: {
        products: [],
        selectedProduct: null,
        similarProducts: [],
        bestSellers: [],
        newArrivals: [],
        loading: false,
        error: null,
        filter: {
            category: null,
            size: null,
            color: null,
            gender: null,
            brand: null,
            minPrice: null,
            maxPrice: null,
            sortBy: null,
            search: null,
            material: null,
            limit: null,
            collection: null,
        },
    },
    reducers: {
        setFilter: (state, action) => {
            state.filter = { ...state.filter, ...action.payload };
        },
        clearFilter: (state) => {
            state.filter = {
                size: null,
                color: null,
                gender: null,
                brand: null,
                minPrice: null,
                maxPrice: null,
                sortBy: null,
                search: null,
                material: null,
                limit: null,
                collection: null,
            };
        }
    },
    extraReducers: (builder) => {
        builder
            // Handle fetchProductsByFilter
            .addCase(fetchProductsByFilter.pending, (state) => {
                state.loading = true;
                state.error = null;
            })
            .addCase(fetchProductsByFilter.fulfilled, (state, action) => {
                state.loading = false;
                state.products = action.payload.products || [];
            })
            .addCase(fetchProductsByFilter.rejected, (state, action) => {
                state.loading = false;
                state.error = action.error.message;
            })
            // Handle fetchProductById
            .addCase(fetchProductById.pending, (state) => {
                state.loading = true;
                state.error = null;
            })
            .addCase(fetchProductById.fulfilled, (state, action) => {
                state.loading = false;
                state.selectedProduct = action.payload;
            })
            .addCase(fetchProductById.rejected, (state, action) => {
                state.loading = false;
                state.error = action.error.message;
            })
            // Handle fetchSimilarProducts
            .addCase(fetchSimilarProducts.pending, (state) => {
                state.loading = true;
                state.error = null;
            })
            .addCase(fetchSimilarProducts.fulfilled, (state, action) => {
                state.loading = false;
                state.similarProducts = action.payload;
            })
            .addCase(fetchSimilarProducts.rejected, (state, action) => {
                state.loading = false;
                state.error = action.error.message;
            })
            // Handle fetchBestSellers
            .addCase(fetchBestSellers.pending, (state) => {
                state.loading = true;
                state.error = null;
            })
            .addCase(fetchBestSellers.fulfilled, (state, action) => {
                state.loading = false;
                state.bestSellers = action.payload;
            })
            .addCase(fetchBestSellers.rejected, (state, action) => {
                state.loading = false;
                state.error = action.error.message;
            })
            // Handle fetchNewArrivals
            .addCase(fetchNewArrivals.pending, (state) => {
                state.loading = true;
                state.error = null;
            })
            .addCase(fetchNewArrivals.fulfilled, (state, action) => {
                state.loading = false;
                state.newArrivals = action.payload;
            })
            .addCase(fetchNewArrivals.rejected, (state, action) => {
                state.loading = false;
                state.error = action.error.message;
            });
    },
});

export const { setFilter, clearFilter } = productsSlice.actions;
export default productsSlice.reducer;

===== FILE: ./frontend/src/redux/store.js =====
import { configureStore } from '@reduxjs/toolkit';
import authReducer from './slices/authSlice';
import prodcutReducer from './slices/productsSlice';
import cartReducer from './slices/cartSlice';
import checkoutReducer from './slices/checkoutSlice';
import orderReducer from './slices/orderSlice';
import adminReducer from './slices/adminSlice';
import adminProductReducer from './slices/adminProductSlice';
import adminOrderReducer from './slices/adminOrderSlice';

const store = configureStore({
    reducer: {
        auth: authReducer,
        products: prodcutReducer,
        cart: cartReducer,
        checkout: checkoutReducer,
        order: orderReducer,
        admin: adminReducer,
        adminProduct: adminProductReducer,
        adminOrder: adminOrderReducer,
    },
});

export default store;

===== FILE: ./frontend/src/services/productService.js =====
import axios from 'axios';

const API_URL = import.meta.env.VITE_API_URL || 'http://localhost:9000';

// Get all products with filters
export const getProducts = async (filters) => {
    try {
        const response = await axios.get(`${API_URL}/api/products`, { params: filters });
        return response.data;
    } catch (error) {
        throw error.response?.data || error.message;
    }
};

// Get product by ID
export const getProductById = async (id) => {
    try {
        const response = await axios.get(`${API_URL}/api/products/${id}`);
        return response.data;
    } catch (error) {
        throw error.response?.data || error.message;
    }
};

// Get similar products
export const getSimilarProducts = async (id) => {
    try {
        const response = await axios.get(`${API_URL}/api/products/similar/${id}`);
        return response.data;
    } catch (error) {
        throw error.response?.data || error.message;
    }
};

// Get best sellers
export const getBestSellers = async () => {
    try {
        const response = await axios.get(`${API_URL}/api/products/best-sellers`);
        return response.data;
    } catch (error) {
        throw error.response?.data || error.message;
    }
};

// Get new arrivals
export const getNewArrivals = async () => {
    try {
        const response = await axios.get(`${API_URL}/api/products/new-arrivals`);
        return response.data;
    } catch (error) {
        throw error.response?.data || error.message;
    }
}; 

===== FILE: ./frontend/src/utils/auth.js =====
// Utility function to get auth token from localStorage
// Checks both 'userToken' (used by authSlice) and 'token' (legacy) for compatibility
export const getAuthToken = () => {
  return localStorage.getItem("userToken") || localStorage.getItem("token");
};

// Utility function to remove auth tokens
export const removeAuthTokens = () => {
  localStorage.removeItem("userToken");
  localStorage.removeItem("token");
};

// Utility function to set auth token
export const setAuthToken = (token) => {
  localStorage.setItem("userToken", token);
};


===== FILE: ./frontend/src/utils/axiosInterceptor.js =====
// frontend/src/utils/axiosInterceptor.js
import axios from 'axios';
import store from '../redux/store';
import { logoutUser } from '../redux/slices/authSlice';
import { toast } from 'sonner';

// Setup axios interceptor
axios.interceptors.response.use(
  (response) => {
    return response;
  },
  async (error) => {
    const originalRequest = error.config;
    
    if (error.response?.status === 401) {
      const errorData = error.response.data;
      
      // N·∫øu token expired ho·∫∑c invalid th√¨ auto logout
      if (errorData?.expired || errorData?.invalid || errorData?.message === "Token expired") {
        // Prevent infinite loop
        if (!originalRequest._retry) {
          originalRequest._retry = true;
          
          // Dispatch logout
          store.dispatch(logoutUser());
          
          toast.error("Phi√™n ƒëƒÉng nh·∫≠p ƒë√£ h·∫øt h·∫°n. Vui l√≤ng ƒëƒÉng nh·∫≠p l·∫°i!");
          
          // Redirect to login
          if (typeof window !== 'undefined') {
            window.location.href = '/login';
          }
        }
      }
    }
    
    return Promise.reject(error);
  }
);

export default axios;

===== FILE: ./frontend/src/utils/bankInfo.js =====
// Th√¥ng tin ng√¢n h√†ng cho chuy·ªÉn kho·∫£n
export const BANK_INFO = {
  bankName: "MB Bank",
  accountNumber: "7318032005",
  accountName: "CONG TY THOI TRANG WUKUDADA",
  bankCode: "970422", // M√£ ng√¢n h√†ng Vietcombank cho VietQR

  // C·∫•u h√¨nh VietQR
  vietqr: {
    template: "compact2",
    baseUrl: "https://img.vietqr.io/image",
  },

  // Th√¥ng tin li√™n h·ªá
  contact: {
    hotline: "1900 1234",
    processingTime: "1-2 gi·ªù trong gi·ªù h√†nh ch√≠nh",
  },
};

// H√†m t·∫°o URL VietQR
export const generateVietQRUrl = (amount, orderCode, phone) => {
  const { bankCode, accountNumber, accountName, vietqr } = BANK_INFO;
  const transferContent = `${orderCode} ${phone}`;

  return `${vietqr.baseUrl}/${bankCode}-${accountNumber}-${
    vietqr.template
  }.png?amount=${amount}&addInfo=${encodeURIComponent(
    transferContent
  )}&accountName=${encodeURIComponent(accountName)}`;
};

// H√†m t·∫°o m√£ ƒë∆°n h√†ng
export const generateOrderCode = () => {
  return `DH${Date.now().toString().slice(-6)}`;
};

// Fallback SVG cho QR code (224x224px)
export const QR_FALLBACK_SVG =
  "data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjI0IiBoZWlnaHQ9IjIyNCIgdmlld0JveD0iMCAwIDIyNCAyMjQiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIyMjQiIGhlaWdodD0iMjI0IiBmaWxsPSIjRjNGNEY2Ii8+CjxwYXRoIGQ9Ik0xMTIgMTY4QzE0MS4wNjEgMTY4IDE2NCAxNDUuMDYxIDE2NCAxMTJDMTY0IDc4LjkzOSAxNDEuMDYxIDU2IDExMiA1NkM4Mi45MzkgNTYgNjAgNzguOTM5IDYwIDExMkM2MCAxNDUuMDYxIDgyLjkzOSAxNjggMTEyIDE2OFoiIHN0cm9rZT0iIzlDQTNBRiIgc3Ryb2tlLXdpZHRoPSIzIi8+Cjwvc3ZnPgo=";

// Ki·ªÉm tra thanh to√°n th√†nh c√¥ng t·ª´ danh s√°ch giao d·ªãch
export function checkPaymentSuccess(transactions, orderCode, amount, phone) {
  if (!Array.isArray(transactions)) return null;
  const now = new Date();
  const orderCodeNorm = orderCode.trim().toLowerCase();
  const phoneNorm = phone.replace(/\D/g, "");
  for (const tx of transactions) {
    const moTa = (tx.moTa || "").toLowerCase();
    const hasOrderCode = moTa.includes(orderCodeNorm);
    const hasPhone = moTa.includes(phoneNorm);
    const amountMatch = Math.abs(Number(tx.giaTri) - Number(amount)) <= 1000;
    const timeDiff = now - new Date(tx.ngayDienRa);
    const isRecent = timeDiff >= 0 && timeDiff <= 24 * 60 * 60 * 1000;
    // DEBUG LOG
    console.log("[checkPaymentSuccess]", {
      moTa,
      orderCodeNorm,
      phoneNorm,
      hasOrderCode,
      hasPhone,
      amount: Number(amount),
      txAmount: Number(tx.giaTri),
      amountMatch,
      txTime: tx.ngayDienRa,
      now: now.toISOString(),
      timeDiff,
      isRecent,
    });
    if (hasOrderCode && hasPhone && amountMatch && isRecent) {
      return tx;
    }
  }
  return null;
}

/**
 * G·ªçi API Google Apps Script l·∫•y 5 giao d·ªãch g·∫ßn nh·∫•t v√† ki·ªÉm tra thanh to√°n
 * @param {string} orderCode - M√£ ƒë∆°n h√†ng
 * @param {number} amount - S·ªë ti·ªÅn
 * @param {string} phone - S·ªë ƒëi·ªán tho·∫°i
 * @returns {Promise<object|null>} Object giao d·ªãch n·∫øu t√¨m th·∫•y, null n·∫øu kh√¥ng
 */
export async function fetchRecentTransactionsAndCheckPayment(
  orderCode,
  amount,
  phone
) {
  // G·ªçi API backend thay v√¨ Google Apps Script tr·ª±c ti·∫øp ƒë·ªÉ tr√°nh CORS
  const API_URL =
    "/api/payment/check?orderCode=" +
    encodeURIComponent(orderCode) +
    "&amount=" +
    encodeURIComponent(amount) +
    "&phone=" +
    encodeURIComponent(phone);
  try {
    const res = await fetch(API_URL);
    if (!res.ok)
      throw new Error("Kh√¥ng th·ªÉ l·∫•y d·ªØ li·ªáu giao d·ªãch t·ª´ API backend");
    const data = await res.json();
    // DEBUG LOG: In ra danh s√°ch giao d·ªãch l·∫•y ƒë∆∞·ª£c t·ª´ backend
    console.log(
      "[fetchRecentTransactionsAndCheckPayment] transactions:",
      data.transactions
    );
    // DEBUG LOG: In ra n·ªôi dung ƒë·ªëi chi·∫øu
    console.log("[fetchRecentTransactionsAndCheckPayment] ƒê·ªëi chi·∫øu v·ªõi:", {
      orderCode,
      amount,
      phone,
    });
    return checkPaymentSuccess(data.transactions, orderCode, amount, phone);
  } catch (err) {
    console.error("L·ªói khi ki·ªÉm tra thanh to√°n:", err);
    return {
      error: true,
      message:
        "Kh√¥ng th·ªÉ k·∫øt n·ªëi ƒë·∫øn m√°y ch·ªß x√°c th·ª±c thanh to√°n. Vui l√≤ng th·ª≠ l·∫°i sau!",
    };
  }
}


===== FILE: ./frontend/src/utils/cities.js =====
// Danh s√°ch t·ªânh/th√†nh ph·ªë Vi·ªát Nam (c√≥ th·ªÉ m·ªü r·ªông th√™m)
export const CITIES = [
  "H·ªì Ch√≠ Minh",
  "H√† N·ªôi",
  "ƒê√† N·∫µng",
  "C·∫ßn Th∆°",
  "H·∫£i Ph√≤ng",
  "An Giang",
  "B√† R·ªãa - V≈©ng T√†u",
  "B·∫Øc Giang",
  "B·∫Øc K·∫°n",
  "B·∫°c Li√™u",
  "B·∫Øc Ninh",
  "B·∫øn Tre",
  "B√¨nh ƒê·ªãnh",
  "B√¨nh D∆∞∆°ng",
  "B√¨nh Ph∆∞·ªõc",
  "B√¨nh Thu·∫≠n",
  "C√† Mau",
  "Cao B·∫±ng",
  "ƒê·∫Øk L·∫Øk",
  "ƒê·∫Øk N√¥ng",
  "ƒêi·ªán Bi√™n",
  "ƒê·ªìng Nai",
  "ƒê·ªìng Th√°p",
  "Gia Lai",
  "H√† Giang",
  "H√† Nam",
  "H√† Tƒ©nh",
  "H·∫£i D∆∞∆°ng",
  "H·∫≠u Giang",
  "Ho√† B√¨nh",
  "H∆∞ng Y√™n",
  "Kh√°nh Ho√†",
  "Ki√™n Giang",
  "Kon Tum",
  "Lai Ch√¢u",
  "L√¢m ƒê·ªìng",
  "L·∫°ng S∆°n",
  "L√†o Cai",
  "Long An",
  "Nam ƒê·ªãnh",
  "Ngh·ªá An",
  "Ninh B√¨nh",
  "Ninh Thu·∫≠n",
  "Ph√∫ Th·ªç",
  "Ph√∫ Y√™n",
  "Qu·∫£ng B√¨nh",
  "Qu·∫£ng Nam",
  "Qu·∫£ng Ng√£i",
  "Qu·∫£ng Ninh",
  "Qu·∫£ng Tr·ªã",
  "S√≥c TrƒÉng",
  "S∆°n La",
  "T√¢y Ninh",
  "Th√°i B√¨nh",
  "Th√°i Nguy√™n",
  "Thanh Ho√°",
  "Th·ª´a Thi√™n Hu·∫ø",
  "Ti·ªÅn Giang",
  "Tr√† Vinh",
  "Tuy√™n Quang",
  "Vƒ©nh Long",
  "Vƒ©nh Ph√∫c",
  "Y√™n B√°i",
];


===== FILE: ./frontend/src/utils/districts.js =====
// V√≠ d·ª• d·ªØ li·ªáu qu·∫≠n/huy·ªán cho m·ªôt s·ªë th√†nh ph·ªë l·ªõn
export const DISTRICTS = {
  "H·ªì Ch√≠ Minh": [
    "Qu·∫≠n 1",
    "Qu·∫≠n 2",
    "Qu·∫≠n 3",
    "Qu·∫≠n 4",
    "Qu·∫≠n 5",
    "Qu·∫≠n 6",
    "Qu·∫≠n 7",
    "Qu·∫≠n 8",
    "Qu·∫≠n 9",
    "Qu·∫≠n 10",
    "Qu·∫≠n 11",
    "Qu·∫≠n 12",
    "B√¨nh Th·∫°nh",
    "G√≤ V·∫•p",
    "Ph√∫ Nhu·∫≠n",
    "T√¢n B√¨nh",
    "T√¢n Ph√∫",
    "B√¨nh T√¢n",
    "Th·ªß ƒê·ª©c",
    "B√¨nh Ch√°nh",
    "C·ªß Chi",
    "H√≥c M√¥n",
    "Nh√† B√®",
    "C·∫ßn Gi·ªù",
  ],
  "H√† N·ªôi": [
    "Ba ƒê√¨nh",
    "Ho√†n Ki·∫øm",
    "T√¢y H·ªì",
    "Long Bi√™n",
    "C·∫ßu Gi·∫•y",
    "ƒê·ªëng ƒêa",
    "Hai B√† Tr∆∞ng",
    "Ho√†ng Mai",
    "Thanh Xu√¢n",
    "S√≥c S∆°n",
    "ƒê√¥ng Anh",
    "Gia L√¢m",
    "Nam T·ª´ Li√™m",
    "Thanh Tr√¨",
    "B·∫Øc T·ª´ Li√™m",
    "M√™ Linh",
    "H√† ƒê√¥ng",
    "S∆°n T√¢y",
    "Ba V√¨",
    "Ph√∫c Th·ªç",
    "ƒêan Ph∆∞·ª£ng",
    "Ho√†i ƒê·ª©c",
    "Qu·ªëc Oai",
    "Th·∫°ch Th·∫•t",
    "Ch∆∞∆°ng M·ªπ",
    "Thanh Oai",
    "Th∆∞·ªùng T√≠n",
    "Ph√∫ Xuy√™n",
    "·ª®ng H√≤a",
    "M·ªπ ƒê·ª©c",
  ],
  // ...c√≥ th·ªÉ b·ªï sung th√™m c√°c t·ªânh/th√†nh kh√°c
};


===== FILE: ./frontend/src/utils/googleAppsScript.js =====


===== FILE: ./frontend/src/utils/paymentChecker.js =====


===== FILE: ./frontend/src/utils/testPaymentChecker.js =====


===== FILE: ./frontend/src/utils/wards.js =====
// S·ª≠ d·ª•ng API https://provinces.open-api.vn/api/ ƒë·ªÉ l·∫•y d·ªØ li·ªáu ƒë·ªãa gi·ªõi h√†nh ch√≠nh ƒë·ªông
// H√†m fetch danh s√°ch t·ªânh/th√†nh ph·ªë
export async function fetchCities() {
  const res = await fetch("https://provinces.open-api.vn/api/p/");
  if (!res.ok) throw new Error("Kh√¥ng th·ªÉ l·∫•y danh s√°ch t·ªânh/th√†nh");
  return await res.json();
}

// H√†m fetch danh s√°ch qu·∫≠n/huy·ªán theo m√£ t·ªânh/th√†nh
export async function fetchDistricts(provinceCode) {
  const res = await fetch(
    `https://provinces.open-api.vn/api/p/${provinceCode}?depth=2`
  );
  if (!res.ok) throw new Error("Kh√¥ng th·ªÉ l·∫•y danh s√°ch qu·∫≠n/huy·ªán");
  const data = await res.json();
  return data.districts;
}

// H√†m fetch danh s√°ch ph∆∞·ªùng/x√£ theo m√£ qu·∫≠n/huy·ªán
export async function fetchWards(districtCode) {
  const res = await fetch(
    `https://provinces.open-api.vn/api/d/${districtCode}?depth=2`
  );
  if (!res.ok) throw new Error("Kh√¥ng th·ªÉ l·∫•y danh s√°ch ph∆∞·ªùng/x√£");
  const data = await res.json();
  return data.wards;
}


===== FILE: ./frontend/vercel.json =====
{
    "version": 2,
    "builds": [
      {
        "src": "package.json",
        "use": "@vercel/static-build",
        "config": {
          "distDir": "dist"
        }
      }
    ],
    "rewrites": [
      {
        "source": "/(.*)",
        "destination": "/"
      }
    ]
  }

===== FILE: ./tree.txt =====
.
‚îú‚îÄ‚îÄ backend
‚îÇ¬†¬† ‚îú‚îÄ‚îÄ Guide.md
‚îÇ¬†¬† ‚îú‚îÄ‚îÄ IMPORT_INSTRUCTIONS.md
‚îÇ¬†¬† ‚îú‚îÄ‚îÄ clear-products.js
‚îÇ¬†¬† ‚îú‚îÄ‚îÄ config
‚îÇ¬†¬† ‚îÇ¬†¬† ‚îú‚îÄ‚îÄ db.js
‚îÇ¬†¬† ‚îÇ¬†¬† ‚îî‚îÄ‚îÄ passport.js
‚îÇ¬†¬† ‚îú‚îÄ‚îÄ data
‚îÇ¬†¬† ‚îÇ¬†¬† ‚îú‚îÄ‚îÄ collections.js
‚îÇ¬†¬† ‚îÇ¬†¬† ‚îú‚îÄ‚îÄ dataManager.js
‚îÇ¬†¬† ‚îÇ¬†¬† ‚îú‚îÄ‚îÄ products.js
‚îÇ¬†¬† ‚îÇ¬†¬† ‚îî‚îÄ‚îÄ users.js
‚îÇ¬†¬† ‚îú‚îÄ‚îÄ debug-cart-merge.js
‚îÇ¬†¬† ‚îú‚îÄ‚îÄ env.txt
‚îÇ¬†¬† ‚îú‚îÄ‚îÄ middleware
‚îÇ¬†¬† ‚îÇ¬†¬† ‚îú‚îÄ‚îÄ authMiddleware.js
‚îÇ¬†¬† ‚îÇ¬†¬† ‚îî‚îÄ‚îÄ errorHandler.js
‚îÇ¬†¬† ‚îú‚îÄ‚îÄ models
‚îÇ¬†¬† ‚îÇ¬†¬† ‚îú‚îÄ‚îÄ Cart.js
‚îÇ¬†¬† ‚îÇ¬†¬† ‚îú‚îÄ‚îÄ Checkout.js
‚îÇ¬†¬† ‚îÇ¬†¬† ‚îú‚îÄ‚îÄ Collection.js
‚îÇ¬†¬† ‚îÇ¬†¬† ‚îú‚îÄ‚îÄ Order.js
‚îÇ¬†¬† ‚îÇ¬†¬† ‚îú‚îÄ‚îÄ Product.js
‚îÇ¬†¬† ‚îÇ¬†¬† ‚îî‚îÄ‚îÄ User.js
‚îÇ¬†¬† ‚îú‚îÄ‚îÄ routes
‚îÇ¬†¬† ‚îÇ¬†¬† ‚îú‚îÄ‚îÄ adminOrderRoutes.js
‚îÇ¬†¬† ‚îÇ¬†¬† ‚îú‚îÄ‚îÄ adminRoutes.js
‚îÇ¬†¬† ‚îÇ¬†¬† ‚îú‚îÄ‚îÄ authRoutes.js
‚îÇ¬†¬† ‚îÇ¬†¬† ‚îú‚îÄ‚îÄ cartRoutes.js
‚îÇ¬†¬† ‚îÇ¬†¬† ‚îú‚îÄ‚îÄ checkoutRoutes.js
‚îÇ¬†¬† ‚îÇ¬†¬† ‚îú‚îÄ‚îÄ collectionRoutes.js
‚îÇ¬†¬† ‚îÇ¬†¬† ‚îú‚îÄ‚îÄ orderRoutes.js
‚îÇ¬†¬† ‚îÇ¬†¬† ‚îú‚îÄ‚îÄ paymentRoutes.js
‚îÇ¬†¬† ‚îÇ¬†¬† ‚îú‚îÄ‚îÄ productAdminRoutes.js
‚îÇ¬†¬† ‚îÇ¬†¬† ‚îú‚îÄ‚îÄ productRoutes.js
‚îÇ¬†¬† ‚îÇ¬†¬† ‚îú‚îÄ‚îÄ uploadRoutes.js
‚îÇ¬†¬† ‚îÇ¬†¬† ‚îî‚îÄ‚îÄ userRoutes.js
‚îÇ¬†¬† ‚îú‚îÄ‚îÄ seeder.js
‚îÇ¬†¬† ‚îú‚îÄ‚îÄ server.js
‚îÇ¬†¬† ‚îî‚îÄ‚îÄ vercel.json
‚îú‚îÄ‚îÄ frontend
‚îÇ¬†¬† ‚îú‚îÄ‚îÄ PAYMENT_SETUP_GUIDE.md
‚îÇ¬†¬† ‚îú‚îÄ‚îÄ README.md
‚îÇ¬†¬† ‚îú‚îÄ‚îÄ env.txt
‚îÇ¬†¬† ‚îú‚îÄ‚îÄ eslint.config.js
‚îÇ¬†¬† ‚îú‚îÄ‚îÄ src
‚îÇ¬†¬† ‚îÇ¬†¬† ‚îú‚îÄ‚îÄ App.jsx
‚îÇ¬†¬† ‚îÇ¬†¬† ‚îú‚îÄ‚îÄ assets
‚îÇ¬†¬† ‚îÇ¬†¬† ‚îÇ¬†¬† ‚îî‚îÄ‚îÄ dummyData.js
‚îÇ¬†¬† ‚îÇ¬†¬† ‚îú‚îÄ‚îÄ components
‚îÇ¬†¬† ‚îÇ¬†¬† ‚îÇ¬†¬† ‚îú‚îÄ‚îÄ Admin
‚îÇ¬†¬† ‚îÇ¬†¬† ‚îÇ¬†¬† ‚îÇ¬†¬† ‚îú‚îÄ‚îÄ AdminLayout.jsx
‚îÇ¬†¬† ‚îÇ¬†¬† ‚îÇ¬†¬† ‚îÇ¬†¬† ‚îú‚îÄ‚îÄ AdminSidebar.jsx
‚îÇ¬†¬† ‚îÇ¬†¬† ‚îÇ¬†¬† ‚îÇ¬†¬† ‚îú‚îÄ‚îÄ CollectionManagement.jsx
‚îÇ¬†¬† ‚îÇ¬†¬† ‚îÇ¬†¬† ‚îÇ¬†¬† ‚îú‚îÄ‚îÄ EditCollection.jsx
‚îÇ¬†¬† ‚îÇ¬†¬† ‚îÇ¬†¬† ‚îÇ¬†¬† ‚îú‚îÄ‚îÄ EditProductPage.jsx
‚îÇ¬†¬† ‚îÇ¬†¬† ‚îÇ¬†¬† ‚îÇ¬†¬† ‚îú‚îÄ‚îÄ OrderManagement.jsx
‚îÇ¬†¬† ‚îÇ¬†¬† ‚îÇ¬†¬† ‚îÇ¬†¬† ‚îú‚îÄ‚îÄ ProductManagement.jsx
‚îÇ¬†¬† ‚îÇ¬†¬† ‚îÇ¬†¬† ‚îÇ¬†¬† ‚îî‚îÄ‚îÄ UserManagement.jsx
‚îÇ¬†¬† ‚îÇ¬†¬† ‚îÇ¬†¬† ‚îú‚îÄ‚îÄ Auth
‚îÇ¬†¬† ‚îÇ¬†¬† ‚îÇ¬†¬† ‚îÇ¬†¬† ‚îú‚îÄ‚îÄ AdminRoute.jsx
‚îÇ¬†¬† ‚îÇ¬†¬† ‚îÇ¬†¬† ‚îÇ¬†¬† ‚îú‚îÄ‚îÄ PrivateRoute.jsx
‚îÇ¬†¬† ‚îÇ¬†¬† ‚îÇ¬†¬† ‚îÇ¬†¬† ‚îî‚îÄ‚îÄ PublicOnlyRoute.jsx
‚îÇ¬†¬† ‚îÇ¬†¬† ‚îÇ¬†¬† ‚îú‚îÄ‚îÄ Cart
‚îÇ¬†¬† ‚îÇ¬†¬† ‚îÇ¬†¬† ‚îÇ¬†¬† ‚îî‚îÄ‚îÄ CartContext.jsx
‚îÇ¬†¬† ‚îÇ¬†¬† ‚îÇ¬†¬† ‚îú‚îÄ‚îÄ Common
‚îÇ¬†¬† ‚îÇ¬†¬† ‚îÇ¬†¬† ‚îÇ¬†¬† ‚îú‚îÄ‚îÄ Footer.jsx
‚îÇ¬†¬† ‚îÇ¬†¬† ‚îÇ¬†¬† ‚îÇ¬†¬† ‚îú‚îÄ‚îÄ Header.jsx
‚îÇ¬†¬† ‚îÇ¬†¬† ‚îÇ¬†¬† ‚îÇ¬†¬† ‚îú‚îÄ‚îÄ MenuSide.jsx
‚îÇ¬†¬† ‚îÇ¬†¬† ‚îÇ¬†¬† ‚îÇ¬†¬† ‚îú‚îÄ‚îÄ Navbar.jsx
‚îÇ¬†¬† ‚îÇ¬†¬† ‚îÇ¬†¬† ‚îÇ¬†¬† ‚îú‚îÄ‚îÄ Newsletter.jsx
‚îÇ¬†¬† ‚îÇ¬†¬† ‚îÇ¬†¬† ‚îÇ¬†¬† ‚îú‚îÄ‚îÄ PaymentStatus.jsx
‚îÇ¬†¬† ‚îÇ¬†¬† ‚îÇ¬†¬† ‚îÇ¬†¬† ‚îú‚îÄ‚îÄ ScrollToTop.jsx
‚îÇ¬†¬† ‚îÇ¬†¬† ‚îÇ¬†¬† ‚îÇ¬†¬† ‚îî‚îÄ‚îÄ SearchBar.jsx
‚îÇ¬†¬† ‚îÇ¬†¬† ‚îÇ¬†¬† ‚îú‚îÄ‚îÄ Layout
‚îÇ¬†¬† ‚îÇ¬†¬† ‚îÇ¬†¬† ‚îÇ¬†¬† ‚îú‚îÄ‚îÄ Hero.jsx
‚îÇ¬†¬† ‚îÇ¬†¬† ‚îÇ¬†¬† ‚îÇ¬†¬† ‚îî‚îÄ‚îÄ UserLayout.jsx
‚îÇ¬†¬† ‚îÇ¬†¬† ‚îÇ¬†¬† ‚îú‚îÄ‚îÄ Products
‚îÇ¬†¬† ‚îÇ¬†¬† ‚îÇ¬†¬† ‚îÇ¬†¬† ‚îú‚îÄ‚îÄ FeaturedCollection.jsx
‚îÇ¬†¬† ‚îÇ¬†¬† ‚îÇ¬†¬† ‚îÇ¬†¬† ‚îú‚îÄ‚îÄ FilterSidebar.jsx
‚îÇ¬†¬† ‚îÇ¬†¬† ‚îÇ¬†¬† ‚îÇ¬†¬† ‚îú‚îÄ‚îÄ ProductDetails.jsx
‚îÇ¬†¬† ‚îÇ¬†¬† ‚îÇ¬†¬† ‚îÇ¬†¬† ‚îú‚îÄ‚îÄ ProductGrid.jsx
‚îÇ¬†¬† ‚îÇ¬†¬† ‚îÇ¬†¬† ‚îÇ¬†¬† ‚îî‚îÄ‚îÄ SortOptions.jsx
‚îÇ¬†¬† ‚îÇ¬†¬† ‚îÇ¬†¬† ‚îú‚îÄ‚îÄ information
‚îÇ¬†¬† ‚îÇ¬†¬† ‚îÇ¬†¬† ‚îÇ¬†¬† ‚îú‚îÄ‚îÄ About.jsx
‚îÇ¬†¬† ‚îÇ¬†¬† ‚îÇ¬†¬† ‚îÇ¬†¬† ‚îî‚îÄ‚îÄ Sponsorship.jsx
‚îÇ¬†¬† ‚îÇ¬†¬† ‚îÇ¬†¬† ‚îî‚îÄ‚îÄ profile
‚îÇ¬†¬† ‚îÇ¬†¬† ‚îÇ¬†¬†     ‚îú‚îÄ‚îÄ MyOdersPage.jsx
‚îÇ¬†¬† ‚îÇ¬†¬† ‚îÇ¬†¬†     ‚îú‚îÄ‚îÄ OrderContext.jsx
‚îÇ¬†¬† ‚îÇ¬†¬† ‚îÇ¬†¬†     ‚îú‚îÄ‚îÄ OrderDetailPage.jsx
‚îÇ¬†¬† ‚îÇ¬†¬† ‚îÇ¬†¬†     ‚îú‚îÄ‚îÄ OrderSearch.jsx
‚îÇ¬†¬† ‚îÇ¬†¬† ‚îÇ¬†¬†     ‚îú‚îÄ‚îÄ ProfileInfo.jsx
‚îÇ¬†¬† ‚îÇ¬†¬† ‚îÇ¬†¬†     ‚îî‚îÄ‚îÄ ProfileLayout.jsx
‚îÇ¬†¬† ‚îÇ¬†¬† ‚îú‚îÄ‚îÄ hooks
‚îÇ¬†¬† ‚îÇ¬†¬† ‚îÇ¬†¬† ‚îî‚îÄ‚îÄ usePaymentChecker.js
‚îÇ¬†¬† ‚îÇ¬†¬† ‚îú‚îÄ‚îÄ main.jsx
‚îÇ¬†¬† ‚îÇ¬†¬† ‚îú‚îÄ‚îÄ pages
‚îÇ¬†¬† ‚îÇ¬†¬† ‚îÇ¬†¬† ‚îú‚îÄ‚îÄ About.jsx
‚îÇ¬†¬† ‚îÇ¬†¬† ‚îÇ¬†¬† ‚îú‚îÄ‚îÄ AdminHomePage.jsx
‚îÇ¬†¬† ‚îÇ¬†¬† ‚îÇ¬†¬† ‚îú‚îÄ‚îÄ Cart.jsx
‚îÇ¬†¬† ‚îÇ¬†¬† ‚îÇ¬†¬† ‚îú‚îÄ‚îÄ Checkout.jsx
‚îÇ¬†¬† ‚îÇ¬†¬† ‚îÇ¬†¬† ‚îú‚îÄ‚îÄ CheckoutBuyNow.jsx
‚îÇ¬†¬† ‚îÇ¬†¬† ‚îÇ¬†¬† ‚îú‚îÄ‚îÄ Collection.jsx
‚îÇ¬†¬† ‚îÇ¬†¬† ‚îÇ¬†¬† ‚îú‚îÄ‚îÄ GenderCollection.jsx
‚îÇ¬†¬† ‚îÇ¬†¬† ‚îÇ¬†¬† ‚îú‚îÄ‚îÄ GoogleCallback.jsx
‚îÇ¬†¬† ‚îÇ¬†¬† ‚îÇ¬†¬† ‚îú‚îÄ‚îÄ Home.jsx
‚îÇ¬†¬† ‚îÇ¬†¬† ‚îÇ¬†¬† ‚îú‚îÄ‚îÄ Information.jsx
‚îÇ¬†¬† ‚îÇ¬†¬† ‚îÇ¬†¬† ‚îú‚îÄ‚îÄ Login.jsx
‚îÇ¬†¬† ‚îÇ¬†¬† ‚îÇ¬†¬† ‚îú‚îÄ‚îÄ Policy.jsx
‚îÇ¬†¬† ‚îÇ¬†¬† ‚îÇ¬†¬† ‚îî‚îÄ‚îÄ Signup.jsx
‚îÇ¬†¬† ‚îÇ¬†¬† ‚îú‚îÄ‚îÄ redux
‚îÇ¬†¬† ‚îÇ¬†¬† ‚îÇ¬†¬† ‚îú‚îÄ‚îÄ slices
‚îÇ¬†¬† ‚îÇ¬†¬† ‚îÇ¬†¬† ‚îÇ¬†¬† ‚îú‚îÄ‚îÄ adminOrderSlice.js
‚îÇ¬†¬† ‚îÇ¬†¬† ‚îÇ¬†¬† ‚îÇ¬†¬† ‚îú‚îÄ‚îÄ adminProductSlice.js
‚îÇ¬†¬† ‚îÇ¬†¬† ‚îÇ¬†¬† ‚îÇ¬†¬† ‚îú‚îÄ‚îÄ adminSlice.js
‚îÇ¬†¬† ‚îÇ¬†¬† ‚îÇ¬†¬† ‚îÇ¬†¬† ‚îú‚îÄ‚îÄ authSlice.js
‚îÇ¬†¬† ‚îÇ¬†¬† ‚îÇ¬†¬† ‚îÇ¬†¬† ‚îú‚îÄ‚îÄ cartSlice.js
‚îÇ¬†¬† ‚îÇ¬†¬† ‚îÇ¬†¬† ‚îÇ¬†¬† ‚îú‚îÄ‚îÄ checkoutSlice.js
‚îÇ¬†¬† ‚îÇ¬†¬† ‚îÇ¬†¬† ‚îÇ¬†¬† ‚îú‚îÄ‚îÄ orderSlice.js
‚îÇ¬†¬† ‚îÇ¬†¬† ‚îÇ¬†¬† ‚îÇ¬†¬† ‚îî‚îÄ‚îÄ productsSlice.js
‚îÇ¬†¬† ‚îÇ¬†¬† ‚îÇ¬†¬† ‚îî‚îÄ‚îÄ store.js
‚îÇ¬†¬† ‚îÇ¬†¬† ‚îú‚îÄ‚îÄ services
‚îÇ¬†¬† ‚îÇ¬†¬† ‚îÇ¬†¬† ‚îî‚îÄ‚îÄ productService.js
‚îÇ¬†¬† ‚îÇ¬†¬† ‚îî‚îÄ‚îÄ utils
‚îÇ¬†¬† ‚îÇ¬†¬†     ‚îú‚îÄ‚îÄ auth.js
‚îÇ¬†¬† ‚îÇ¬†¬†     ‚îú‚îÄ‚îÄ axiosInterceptor.js
‚îÇ¬†¬† ‚îÇ¬†¬†     ‚îú‚îÄ‚îÄ bankInfo.js
‚îÇ¬†¬† ‚îÇ¬†¬†     ‚îú‚îÄ‚îÄ cities.js
‚îÇ¬†¬† ‚îÇ¬†¬†     ‚îú‚îÄ‚îÄ districts.js
‚îÇ¬†¬† ‚îÇ¬†¬†     ‚îú‚îÄ‚îÄ googleAppsScript.js
‚îÇ¬†¬† ‚îÇ¬†¬†     ‚îú‚îÄ‚îÄ paymentChecker.js
‚îÇ¬†¬† ‚îÇ¬†¬†     ‚îú‚îÄ‚îÄ testPaymentChecker.js
‚îÇ¬†¬† ‚îÇ¬†¬†     ‚îî‚îÄ‚îÄ wards.js
‚îÇ¬†¬† ‚îî‚îÄ‚îÄ vercel.json
‚îî‚îÄ‚îÄ tree.txt
25 directories, 111 files

